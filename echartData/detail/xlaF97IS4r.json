{"status":0,"data":{"cid":"xlaF97IS4r","authorUid":"obd-oN6D3qfp-72Q3GmepBJ4XZpEj5XIyCI","authorUserName":"b***n","title":"双轴水平堆栈柱状图","description":"双轴水平堆栈柱状图","latestVersion":5,"alwaysLatest":1,"createTime":"2020-09-23T01:04:20.000Z","lastUpdateTime":"2020-09-23T01:04:20.000Z","auth":2,"uid":"obd-oN6D3qfp-72Q3GmepBJ4XZpEj5XIyCI","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"4.8.0","versionCreateTime":"2020-09-23T09:48:38.000Z","code":"let yAxisData = [];\r\nlet legendList = [{\r\n        name: \"农、林、牧、渔业\",\r\n        color: \"#5B90FA\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n    {\r\n        name: \"文化旅游业\",\r\n        color: \"#5AD9A6\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n    {\r\n        name: \"工业\",\r\n        color: \"#F6BD16\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n    {\r\n        name: \"房地产业\",\r\n        color: \"#945FB9\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n    {\r\n        name: \"商业\",\r\n        color: \"#1E9593\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n    {\r\n        name: \"服务业\",\r\n        color: \"#FF98C3\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n    {\r\n        name: \"其他\",\r\n        color: \"#BCDEDF\",\r\n        leftList: [],\r\n        rightList: [],\r\n    },\r\n];\r\nlet listAry = [{\r\n        \"NF\": \"2019\",\r\n        \"DATA\": [{\r\n            \"CZID\": \"1\",\r\n            \"CZMC\": \"左半部分\",\r\n            \"DATA\": [{\r\n                \"CZID\": \"1\",\r\n                \"NF\": \"2019\",\r\n                \"NLMY\": 14493.0,\r\n                \"WHLYY\": 26179.0,\r\n                \"GYSR\": 253030.0,\r\n                \"FDCY\": 63925.0,\r\n                \"SYSR\": 45541.0,\r\n                \"FWYSR\": 49322.0,\r\n                \"QTSR\": 155505.0\r\n            }]\r\n        }]\r\n    },\r\n    {\r\n        \"NF\": \"2018\",\r\n        \"DATA\": [{\r\n            \"CZID\": \"2\",\r\n            \"CZMC\": \"右半部分\",\r\n            \"DATA\": [{\r\n                \"CZID\": \"2\",\r\n                \"NF\": \"2018\",\r\n                \"NLMY\": 0.0,\r\n                \"WHLYY\": 0.0,\r\n                \"GYSR\": 2064514.0,\r\n                \"FDCY\": 0.0,\r\n                \"SYSR\": 0.0,\r\n                \"FWYSR\": 0.0,\r\n                \"QTSR\": 0.0\r\n            }]\r\n        }]\r\n    }\r\n]\r\n\r\nlistAry.map((item) => {\r\n    yAxisData.push(item.NF);\r\n    // 获取列数据\r\n    legendList.map((itemInner, indexInner) => {\r\n        switch (indexInner) {\r\n            case 0:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"左半部分\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].NLMY);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].NLMY);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].NLMY);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].NLMY);\r\n                }\r\n                break;\r\n            case 1:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"左半部分\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].WHLYY);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].WHLYY);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].WHLYY);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].WHLYY);\r\n                }\r\n                break;\r\n            case 2:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"左半部分\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].GYSR);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].GYSR);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].GYSR);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].GYSR);\r\n                }\r\n                break;\r\n            case 3:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"左半部分\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].FDCY);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].FDCY);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].FDCY);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].FDCY);\r\n                }\r\n                break;\r\n            case 4:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"左半部分\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].SYSR);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].SYSR);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].SYSR);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].SYSR);\r\n                }\r\n                break;\r\n            case 5:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"左半部分\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].FWYSR);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].FWYSR);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].FWYSR);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].FWYSR);\r\n                }\r\n                break;\r\n            case 6:\r\n                if (item.DATA.length == 1) {\r\n                    if (item.DATA[0].CZMC == \"良渚街道\") {\r\n                        itemInner.leftList.push(item.DATA[0].DATA[0].QTSR);\r\n                        itemInner.rightList.push(0);\r\n                    } else {\r\n                        itemInner.leftList.push(0);\r\n                        itemInner.rightList.push(item.DATA[0].DATA[0].QTSR);\r\n                    }\r\n                } else {\r\n                    itemInner.leftList.push(item.DATA[0].DATA[0].QTSR);\r\n                    itemInner.rightList.push(item.DATA[1].DATA[0].QTSR);\r\n                }\r\n                break;\r\n        }\r\n    });\r\n});\r\nlet maxNum = 0; //  计算出 每一行的 和的最大值\r\nlet sumList = [];\r\n// 计算出 每一行的 和\r\nlistAry.map((item) => {\r\n    item.DATA.map((itemInner) => {\r\n        let obj = itemInner.DATA[0];\r\n        let sum =\r\n            obj.FDCY + obj.GYSR + obj.NLMY + obj.QTSR + obj.SYSR + obj.WHLYY;\r\n        itemInner.total = sum;\r\n        sumList.push(sum);\r\n    });\r\n});\r\nmaxNum = Math.max(...sumList) + 200;\r\nlet bgLeft = [{\r\n    name: \"进度条背景\",\r\n    type: \"bar\",\r\n    stack: \"1\",\r\n    data: [],\r\n    barWidth: 25,\r\n    barGap: \"-100%\",\r\n    itemStyle: {\r\n        color: \"#0b2940\",\r\n    },\r\n}, ];\r\nlet bgRight = [{\r\n    name: \"进度条背景\",\r\n    type: \"bar\",\r\n    stack: \"2\",\r\n    xAxisIndex: 2,\r\n    yAxisIndex: 2,\r\n    data: [],\r\n    barWidth: 25,\r\n    barGap: \"-100%\",\r\n    itemStyle: {\r\n        color: \"#0b2940\",\r\n    },\r\n}, ];\r\n// 将每一行的放到数组\r\nlet totalList = [];\r\nyAxisData.map((item) => {\r\n    let obj = {\r\n        leftTotal: 0,\r\n        rightTotal: 0,\r\n    };\r\n    totalList.push(obj);\r\n});\r\nlistAry.map((item, index) => {\r\n    if (item.DATA.length == 1) {\r\n        if (item.DATA[0].CZMC == \"左半部分\") {\r\n            totalList[index].leftTotal = item.DATA[0].total;\r\n            totalList[index].rightTotal = 0;\r\n        } else {\r\n            totalList[index].leftTotal = 0;\r\n            totalList[index].rightTotal = item.DATA[0].total;\r\n        }\r\n    } else {\r\n        totalList[index].leftTotal = item.DATA[0].total;\r\n        totalList[index].rightTotal = item.DATA[1].total;\r\n    }\r\n});\r\ntotalList.map((item) => {\r\n    bgLeft[0].data.push(maxNum - item.leftTotal);\r\n    bgRight[0].data.push(maxNum - item.rightTotal);\r\n});\r\n\r\nlet legend = [];\r\nlet seriesData = [];\r\nlet seriesDataLeft = [];\r\nlet seriesDataRight = [];\r\n// 拼凑数据\r\nlegendList.map((item) => {\r\n    legend.push(item.name);\r\n    let objLeft = {\r\n        name: item.name,\r\n        type: \"bar\",\r\n        barWidth: 25,\r\n        stack: \"1\",\r\n        itemStyle: {\r\n            normal: {\r\n                color: item.color,\r\n            },\r\n        },\r\n        label: {\r\n            normal: {\r\n                show: false,\r\n            },\r\n        },\r\n        data: item.leftList,\r\n    };\r\n    let objRight = {\r\n        name: item.name,\r\n        type: \"bar\",\r\n        xAxisIndex: 2,\r\n        yAxisIndex: 2,\r\n        barWidth: 25,\r\n        stack: \"2\",\r\n        z: 100,\r\n        itemStyle: {\r\n            normal: {\r\n                color: item.color,\r\n            },\r\n        },\r\n        data: item.rightList,\r\n    };\r\n    seriesDataLeft.push(objLeft);\r\n    seriesDataRight.push(objRight);\r\n});\r\n\r\nseriesData = [\r\n    ...seriesDataLeft,\r\n    ...bgLeft,\r\n    ...seriesDataRight,\r\n    ...bgRight,\r\n];\r\nlet textColor = \"#fff\";\r\nlet lineColor = \"rgba(255,255,255,0.2)\";\r\n\r\nvar option = {\r\n    baseOption: {\r\n        backgroundColor:\"#999\",\r\n        timeline: {\r\n            show: false,\r\n            top: 0,\r\n            data: [],\r\n        },\r\n        tooltip: {\r\n            trigger: \"axis\",\r\n            axisPointer: {\r\n                type: \"none\",\r\n            },\r\n            textStyle: {\r\n                align: \"left\",\r\n            },\r\n            formatter: (params) => {\r\n                let str = `${params[0].name}<br/>`;\r\n                params.map((item, index) => {\r\n                    if (item.seriesName != \"进度条背景\") {\r\n                        str += `${item.marker}${item.seriesName}${item.value}<br/>`;\r\n                    }\r\n                });\r\n                return str;\r\n            },\r\n        },\r\n        title: {\r\n            text: \"\",\r\n            left: \"center\",\r\n            color: \"green\",\r\n        },\r\n        legend: {\r\n            top: \"5%\",\r\n            right: \"5%\",\r\n            itemWidth: 80,\r\n            itemHeight: 5,\r\n            itemGap: 30,\r\n            icon: \"horizontal\",\r\n            textStyle: {\r\n                color: \"#ffffff\",\r\n                fontSize: 16,\r\n            },\r\n            data: legend,\r\n        },\r\n        grid: [{\r\n                show: false,\r\n                left: \"5%\",\r\n                top: \"20%\",\r\n                bottom: \"8%\",\r\n                containLabel: true,\r\n                width: \"37%\",\r\n            },\r\n            {\r\n                show: false,\r\n                left: \"51%\",\r\n                top: \"20%\",\r\n                bottom: \"8%\",\r\n                width: \"0%\",\r\n            },\r\n            {\r\n                show: false,\r\n                right: \"2%\",\r\n                top: \"20%\",\r\n                bottom: \"8%\",\r\n                containLabel: true,\r\n                width: \"37%\",\r\n            },\r\n        ],\r\n        xAxis: [{\r\n                type: \"value\",\r\n                inverse: true,\r\n                axisLine: {\r\n                    show: false,\r\n                },\r\n                axisTick: {\r\n                    show: false,\r\n                },\r\n                position: \"top\",\r\n                axisLabel: {\r\n                    show: false,\r\n                    color: textColor,\r\n                },\r\n                splitLine: {\r\n                    show: false,\r\n                    lineStyle: {\r\n                        color: lineColor,\r\n                    },\r\n                },\r\n            },\r\n            {\r\n                gridIndex: 1,\r\n                show: false,\r\n            },\r\n            {\r\n                gridIndex: 2,\r\n                axisLine: {\r\n                    show: false,\r\n                },\r\n                axisTick: {\r\n                    show: false,\r\n                },\r\n                position: \"top\",\r\n                axisLabel: {\r\n                    show: false,\r\n                    color: textColor,\r\n                },\r\n                splitLine: {\r\n                    show: false,\r\n                    lineStyle: {\r\n                        color: lineColor,\r\n                    },\r\n                },\r\n            },\r\n        ],\r\n        yAxis: [{\r\n                type: \"category\",\r\n                inverse: true,\r\n                position: \"right\",\r\n                axisLine: {\r\n                    show: false,\r\n                    lineStyle: {\r\n                        color: lineColor,\r\n                    },\r\n                },\r\n\r\n                axisTick: {\r\n                    show: false,\r\n                },\r\n                axisLabel: {\r\n                    show: false,\r\n                },\r\n                data: yAxisData,\r\n            },\r\n            {\r\n                gridIndex: 1,\r\n                type: \"category\",\r\n                inverse: true,\r\n                position: \"left\",\r\n                axisLine: {\r\n                    show: false,\r\n                },\r\n                axisTick: {\r\n                    show: false,\r\n                },\r\n                axisLabel: {\r\n                    show: true,\r\n                    padding: [0, 0, 0, 0],\r\n                    textStyle: {\r\n                        color: \"#ffffff\",\r\n                        fontSize: 20,\r\n                    },\r\n                    align: \"center\",\r\n                },\r\n                data: yAxisData.map(function(value) {\r\n                    return {\r\n                        value: value,\r\n                        textStyle: {\r\n                            align: \"center\",\r\n                        },\r\n                    };\r\n                }),\r\n            },\r\n            {\r\n                gridIndex: 2,\r\n                type: \"category\",\r\n                inverse: true,\r\n                position: \"left\",\r\n                axisLine: {\r\n                    show: false,\r\n                    lineStyle: {\r\n                        color: lineColor,\r\n                    },\r\n                },\r\n                axisTick: {\r\n                    show: false,\r\n                },\r\n                axisLabel: {\r\n                    show: false,\r\n                },\r\n                data: yAxisData,\r\n            },\r\n        ],\r\n        series: [],\r\n    },\r\n    options: [{\r\n        series: seriesData,\r\n    }, ],\r\n};","html":"","externalScripts":"","updaterUID":"obd-oN6D3qfp-72Q3GmepBJ4XZpEj5XIyCI","theme":"","layout":"","viewCount":68,"userName":"b***n","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xlaF97IS4r.png?v=1600854518726","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","timeline","title","tooltip"],"customTags":[],"updaterUserName":"b***n"}}