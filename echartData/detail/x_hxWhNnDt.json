{"status":0,"data":{"cid":"x_hxWhNnDt","authorUid":"bd-2686412061","authorUserName":"dengshao2011","title":"树图tree","description":"可根据所有层级的节点最多的层级的节点和总层级数，自动缩小放大图表容器","latestVersion":1,"alwaysLatest":1,"createTime":"2019-06-12T10:10:19.000Z","lastUpdateTime":"2019-06-12T10:10:19.000Z","auth":2,"uid":"bd-2686412061","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2019-06-12T10:10:19.000Z","code":"// 把数组整理成树形结构\n\t\t\tfunction toTreeData(data) {\n\t\t\t\tconst cloneData = JSON.parse(JSON.stringify(data)); // 对源数据深度克隆\n\t\t\t\tconst tree = cloneData.filter(father => {\n\t\t\t\t\t// 循环所有项\n\t\t\t\t\tconst branchArr = cloneData.filter(\n\t\t\t\t\t\tchild => father.tenantId === child.parentTenantId\n\t\t\t\t\t); // 返回每一项的子级数组\n\t\t\t\t\tif (branchArr.length > 0) {\n\t\t\t\t\t\tfather.children = branchArr; // 如果存在子级，则给父级添加一个children属性，并赋值\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfather.label = {\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\tposition: 'insideTop',\n\t\t\t\t\t\t\tdistance: 0,\n\t\t\t\t\t\t\tverticalAlign: 'top',\n\t\t\t\t\t\t\talign: 'center',\n\t\t\t\t\t\t\tbackgroundColor: '#f3c36b',\n\t\t\t\t\t\t\tfontSize: 14,\n\t\t\t\t\t\t\tpadding: [4, 10],\n\t\t\t\t\t\t\tborderRadius: 4,\n\t\t\t\t\t\t\tformatter: params => {\n\t\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\t\ttenantName,\n\t\t\t\t\t\t\t\t\ttenantCreditCode,\n\t\t\t\t\t\t\t\t} = params.data;\n\t\t\t\t\t\t\t\treturn `{name|${tenantName}}\\n{code|${tenantCreditCode}}`;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trich: {\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\theight: 22,\n\t\t\t\t\t\t\t\t\tfontWeight: 'bold',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcode: {\n\t\t\t\t\t\t\t\t\theight: 18,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!father.parentTenantId || father.parentTenantId === ''\n\t\t\t\t\t); // 返回第一层\n\t\t\t\t});\n\t\t\t\treturn tree; // 返回树形数据\n\t\t\t}\n\t\t\t// 获取所有层级中节点数最大的层级的节点数(tempNodeNum)，总层数(tempclassesNum)\n\t\t\tfunction treeDataProcess(data) {\n\t\t\t\tlet tempNodeNum = 0;\n\t\t\t\tlet tempclassesNum = 0;\n\t\t\t\tif (data.children) {\n\t\t\t\t\ttempNodeNum = data.children.length; // 第二层,四，六,...\n\t\t\t\t\tconst len = data.children.length;\n\t\t\t\t\ttempclassesNum += 1; // 2\n\t\t\t\t\t// let classesComputeEnable = true;\n\t\t\t\t\tlet perNodeNum = 0; // 3\n\t\t\t\t\tlet arr = [];\n\t\t\t\t\tfor (let i = 0; i < len; i += 1) {\n\t\t\t\t\t\tif (data.children[i].children) {\n\t\t\t\t\t\t\t// if (classesComputeEnable) {\n\t\t\t\t\t\t\t// \ttempclassesNum += 1;\n\t\t\t\t\t\t\t// \tclassesComputeEnable = false;\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\tperNodeNum += data.children[i].children.length; // 第三层,五，七，...\n\t\t\t\t\t\t\tarr.push(treeDataProcess(data.children[i])); // {1,3}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttempNodeNum = Math.max(perNodeNum, tempNodeNum);\n\t\t\t\t\tlet arrLen = arr.length;\n\t\t\t\t\tlet maxClassesNum =\n\t\t\t\t\t\tarr.length > 0 ? arr[0].tempclassesNum : 0;\n\t\t\t\t\tlet maxNodeNum = arr.length > 0 ? arr[0].tempNodeNum : 0;\n\t\t\t\t\tfor (let i = 1; i < arrLen; i += 1) {\n\t\t\t\t\t\tif (maxNodeNum < arr[i].tempNodeNum) {\n\t\t\t\t\t\t\tmaxNodeNum = arr[i].tempNodeNum;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (maxClassesNum < arr[i].tempclassesNum) {\n\t\t\t\t\t\t\tmaxClassesNum = arr[i].tempclassesNum;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttempNodeNum = Math.max(maxNodeNum, tempNodeNum);\n\t\t\t\t\ttempclassesNum = tempclassesNum + maxClassesNum;\n\t\t\t\t}\n\t\t\t\t// tempNodeNum：每层最大的节点数，tempclassesNum：总层数\n\t\t\t\treturn { tempNodeNum, tempclassesNum };\n\t\t\t}\n\t\t\tvar data = [\n\t\t\t\t{\n\t\t\t\t\ttenantName: '企业A',\n\t\t\t\t\tnetId: 'n1111',\n\t\t\t\t\ttenantId: 't1111',\n\t\t\t\t\ttenantLevel: '0',\n\t\t\t\t\ttenantCreditCode: 'tcc1111',\n\t\t\t\t\tid: '1111',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tparentTenantId: 't1111',\n\t\t\t\t\ttenantName: '企业B1',\n\t\t\t\t\tnetId: 'n1111',\n\t\t\t\t\ttenantId: 't1112',\n\t\t\t\t\ttenantLevel: '1',\n\t\t\t\t\ttenantCreditCode: 'tcc1112',\n\t\t\t\t\tid: '1112',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tparentTenantId: 't1111',\n\t\t\t\t\ttenantName: '企业B2',\n\t\t\t\t\tnetId: 'n1111',\n\t\t\t\t\ttenantId: 't1113',\n\t\t\t\t\ttenantLevel: '1',\n\t\t\t\t\ttenantCreditCode: 'tcc1113',\n\t\t\t\t\tid: '1113',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tparentTenantId: 't1112',\n\t\t\t\t\ttenantName: '企业C',\n\t\t\t\t\tnetId: 'n1111',\n\t\t\t\t\ttenantId: 't1114',\n\t\t\t\t\ttenantLevel: '2',\n\t\t\t\t\ttenantCreditCode: 'tcc1114',\n\t\t\t\t\tid: '1114',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tparentTenantId: 't1114',\n\t\t\t\t\ttenantName: '企业D',\n\t\t\t\t\tnetId: 'n1111',\n\t\t\t\t\ttenantId: 't1115',\n\t\t\t\t\ttenantLevel: '3',\n\t\t\t\t\ttenantCreditCode: 'tcc1115',\n\t\t\t\t\tid: '1115',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tvar container = document.getElementById('testEchart');\n\t\t\tcontainer.addEventListener('click', e => {\n\t\t\t\t// // console.log('mainE-e', e);\n\t\t\t\tconst targetE = e.target;\n\t\t\t\tif (targetE.hasAttribute('data-btn')) {\n\t\t\t\t\tconst type = targetE.getAttribute('data-btn');\n\t\t\t\t\tconst netId = targetE.getAttribute('data-netId');\n\t\t\t\t\tconst tenantLevel = targetE.getAttribute(\n\t\t\t\t\t\t'data-tenantLevel'\n\t\t\t\t\t);\n\t\t\t\t\tconst tenantId = targetE.getAttribute('data-tenantId');\n\t\t\t\t\tconst tenantName = targetE.getAttribute('data-tenantName');\n\t\t\t\t\tconst memberId = targetE.getAttribute('data-id');\n\t\t\t\t\tconst param = {\n\t\t\t\t\t\tnetId,\n\t\t\t\t\t\ttenantId,\n\t\t\t\t\t\ttenantLevel,\n\t\t\t\t\t\ttenantName,\n\t\t\t\t\t\t// tenantCreditCode,\n\t\t\t\t\t\tid: memberId,\n\t\t\t\t\t\t// children,\n\t\t\t\t\t};\n\t\t\t\t\talert('tenantName=' + tenantName);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// 设置echart容器的宽高\n\t\t\tfunction setEchartWH(treeData, dom) {\n\t\t\t\tconst treeInfo = treeDataProcess(treeData);\n\t\t\t\t// console.log('treeInfo', treeInfo);\n\t\t\t\t// console.log('innerWidth', dom.innerWidth);\n\t\t\t\tconst computedW = treeInfo.tempNodeNum * 180;\n\t\t\t\tconst computedH = (treeInfo.tempclassesNum + 1) * 100;\n\t\t\t\tlet isUpdate = false;\n\t\t\t\tif (computedW > 800) {\n\t\t\t\t\tdom.style.width = `${computedW}px`;\n\t\t\t\t\tisUpdate = true;\n\t\t\t\t}\n\t\t\t\tif (computedH > 400) {\n\t\t\t\t\tdom.style.height = `${computedH}px`;\n\t\t\t\t\tisUpdate = true;\n\t\t\t\t}\n\t\t\t\treturn isUpdate;\n\t\t\t}\n\t\t\t// 生成echarts图\n\t\t\tfunction testEcharts(data) {\n\t\t\t\tconst chainClassChart = echarts.init(container);\n\t\t\t\tlet treeData = [];\n\t\t\t\tif (data.length === 1) {\n\t\t\t\t\ttreeData = data;\n\t\t\t\t} else {\n\t\t\t\t\ttreeData = this.toTreeData(data);\n\t\t\t\t}\n\t\t\t\tif (setEchartWH(treeData[0], container)) {\n\t\t\t\t\tchainClassChart.resize();\n\t\t\t\t}\n\t\t\t\t// updateData({operationDa.ta: treeData});\n\t\t\t\tif (treeData[0]) {\n\t\t\t\t\ttreeData[0].label = {\n\t\t\t\t\t\tnormal: {\n\t\t\t\t\t\t\tposition: 'insideTop',\n\t\t\t\t\t\t\tdistance: 0,\n\t\t\t\t\t\t\tverticalAlign: 'top',\n\t\t\t\t\t\t\talign: 'center',\n\t\t\t\t\t\t\tbackgroundColor: '#e69103',\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t// console.log('treeData', JSON.stringify(treeData), data);\n\t\t\t\tchainClassChart.setOption({\n\t\t\t\t\ttooltip: {\n\t\t\t\t\t\ttrigger: 'item',\n\t\t\t\t\t\ttriggerOn: 'mousemove',\n\t\t\t\t\t\tshowContent: true,\n\t\t\t\t\t\tenterable: true,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\tformatter: params => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\tnetId,\n\t\t\t\t\t\t\t\ttenantId,\n\t\t\t\t\t\t\t\ttenantLevel,\n\t\t\t\t\t\t\t\ttenantName,\n\t\t\t\t\t\t\t\t// tenantCreditCode,\n\t\t\t\t\t\t\t\tchildren,\n\t\t\t\t\t\t\t} = params.data;\n\t\t\t\t\t\t\t// {\"tenantName\":\"上海海澜之家服装有限公司\",\"netId\":\"ca62969ac6184e8bbe899db9b1508cc9\",\"tenantId\":\"d0000009b4943a78fcf36faba1e7ae5\",\"tenantLevel\":\"0\",\n\t\t\t\t\t\t\t// \"tenantCreditCode\":\"39030120312264363B\",\"id\":\"ff78b341a2fd451cb4e0ded68dde7105\",\"name\":\"上海海澜之家服装有限公司\\n39030120312264363B\"}\n\t\t\t\t\t\t\tlet htmlStr = '<div class=\"toolTipBox\">';\n\t\t\t\t\t\t\tconst domAttribute = `data-netId=\"${netId}\" data-tenantName=\"${tenantName}\" data-id=\"${\n\t\t\t\t\t\t\t\tparams.data.id\n\t\t\t\t\t\t\t}\" data-tenantLevel=\"${tenantLevel}\" data-tenantId=\"${tenantId}\"`;\n\t\t\t\t\t\t\tif (tenantLevel === '0') {\n\t\t\t\t\t\t\t\thtmlStr += `<span ${domAttribute} data-btn=\"add\">新增</span>`;\n\t\t\t\t\t\t\t} else if (children) {\n\t\t\t\t\t\t\t\thtmlStr += `<span ${domAttribute} data-btn=\"add\">新增</span><span ${domAttribute} data-btn=\"view\">查看</span>`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\thtmlStr += `<span ${domAttribute} data-btn=\"add\">新增</span><span ${domAttribute} data-btn=\"view\">查看</span><span ${domAttribute} data-btn=\"edit\">修改</span><span ${domAttribute} data-btn=\"delete\">删除</span>`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn `${htmlStr}</div>`;\n\t\t\t\t\t\t},\n\t\t\t\t\t\textraCssText: 'z-index:999;',\n\t\t\t\t\t},\n\t\t\t\t\tseries: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'tree',\n\t\t\t\t\t\t\tdata: treeData,\n\t\t\t\t\t\t\tname: '产业链层级',\n\t\t\t\t\t\t\tleft: '2%',\n\t\t\t\t\t\t\tright: '2%',\n\t\t\t\t\t\t\ttop: '20px',\n\t\t\t\t\t\t\tbottom: '20px',\n\t\t\t\t\t\t\torient: 'vertical',\n\t\t\t\t\t\t\t// symbolSize: [220, 60],\n\t\t\t\t\t\t\tsymbolSize: [100, 46],\n\t\t\t\t\t\t\tsymbol: 'rect',\n\t\t\t\t\t\t\troam: false, // 开启缩放和移动。scale，缩放。move，移动。\n\t\t\t\t\t\t\tinitialTreeDepth: 8,\n\t\t\t\t\t\t\texpandAndCollapse: true,\n\t\t\t\t\t\t\titemStyle: {\n\t\t\t\t\t\t\t\t// 设置边框的属性\n\t\t\t\t\t\t\t\tnormal: {\n\t\t\t\t\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\t\t\t\t\tborderWidth: 0,\n\t\t\t\t\t\t\t\t\t// opacity: 0,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\tnormal: {\n\t\t\t\t\t\t\t\t\t// position: 'center',\n\t\t\t\t\t\t\t\t\tposition: 'insideTop',\n\t\t\t\t\t\t\t\t\tdistance: 0,\n\t\t\t\t\t\t\t\t\tverticalAlign: 'top',\n\t\t\t\t\t\t\t\t\talign: 'center',\n\t\t\t\t\t\t\t\t\tbackgroundColor: '#ffa500',\n\t\t\t\t\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\t\t\t\t\tfontSize: 14,\n\t\t\t\t\t\t\t\t\tpadding: [4, 10],\n\t\t\t\t\t\t\t\t\tborderRadius: 4,\n\t\t\t\t\t\t\t\t\tborderColor: '#fff',\n\t\t\t\t\t\t\t\t\tborderWidth: 1,\n\t\t\t\t\t\t\t\t\tformatter: params => {\n\t\t\t\t\t\t\t\t\t\t// console.log('params', params);\n\t\t\t\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\t\t\t\ttenantName,\n\t\t\t\t\t\t\t\t\t\t\ttenantCreditCode,\n\t\t\t\t\t\t\t\t\t\t} = params.data;\n\t\t\t\t\t\t\t\t\t\treturn `{name|${tenantName}}\\n{code|${tenantCreditCode}}`;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trich: {\n\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\theight: 22,\n\t\t\t\t\t\t\t\t\t\t\tfontWeight: 'bold',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcode: {\n\t\t\t\t\t\t\t\t\t\t\theight: 18,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlineStyle: {\n\t\t\t\t\t\t\t\t// 连线颜色\n\t\t\t\t\t\t\t\tnormal: {\n\t\t\t\t\t\t\t\t\tcolor: '#ccc',\n\t\t\t\t\t\t\t\t\twidth: 1.5,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tanimationDuration: 550,\n\t\t\t\t\t\t\tanimationDurationUpdate: 750,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttestEcharts(data);","html":"","externalScripts":"","updaterUID":"bd-2686412061","theme":"","layout":"","viewCount":787,"userName":"dengshao2011","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x_hxWhNnDt.png?v=1560334219383","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-line","title"],"customTags":["tree","树图"],"updaterUserName":"dengshao2011"}}