{"status":0,"data":{"cid":"xryKWKNVGb","authorUid":"bd-167860219","authorUserName":"n***1","title":"公交线路客流可视化","description":"深圳某公交线路客流可视化","latestVersion":29,"alwaysLatest":1,"createTime":"2017-06-06T14:15:29.000Z","lastUpdateTime":"2021-08-01T03:24:56.000Z","auth":2,"uid":"bd-167860219","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":29,"parentVersion":28,"echartsVersion":"4.9.0","versionCreateTime":"2021-08-01T03:24:56.000Z","code":"//关于这个图表我做的视频简介：https://www.bilibili.com/video/BV1pD4y127tW\n//各位观众老爷们一键三连，下次一定！\n\nvar uploadedDataURL = \"/asset/get/s/data-1497613978134-ByGiUH-m-.json\";\n\n\nvar t_pos = {\n    left: 0,\n    top: 0\n}\n\nvar last_point = [0, 0];\nvar counter = 0;\nmyChart.showLoading();\nvar planePath = 'path://M268.601,18.375c0,0,14.496,0,18.005,0 \t\t\\\nc31.325,0,59.155,0,59.155,0c6.701,0,12.14,5.238,12.14,11.695v17.872c-24.507,0-44.374,19.859-44.374,44.351 \t\t\\\nc0,24.492,19.86,44.351,44.374,44.351V335.99c-24.507,0.006-44.374,19.857-44.374,44.357c0,24.484,19.86,44.344,44.374,44.352 \t\t\\\nv25.26c0,6.457-5.431,11.695-12.14,11.695H200.158c-12.013,0-19.527-7.781-19.527-19.084c0,0,0-351.215,0-365.378 \t\t\\\ns18.736-42.622,44.1-53.734C238.303,17.658,268.601,18.375,268.601,18.375z M202.818,387.729v39.918 \t\t\\\nc0,6.531,5.29,11.828,11.821,11.828h35.426c6.531,0,11.814-5.297,11.814-11.828v-39.918H202.818z M202.818,321.199v51.746h59.053 \t\t\\\nv-51.746H202.818z M202.818,254.904v51.518h59.053v-51.518H202.818z M202.818,188.413v51.517h59.053v-51.517H202.818z \t\t \\\nM202.818,121.882v51.746h59.053v-51.746H202.818z M289.658,121.904c-3.037,0-5.497,3.311-5.497,7.396 \t\t\\\nc0,4.086,2.46,7.389,5.497,7.389h10.978c3.037,0,5.497-3.303,5.497-7.389c0-4.085-2.46-7.396-5.497-7.396H289.658z M237.38,43.472 \t\tc-20.229,4.766-34.562,30.897-34.562,38.145c0,17.754,0,25.475,0,25.475h59.053l0.03-66.094 \t\tC261.901,40.998,253.641,39.653,237.38,43.472z M328.326,380.348c0-16.328,13.247-29.568,29.59-29.568 \t\t\\\nc16.335,0,29.582,13.24,29.582,29.568c0,16.334-13.247,29.566-29.582,29.566C341.573,409.914,328.326,396.682,328.326,380.348z \t\t M328.326,92.286c0-16.328,13.247-29.567,29.59-29.567c16.335,0,29.582,13.239,29.582,29.567c0,16.335-13.247,29.574-29.582,29.574 \t\tC341.573,121.86,328.326,108.621,328.326,92.286z  '\nmyChart.setOption(option = {\n    title: [{\n        text: \"公交线路可视化\",\n        subtext: '点击右侧柱状图可对应到站点',\n        left: 10,\n        top: 10,\n        textStyle: {\n            color: 'rgba(18,89,147,1)',\n            fontSize: 40\n        }\n    }, {\n        right: 170,\n        text: \"公交站点上车人数\",\n        subtext: '',\n        textStyle: {\n            color: '#fff',\n            fontSize: 15\n        }\n    }, {\n        right: 170,\n        top: '53%',\n        text: \"公交上车客流时变\",\n        subtext: '',\n        textStyle: {\n            color: '#fff',\n            fontSize: 15\n        }\n    }],\n\n    grid: [{\n            right: 150,\n\n            height: '44%',\n            width: '300px',\n\n        }, {\n            right: 50,\n            width: '380px',\n            bottom: '3%',\n            top: '58%',\n\n            //height: '40%',\n\n        }, {\n            show: true,\n            left: null,\n            right: 0,\n            height: '100%',\n            width: '480px',\n            bottom: '0%',\n            backgroundColor: 'rgba(18,89,147,0.8)'\n        }, {\n            show: true,\n            left: 0,\n            top: 0,\n            height: '80px',\n            width: '320px',\n            bottom: '0%',\n            backgroundColor: 'rgba(255,255,255,0.8)',\n            zlevel: -1\n        }\n\n    ],\n    tooltip: {\n        trigger: 'item',\n        transitionDuration: 0,\n        position: function(point, params, dom, rect, size) {\n            var least_area = 20;\n            var offset_x = 30; /* 相对于point的偏移 */\n            var offset_y = 30;\n\n            /* last_point的least_area范围内不会产生新的t_pos */\n            if (Math.abs(point[0] - last_point[0]) < least_area &&\n                Math.abs(point[1] - last_point[1]) < least_area &&\n                counter >= 2) {\n                return t_pos;\n            }\n            if (Math.abs(point[0] - last_point[0]) >= least_area ||\n                Math.abs(point[1] - last_point[1]) >= least_area) {\n                counter = 0;\n            }\n            counter += 1;\n            /* 使real_x,real_y有数值 */\n            if (counter == 1) {\n                t_pos.left = point[0] + offset_x;\n                t_pos.top = point[1] + offset_y;\n                last_point = [point[0], point[1]];\n            }\n            /* 此处进行修正tooltip的位置 */\n            if (counter == 2) {\n                var real_x = $(dom).position().left;\n                var real_y = $(dom).position().top;\n                t_pos.left += point[0] - real_x + offset_x;\n                t_pos.top += point[1] - real_y + offset_y;\n            }\n            return t_pos;\n        }\n    },\n    animation: false,\n    bmap: {\n        center: [114.050032, 22.543052],\n        zoom: 13,\n        roam: true,\n\n\n    },\n    dataZoom: [{\n        type: 'slider',\n        yAxisIndex: 0,\n        start: 0,\n        end: 30,\n        filterMode: 'empty',\n        textStyle: {\n            color: '#fff'\n        },\n        borderColor: '#fff',\n        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\n        handleSize: '80%',\n        handleStyle: {\n            color: '#fff',\n            shadowBlur: 3,\n            shadowColor: 'rgba(0, 0, 0, 0.6)',\n            shadowOffsetX: 2,\n            shadowOffsetY: 2\n        }\n    }, {\n        type: 'inside',\n        yAxisIndex: 0,\n        start: 0,\n        end: 30,\n        filterMode: 'empty'\n    }, ],\n    visualMap: {\n        type: 'continuous',\n        top: '65%',\n        text: ['High', 'Low'],\n        min: 0,\n\n        //seriesIndex: [0,2],\n        calculable: false,\n        inRange: {\n            color: ['lightblue', 'yellow', '#FF8000'] //['green', '#eac736','#d94e5d']\n        },\n        textStyle: {\n            color: '#000',\n            formatter: 'aaaa{value}bbbb{value2}' // 范围标签显示内容。\n        }\n\n    },\n    xAxis: [{\n        type: 'value',\n        scale: true,\n        position: 'top',\n        boundaryGap: false,\n        splitLine: {\n            show: false\n        },\n        axisLine: {\n            show: false\n        },\n        axisTick: {\n            show: false\n        },\n        axisLabel: {\n            margin: 2,\n            textStyle: {\n                color: '#fff'\n            }\n        }\n    }, {\n        gridIndex: 1,\n        min: 0,\n        max: 24,\n        name: '时间',\n        axisLine: {\n            lineStyle: {\n                color: '#fff'\n            }\n        },\n        axisLabel: {\n            margin: 2,\n            textStyle: {\n                color: '#fff'\n            }\n        }\n    }],\n    yAxis: [{\n        type: 'category',\n        //  name: 'TOP 20',\n        nameGap: 16,\n        axisLine: {\n            show: true,\n            lineStyle: {\n                color: '#fff'\n            }\n        },\n        axisTick: {\n            show: false,\n            lineStyle: {\n                color: '#fff'\n            }\n        },\n        axisLabel: {\n            show: false,\n            interval: 0,\n            textStyle: {\n                color: '#fff'\n            }\n        },\n        data: []\n    }, {\n        gridIndex: 1,\n        min: 0,\n        name: '客流',\n        axisLine: {\n            lineStyle: {\n                color: '#fff'\n            }\n        },\n        axisLabel: {\n\n            margin: 2,\n            textStyle: {\n\n                color: '#fff'\n            }\n        }\n    }],\n    series: [{\n        id: 'scatter',\n        zlevel: -2,\n        type: 'scatter',\n        coordinateSystem: 'bmap',\n        symbolSize: 8,\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.name + ' : ' + params.value[2];\n            },\n            position: 'left'\n        },\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.name + '上车人数:' + params.data.value[2] + '人次';\n            }\n        },\n        label: {\n            normal: {\n                show: false\n            },\n            emphasis: {\n                show: false\n            }\n        },\n    }, {\n        type: 'lines',\n\n        effect: {\n            show: true,\n            period: 20,\n            trailLength: 0,\n            symbol: planePath,\n            symbolSize: 15\n\n        },\n        coordinateSystem: 'bmap',\n        polyline: true,\n        zlevel: -2,\n        lineStyle: {\n            normal: {\n                color: 'rgba(18,89,147, 1)',\n\n                opacity: 0.8,\n                width: 5,\n                shadowColor: 'rgba(0, 0, 0, 0.9)',\n                shadowBlur: 10\n            }\n        },\n\n        progressiveThreshold: 500,\n        progressive: 200\n    }, {\n        id: 'bar',\n        zlevel: 2,\n        type: 'bar',\n        symbol: 'none',\n        itemStyle: {\n            normal: {\n                color: '#ddb926'\n            }\n        },\n        label: {\n            normal: {\n                show: true,\n                position: 'right',\n                formatter: function(params) {\n                    return params.data[0] + ':' + params.data[1] + '人次';\n                }\n            }\n        },\n        xAxisIndex: 0,\n        yAxisIndex: 0,\n        data: [],\n        encode: {\n            x: [1]\n        },\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.name + '上车人数:' + params.data + '人次';\n            }\n        }\n    }, {\n        id: 'line2',\n        zlevel: 2,\n        type: 'line',\n\n        itemStyle: {\n            normal: {\n                color: '#ddb926'\n            }\n        },\n        xAxisIndex: 1,\n        yAxisIndex: 1,\n        data: [],\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.data[0] + '时客流量' + params.data[1] + '人次';\n            }\n        }\n    }]\n});\nif (!app.inNode) {\n    // 添加百度地图插件\n    var bmap = myChart.getModel().getComponent('bmap').getBMap();\n    bmap.addControl(new BMap.MapTypeControl());\n}\n\n\nif (option && typeof option === \"object\") {\n    myChart.setOption(option, true);\n}\n\n;\n\n$.getJSON(uploadedDataURL, function(linedata) {\n    var xAxisData = [];\n    var bardata = [];\n    for (var i = 0; i < linedata[0].length; i += 1) {\n        xAxisData.push(linedata[0][i].name)\n        bardata.push([linedata[0][i].name, linedata[0][i].value[2]])\n    }\n    myChart.hideLoading();\n    myChart.setOption({\n        yAxis: {\n            data: xAxisData\n        },\n        visualMap: {\n            max: linedata[1]\n        },\n        series: [{\n            data: linedata[0],\n            symbolSize: function(val) {\n\n                return Math.max(30 * val[2] / linedata[1], 10);\n            },\n        }, {\n            data: [{\n                coords: linedata[2]\n            }]\n        }, {\n            data: bardata\n        }, {\n            data: linedata[3]\n        }]\n    });\n    myChart.on('mouseover', function(params) {\n        if (params.seriesId == 'bar') {\n            myChart.setOption({\n                visualMap: {\n                    seriesIndex: [0, 1, 2, 3, 4]\n                },\n                series: [{}, {}, {}, {}, {\n                    type: 'effectScatter',\n                    coordinateSystem: 'bmap',\n                    symbolSize: function(val) {\n\n                        return Math.max(30 * val[2] / linedata[1], 10)\n                    },\n                    data: [linedata[0][params.dataIndex]],\n                    showEffectOn: 'render',\n                    label: {\n                        normal: {\n                            show: true,\n                            position: 'right',\n                            textStyle: {\n                                fontSize: 15,\n                                fontWeight: 'bolder',\n                                color: 'rgba(18,89,127, 1)'\n                            },\n                            formatter: function(params1) {\n                                return linedata[0][params.dataIndex].name;\n                            }\n                        },\n                        emphasis: {\n                            show: true,\n                            position: 'top',\n                            textStyle: {\n                                fontSize: 25,\n                                fontWeight: 'bold',\n                                color: 'rgba(18,89,147, 1)'\n                            },\n                            formatter: function(params1) {\n                                return linedata[0][params.dataIndex].name;\n                            }\n                        }\n                    }\n                }]\n            });\n        }\n    })\n    myChart.on('click', function(params) {\n        if(params.seriesIndex == 0 | params.seriesIndex == 2){\n        myChart.setOption({\n            bmap: {\n                center: linedata[0][params.dataIndex].value,\n                zoom: 16\n            },\n            visualMap: {\n                seriesIndex: [0, 1, 2, 3, 4]\n            },\n            series: [{}, {}, {}, {}, {\n                type: 'effectScatter',\n                coordinateSystem: 'bmap',\n                symbolSize: function(val) {\n\n                    return Math.max(30 * val[2] / linedata[1], 10)\n                },\n                data: [linedata[0][params.dataIndex]],\n                showEffectOn: 'render',\n                label: {\n                    normal: {\n                        show: true,\n                        position: 'top',\n                        textStyle: {\n                            fontSize: 25,\n                            fontWeight: 'bold',\n                            color: 'rgba(18,89,147, 1)'\n                        },\n                        formatter: function(params1) {\n                            return linedata[0][params.dataIndex].name;\n                        }\n                    },\n                    emphasis: {\n                        show: true,\n                        position: 'top',\n                        textStyle: {\n                            fontSize: 25,\n                            fontWeight: 'bold',\n                            color: 'rgba(18,89,147, 1)'\n                        },\n                        formatter: function(params1) {\n                            return linedata[0][params.dataIndex].name;\n                        }\n                    }\n                }\n            }]\n        });}\n\n    });\n});","html":"","externalScripts":"https://cdn.jsdelivr.net/npm/echarts@5/dist/extension/bmap.js,https://api.map.baidu.com/getscript?v=2.0&ak=xfhhaTThl11qYVrqLZii6w8qE5ggnhrY&services=&t=20190123111209","updaterUID":"bd-167860219","theme":"default","layout":"","viewCount":22806,"userName":"n***1","commentCount":36,"starCount":108,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xryKWKNVGb.png?v=1589033471979","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"n***1"}}