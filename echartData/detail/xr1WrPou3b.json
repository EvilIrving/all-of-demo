{"status":0,"data":{"cid":"xr1WrPou3b","authorUid":"bd-271949924","authorUserName":"abc1833002417","title":"数据资源","description":"记录下工作上使用echarts和d3画出的圆。\n此图在画时有参考d3教程和\nhttp://gallery.echartsjs.com/editor.html?c=xHyzR8UUNb\n上的例子。","latestVersion":17,"alwaysLatest":1,"createTime":"2017-10-09T07:37:29.000Z","lastUpdateTime":"2017-10-09T07:59:19.000Z","auth":2,"uid":"bd-271949924","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":17,"parentVersion":16,"echartsVersion":"3.7.2","versionCreateTime":"2017-10-09T08:09:24.000Z","code":"//数据\nvar data = {\n    name: \"基础数据资源\",\n    \"children\": [{\n            \"name\": \"基础信息数据量\",\n            \"children\": [{\n                \"name\": \"建档人数\", //类型名称\n                \"size\": 133, //总数\n                \"add\": \"11\", //本月新增数\n                \"rate\": \"13%\" //月增长率\n            }, {\n                \"name\": \"妊娠期妇女管理数\",\n                \"size\": 44,\n                \"add\": \"11\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"儿童管理数\",\n                \"size\": 24,\n                \"add\": \"11\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"新生儿管理数\",\n                \"size\": 4,\n                \"add\": \"13\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"老年人管理数\",\n                \"size\": 34,\n                \"add\": \"14\",\n                \"rate\": \"13%\"\n            }],\n            \"size\": 199,\n            \"add\": \"11\",\n            \"rate\": \"13%\"\n        }, {\n            \"name\": \"健康档案数量\",\n            \"children\": [{\n                \"name\": \"健康档案管理数\", //类型名称\n                \"size\": 155, //总数\n                \"add\": \"11\", //本月新增数\n                \"rate\": \"13%\" //月增长率\n            }, {\n                \"name\": \"门诊管理数\",\n                \"size\": 114,\n                \"add\": \"1\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"住院管理数\",\n                \"size\": 84,\n                \"add\": \"1\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"检验报告管理数\",\n                \"size\": 14,\n                \"add\": \"3\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"检查报告管理数\",\n                \"size\": 15,\n                \"add\": \"4\",\n                \"rate\": \"13%\"\n            }],\n            \"size\": 300,\n            \"add\": \"11\",\n            \"rate\": \"13%\"\n        },\n\n        {\n            \"name\": \"家庭医生签约人数\",\n            \"children\": [{\n                \"name\": \"慢性病人管理数\",\n                \"children\": [{\n                    \"name\": \"精神病患者管理数\", //类型名称\n                    \"size\": 13, //总数\n                    \"add\": \"1\", //本月新增数\n                    \"rate\": \"13%\" //月增长率\n                }, {\n                    \"name\": \"糖尿病患者管理数\",\n                    \"size\": 14,\n                    \"add\": \"1\",\n                    \"rate\": \"13%\"\n                }, {\n                    \"name\": \"高血压患者管理数\",\n                    \"size\": 4,\n                    \"add\": \"3\",\n                    \"rate\": \"13%\"\n                }, {\n                    \"name\": \"脑卒中患者管理数\",\n                    \"size\": 4,\n                    \"add\": \"3\",\n                    \"rate\": \"13%\"\n                }, {\n                    \"name\": \"残疾患者管理数\",\n                    \"size\": 4,\n                    \"add\": \"4\",\n                    \"rate\": \"13%\"\n                }],\n                \"size\": 55,\n                \"add\": \"11\",\n                \"rate\": \"13%\"\n            }, {\n                \"name\": \"家庭医生签约\",\n                \"children\": [{\n                        \"name\": \"糖尿病患者签约数\", //类型名称\n                        \"size\": 15, //总数\n                        \"add\": \"11\", //本月新增数\n                        \"rate\": \"13%\" //月增长率\n                    }, {\n                        \"name\": \"精神病患者签约数\",\n                        \"size\": 4,\n                        \"add\": \"1\",\n                        \"rate\": \"13%\"\n                    }, {\n                        \"name\": \"高血压患者签约数\",\n                        \"size\": 4,\n                        \"add\": \"1\",\n                        \"rate\": \"13%\"\n                    }, {\n                        \"name\": \"脑卒中患者签约数\",\n                        \"size\": 4,\n                        \"add\": \"3\",\n                        \"rate\": \"13%\"\n                    }\n\n                ],\n                \"size\": 44,\n                \"add\": \"11\",\n                \"rate\": \"13%\"\n            }],\n            \"size\": 77,\n            \"add\": \"11\",\n            \"rate\": \"13%\"\n        }\n    ]\n};\n\n//配色\nvar getFillColor = function(nodeName, isLeaf) {\n    var fill = {};\n    var baseArray = [\"基础信息数据量\", \"建档人数\", \"妊娠期妇女管理数\", \"儿童管理数\", \"新生儿管理数\", \"老年人管理数\"];\n    var signArray = [\"家庭医生签约人数\", \"慢性病人管理数\", \"家庭医生签约\", \"精神病患者管理数\", \"糖尿病患者管理数\", \"高血压患者管理数\", \"脑卒中患者管理数\", \"残疾患者管理数\",\n        \"糖尿病患者签约数\", \"精神病患者签约数\", \"高血压患者签约数\", \"脑卒中患者签约数\"\n    ];\n    var recordArray = [\"健康档案数量\", \"健康档案管理数\", \"门诊管理数\", \"住院管理数\", \"检验报告管理数\", \"检查报告管理数\"];\n    if ($.inArray(nodeName, baseArray) != -1) {\n        if (isLeaf) {\n            fill.fillColor = {\n                type: \"radial\",\n                x: 0.5,\n                y: 0.5,\n                r: 0.5,\n                colorStops: [{\n                        offset: 0,\n                        color: \"#626815\" // 0% 处的颜色\n                    },\n                    /* {\n                                               offset: 0.7, color: \"#7b8013\" // 100% 处的颜色\n                                           },*/\n                    {\n                        offset: 1,\n                        color: \"#a9aa0e\" // 100% 处的颜色\n                    }\n                ],\n                globalCoord: false // 缺省为 false\n            };\n            fill.borderColor = \"rgba(182, 184,30, 1)\";\n            fill.borderWidth = 2;\n\n            fill.emphasisFillColor = {\n                type: \"radial\",\n                x: 0.5,\n                y: 0.5,\n                r: 0.5,\n                colorStops: [{\n                    offset: 0,\n                    color: \"#a7ac0e\" // 0% 处的颜色\n                }, {\n                    offset: 0.5,\n                    color: \"#babc0c\" // 50% 处的颜色\n                }, {\n                    offset: 1,\n                    color: \"#f6f701\" // 100% 处的颜色\n                }],\n                globalCoord: false // 缺省为 false\n            };\n            fill.emphasisBorderColor = \"#f6f701\";\n            fill.emphasisborderWidth = 2;\n        } else {\n            fill.fillColor = \"rgba(156,156,14,0.1)\";\n            fill.borderColor = \"rgba(64,67,34,1)\";\n            fill.borderWidth = 1;\n            fill.emphasisFillColor = \"rgba(156,156,14,0.1)\";\n            fill.emphasisBorderColor = \"rgba(64,67,34,1)\";\n            fill.emphasisborderWidth = 3;\n        }\n    } else if ($.inArray(nodeName, signArray) != -1) {\n        if (isLeaf) {\n            fill.fillColor = {\n                type: \"radial\",\n                x: 0.5,\n                y: 0.5,\n                r: 0.5,\n                colorStops: [{\n                        offset: 0,\n                        color: \"#4e0435\" // 0% 处的颜色\n                    },\n                    /* {\n                                               offset: 0.5, color: \"#730c50\" // 100% 处的颜色\n                                           },*/\n                    {\n                        offset: 1,\n                        color: \"#84085a\" // 100% 处的颜色\n                    }\n                ],\n                globalCoord: false // 缺省为 false\n            };\n            fill.borderColor = \"rgba(154, 14, 109, 1)\";\n            fill.borderWidth = 2;\n            fill.emphasisFillColor = {\n                type: \"radial\",\n                x: 0.5,\n                y: 0.5,\n                r: 0.5,\n                colorStops: [{\n                    offset: 0,\n                    color: \"#ae0876\" // 0% 处的颜色\n                }, {\n                    offset: 0.5,\n                    color: \"#cd0a8b\" // 50% 处的颜色\n                }, {\n                    offset: 1,\n                    color: \"#f505a4\" // 100% 处的颜色\n                }],\n                globalCoord: false // 缺省为 false\n            };\n            fill.emphasisBorderColor = \"#f505a4\";\n            fill.emphasisborderWidth = 3;\n        } else {\n            fill.fillColor = \"rgba(130, 10, 88, 0.18)\";\n            fill.borderColor = \"rgba(77, 15, 75, 1)\";\n            fill.borderWidth = 1;\n            fill.emphasisFillColor = \"rgba(130, 10, 88, 0.18)\";\n            fill.emphasisBorderColor = \"rgba(77, 15, 75, 1)\";\n            fill.emphasisborderWidth = 3;\n        }\n    } else {\n        if (isLeaf) {\n            fill.fillColor = {\n                type: \"radial\",\n                x: 0.5,\n                y: 0.5,\n                r: 0.5,\n                colorStops: [{\n                    offset: 0,\n                    color: \"#034e61\" // 0% 处的颜色\n                }, {\n                    offset: 0.7,\n                    color: \"#086b87\" // 70% 处的颜色\n                }, {\n                    offset: 1,\n                    color: \"#068ca3\" // 100% 处的颜色\n                }],\n                globalCoord: false // 缺省为 false\n            };\n            fill.borderColor = \"#03a1b3\";\n            fill.borderWidth = 2;\n            fill.emphasisFillColor = {\n                type: \"radial\",\n                x: 0.5,\n                y: 0.5,\n                r: 0.5,\n                colorStops: [{\n                    offset: 0,\n                    color: \"#0a7998\" // 0% 处的颜色\n                }, {\n                    offset: 0.7,\n                    color: \"#0b9ec8\" //70% 处的颜色\n                }, {\n                    offset: 1,\n                    color: \"#09c2f6\" // 100% 处的颜色\n                }],\n                globalCoord: false // 缺省为 false\n            };\n            fill.emphasisBorderColor = \"#09c2f6\";\n            fill.emphasisborderWidth = 1;\n        } else {\n            fill.fillColor = \"rgba(0, 252, 255, 0.1)\";\n            fill.borderColor = \"rgba(11, 72, 115, 1)\";\n            fill.borderWidth = 1;\n            fill.emphasisFillColor = \"rgba(0, 252, 255, 0.1)\";\n            fill.emphasisBorderColor = \"rgba(11, 72, 115, 1)\";\n            fill.emphasisborderWidth = 3;\n        }\n    }\n    return fill;\n};\n\n//渲染函数\nvar renderItem = function(params, api) {\n    var fillObj = getFillColor(api.value(2), api.value(9));\n    var textPosition = \"inside\";\n    if (!api.value(9)) {\n        if (api.value(1) == 1) {\n            if (api.value(6) > api.getWidth() / 2) {\n                textPosition = \"right\";\n            } else {\n                textPosition = \"left\";\n            }\n        } else {\n            textPosition = \"top\";\n        }\n    }\n    return {\n        type: \"circle\",\n        shape: {\n            cx: api.value(6),\n            cy: api.value(7),\n            r: api.value(8)\n        },\n        z2: api.value(1) * 2,\n        style: api.style({\n            stroke: fillObj.borderColor,\n            fill: fillObj.fillColor,\n            textPosition: textPosition,\n            lineWidth: fillObj.borderWidth\n                //text: nodeName,\n                // textFont: textFont,\n                // textDistance : itemLayout.r,\n        }),\n        styleEmphasis: api.style({\n            textPosition: textPosition,\n            stroke: fillObj.emphasisBorderColor,\n            fill: fillObj.emphasisFillColor,\n            lineWidth: fillObj.emphasisborderWidth\n        })\n    };\n};\n\nvar root = d3.hierarchy(data)\n    .sum(function(d) {\n        return d.size;\n    })\n    .sort(function(a, b) {\n        return b.value - a.value;\n    });\nd3.pack()\n    .size([800 - 2, 480 - 2])\n    .padding(0.5)(root);\nvar maxDepth = 0;\nvar nodeAll = root.descendants();\nvar nodes = nodeAll.filter(function(it) {\n    return it.parent;\n});\n\n//获取各圆相关数据\nvar seriesData = nodes.map(function(node) {\n    maxDepth = Math.max(maxDepth, node.depth);\n    var color = \"#ffffff\";\n    node.isLeaf = !node.children || !node.children.length;\n    if (node.depth == 1) {\n        switch (node.data.name) {\n            case \"家庭医生签约人数\":\n                color = \"rgba(218, 22, 158, 1)\";\n                break;\n            case \"基础信息数据量\":\n                color = \"rgba(156,156,14,1)\";\n                break;\n            case \"健康档案数量\":\n                color = \"rgba(14, 149, 156, 1)\";\n                break;\n        }\n        return {\n            value: [\n                node.value,\n                node.depth,\n                node.data.name,\n                node.data.size,\n                node.data.add,\n                node.data.rate,\n                node.x,\n                node.y,\n                node.r,\n                node.isLeaf\n            ],\n            label: {\n                normal: {\n                    show: true,\n                    color: color,\n                    formatter: function(params) {\n                        return \"{type|\" + params.value[2] + \"}\\n{numAll|\" + params.value[3] + \"}\\n{add|本月新增：\" + params.value[4] + \"}\";\n                    },\n                    rich: {\n                        type: {\n                            fontSize: 14,\n                            color: color\n                        },\n                        numAll: {\n                            fontSize: 28,\n                            padding: [5, 0, 5, 0],\n                            color: color\n                        },\n                        add: {\n                            fontSize: 14,\n                            color: color\n                        }\n                    }\n                }\n            }\n        }\n    } else {\n        if (node.data.name == \"家庭医生签约\" || node.data.name == \"慢性病人管理数\") {\n            color = \"rgba(222, 0, 155,1)\";\n        }\n        return {\n            value: [\n                node.value,\n                node.depth,\n                node.data.name,\n                node.data.size,\n                node.data.add,\n                node.data.rate,\n                node.x,\n                node.y,\n                node.r,\n                node.isLeaf\n            ],\n            label: {\n                normal: {\n                    show: true,\n                    color: color,\n                    position: \"inside\",\n                    formatter: function(params) {\n                        var result = \"\";\n                        var nodeName = params.value[2];\n                        if (params.value[9]) {\n                            if (params.value[8] > 10) {\n                                var trunText = echarts.format.truncateText(nodeName, 2 * params.value[8], {\n                                    fontSize: 14,\n                                    fontFamily: \"微软雅黑\"\n                                }, '.');\n                                if (trunText.indexOf(\".\") > 0) {\n                                    var strindex1 = nodeName.indexOf(\"患者\");\n                                    var strindex2 = nodeName.indexOf(\"管理数\");\n                                    if (strindex1 > 0) {\n                                        result += \"{type|\" + nodeName.substring(0, strindex1) + \"}\";\n                                    } else {\n                                        result += \"{type|\" + nodeName.substring(0, strindex2) + \"}\";\n                                    }\n                                } else {\n                                    result += \"{type|\" + nodeName + \"}\";\n                                }\n                                if (params.value[8] > 45) {\n                                    result += \"\\n{num|\" + params.value[3] + \"}\";\n                                }\n                            }\n                        } else {\n                            result += \"{type|\" + params.value[2] + \"}\";\n                        }\n                        return result;\n                    },\n                    rich: {\n                        type: {\n                            fontSize: 12,\n                            padding: [5, 0, 5, 0],\n                            color: color\n                        },\n                        num: {\n                            fontSize: 16,\n                            color: color\n                        }\n                    }\n                }\n            }\n        }\n    }\n});\n\n//echarts 配置\noption = {\n    backgroundColor: \"#0c1b3e\",\n    title: {\n        text: \"2017-10\",\n        textStyle: {\n            color: \"rgba(164, 159, 159, 0.21)\",\n            fontSize: 32,\n            fontFamily: \"微软雅黑\",\n            fontWeight: \"normal\"\n        },\n        right: 10,\n        bottom: 10\n    },\n    xAxis: {\n        axisLine: {\n            show: false\n        },\n        axisTick: {\n            show: false\n        },\n        axisLabel: {\n            show: false\n        },\n        splitLine: {\n            show: false\n        }\n    },\n    yAxis: {\n        axisLine: {\n            show: false\n        },\n        axisTick: {\n            show: false\n        },\n        axisLabel: {\n            show: false\n        },\n        splitLine: {\n            show: false\n        }\n    },\n    tooltip: {\n        backgroundColor: \"rgba(50,50,50,0.95)\",\n        formatter: function(params) {\n            var size = (\"\" + params.value[3]).replace(/\\d{1,3}(?=(\\d{3})+$)/g, \"$&,\");\n            var add = (\"\" + params.value[4]).replace(/\\d{1,3}(?=(\\d{3})+$)/g, \"$&,\");\n            var result = \"<span>\" + params.value[2] + \"</span><br>\" +\n                \"<span style = 'line-height:30px;font-size : 25px; font-weight:bold;'>\" + size + \"</span></br>\" +\n                \"<div>\" +\n                \"<div style = 'float : left; padding-right:20px; border-right: solid 1px #4c4a4a;'>\" +\n                \"<span >本月新增</span></br>\" +\n                \"<span style = 'color : red; '>\" + add + \"</span>\" +\n                \"</div>\" +\n                \"<div style = 'float : right; margin-left:20px;'>\" +\n                \"<span style = 'width : 100px;'>月增长率</span></br>\";\n            if (params.value[5] > 0) {\n                result += \"<span style = 'color : red;  width : 100px;'>+\" + params.value[5] + \"</span>\"\n            } else {\n                result += \"<span style = 'color : red;  width : 100px;'>\" + params.value[5] + \"</span>\"\n            }\n            result += \"</div>\" +\n                \"</div>\";\n            return result;\n        }\n    },\n    series: {\n        type: \"custom\",\n        renderItem: renderItem,\n        data: seriesData\n    }\n};","html":"","externalScripts":"https://d3js.org/d3.v4.min.js","updaterUID":"bd-271949924","theme":"default","layout":"","viewCount":14234,"userName":"abc1833002417","commentCount":4,"starCount":65,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xr1WrPou3b.png?v=1507536564585","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-custom","title","tooltip"],"customTags":["circle","d3"],"updaterUserName":"abc1833002417"}}