{"status":0,"data":{"cid":"x9PNKdWhV","authorUid":"bd-4161428444","authorUserName":"b***n","title":"海外疫情病例趋势图","description":"截止: 2020年3月03日\n累计确诊: {a| sumDiagnosed}  累计治愈: {c| sumCured}  累计死亡: {d| sumDied}","latestVersion":8,"alwaysLatest":1,"createTime":"2020-03-03T13:58:13.000Z","lastUpdateTime":"2020-03-03T13:58:13.000Z","auth":2,"uid":"bd-4161428444","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":8,"parentVersion":7,"echartsVersion":"4.7.0","versionCreateTime":"2020-05-18T13:03:18.000Z","code":"//声明jsonp函数\r\nfunction jsonp(url, callback, callbackname){ //给系统中创建一个全局变量，叫做callbackname，指向callback函数名\r\n\t//定义一个处理Jsonp返回数据的回调函数\r\n\twindow[callbackname] = callback;\r\n\t//创建一个script节点\r\n\tvar script = document.createElement(\"script\");\r\n\t    script.src = url;\r\n\t    script.type = \"text/javascript\";\t\t\t\r\n\tdocument.getElementsByTagName(\"body\")[0].appendChild(script); //将创建的新节点添加到BOM树上  \r\n\tsetTimeout(function(){\r\n\t\tdocument.body.removeChild(script); //为了不污染页面，把script拿掉\r\n\t}, 500);\r\n}\r\n\r\nvar jsonpURL ='https://m.look.360.cn/events/feiyan?sv=&version=&market=&device=2&net=4&stype=&scene=&sub_scene=&refer_scene=&refer_subscene=&f=jsonp&location=true&_=1583145636129&callback=jsonp2';\r\n//调用jsonp函数发送jsonp请求的callback\r\njsonp(jsonpURL, function(data){\r\n\tconsole.log(data.country);\r\n\t\tvar chartsJSON = data.country; // 发送请求成功后开始执行，data是请求成功后，返回的数据\r\n\t\tvar provinceName = [], //国家  \r\n        \tdiagnosed = [],    //确诊\r\n        \tdiffDiagnosed = [],//新增确诊\r\n\t\t    cured = [],        //治愈\r\n        \tdied = []; \t       //死亡\r\n\t\t\r\n\t\t// 取出每一条数据value,作为显示数据\r\nchartsJSON.forEach(function(items, index) {\r\n    provinceName.push(items.provinceName);\r\n    diagnosed.push(items.diagnosed);\r\n    diffDiagnosed.push(items.diffDiagnosed);\r\n    cured.push(items.cured);\r\n    died.push(items.died);\r\n});\r\n//数组求和\r\nvar sumDiagnosed = eval(diagnosed.join(\"+\")),\r\n    sumDiffDiagnosed = eval(diffDiagnosed.join(\"+\")),\r\n    sumCured = eval(cured.join(\"+\")),\r\n    sumDied = eval(died.join(\"+\"));\r\n\r\nconsole.log(\"数据来源：\" + \"%c\" + \"https://m.look.360.cn\", \"color:#00cc00\");\r\nconsole.log(\"海外累计确诊：\" + \"%c\" + sumDiagnosed, \"color:rgb(224, 32, 32)\");\r\nconsole.log(\"海外新增确诊：\" + \"%c\" + sumDiffDiagnosed, \"color:#ff6600\");\r\nconsole.log(\"海外累计治愈：\" + \"%c\" + sumCured, \"color:rgb(17, 191, 199)\");\r\nconsole.log(\"海外累计死亡：\" + \"%c\" + sumDied, \"color:gray\");\r\n\r\nconst mydate = new Date();\r\nvar jsonMonth = mydate.getMonth() + 1,\r\n    subDay = mydate.getDate();\r\nsubDay < 10 ? subDay = \"0\" + subDay : subDay = subDay;\r\nvar subDate = mydate.getFullYear() + \"年\" + jsonMonth + \"月\" + subDay + \"日\";\r\n//console.log(subDate)\r\nvar subFunc = [\r\n    '截止: ' + subDate + '\\n' +\r\n    '累计确诊: {a| ' + sumDiagnosed + '}', '新增确诊: {b| ' + sumDiffDiagnosed + '}', '累计治愈: {c| ' + sumCured + '}', '累计死亡: {d| ' + sumDied + '}'\r\n].join('\\xa0\\xa0');\r\n\r\n//基于准备好的dom，初始化echarts实例\r\noption = {\r\n    backgroundColor: '#f8f8f8', //背景色\r\n    title: {\r\n        text: '海外疫情病例趋势图',\r\n        textStyle: {\r\n            color: '#000',\r\n            fontSize: 18\r\n        },\r\n        itemGap: 5,\r\n        subtext: subFunc,\r\n        subtextStyle: {\r\n            color: '#333',\r\n            fontSize: 14,\r\n            rich: {\r\n                a: {\r\n                    color: '#b61e33',\r\n                    fontSize: 15\r\n                },\r\n                b: {\r\n                    color: '#ff6600',\r\n                    fontSize: 15\r\n                },\r\n                c: {\r\n                    color: 'rgb(17, 191, 199)',\r\n                    fontSize: 15\r\n                },\r\n                d: {\r\n                    color: 'gray',\r\n                    fontSize: 15\r\n                }\r\n            }\r\n        },\r\n        x: 'center'\r\n    },\r\n    tooltip: {\r\n        trigger: 'axis', //axis , item\r\n        axisPointer: {\r\n            type: 'line', //'line' | 'cross' | 'shadow' | 'none\r\n            lineStyle: {\r\n                color: '#c9caca',\r\n                width: 1,\r\n                type: 'dotted'\r\n            }\r\n        },\r\n        x: 'left',\r\n        textStyle: {\r\n            fontSize: 14\r\n        }\r\n    },\r\n    grid: {\r\n        top: '12%',\r\n        right: '2%',\r\n        bottom: '10%',\r\n        left: '7%'\r\n    },\r\n    legend: {\r\n        data: ['确诊', '新增确诊', '治愈', '死亡'],\r\n        x: 'right'\r\n    },\r\n    xAxis: {\r\n        type: 'category',\r\n        axisLabel: {\r\n            rotate: 45,\r\n            interval: 0, //类目间隔 设置为 1，表示(隔一个标签显示一个标签)\r\n            textStyle: {\r\n                color: '#333',\r\n                fontSize: 12\r\n            },\r\n            formatter: '{value}'\r\n        },\r\n        axisLine: {\r\n            lineStyle: {\r\n                color: '#ccc',\r\n                width: 1\r\n            }\r\n        },\r\n        splitLine: {\r\n            show: true,\r\n            lineStyle: {\r\n                color: 'rgba(102,102,102,.1)', //纵向网格线颜色\r\n                width: 1,\r\n                type: 'dashed'\r\n            }\r\n        },\r\n        axisTick: {\r\n            show: true //坐标轴小标记\r\n        },\r\n        data: provinceName //载入横坐标数据\r\n    },\r\n    yAxis: {\r\n        type: 'value',\r\n        axisLabel: {\r\n            show: true,\r\n            textStyle: {\r\n                color: '#333',\r\n                fontSize: 12\r\n            },\r\n            formatter: '{value}'\r\n        },\r\n        splitNumber: 4, //y轴刻度设置(值越大刻度越小)\r\n        axisLine: {\r\n            lineStyle: {\r\n                color: '#ccc',\r\n                width: 1\r\n            }\r\n        },\r\n        splitLine: {\r\n            show: true,\r\n            lineStyle: {\r\n                color: 'rgba(102,102,102,.1)', //横向网格线颜色\r\n                width: 1,\r\n                type: 'dashed'\r\n            }\r\n        }\r\n    },\r\n    color: ['#b61e33', 'rgb(255, 160, 25)', 'rgb(17, 191, 199)', 'rgba(77, 80, 84, 0.7)'],\r\n    dataZoom: [\r\n        //   {\r\n        //     type: \"slider\",\r\n        //     show: false,\r\n        //     start: 0,\r\n        //     end: (7 / data.length) * 100,\r\n        //     handleSize: 8\r\n        //   },\r\n        {\r\n            type: \"inside\",\r\n            start: 0,\r\n            end: 7\r\n        },\r\n        //   {\r\n        //     type: \"slider\",\r\n        //     show: false,\r\n        //     yAxisIndex: 0,\r\n        //     filterMode: \"empty\",\r\n        //     width: 12,\r\n        //     height: \"70%\",\r\n        //     handleSize: 8,\r\n        //     showDataShadow: false,\r\n        //     left: \"90%\"\r\n        //   }\r\n    ],\r\n    series: [{\r\n            name: '确诊',\r\n            type: 'line', //line        \r\n            symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n            symbolSize: 12, //曲线点大小\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'top'\r\n                }\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 2\r\n                }\r\n            },\r\n            smooth: true,\r\n            data: diagnosed //载入数据\r\n        },\r\n        {\r\n            name: '新增确诊',\r\n            type: 'line', //line\r\n            symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n            symbolSize: 12, //曲线点大小\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'top'\r\n                }\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 2\r\n                }\r\n            },\r\n            smooth: true,\r\n            data: diffDiagnosed //载入数据\r\n        },\r\n        {\r\n            name: '治愈',\r\n            type: 'line', //line\r\n            symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n            symbolSize: 12, //曲线点大小\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'top'\r\n                }\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 2\r\n                }\r\n            },\r\n            smooth: true,\r\n            data: cured //载入数据\r\n        },\r\n        {\r\n            name: '死亡',\r\n            type: 'line', //line\r\n            symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n            symbolSize: 12, //曲线点大小\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'top'\r\n                }\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 2\r\n                }\r\n            },\r\n            smooth: true,\r\n            data: died //载入数据\r\n        }\r\n    ]\r\n};\r\n\r\n//使用刚指定的配置项和数据显示图表。\r\nmyChart.setOption(option);\r\n\r\nvar app = {\r\n    currentIndex: -1,\r\n};\r\nsetInterval(function() {\r\n    var dataLen = option.series[0].data.length;\r\n\r\n    // 取消之前高亮的图形\r\n    myChart.dispatchAction({\r\n        type: 'downplay',\r\n        seriesIndex: 0,\r\n        dataIndex: app.currentIndex\r\n    });\r\n    // 感谢网友j***o的优化方案\r\n    // option.dataZoom[0].start= app.currentIndex + 1;\r\n    // option.dataZoom[0].end=app.currentIndex + 8;\r\n    // console.log(app.currentIndex, option.dataZoom[0].end / 100 * dataLen - 2)\r\n    if (app.currentIndex > option.dataZoom[0].end / 100 * dataLen - 2) {\r\n        option.dataZoom[0].start = app.currentIndex / dataLen * 100;\r\n        option.dataZoom[0].end = app.currentIndex / dataLen * 100 + 7;\r\n    }\r\n    \r\n    myChart.setOption(option)\r\n\r\n    app.currentIndex = (app.currentIndex + 1) % dataLen;\r\n\r\n    // 高亮当前图形\r\n    myChart.dispatchAction({\r\n        type: 'highlight',\r\n        seriesIndex: 0,\r\n        dataIndex: app.currentIndex,\r\n    });\r\n\r\n    // 显示 tooltip\r\n    myChart.dispatchAction({\r\n        type: 'showTip',\r\n        seriesIndex: 0,\r\n        dataIndex: app.currentIndex\r\n    });\r\n\r\n}, 3000);\r\n\t\r\n},\"jsonp2\");","html":"","externalScripts":"","updaterUID":"bd-4161428444","theme":"","layout":"","viewCount":8119,"userName":"b***n","commentCount":2,"starCount":16,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x9PNKdWhV.png?v=1589806998784","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","legend","series-line","title","tooltip"],"customTags":[],"updaterUserName":"b***n"}}