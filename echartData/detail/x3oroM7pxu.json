{"status":0,"data":{"cid":"x3oroM7pxu","authorUid":"bd-3523491757","authorUserName":"y***g","title":"漏斗-细分对比","description":"","latestVersion":17,"alwaysLatest":1,"createTime":"2019-06-06T07:29:16.000Z","lastUpdateTime":"2019-06-06T07:29:16.000Z","auth":2,"uid":"bd-3523491757","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":17,"parentVersion":16,"echartsVersion":"4.2.1","versionCreateTime":"2019-06-12T09:55:44.000Z","code":"var convertRatePostion = 15;\nvar events = [\"搜索商品\", \"查看商品详情\", \"加入购物车\", \"开始付款\", \"付款成功\"];\nvar data = [{\n        \"names\": [\"北京\"],\n        \"original_names\": [\"北京\"],\n        \"values\": [1151, 594, 109, 44, 23],\n        \"p_next\": [\"100.0\", \"51.6\", \"18.4\", \"40.4\", \"52.3\"],\n        \"p_total\": [\"100.0\", \"51.6\", \"9.5\", \"3.8\", \"2.0\"]\n    },\n    {\n        \"names\": [\"上海\"],\n        \"original_names\": [\"上海\"],\n        \"values\": [845, 334, 116, 43, 30],\n        \"p_next\": [\"100.0\", \"39.5\", \"34.7\", \"37.1\", \"69.8\"],\n        \"p_total\": [\"100.0\", \"39.5\", \"13.7\", \"5.1\", \"3.6\"]\n    },\n    {\n        \"names\": [\"湖北\"],\n        \"original_names\": [\"湖北\"],\n        \"values\": [577, 161, 38, 13, 7],\n        \"p_next\": [\"100.0\", \"27.9\", \"23.6\", \"34.2\", \"53.8\"],\n        \"p_total\": [\"100.0\", \"27.9\", \"6.6\", \"2.3\", \"1.2\"]\n    },\n    {\n        \"names\": [\"广东\"],\n        \"original_names\": [\"广东\"],\n        \"values\": [463, 209, 57, 28, 14],\n        \"p_next\": [\"100.0\", \"45.1\", \"27.3\", \"49.1\", \"50.0\"],\n        \"p_total\": [\"100.0\", \"45.1\", \"12.3\", \"6.0\", \"3.0\"]\n    }\n];\n\nvar color = [\n    \"#00a0e9\",\n    \"#f4b93b\",\n    \"#85bd41\",\n    \"#f29c9f\",\n    \"#8f82bc\",\n    \"#0068b7\",\n    \"#f29b76\",\n    \"#13b5b1\",\n    \"#6e7074\",\n    \"#546570\",\n    \"#c4ccd3\"\n];\n\n\nfunction getYAxisData() {\n    var result = [];\n    for (i = 0; i < events.length; i++) {\n        result[i * 2] = events[i];\n        if (i < events.length - 1)\n            result[i * 2 + 1] = 'a' + i.toString();\n    }\n    return result;\n}\nvar yAxisData = getYAxisData();\n\nfunction getSeriesData() {\n    var result = [];\n    for (i = 0; i < data.length; i++) {\n        var s = [];\n        s[0] = [];\n        s[1] = [];\n        s[2] = [];\n        s[2][0] = 0;\n        for (j = 0; j < data[i][\"p_total\"].length; j++) {\n            s[0][j * 2] = data[i][\"p_total\"][j];\n            if (j > 0) {\n                s[2][j * 2] = data[i][\"p_total\"][j - 1];\n            }\n            if (j < events.length - 1) {\n                s[0][j * 2 + 1] = null;\n                s[1][j] = {\n                    value: data[i][\"p_next\"][j + 1],\n                    xAxis: convertRatePostion,\n                    yAxis: 'a' + j.toString()\n                };\n            }\n        }\n        result[i] = s;\n    }\n    return result;\n}\n\nvar seriesData = getSeriesData();\n\n\nfunction generateXAxises() {\n    var result = [];\n    for (i = 0; i < data.length; i++) {\n        result.push({\n            gridIndex: i,\n            min: 0,\n            max: 100,\n            axisLine: {\n                show: false\n            },\n            axisTick: {\n                show: false\n            },\n            splitLine: {\n                show: false,\n                lineStyle: {\n                    color: \"#eee\",\n                    type: \"dotted\"\n                }\n            },\n            axisLabel: {\n                show: false,\n                formatter: \"{value}%\",\n                color: \"#aaa\",\n                fontSize: 10\n            }\n        })\n    }\n    return result;\n}\n\nfunction generateYAxises() {\n    var result = [];\n    for (i = 0; i < data.length; i++) {\n        result.push({\n            gridIndex: i,\n            axisLine: {\n                show: false\n            },\n            data: yAxisData,\n            inverse: true,\n            axisTick: {\n                show: false\n            },\n            axisLabel: {\n                show: i == 0,\n                width: \"100%\",\n                interval: 1,\n                fontSize: 11\n            },\n\n        })\n    }\n    return result;\n}\n\nfunction generateSeries() {\n    var result = [];\n    for (i = 0; i < data.length; i++) {\n        result.push({\n            xAxisIndex: i,\n            yAxisIndex: i,\n            type: 'bar',\n            barWidth: 40,\n            z: 10,\n            name: data[i][\"names\"][0],\n            data: seriesData[i][0],\n            itemStyle: {\n                color: color[i]\n            },\n            emphasis: {\n                itemStyle: {\n                    opacity: 0.6,\n                }\n            },\n            markPoint: {\n                symbol: 'triangle',\n                symbolSize: [42, 21],\n                symbolRotate: 180,\n                label: {\n                    formatter: \"{c}%\",\n                    position: \"insideTop\",\n                    distance: 1,\n                    fontSize: 7\n                },\n                itemStyle: {\n                    color: \"#bbb\",\n                },\n                data: seriesData[i][1],\n            }\n        })\n    }\n    return result;\n}\n\nfunction generateTitles() {\n    var result = [];\n    for (i = 0; i < data.length; i++) {\n        result.push({\n            textAlign: 'left',\n            text: data[i][\"names\"][0],\n            left: (12 + i * 22) + \"%\",\n            top: \"2%\",\n            textStyle: {\n                fontSize: 12,\n                fontWeight: 'normal',\n                color: color[i]\n            }\n        })\n    }\n    return result;\n}\n\n\noption = {\n    backgroundColor: \"#fff\",\n    height: 350,\n    grid: [{\n            show: false,\n            x: '10%',\n            y: '7%',\n            width: '20%',\n        },\n        {\n            show: false,\n            x: '32%',\n            y: '7%',\n            width: '20%',\n        },\n        {\n            show: false,\n            x: '54%',\n            y: '7%',\n            width: '20%',\n        },\n        {\n            show: false,\n            x: '76%',\n            y: '7%',\n            width: '20%',\n        },\n    ],\n    tooltip: {\n        trigger: \"item\",\n        formatter: function(params){\n            if(params.componentType=='markPoint')\n                return events[params.dataIndex] + \"→\" + events[params.dataIndex+1] + \"<br>\" + data[params.dataIndex][\"names\"][0] + \"：\" + params.value + \"%\";\n        },\n        textStyle: {\n            fontSize: 10\n        },\n        axisPointer: {\n            type: \"none\",\n            label: {\n                show: false\n            }\n        }\n    },\n    title: generateTitles(),\n    xAxis: generateXAxises(),\n    yAxis: generateYAxises(),\n    series: generateSeries()\n};\n\n// 鼠标滑过时实现对比效果\nfunction compare(seriesIndex, dataIndex) {\n    if(dataIndex==0)\n        return;\n    option.animation = false;\n    for (i = 0; i < data.length; i++) {\n        var sData = Array(seriesData[seriesIndex][0].length).fill(null);\n        sData[dataIndex] = {value: seriesData[seriesIndex][0][dataIndex], vs: seriesData[i][0][dataIndex], currentIndex: seriesIndex, compareIndex: i};\n        option.series.push({\n            xAxisIndex: i,\n            yAxisIndex: i,\n            type: 'bar',\n            name: \"compare\",\n            z: 15,\n            itemStyle: {\n                color: \"rgb(1, 1, 1, 0)\",\n                borderWidth: 1,\n                borderColor: color[seriesIndex],\n            },\n            label: {\n                show: true,\n                fontSize: 9,\n                position: \"right\",\n                align: \"left\",\n                color: \"#777777\",\n                formatter: function(params){\n                    if(params.data.currentIndex == params.data.compareIndex)\n                        return \"转化：\" + params.data.value + \"%（\" + data[params.data.currentIndex].values[params.dataIndex] + \"人）\";\n                    else\n                        return data[params.data.currentIndex].names[0] + \"：\" + params.data.value + \"%（\" + data[params.data.currentIndex].values[params.dataIndex] + \"人）\\n\" \n                        + data[params.data.compareIndex].names[0] + \"：\" + params.data.vs + \"%（\" + data[params.data.compareIndex].values[params.dataIndex] + \"人）\"\n                }\n            },\n            silent: true,\n            barWidth: 40,\n            barGap: '-100%', //与原始柱图叠加\n            data: sData,\n        })\n        option.series[i].markLine = {\n            symbol: [\"none\", \"none\"],\n            z: 20,\n            data: [{\n                xAxis: seriesData[seriesIndex][0][dataIndex],\n            }],\n            lineStyle: {\n                color: color[seriesIndex],\n                type: \"dotted\"\n            },\n            label: {\n                formatter: \"{c}%\",\n                fontSize: 10\n            }\n        }\n    }\n    myChart.setOption(option, false)\n}\n\nmyChart.on('mouseover', {\n        componentType: \"series\"\n    },\n    function(params) {\n        if (params.componentSubType == 'bar') {\n            compare(params.seriesIndex, params.dataIndex);\n            for (i = 0; i < data.length; i++) {\n                myChart.dispatchAction({\n                    type: 'highlight',\n                    seriesIndex: i,\n                    dataIndex: params.dataIndex,\n                });\n            }\n        }\n    }\n);\n\nmyChart.on('mouseout', {\n        componentType: \"series\"\n    },\n    function(params) {\n        option.grid[params.seriesIndex].show = false;\n        if (params.componentSubType == 'bar') {\n            for (i = 0; i < data.length; i++) {\n                myChart.dispatchAction({\n                    type: 'downplay',\n                    seriesIndex: i,\n                    dataIndex: params.dataIndex,\n                });\n                option.series[i].markLine = null;\n            }\n            option.series.splice(4, 4);\n            myChart.setOption(option, true)\n        }\n    }\n);\n","html":"","externalScripts":"","updaterUID":"bd-3523491757","theme":"","layout":"","viewCount":1256,"userName":"y***g","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x3oroM7pxu.png?v=1560333344409","isCustomThumbnail":0,"builtinTags":["category-work","grid","markPoint","series-bar","title","tooltip"],"customTags":[],"updaterUserName":"y***g"}}