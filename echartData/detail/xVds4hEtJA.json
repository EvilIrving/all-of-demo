{"status":0,"data":{"cid":"xVds4hEtJA","authorUid":"bd-939842705","authorUserName":"j***h","title":"热门起点站","description":"老人热门的起点站热力图","latestVersion":6,"alwaysLatest":1,"createTime":"2019-06-14T06:59:57.000Z","lastUpdateTime":"2019-06-14T06:59:57.000Z","auth":2,"uid":"bd-939842705","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":6,"parentVersion":5,"echartsVersion":"4.2.1","versionCreateTime":"2019-06-19T14:33:34.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1560952617745-J48vwHZ-j.csv\";\n\n\n//以下是离线转换GPS坐标到百度坐标\n\nvar pi = 3.14159265358979324;\nvar a = 6378245.0;\nvar ee = 0.00669342162296594323;\nvar x_pi = 3.14159265358979324 * 3000.0 / 180.0;\n\nfunction transformLat(lat, lon) {\n    var ret = -100.0 + 2.0 * lat + 3.0 * lon + 0.2 * lon * lon + 0.1 * lat * lon + 0.2 * Math.sqrt(Math.abs(lat));\n    ret += (20.0 * Math.sin(6.0 * lat * pi) + 20.0 * Math.sin(2.0 * lat * pi)) * 2.0 / 3.0;\n    ret += (20.0 * Math.sin(lon * pi) + 40.0 * Math.sin(lon / 3.0 * pi)) * 2.0 / 3.0;\n    ret += (160.0 * Math.sin(lon / 12.0 * pi) + 320 * Math.sin(lon * pi / 30.0)) * 2.0 / 3.0;\n    return ret;\n}\n\nfunction transformLon(lat, lon) {\n    var ret = 300.0 + lat + 2.0 * lon + 0.1 * lat * lat + 0.1 * lat * lon + 0.1 * Math.sqrt(Math.abs(lat));\n    ret += (20.0 * Math.sin(6.0 * lat * pi) + 20.0 * Math.sin(2.0 * lat * pi)) * 2.0 / 3.0;\n    ret += (20.0 * Math.sin(lat * pi) + 40.0 * Math.sin(lat / 3.0 * pi)) * 2.0 / 3.0;\n    ret += (150.0 * Math.sin(lat / 12.0 * pi) + 300.0 * Math.sin(lat / 30.0 * pi)) * 2.0 / 3.0;\n    return ret;\n}\n\nfunction wgs2gcj(lat, lon) {\n    var dLat = transformLat(lon - 105.0, lat - 35.0);\n    var dLon = transformLon(lon - 105.0, lat - 35.0);\n    var radLat = lat / 180.0 * pi;\n    var magic = Math.sin(radLat);\n    magic = 1 - ee * magic * magic;\n    var sqrtMagic = Math.sqrt(magic);\n    dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * pi);\n    dLon = (dLon * 180.0) / (a / sqrtMagic * Math.cos(radLat) * pi);\n    var mgLat = lat + dLat;\n    var mgLon = lon + dLon;\n    var loc = [mgLat, mgLon];\n    return loc;\n}\n\nfunction gcj2bd(lat, lon) {\n    var x = lon,\n        y = lat;\n    var z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * x_pi);\n    var theta = Math.atan2(y, x) + 0.000003 * Math.cos(x * x_pi);\n    var bd_lon = z * Math.cos(theta) + 0.0065;\n    var bd_lat = z * Math.sin(theta) + 0.006;\n    return [bd_lat, bd_lon];\n}\n\nfunction wgs2bd(lat, lon) {\n\n    var gcj = wgs2gcj(lat, lon);\n\n    var bd = gcj2bd(gcj[0], gcj[1]);\n    return bd;\n}\n\n\n//百度坐标转换结束\n\nvar convertData = function(csvdata) {\n    var res = {\n        'education': [],\n        'hospital': [],\n        'scope': [],\n        'shopping': []\n    };\n    var rows = csvdata.split('\\n');\n    for (var i in rows) {\n        if (i < 1)\n            continue;\n        var row = rows[i].split(',');\n        //console.log(row);\n        if (row[0]) {\n            var bd = wgs2bd(parseFloat(row[1]), parseFloat(row[2]));\n\n            res[row[3]].push({\n                \"name\": row[0],\n                \"value\": [bd[1].toFixed(4), bd[0].toFixed(4), parseInt(row[4])]\n            });\n        }\n    }\n    //console.log(res);\n\n    return res;\n};\n\nvar max = 86029,\n    min = 1; // todo \n\n\n\nvar option = {\n    // backgroundColor: '#404a59',\n    tooltip: {\n        trigger: 'item'\n    },\n    title: {\n        text: \"厦门老人乘公交出行热门起点站热力图\",\n        subtext: \"2014年5月\",\n        textStyle: {\n            color: 'blue',\n            fontSize: 30\n        },\n        subtextStyle: {\n            fontSize: 20\n        },\n        right: '10%'\n    },\n    bmap: {\n        roam: true,\n    },\n    legend: {\n        x:'right',\n        y:'center',\n        orient:'vertical',\n        selectedMode:'single',\n        data: ['学校', '医院', '公园', '购物'],\n        color: [ 'blue', 'green', 'yellow', 'red'],\n    },\n            visualMap: {\n            show: false,\n            top: 'top',\n            min: 0,\n            max: 5,\n            seriesIndex: 0,\n            calculable: true,\n            inRange: {\n                color: [ 'blue', 'green', 'yellow', 'red']\n            }\n        },\n    series: [{\n            name: '学校',\n            type: 'heatmap',\n            coordinateSystem: 'bmap',\n            pointSize: 5,\n            blurSize: 6\n\n        },\n        {\n            name: '医院',\n            type: 'heatmap',\n            coordinateSystem: 'bmap',\n            pointSize: 5,\n            blurSize: 6\n\n        },\n        {\n            name: '公园',\n            type: 'heatmap',\n            coordinateSystem: 'bmap',\n            pointSize: 5,\n            blurSize: 6\n        },\n        {\n            name: '购物',\n            type: 'heatmap',\n            coordinateSystem: 'bmap',\n            pointSize: 5,\n            blurSize: 6\n\n        },\n    ]\n\n};\n\n$.ajax({\n    \"url\": uploadedDataURL,\n    \"dataType\": \"text\",\n    \"method\": \"GET\",\n    \"success\": function(csvdata) {\n        var res = convertData(csvdata);\n        option.series[0].data = res['education'];\n        option.series[1].data = res['hospital'];\n        option.series[2].data = res['scope'];\n        option.series[3].data = res['shopping'];\n        \n        console.log(option.series);\n        myChart.setOption(option);\n        // console.log(option);\n        //获取echart中使用的bmap实例\n        var map = myChart.getModel().getComponent('bmap').getBMap();\n        map.disableDoubleClickZoom();\n        map.centerAndZoom(\"厦门\", 14);\n\n\n    },\n});","html":"","externalScripts":"http://api.map.baidu.com/api?v=2.0&ak=BFcd9e84753ab8dcef34748bc43f952d,/dep/echarts/latest/extension/bmap.min.js","updaterUID":"bd-939842705","theme":"","layout":"","viewCount":32,"userName":"j***h","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xVds4hEtJA.png?v=1560951247661","isCustomThumbnail":0,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"j***h"}}