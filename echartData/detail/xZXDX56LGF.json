{"status":0,"data":{"cid":"xZXDX56LGF","authorUid":"obd-oEOgfrW8Vm6QmnUTJhd5d6ZAIjdU74N","authorUserName":"k***f","title":"Sankey Diagram","description":"点击找到所有子集，孙集和一层父级","latestVersion":3,"alwaysLatest":0,"createTime":"2021-12-10T09:22:06.000Z","lastUpdateTime":"2022-01-20T07:40:29.000Z","auth":1,"uid":"obd-oEOgfrW8Vm6QmnUTJhd5d6ZAIjdU74N","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.9.0","versionCreateTime":"2022-01-20T07:40:29.000Z","code":"var ROOT_PATH = 'https://cdn.jsdelivr.net/gh/apache/echarts-website@asf-site/examples';\n\nmyChart.showLoading();\n$.get(ROOT_PATH + '/data/asset/data/energy.json', function (data) {\n    myChart.hideLoading();\n\n    myChart.setOption(option = {\n        title: {\n            text: 'Sankey Diagram'\n        },\n        tooltip: {\n            trigger: 'item',\n            triggerOn: 'mousemove'\n        },\n        series: [\n            {\n                type: 'sankey',\n                data: data.nodes,\n                links: data.links,\n                emphasis: {\n                    focus: 'adjacency'\n                },\n                lineStyle: {\n                    color: 'source',\n                    curveness: 0.5\n                }\n            }\n        ]\n    });\n    \n    \n    let isSelected = false, cacheName = '';\n    myChart.on('click',(e) => {\n        // console.log(e,drawData)\n        if(e.data.source) return;\n        let {name} = e;\n        let {links,nodes} = _.cloneDeep(data);\n        let options = myChart.getOption();\n        if(cacheName !== name){\n            isSelected = false;\n        }\n        cacheName = name;\n        if(!isSelected){\n            let selectedNodesParent = [];\n            let selectedNodesChilds = [];\n            let allSelectedNodes = []\n            let allSelectedLinks = []\n            let allParentsNames = [name]\n            let allChildsNames = []\n            \n            function findParentNodes(nm){\n                selectedNodesParent = links.filter(item => {\n                    return item.target === nm;\n                }).map(item=>{\n                    allParentsNames.push(item.source)\n                    return [{\n                        name: item.source,\n                        itemStyle: {\n                            // color: '#1DFA7C',\n                            opacity: 1\n                        },\n                        label: {\n                            fontSize: 12,\n                        }\n                    }];\n                }).flat()\n            }\n            \n            function findChildrenNodes(nm){\n                let tempAry = links.filter(item => {\n                    return item.source === nm;\n                }).map(item=>{\n                    allChildsNames.push(item.source)\n                    return [{\n                        name: item.target,\n                        itemStyle: {\n                            // color: '#1DFA7C',\n                            opacity: 1\n                        },\n                        label: {\n                            fontSize: 12,\n                        }\n                    }];\n                }).flat()\n                if (tempAry.length) {\n                    tempAry.forEach(item=>{\n                        findChildrenNodes(item.name)\n                    })\n                }\n                selectedNodesChilds = selectedNodesChilds.concat(tempAry)\n            }\n            \n            findParentNodes(name)\n            findChildrenNodes(name)\n            allSelectedNodes = _.unionBy([...selectedNodesParent, ...selectedNodesChilds, {name, itemStyle: {opacity:1}, label: {fontSize: 12}}], nodes, 'name').map(item=>{\n                if(!item.itemStyle){\n                    item.itemStyle = {\n                        opacity: 0.3\n                    };\n                    item.label = {\n                        show: false\n                    };\n                }\n                return item;\n            })\n            \n            let childrenLinks = links.map(item=>{\n                if (allChildsNames.includes(item.source)){\n                    return {\n                        ...item,\n                        lineStyle: {\n                            // color: '#FFD700',\n                            opacity: .8\n                        }\n                    }\n                } else {\n                    return {\n                        ...item,\n                        lineStyle: {\n                            color: 'transparent',\n                            opacity: 0.3\n                        }\n                    }\n                }\n            })\n            \n            let parentsLinks = links.map(item=>{\n                if (allParentsNames.includes(item.target)){\n                    return {\n                        ...item,\n                        lineStyle: {\n                            // color: '#FFD700',\n                            opacity: .8\n                        }\n                    }\n                } else {\n                    return {\n                        ...item,\n                        lineStyle: {\n                            color: 'transparent',\n                            opacity: 0.3\n                        }\n                    }\n                }\n            })\n            \n            allSelectedLinks = [...parentsLinks, ...childrenLinks]\n            options.series[0].data = allSelectedNodes;\n            options.series[0].links = allSelectedLinks;\n            isSelected = true;\n        }else{\n            options.series[0].data = nodes;\n            options.series[0].links = links;\n            isSelected = false;\n        }\n        myChart.setOption(options);\n    })\n    \n});\n","html":"","externalScripts":"https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.min.js","updaterUID":"obd-o2ST2mKLxBHZAwth_7a5KwG8f6Vq96P","theme":"default","layout":"","viewCount":0,"userName":"k***f","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xZXDX56LGF.png?v=1642664429240","isCustomThumbnail":0,"builtinTags":["category-work","series-sankey","title","tooltip"],"customTags":[],"updaterUserName":"G***睢"}}