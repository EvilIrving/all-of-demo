{"status":0,"data":{"cid":"xbxUJPSiG9","authorUid":"bd-1317263948","authorUserName":"全***果","title":"省市区县多级联动下钻","description":"echarts地图边界数据的实时获取与应用，省市区县多级联动【附最新geoJson文件以及项目源码下载】","latestVersion":2,"alwaysLatest":1,"createTime":"2019-04-21T16:07:33.000Z","lastUpdateTime":"2019-04-21T16:07:33.000Z","auth":2,"uid":"bd-1317263948","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.2.1","versionCreateTime":"2019-04-21T16:08:53.000Z","code":"/**\r\n边界数据的实时获取与应用，省市区县多级联动【附最新geoJson文件下载】\r\n边界数据可以实时获取，也可以结合geojson本地文件加载\r\n\r\ngeojson文件下载地址：https://hxkj.vip/demo/echartsMap/\r\n\r\n项目GitHub地址（欢迎star）：https://github.com/TangSY/echarts-map-demo\r\n\r\n作者：TSY\r\n作者个人空间（欢迎闲逛）：https://hxkj.vip\r\n**/\r\n\r\nvar mapData = [];\r\nthis.opts = {\r\n    subdistrict: 1, //返回下一级行政区\r\n    showbiz: false //最后一级返回街道信息\r\n};\r\nthis.district = new AMap.DistrictSearch(this.opts); //注意：需要使用插件同步下发功能才能这样直接使用\r\nthis.district.search('中国', (status, result) => {\r\n    if (status == 'complete') {\r\n        getData(result.districtList[0], '', 100000);\r\n    }\r\n});\r\n\r\n\r\nfunction getData(data, level, adcode) {\r\n    var bounds = data.boundaries || [];\r\n    if (bounds) {\r\n        for (var i = 0, l = bounds.length; i < l; i++) {\r\n            var polygon = new AMap.Polygon({\r\n                map: this.map,\r\n                strokeWeight: 1,\r\n                strokeColor: '#0091ea',\r\n                fillColor: '#80d8ff',\r\n                fillOpacity: 0.2,\r\n                path: bounds[i]\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    var subList = data.districtList || [];\r\n    if (subList) {\r\n        var contentSub = new Option('--请选择--');\r\n        var curlevel = subList[0].level;\r\n        if (curlevel === 'street') {\r\n            let mapJsonList = this.geoJsonData.features || [];\r\n            let mapJson = {};\r\n            for (let i in mapJsonList) {\r\n                if (mapJsonList[i].properties.name == this.cityName) {\r\n                    mapJson.features = [].concat(mapJsonList[i]);\r\n                }\r\n            }\r\n            mapData = [];\r\n            mapData.push({\r\n                name: this.cityName,\r\n                value: Math.random() * 100,\r\n                level: curlevel\r\n            });\r\n            loadMap(this.cityName, mapJson);\r\n            this.geoJsonData = mapJson;\r\n            return;\r\n        }\r\n\r\n        mapData = [];\r\n        for (var i = 0, l = subList.length; i < l; i++) {\r\n            var name = subList[i].name;\r\n            var cityCode = subList[i].adcode;\r\n            mapData.push({\r\n                name: name,\r\n                value: Math.random() * 100,\r\n                cityCode: cityCode,\r\n                level: curlevel\r\n            });\r\n            var levelSub = subList[i] && subList[i].level;\r\n            contentSub = new Option(name);\r\n            contentSub.setAttribute(\"value\", levelSub);\r\n            contentSub.center = subList[i].center;\r\n            contentSub.adcode = subList[i].adcode;\r\n\r\n        }\r\n        loadMapData(adcode);\r\n    }\r\n\r\n};\r\n\r\nfunction loadMapData(areaCode) {\r\n    AMapUI.loadUI(['geo/DistrictExplorer'], DistrictExplorer => {\r\n\r\n        //创建一个实例\r\n        var districtExplorer = window.districtExplorer = new DistrictExplorer({\r\n            eventSupport: true, //打开事件支持\r\n            map: this.map\r\n        });\r\n\r\n        districtExplorer.loadAreaNode(areaCode, (error, areaNode) => {\r\n\r\n            if (error) {\r\n                console.error(error);\r\n                return;\r\n            }\r\n            let mapJson = {};\r\n            mapJson.features = areaNode.getSubFeatures();\r\n            loadMap(this.cityName, mapJson);\r\n            this.geoJsonData = mapJson;\r\n        });\r\n    });\r\n};\r\n\r\nfunction loadMap(mapName, data) {\r\n    if (Object.keys(data).length !== 0 && data) {\r\n        echarts.registerMap(mapName, data);\r\n        var option = {\r\n            visualMap: {\r\n                type: 'piecewise',\r\n                pieces: [{\r\n                        max: 30,\r\n                        label: '安全',\r\n                        color: '#2c9a42'\r\n                    },\r\n                    {\r\n                        min: 30,\r\n                        max: 60,\r\n                        label: '警告',\r\n                        color: '#d08a00'\r\n                    },\r\n                    {\r\n                        min: 60,\r\n                        label: '危险',\r\n                        color: '#c23c33'\r\n                    },\r\n                ],\r\n                color: '#fff',\r\n                textStyle: {\r\n                    color: '#fff',\r\n                },\r\n                visibility: 'off'\r\n            },\r\n            series: [{\r\n                name: '数据名称',\r\n                type: 'map',\r\n                roam: false,\r\n                mapType: mapName,\r\n                selectedMode: 'single',\r\n                showLegendSymbol: false,\r\n                visibility: 'off',\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: '#ccc',\r\n                        areaColor: '#fff',\r\n                        borderColor: '#fff',\r\n                        borderWidth: 0.5,\r\n                        label: {\r\n                            show: true,\r\n                            textStyle: {\r\n                                color: \"rgb(249, 249, 249)\"\r\n                            }\r\n                        }\r\n                    },\r\n                    emphasis: {\r\n                        areaColor: false,\r\n                        borderColor: '#fff',\r\n                        areaStyle: {\r\n                            color: '#fff'\r\n                        },\r\n                        label: {\r\n                            show: true,\r\n                            textStyle: {\r\n                                color: \"rgb(249, 249, 249)\"\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                data: mapData,\r\n            }]\r\n        };\r\n        myChart.setOption(option);\r\n    }\r\n};\r\nmyChart.on('click', echartsMapClick);\r\nvar that = this;\r\n\r\nfunction echartsMapClick(params) { //地图点击事件\r\n    if (!params.data || params.data.level == 'street') return;\r\n    that.cityName = params.data.name;\r\n    that.cityCode = params.data.cityCode;\r\n    that.district.setLevel(params.data.level); //行政区级别\r\n    that.district.setExtensions('all');\r\n    //行政区查询\r\n    //按照adcode进行查询可以保证数据返回的唯一性\r\n    that.district.search(params.data.cityCode, (status, result) => {\r\n        if (status === 'complete') {\r\n            getData(result.districtList[0], params.data.level, params.data.cityCode);\r\n        }\r\n    });\r\n}","html":"","externalScripts":"https://webapi.amap.com/maps?v=1.4.11&key=35a871e5905ecfd749bd998448b9cd03,https://webapi.amap.com/maps?v=1.4.11&key=35a871e5905ecfd749bd998448b9cd03&plugin=AMap.DistrictSearch,https://webapi.amap.com/ui/1.0/main.js?v=1.0.11","updaterUID":"bd-1317263948","theme":"dark","layout":"","viewCount":34599,"userName":"全***果","commentCount":15,"starCount":91,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xbxUJPSiG9.png?v=1555862855088","isCustomThumbnail":1,"builtinTags":["category-work","series-map","visualMap"],"customTags":[],"updaterUserName":"全***果"}}