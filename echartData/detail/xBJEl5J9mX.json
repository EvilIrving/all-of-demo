{"status":0,"data":{"cid":"xBJEl5J9mX","authorUid":"bd-4029760411","authorUserName":"6002晴","title":"时间轴加类目轴，数据缩放，实线虚线结合，点与坐标不对应","description":"","latestVersion":2,"alwaysLatest":1,"createTime":"2018-07-16T09:48:28.000Z","lastUpdateTime":"2018-07-16T09:48:28.000Z","auth":2,"uid":"bd-4029760411","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.2.1","versionCreateTime":"2019-04-16T03:42:10.000Z","code":"let changeDate = ['2017-03', '2017-04', '2017-05', '2017-06', '2017-07', '2017-08', '2017-09', '2017-10', '2017-11', '2017-12', '2018-01', '2018-02', '2018-03', '2018-04', '2018-05', '2018-06', '2018-07'];\r\nlet costData = [{\r\n    startDate: '2017-03-01',\r\n    endDate: '2017-03-31',\r\n    cost: 900000,\r\n    costState: '已确认',\r\n    count: 88\r\n}, {\r\n    startDate: '2017-04-01',\r\n    endDate: '2017-04-30',\r\n    cost: 300000,\r\n    costState: '已确认',\r\n    count: 88\r\n}, {\r\n    startDate: '2017-05-01',\r\n    endDate: '2017-05-31',\r\n    cost: 850000,\r\n    costState: '已确认',\r\n    count: 88\r\n}, {\r\n    startDate: '2017-06-01',\r\n    endDate: '2017-06-15',\r\n    cost: 800000,\r\n    costState: '已确认',\r\n    count: 88\r\n}, {\r\n    startDate: '2017-06-16',\r\n    endDate: '2017-06-30',\r\n    cost: 1000000,\r\n    costState: '已确认',\r\n    count: 88\r\n}, {\r\n    startDate: '2017-07-01',\r\n    endDate: '2017-07-04',\r\n    cost: 1100000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2017-07-05',\r\n    endDate: '2017-07-21',\r\n    costState: '已确认',\r\n    cost: 880000,\r\n    count: 99\r\n}, {\r\n    startDate: '2017-08-01',\r\n    endDate: '2017-08-31',\r\n    costState: '已确认',\r\n    cost: 120000,\r\n    count: 99\r\n}, {\r\n    startDate: '2017-09-01',\r\n    endDate: '2017-09-30',\r\n    cost: 300000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2017-10-01',\r\n    endDate: '2017-10-20',\r\n    cost: 700000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2017-10-21',\r\n    endDate: '2017-11-15',\r\n    cost: 700000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2017-11-16',\r\n    endDate: '2017-11-20',\r\n    cost: 800000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2017-12-01',\r\n    endDate: '2017-12-31',\r\n    cost: 600000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-01-01',\r\n    endDate: '2018-01-31',\r\n    cost: 500000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-02-01',\r\n    endDate: '2018-02-28',\r\n    cost: 300000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-03-01',\r\n    endDate: '2018-03-31',\r\n    cost: 900000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-04-01',\r\n    endDate: '2018-04-30',\r\n    cost: 300000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-05-01',\r\n    endDate: '2018-05-31',\r\n    cost: 850000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-06-01',\r\n    endDate: '2018-06-15',\r\n    cost: 800000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-06-16',\r\n    endDate: '2018-06-30',\r\n    cost: 850000,\r\n    costState: '已确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-07-01',\r\n    endDate: '2018-07-04',\r\n    cost: 1100000,\r\n    costState: '未确认',\r\n    count: 99\r\n}, {\r\n    startDate: '2018-07-05',\r\n    endDate: '2018-07-21',\r\n    cost: 880000,\r\n    costState: '未确认',\r\n    count: 99\r\n}];\r\n\r\nfunction getMinusDays(date1, date2) {\r\n    var date1Str = date1.split('-');\r\n    var date1Obj = new Date(date1Str[0], (date1Str[1] - 1), date1Str[2]);\r\n    var date2Str = date2.split('-');\r\n    var date2Obj = new Date(date2Str[0], (date2Str[1] - 1), date2Str[2]);\r\n    var t1 = date1Obj.getTime();\r\n    var t2 = date2Obj.getTime();\r\n    var dateTime = 1000 * 60 * 60 * 24;\r\n    var minusDays = Math.floor(((t2 - t1) / dateTime));\r\n    var days = Math.abs(minusDays);\r\n    return days;\r\n}\r\n\r\nfunction addDays(date1, count) {\r\n    var date1Str = date1.split('-');\r\n    var date1Obj = new Date(date1Str[0], (date1Str[1] - 1), date1Str[2]);\r\n    date1Obj.setDate(date1Obj.getDate() + count);\r\n    let midDate = date1Obj.getFullYear() + '-' + (date1Obj.getMonth() + 1) + '-' + date1Obj.getDate();\r\n    return midDate;\r\n}\r\n\r\nlet cost = [];\r\n\r\nfor (let i = 0; i < costData.length; i++) {\r\n    let midDate = addDays(costData[i].startDate, getMinusDays(costData[i].startDate, costData[i].endDate) / 2);\r\n    cost.push({\r\n        name: costData[i].startDate + ' ~ ' + costData[i].endDate,\r\n        value: [midDate, costData[i].cost]\r\n    });\r\n}\r\n\r\nlet costChange = {\r\n    changeDate: changeDate,\r\n    cost: cost,\r\n    minDate: costData[0].startDate.slice(0, 7) + '-01',\r\n    maxDate: costData[costData.length - 1].endDate.slice(0, 7) + '-31',\r\n    dashLastStart: 2\r\n};\r\n\r\nlet monthCount = costChange.changeDate.length;\r\nlet data = costChange.cost;\r\nlet chartData = {\r\n    xAxisNames: costChange.changeDate,\r\n    seriesData: data,\r\n    axisLabelFormatter: '{value}w',\r\n    name: '费用',\r\n    seriesDash: true,\r\n    dashStart: data.length - costChange.dashLastStart,\r\n    minDate: costChange.minDate,\r\n    maxDate: costChange.maxDate,\r\n    scrollLen: Math.ceil(100 - 12 / this.monthCount * 100),\r\n    showScroll: this.monthCount > 12,\r\n    bottom: this.monthCount > 12 ? 50 : 0\r\n};\r\n\r\nlet seriesData = [];\r\nconsole.log(chartData.seriesData);\r\nif (chartData.seriesDash) {\r\n    let len = chartData.seriesData.length;\r\n    let minusArr = [];\r\n    for (let i = 0; i < len; i++) {\r\n        minusArr.push({\r\n            name: '-',\r\n            value: []\r\n        });\r\n    }\r\n    seriesData = [{\r\n            name: chartData.name,\r\n            symbol: 'circle',\r\n            symbolSize: 12,\r\n            type: 'line',\r\n            smooth: false,\r\n            data: (chartData.seriesData.slice(0, chartData.dashStart)).concat(minusArr.slice(0, len - chartData.dashStart))\r\n        },\r\n        {\r\n            name: chartData.name,\r\n            symbol: 'emptyCircle',\r\n            symbolSize: 6,\r\n            type: 'line',\r\n            smooth: false,\r\n            data: (chartData.seriesData.slice(0, chartData.dashStart)).concat(minusArr.slice(0, len - chartData.dashStart))\r\n        },\r\n        {\r\n            name: chartData.name,\r\n            symbol: 'circle',\r\n            symbolSize: 12,\r\n            type: 'line',\r\n            smooth: false,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: '#95EBE1',\r\n                    lineStyle: {\r\n                        width: 2,\r\n                        type: 'dashed'\r\n                    }\r\n                }\r\n            },\r\n            data: (minusArr.slice(0, chartData.dashStart - 1)).concat(chartData.seriesData.slice(chartData.dashStart - 1, len))\r\n        },\r\n        {\r\n            name: chartData.name,\r\n            symbol: 'circle',\r\n            symbolSize: 6,\r\n            type: 'line',\r\n            smooth: false,\r\n            itemStyle: {\r\n                normal: {\r\n                    lineStyle: {\r\n                        width: 2,\r\n                        type: 'dotted'\r\n                    }\r\n                }\r\n            },\r\n            data: (minusArr.slice(0, chartData.dashStart - 1)).concat(chartData.seriesData.slice(chartData.dashStart - 1, len))\r\n        },\r\n        {\r\n            name: chartData.name,\r\n            symbol: 'circle',\r\n            symbolSize: 12,\r\n            type: 'line',\r\n            smooth: false,\r\n            data: (minusArr.slice(0, chartData.dashStart - 1)).concat(chartData.seriesData.slice(chartData.dashStart - 1, chartData.dashStart)).concat(minusArr.slice(0, len - chartData.dashStart))\r\n        },\r\n        {\r\n            name: chartData.name,\r\n            symbol: 'emptyCircle',\r\n            symbolSize: 6,\r\n            type: 'line',\r\n            smooth: false,\r\n            data: (minusArr.slice(0, chartData.dashStart - 1)).concat(chartData.seriesData.slice(chartData.dashStart - 1, chartData.dashStart)).concat(minusArr.slice(0, len - chartData.dashStart))\r\n        }\r\n    ];\r\n} else {\r\n    seriesData = [{\r\n            name: chartData.name,\r\n            symbol: 'circle',\r\n            symbolSize: 12,\r\n            type: 'line',\r\n            data: chartData.seriesData\r\n        },\r\n        {\r\n            name: chartData.name,\r\n            symbol: 'emptyCircle',\r\n            symbolSize: 6,\r\n            type: 'line',\r\n            data: chartData.seriesData\r\n        }\r\n    ];\r\n}\r\n\r\nlet xAxisNames1 = [];\r\nfor (let i = 0; i < chartData.seriesData.length; i++) {\r\n    xAxisNames1.push('-');\r\n}\r\noption = {\r\n    color: '#28BBAB',\r\n    backgroundColor: '#404a59',\r\n    tooltip: {\r\n        backgroundColor: 'rgba(46, 126, 139, 0.90)',\r\n        padding: [10, 20, 10, 8],\r\n        textStyle: {\r\n            fontSize: 12,\r\n            lineHeight: 24\r\n        },\r\n        trigger: 'axis',\r\n        axisPointer: {\r\n            type: 'line',\r\n            lineStyle: {\r\n                type: 'dashed',\r\n                color: '#28BBAB'\r\n            }\r\n        },\r\n        formatter: function(params, ticket, callback) {\r\n            callback;\r\n            var htmlStr = '';\r\n            var valMap = {};\r\n            for (var i = 0; i < params.length; i++) {\r\n                var param = params[i];\r\n                var xName = param.name;\r\n                var seriesName = param.seriesName;\r\n                var value = param.value;\r\n                // var color = param.color;\r\n                if (value.length === 0) {\r\n                    continue;\r\n                }\r\n                if (valMap[seriesName] && valMap[seriesName][0] === value[0] && valMap[seriesName][1] === value[1]) {\r\n                    continue;\r\n                }\r\n                htmlStr += xName;\r\n                // if (chartData.dashStart && params[0].dataIndex >= chartData.dashStart) {\r\n                //     htmlStr += '预估';\r\n                // }\r\n                htmlStr += '<br/><div>';\r\n                // htmlStr += '<span style=\"margin-right:5px;display:inline-block;width:10px;height:10px;border-radius:5px;background-color:' + color + ';\"></span>';\r\n                htmlStr += seriesName + '：' + value[1];\r\n                htmlStr += '</div>';\r\n                valMap[seriesName] = value;\r\n            }\r\n            return htmlStr;\r\n        }\r\n    },\r\n    grid: {\r\n        left: 40,\r\n        right: 14,\r\n        bottom: 80,\r\n        top: 20\r\n    },\r\n    dataZoom: [{\r\n        type: 'slider',\r\n        zoomLock: true,\r\n        show: true,\r\n        labelFormatter: () => {\r\n            return '';\r\n        },\r\n        realtime: true,\r\n        start: 30,\r\n        filterMode: 'none',\r\n        end: 100,\r\n        throttle: 0,\r\n        dataBackground: {\r\n            lineStyle: {\r\n                opacity: 0\r\n            },\r\n            areaStyle: {\r\n                opacity: 0\r\n            }\r\n        },\r\n        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\r\n        handleSize: '80%',\r\n        handleStyle: {\r\n            color: '#fff',\r\n            shadowBlur: 3,\r\n            shadowColor: 'rgba(0, 0, 0, 0.6)',\r\n            shadowOffsetX: 2,\r\n            shadowOffsetY: 2\r\n        },\r\n        xAxisIndex: 0\r\n    }],\r\n    xAxis: [{\r\n        type: 'time',\r\n        min: chartData.minDate,\r\n        max: chartData.maxDate,\r\n        interval: 3600 * 24 * 1000,\r\n        // minInterval: 3600 * 24 * 1000 * 30,\r\n        // maxInterval: 3600 * 24 * 1000 * 31,\r\n        data: xAxisNames1,\r\n        splitLine: {\r\n            show: false\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        },\r\n        axisLabel: {\r\n            color: '#ADB9C7',\r\n            formatter: function(value) {\r\n                let date = new Date(value);\r\n                let day = date.getDate();\r\n                if (day === 16) {\r\n                    let year = date.getFullYear();\r\n                    let month = date.getMonth() + 1;\r\n                    month = month <= 9 ? ('0' + month) : month;\r\n                    return year + '-' + month;\r\n                } else {\r\n                    return '';\r\n                }\r\n            }\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        axisPointer: {\r\n            triggerTooltip: true\r\n        }\r\n    }],\r\n    yAxis: {\r\n        type: 'value',\r\n        axisLine: {\r\n            show: false,\r\n            lineStyle: {\r\n                color: '#999'\r\n            }\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        splitLine: {\r\n            lineStyle: {\r\n                color: '#999'\r\n            }\r\n        },\r\n        axisLabel: {\r\n            color: '#ADB9C7',\r\n            formatter: function(value) {\r\n                if (chartData.axisLabelFormatter === '{value}w') {\r\n                    return (parseInt(value, 10) / 10000) + 'w';\r\n                } else {\r\n                    return value;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    series: seriesData\r\n};","html":"","externalScripts":"","updaterUID":"bd-4029760411","theme":"","layout":"","viewCount":13398,"userName":"6002晴","commentCount":1,"starCount":32,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xBJEl5J9mX.png?v=1555386130423","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","series-line","tooltip"],"customTags":[],"updaterUserName":"6002晴"}}