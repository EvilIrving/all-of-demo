{"status":0,"data":{"cid":"xr1G4qb1uf","authorUid":"bd-442035385","authorUserName":"小***了","title":"2016年各省市GDP中各产业占比（为饼图不互相重叠，修改了经纬度）","description":"地图上配置饼图","latestVersion":68,"alwaysLatest":1,"createTime":"2018-02-24T15:52:10.000Z","lastUpdateTime":"2019-05-22T11:09:24.000Z","auth":2,"uid":"bd-442035385","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":68,"parentVersion":41,"echartsVersion":"3.8.0","versionCreateTime":"2019-05-22T11:09:10.000Z","code":"//数据定义区\r\n//参见秋枫雁飞\r\n//改进之处：地图visualmap和饼图相结合，修改了经纬坐标防止饼图重叠\r\nvar province = ['北京', '天津', '河北', '山西', '内蒙古', '辽宁', '吉林', '黑龙江', '上海', '江苏', '浙江', '安徽', '福建', '江西', '山东', '河南', '湖北', '湖南', '广东', '广西', '海南', '重庆', '四川', '贵州', '云南', '西藏', '陕西', '甘肃', '青海', '宁夏', '新疆'];\r\nvar gdp = [\r\n    //['第一产业','第二产业','第三产业',‘GDP’]\r\n    [129.79, 4944.44, 20594.9, 25669.13],\r\n    [220.22, 7571.35, 10093.82, 17885.39],\r\n    [3492.81, 15256.93, 13320.71, 32070.45],\r\n    [784.78, 5028.99, 7236.64, 13050.41],\r\n    [1637.39, 8553.63, 7937.08, 18128.1],\r\n    [2173.06, 8606.54, 11467.3, 22246.9],\r\n    [1498.52, 7004.95, 6273.33, 14776.8],\r\n    [2670.46, 4400.69, 8314.94, 15386.09],\r\n    [109.47, 8406.28, 19662.9, 28178.65],\r\n    [4077.18, 34619.5, 38691.6, 77388.28],\r\n    [1965.18, 21194.61, 24091.57, 47251.36],\r\n    [2567.72, 11821.58, 10018.32, 24407.62],\r\n    [2363.22, 14093.47, 12353.89, 28810.58],\r\n    [1904.53, 8829.54, 7764.93, 18499],\r\n    [4929.13, 31343.67, 31751.69, 68024.49],\r\n    [4286.21, 19275.82, 16909.76, 40471.79],\r\n    [3659.33, 14654.38, 14351.67, 32665.38],\r\n    [3578.37, 13341.17, 14631.83, 31551.37],\r\n    [3694.37, 35109.66, 42050.88, 80854.91],\r\n    [2796.8, 8273.66, 7247.18, 18317.64],\r\n    [948.35, 905.95, 2198.9, 4053.2],\r\n    [1303.24, 7898.92, 8538.43, 17740.59],\r\n    [3929.33, 13448.92, 15556.29, 32934.54],\r\n    [1846.19, 4669.53, 5261.01, 11776.73],\r\n    [2195.11, 5690.16, 6903.15, 14788.42],\r\n    [115.78, 429.17, 606.46, 1151.41],\r\n    [1693.85, 9490.72, 8215.02, 19399.59],\r\n    [983.39, 2515.56, 3701.42, 7200.37],\r\n    [221.19, 1249.98, 1101.32, 2572.49],\r\n    [241.6, 1488.44, 1438.55, 3168.59],\r\n    [1648.97, 3647.01, 4353.72, 9649.7]\r\n]\r\nvar typeIndex = 1;\r\nvar selectedRange = null;\r\nvar option = null;\r\nvar str = \"\";\r\nvar data = [];\r\nvar geoCoordMap = {};\r\nvar name = \"2016年各省市GDP及各产业占比\"\r\nvar mapName = 'china'\r\n// 地图特征\r\nvar mapFeatures = echarts.getMap(mapName).geoJson.features;\r\nfor (var i = 0; i < province.length; i++) {\r\n    data.push({\r\n        \"name\": province[i],\r\n        \"value\": [{\r\n                \"name\": '第一产业',\r\n                value: gdp[i][0]\r\n            },\r\n            {\r\n                \"name\": '第二产业',\r\n                value: gdp[i][1]\r\n            },\r\n            {\r\n                \"name\": '第三产业',\r\n                value: gdp[i][2]\r\n            }\r\n        ]\r\n    })\r\n}\r\nvar geoCoordMap = { //为了保证饼图不互相重叠，我对经纬坐标进行了调整\r\n    '上海':  [121.472644,  31.231706],\r\n    '云南':  [102.712251,  24.040609],\r\n    '内蒙古':  [111.670801,  40.818311],\r\n    '北京':  [116.405285,  39.904989],\r\n    // '台湾': [121.509062, 25.044332],\r\n    '吉林':  [125.3245,  43.886841],\r\n    '四川':  [103.065735,  30.659462],\r\n    '天津':  [119.190182,  39.125596],\r\n    '宁夏':  [106.278179,  38.46637],\r\n    '安徽':  [117.283042,  31.86119],\r\n    '山东':  [118.000923,  36.675807],\r\n    '山西':  [112.049248,  37.057014],\r\n    '广东':  [113.280637,  23.125178],\r\n    '广西':  [108.320004,  22.82402],\r\n    '新疆':  [87.617733,  43.792818],\r\n    '江苏':  [119.467413,  33.741544],\r\n    '江西':  [115.892151,  28.676493],\r\n    '河北':  [114.802461,  37.745474],\r\n    '河南':  [113.665412,  33.757975],\r\n    '浙江':  [120.153576,  29.287459],\r\n    '海南':  [110.33119,  20.031971],\r\n    '湖北':  [113.298572,  30.984355],\r\n    '湖南':  [112.12279,  28.19409],\r\n    // '澳门': [113.54909, 22.198951],\r\n    '甘肃':  [103.823557,  36.058039],\r\n    '福建':  [119.306239,  26.075302],\r\n    '西藏':  [91.132212,  29.660361],\r\n    '贵州':  [106.713478,  26.578343],\r\n    '辽宁':  [123.029096,  41.396767],\r\n    '重庆':  [106.504962,  29.933155],\r\n    '陕西':  [108.948024,  34.263161],\r\n    '青海':  [100.578916,  36.623178],\r\n    // '香港': [114.173355, 22.320048],\r\n    '黑龙江':  [126.642464,  46.756967],\r\n}\r\n// 地理坐标图(打印出来方便查看)\r\nconsole.log(\"===========geoCoordMap===============\");\r\nfor (var i in geoCoordMap) {\r\n    console.log(geoCoordMap[i]);\r\n}\r\nconsole.log(geoCoordMap);\r\nconsole.log(\"==============data===============\");\r\nconsole.log(data);\r\n\r\n/*变换地图数据（格式）：pie*/\r\nfunction convertMapDta(type, data) {\r\n    var mapData = [];\r\n    for (var i = 0; i < data.length; i++) {\r\n        mapData.push({\r\n            'name': province[i],\r\n            \"value\": gdp[i][3]\r\n        })\r\n    }\r\n    return mapData;\r\n}\r\n\r\nconsole.log(\"================mapData==================\")\r\n// console.log(convertMapDta_bar(province[typeIndex],data))\r\nconsole.log(convertMapDta(province[typeIndex], data))\r\nconsole.log(\"=========================================\")\r\n\r\n/*resetPie*/\r\nfunction resetPie(myChart, params, geoCoordMap, typeIndex) {\r\n    var op = myChart.getOption();\r\n    var ops = op.series;\r\n    ops.forEach(function(v, i) {\r\n        if (i > 0) {\r\n            var geoCoord = geoCoordMap[v.name];\r\n            var p = myChart.convertToPixel({\r\n                seriesIndex: 0\r\n            }, geoCoord);\r\n            v.center = p;\r\n            if (params != 0 && params.zoom) {\r\n                v.radius = v.radius * params.zoom;\r\n            }\r\n            if (params != 0 && params.selected) {\r\n                var rangeFirstNumber = params.selected[0];\r\n                var rangeSecondNumber = params.selected[1];\r\n                var pd = v.data[typeIndex].value;\r\n                if (pd < rangeFirstNumber || pd > rangeSecondNumber) {\r\n                    v.itemStyle.normal.opacity = 0;\r\n                } else {\r\n                    v.itemStyle.normal.opacity = 1;\r\n                }\r\n            }\r\n        }\r\n    });\r\n    myChart.setOption(op, true);\r\n}\r\n\r\n/*addPie*/\r\nfunction addPie(chart, data) {\r\n    var op = chart.getOption();\r\n    var sd = option.series;\r\n    for (var i = 0; i < data.length; i++) {\r\n        var randomValue = 15;\r\n        var radius = randomValue;\r\n        var geoCoord = geoCoordMap[data[i].name];\r\n        if (geoCoord) {\r\n            var vr = [];\r\n            (data[i].value).map(function(v) {\r\n                vr.push({\r\n                    name: v.name,\r\n                    value: v.value,\r\n                    visualMap: false\r\n                }); //饼图的数据不进行映射\r\n            });\r\n            var p = chart.convertToPixel({\r\n                seriesIndex: 0\r\n            }, geoCoord);\r\n            sd.push({\r\n                name: data[i].name,\r\n                type: 'pie',\r\n                // roseType: 'radius',\r\n                tooltip: {\r\n                    formatter: function(params) {\r\n                        return params.seriesName + \"<br/>\" + params.name + \" : \" + params.value + ' 亿元';\r\n                    }\r\n                },\r\n                radius: radius,\r\n                center: p,\r\n                data: vr,\r\n                zlevel: 4,\r\n                tooltip: {\r\n                    formatter: '{a}<br/>{b}: {c}亿元 ({d}%)'\r\n                },\r\n                label: {\r\n                    normal: {\r\n                        show: false,\r\n                    },\r\n                },\r\n                labelLine: {\r\n                    normal: {\r\n                        show: false\r\n                    }\r\n                },\r\n                itemStyle: {\r\n                    opacity: 0.2\r\n                }\r\n            });\r\n        }\r\n    }\r\n    return sd;\r\n};\r\n\r\n\r\n/* 指定图表的配置项和数据:pie*/\r\nvar option = {\r\n    title: {\r\n        text: name,\r\n        left: 'center',\r\n        textStyle: {\r\n            color: 'black'\r\n        }\r\n    },\r\n    legend: {\r\n        data: ['第三产业', '第二产业', '第一产业'],\r\n        orient: 'vertical',\r\n        top: '10%',\r\n        left: 'left',\r\n        zlevel: 4\r\n    },\r\n    toolbox: {\r\n        feature: {\r\n            saveAsImage: {\r\n                pixelRatio: 5\r\n            }\r\n        }\r\n    },\r\n    tooltip: {\r\n        trigger: 'item',\r\n        formatter: function(params) {\r\n            if (params.value) {\r\n                return params.name + \"<br/>\" + \"GDP: \" + params.value + \"亿元\";\r\n            }\r\n        }\r\n    },\r\n    visualMap: {\r\n        type: 'continuous',\r\n        show: true,\r\n        min: 0,\r\n        max: 100000,\r\n        left: 'left',\r\n        top: 'bottom',\r\n        text: ['高    (亿元)', '低    (亿元)'], // 文本，默认为数值文本\r\n        calculable: true,\r\n        // seriesIndex: [0],\r\n        inRange: {\r\n            // color: ['#3B5077', '#031525'] // 蓝黑\r\n            // color: ['#ffc0cb', '#800080'] // 红紫\r\n            // color: ['#3C3B3F', '#605C3C'] // 黑绿\r\n            // color:['#3C3B3F','#EE2C2C']//黑红\r\n            color: ['lightskyblue', 'yellow', 'orangered']\r\n            // color: ['#0f0c29', '#302b63', '#24243e'] // 黑紫黑\r\n            // color: ['#23074d', '#cc5333'] // 紫红\r\n            // color: ['#00467F', '#A5CC82'] // 蓝绿\r\n            // color: ['#1488CC', '#2B32B2'] // 浅蓝\r\n            // color: ['#00467F', '#A5CC82'] // 蓝绿\r\n        }\r\n    },\r\n\r\n    series: [{\r\n        name: 'chinaMap',\r\n        type: 'map',\r\n        mapType: mapName,\r\n        roam: true,\r\n\r\n        label: {\r\n            normal: {\r\n                show: false,\r\n            },\r\n            emphasis: {\r\n                show: true\r\n            }\r\n        },\r\n        geo: {\r\n            show: true,\r\n            map: mapName,\r\n            label: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: false,\r\n                }\r\n            },\r\n            roam: true,\r\n            itemStyle: {\r\n                normal: {\r\n                    areaColor: '#031525',\r\n                    borderColor: '#3B5077',\r\n                },\r\n                emphasis: {\r\n                    areaColor: '#2B91B7',\r\n                }\r\n            }\r\n        },\r\n\r\n        data: convertMapDta(province[typeIndex], data),\r\n        zlevel: 3\r\n    }]\r\n};\r\nconsole.log('========visualMapdata==========')\r\nconsole.log(convertMapDta(province[typeIndex], data))\r\nif (option && typeof option === \"object\") {\r\n    myChart.setOption(option, true);\r\n}\r\n/*pie*/\r\naddPie(myChart, data);\r\n/*bar*/\r\n// addBar(myChart,data);\r\nconsole.log(\"===========option=================\");\r\nconsole.log(option);\r\nmyChart.setOption(option, true);\r\n\r\n/*饼图跟着地图移动:pie*/\r\nmyChart.on('georoam', function(params) {\r\n    resetPie(myChart, params, geoCoordMap, typeIndex);\r\n});\r\nmyChart.on('datarangeselected', function(params) {\r\n    resetPie(myChart, params, geoCoordMap, typeIndex);\r\n});\r\nwindow.addEventListener(\"resize\", function() {\r\n    myChart.resize();\r\n    resetPie(myChart, 0, geoCoordMap);\r\n})\r\n\r\n\r\nmyChart.setOption(option);","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-442035385","theme":"default","layout":"","viewCount":26754,"userName":"小***了","commentCount":7,"starCount":54,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xr1G4qb1uf.png?v=1558523350743","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-map","series-pie","title","toolbox","tooltip","visualMap"],"customTags":[],"updaterUserName":"小***了"}}