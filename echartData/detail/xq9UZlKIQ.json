{"status":0,"data":{"cid":"xq9UZlKIQ","authorUid":"bd-4161428444","authorUserName":"b***n","title":"疫情新增趋势图","description":"jsonp数据","latestVersion":17,"alwaysLatest":1,"createTime":"2020-02-11T14:52:20.000Z","lastUpdateTime":"2020-02-11T14:52:20.000Z","auth":2,"uid":"bd-4161428444","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":17,"parentVersion":16,"echartsVersion":"4.7.0","versionCreateTime":"2020-04-24T14:41:01.000Z","code":"//声明jsonp函数\r\nfunction jsonp(url, callback, callbackname){ //给系统中创建一个全局变量，叫做callbackname，指向callback函数名\r\n\t//定义一个处理Jsonp返回数据的回调函数\r\n\twindow[callbackname] = callback;\r\n\t//创建一个script节点\r\n\tvar script = document.createElement(\"script\");\r\n\t    script.src = url;\r\n\t    script.type = \"text/javascript\";\t\t\t\r\n\tdocument.getElementsByTagName(\"body\")[0].appendChild(script); //将创建的新节点添加到BOM树上  \r\n\tsetTimeout(function(){\r\n\t\tdocument.body.removeChild(script); //为了不污染页面，把script拿掉\r\n\t}, 500);\r\n}\r\nconsole.log(\"数据来源：\"+\"%c https://m.look.360.cn\", \"color:#00cc00\");\r\nvar jsonpURL ='https://m.look.360.cn/events/feiyanTrend?sv=&version=&market=&device=2&net=4&stype=&scene=&sub_scene=&refer_scene=&refer_subscene=&f=jsonp&_=1581431223974&callback=jsonp2&callback=jsonp2';\r\n//调用jsonp函数发送jsonp请求的callback\r\njsonp(jsonpURL, function(data){\r\n\tvar chartsJSON = data.data.timeline; // 发送请求成功后开始执行，data是请求成功后，返回的数据\r\n    console.log(chartsJSON);\r\n\tvar dateTime = [],\t\t//日期\r\n\t    diagnosed_add = [], //新增确诊\r\n\t    suspected_add = [], //新增疑似\r\n\t    cured_add = [],     //新增治愈\r\n\t    died_add = [];      //新增死亡\r\n\r\n\tchartsJSON.reverse(); //排序\r\n\r\n\t//for循环chartsJSON\r\n\tfor (var i = 0; i < chartsJSON.length-1; i++) {\r\n\t\tdateTime.push(chartsJSON[i].total.dateTime);\r\n\t    diagnosed_add.push(chartsJSON[i].total.diagnosed_add);\r\n\t    suspected_add.push(chartsJSON[i].total.suspected_add);\r\n\t    cured_add.push(chartsJSON[i].total.cured_add);\r\n\t    died_add.push(chartsJSON[i].total.died_add);\r\n\t};\r\n    //统计\r\n    const subTotal = data.data.total; \r\n\tvar sumModifyTime = subTotal.modifyTime,\t  //时间\r\n\t\tsumConfirmed = subTotal.currentConfirmed, //现有确诊 \r\n\t\tsumDiagnosed = subTotal.diagnosed,        //累计确诊\r\n\t\tsumSerious = subTotal.serious,        \t  //重症\r\n\t\tsumOverseasInput = subTotal.overseasInput,//境外输入确诊\r\n\t\tsumSuspected = subTotal.suspected,    \t  //现有疑似\r\n\t\tsumCured = subTotal.cured,            \t  //治愈\r\n\t\tsumDied = subTotal.died;              \t  //死亡\r\n\t//较昨日\r\n\tconst subDiff = data.data.newDiff;\r\n\tvar diffConfirmed = subDiff.currentConfirmed,\r\n\t\tdiffDiagnosed = subDiff.diagnosed,\r\n\t\tdiffSerious = subDiff.serious,\r\n\t\tdiffOverseasInput = subDiff.overseasInput,\r\n\t\tdiffSuspected = subDiff.suspected,\r\n\t\tdiffCured = subDiff.cured,\r\n\t\tdiffDied = subDiff.died;\r\n\tdiffConfirmed <0 ? diffConfirmed = diffConfirmed : diffConfirmed = \"+\"+diffConfirmed;\r\n\tdiffDiagnosed <0 ? diffDiagnosed = diffDiagnosed : diffDiagnosed = \"+\"+diffDiagnosed;\r\n\tdiffSerious <0 ? diffSerious = diffSerious : diffSerious = \"+\"+diffSerious;\r\n\tdiffOverseasInput <0 ? diffOverseasInput = diffOverseasInput : diffOverseasInput = \"+\"+diffOverseasInput;\r\n\tdiffSuspected <0 ? diffSuspected = diffSuspected : diffSuspected = \"+\"+diffSuspected;\r\n\tdiffCured <0 ? diffCured = diffCured : diffCured = \"+\"+diffCured;\r\n\tdiffDied <0 ?   diffDied = diffDied : diffDied = \"+\"+diffDied;\r\n\r\n\tvar subFunc = ['截止：'+sumModifyTime +'\\n'+\r\n   \t\t'现有确诊: {a| '+sumConfirmed+'}','较昨日:{g| '+diffConfirmed+'}','现有疑似: {b| '+sumSuspected+'}','较昨日:{h| '+diffSuspected+'}','境外输入确诊: {c| '+sumOverseasInput+'}','较昨日:{i| '+diffOverseasInput+'}'+'\\n'+\r\n   \t\t'累计确诊: {a| '+sumDiagnosed+'}','较昨日:{g| '+diffDiagnosed+'}','重症病例: {d| '+sumSerious+'}','较昨日:{j| '+diffSerious+'}','治愈人数: {f| '+sumCured+'}','较昨日:{l| '+diffCured+'}','死亡人数: {e| '+sumDied+'}','较昨日:{k| '+diffDied+'}'\r\n   \t\t].join('\\xa0\\xa0');\r\n  \r\n    //基于准备好的dom，初始化echarts实例\r\n    option = {\r\n        backgroundColor: '#f8f8f8', //背景色\r\n        title: {\r\n            text: '全国疫情新增病例趋势图',\r\n            textStyle: {\r\n                color: '#000',\r\n                fontSize: 18\r\n            },\r\n            itemGap: 5,\r\n            subtext: subFunc, \r\n    \t\tsubtextStyle: {\r\n    \t\t\tcolor: '#333',\r\n                fontSize: 14,\r\n                rich: {\r\n    \t\t        a: {\r\n\t\t\t            color: '#b61e33',\r\n                \t\tfontSize: 15\r\n\t\t\t        },\r\n\t\t\t        b: {\r\n\t\t\t            color: '#f4a313',\r\n                \t\tfontSize: 15\r\n\t\t\t        },\r\n\t\t\t        c: {\r\n\t\t\t            color: '#eb4c2c',\r\n                \t\tfontSize: 15\r\n\t\t\t        },\r\n\t\t\t        d: {\r\n\t\t\t            color: '#e56617',\r\n                \t\tfontSize: 15\r\n\t\t\t        },\r\n\t\t\t        e: {\r\n\t\t\t            color: '#0c2e47',\r\n                \t\tfontSize: 15\r\n\t\t\t        },\r\n\t\t\t        f: {\r\n\t\t\t            color: '#34cbc4',\r\n                \t\tfontSize: 15\r\n\t\t\t        },\r\n\t\t\t        g: {\r\n\t\t\t            color: '#b61e33',\r\n                \t\tfontSize: 12\r\n\t\t\t        },\r\n\t\t\t        h: {\r\n\t\t\t            color: '#f4a313',\r\n                \t\tfontSize: 12\r\n\t\t\t        },\r\n\t\t\t        i: {\r\n\t\t\t            color: '#eb4c2c',\r\n                \t\tfontSize: 12\r\n\t\t\t        },\r\n\t\t\t        j: {\r\n\t\t\t        \tcolor: '#e56617',\r\n                \t\tfontSize: 12\r\n\t\t\t        },\r\n\t\t\t        k: {\r\n\t\t\t        \tcolor: '#0c2e47',\r\n                \t\tfontSize: 12\r\n\t\t\t        },\r\n\t\t\t        l: {\r\n\t\t\t        \tcolor: '#34cbc4',\r\n                \t\tfontSize: 12\r\n\t\t\t        }\r\n    \t\t    }\r\n    \t\t},\r\n    \t\tx: 'center'\r\n        },\r\n        tooltip: {\r\n            trigger: 'axis', //axis , item\r\n            axisPointer: {\r\n                type: 'line', //'line' | 'cross' | 'shadow' | 'none\r\n                lineStyle: {\r\n                    color: '#c9caca',\r\n                    width: 1,\r\n                    type: 'dotted'\r\n                }\r\n            },\r\n            x: 'left',\r\n            textStyle: {\r\n                fontSize: 14\r\n            }\r\n        },\r\n        grid: {\r\n            top: '10%',\r\n            right: '2%',\r\n            bottom: '5%',\r\n            left: '5%'\r\n        },\r\n        legend: {\r\n            data: ['新增确诊','新增疑似','新增治愈','新增死亡'],\r\n            x: 'right'\r\n        },\r\n        xAxis: {\r\n            type: 'category',\r\n            axisLabel: {\r\n                rotate: 0,\r\n                interval: 0, //类目间隔 设置为 1，表示(隔一个标签显示一个标签)\r\n                textStyle: {\r\n                    color: '#333',\r\n                    fontSize: 12\r\n                },\r\n                formatter: '{value}'\r\n            },\r\n            axisLine: {\r\n                lineStyle: {\r\n                    color: '#ccc',\r\n                     width: 1\r\n                }\r\n            },\r\n            splitLine: {\r\n                show: true,\r\n                lineStyle: {\r\n                    color: 'rgba(102,102,102,.1)', //纵向网格线颜色\r\n                    width: 1,\r\n                    type: 'dashed'\r\n                }\r\n            },\r\n            axisTick: {\r\n                show: true //坐标轴小标记\r\n            },\r\n            data: dateTime //载入横坐标数据\r\n        },\r\n        yAxis: {\r\n            type: 'value',\r\n            axisLabel: {\r\n                show: true,\r\n                textStyle: {\r\n                    color: '#333',\r\n                    fontSize: 12\r\n                },\r\n                formatter: '{value}'\r\n            },\r\n            splitNumber: 4, //y轴刻度设置(值越大刻度越小)\r\n            axisLine: {\r\n                lineStyle: {\r\n                    color: '#ccc',\r\n                    width: 1\r\n                }\r\n            },\r\n            splitLine: {\r\n                show: true,\r\n                lineStyle: {\r\n                    color: 'rgba(102,102,102,.1)', //横向网格线颜色\r\n                    width: 1,\r\n                    type: 'dashed'\r\n                }\r\n            }\r\n        },\r\n        color: ['rgb(255, 53, 55)', 'rgb(255, 160, 25)', 'rgb(17, 191, 199)', 'rgba(77, 80, 84, 0.7)'],\r\n        series: [\r\n    \t    {\r\n    \t        name: '新增确诊',\r\n    \t        type: 'line', //line\t\t\r\n    \t        symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n    \t        symbolSize: 12, //曲线点大小\r\n    \t        label: {\r\n                    normal: {\r\n                        show: true,\r\n                        position: 'top'\r\n                    }\r\n                },\r\n    \t        lineStyle: {\r\n    \t            normal: {\r\n    \t                width: 2\r\n    \t            }\r\n    \t        },\r\n    \t        smooth: true, \r\n    \t        data: diagnosed_add //载入数据\r\n    \t    },\r\n    \t    {\r\n    \t        name: '新增疑似',\r\n    \t        type: 'line', //line\r\n    \t        symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n    \t        symbolSize: 12, //曲线点大小\r\n    \t        label: {\r\n                    normal: {\r\n                        show: true,\r\n                        position: 'top'\r\n                    }\r\n                },\r\n    \t        lineStyle: {\r\n    \t            normal: {\r\n    \t                width: 2\r\n    \t            }\r\n    \t        },\r\n    \t        smooth: true, \r\n    \t        data: suspected_add //载入数据\r\n    \t    },\r\n    \t    {\r\n    \t        name: '新增治愈',\r\n    \t        type: 'line', //line\r\n    \t        symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n    \t        symbolSize: 12, //曲线点大小\r\n    \t        label: {\r\n                    normal: {\r\n                        show: true,\r\n                        position: 'top'\r\n                    }\r\n                },\r\n    \t        lineStyle: {\r\n    \t            normal: {\r\n    \t                width: 2\r\n    \t            }\r\n    \t        },\r\n    \t        smooth: true, \r\n    \t        data: cured_add //载入数据\r\n    \t    },\r\n    \t    {\r\n    \t        name: '新增死亡',\r\n    \t        type: 'line', //line\r\n    \t        symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n    \t        symbolSize: 12, //曲线点大小\r\n    \t        label: {\r\n                    normal: {\r\n                        show: true,\r\n                        position: 'top'\r\n                    }\r\n                },\r\n    \t        lineStyle: {\r\n    \t            normal: {\r\n    \t                width: 2\r\n    \t            }\r\n    \t        },\r\n    \t        smooth: true, \r\n    \t        data: died_add //载入数据\r\n    \t    }\r\n        ]\r\n    };\r\n    \r\n    //使用刚指定的配置项和数据显示图表。\r\n    myChart.setOption(option);\r\n\r\n\tvar app = {\r\n        currentIndex: -1,\r\n    };\r\n    setInterval(function () {\r\n        var dataLen = option.series[0].data.length;\r\n\r\n        // 取消之前高亮的图形\r\n        myChart.dispatchAction({\r\n          type: 'downplay',\r\n          seriesIndex: 0,\r\n          dataIndex: app.currentIndex\r\n        });\r\n\r\n        app.currentIndex = (app.currentIndex + 1) % dataLen;\r\n\r\n        // 高亮当前图形\r\n        myChart.dispatchAction({\r\n          type: 'highlight',\r\n          seriesIndex: 0,\r\n          dataIndex: app.currentIndex,\r\n        });\r\n        \r\n        // 显示 tooltip\r\n        myChart.dispatchAction({\r\n          type: 'showTip',\r\n          seriesIndex: 0,\r\n          dataIndex: app.currentIndex\r\n        });\r\n\r\n    }, 3000);\r\n\t\r\n},\"jsonp2\");","html":"","externalScripts":"","updaterUID":"bd-4161428444","theme":"","layout":"","viewCount":237,"userName":"b***n","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xq9UZlKIQ.png?v=1587739261800","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-line","title","tooltip"],"customTags":[],"updaterUserName":"b***n"}}