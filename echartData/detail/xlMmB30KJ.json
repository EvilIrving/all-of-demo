{"status":0,"data":{"cid":"xlMmB30KJ","authorUid":"bd-3490003427","authorUserName":"j***g","title":"2019年阅读分类统计","description":"每本书都自带光芒，\n许多光组合在一起，\n变成思想的太阳","latestVersion":2,"alwaysLatest":1,"createTime":"2020-01-01T15:12:06.000Z","lastUpdateTime":"2020-01-01T15:12:06.000Z","auth":2,"uid":"bd-3490003427","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.4.0","versionCreateTime":"2020-01-01T15:15:33.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1577891460444-H6EWcM1h.txt\";\nvar colors = [\n    \"#2ec7c9\",\n    \"#b6a2de\",\n    \"#5ab1ef\",\n    \"#ffb980\",\n    \"#d87a80\",\n    \"#8d98b3\",\n    \"#e5cf0d\",\n    \"#97b552\",\n    \"#95706d\",\n    \"#dc69aa\",\n    \"#07a2a4\",\n    \"#9a7fd1\",\n    \"#588dd5\",\n    \"#f5994e\",\n    \"#c05050\",\n    \"#59678c\",\n    \"#c9ab00\",\n    \"#7eb00a\",\n    \"#6f5553\",\n    \"#c14089\"\n];\nvar bgColor = '#2E2733';\nbgColor={\n          type: 'radial',\n          x: 0.5,\n          y: 0.5,\n          r: 0.7,\n          colorStops: [{\n              offset: 0,\n              color: '#b6a2de' // 0% 处的颜色\n          }, {\n              offset: .4,\n              color: '#9a7fd1' // 100% 处的颜色\n          }, {\n              offset: 1,\n              color: '#59678c' // 100% 处的颜色\n          }],\n          globalCoord: false // 缺省为 false\n      };\nfunction obj2string(o) {\n    var r = [];\n    if (typeof o == \"string\") {\n        return \"\\\"\" + o.replace(/([\\'\\\"\\\\])/g, \"\\\\$1\").replace(/(\\n)/g, \"\\\\n\").replace(/(\\r)/g, \"\\\\r\").replace(/(\\t)/g, \"\\\\t\") + \"\\\"\";\n    }\n    if (typeof o == \"object\") {\n        if (!o.sort) {\n            for (var i in o) {\n                r.push(i + \":\" + obj2string(o[i]));\n            }\n            if (!!document.all && !/^\\n?function\\s*toString\\(\\)\\s*\\{\\n?\\s*\\[native code\\]\\n?\\s*\\}\\n?\\s*$/.test(o.toString)) {\n                r.push(\"toString:\" + o.toString.toString());\n            }\n            r = \"{\" + r.join() + \"}\";\n        } else {\n            for (var i = 0; i < o.length; i++) {\n                r.push(obj2string(o[i]))\n            }\n            r = \"[\" + r.join() + \"]\";\n        }\n        return r;\n    }\n    return o.toString();\n};\nvar dd = [];\n\nvar option1 = {\n    backgroundColor: bgColor,\n    color: colors,\n\n    title: {\n        text: '2019年阅读分类统计',\n        subtext: '每本书都自带光芒，\\n许多光组合在一起，\\n变成思想的太阳',\n        textStyle: {\n            fontSize: 30,\n            align: 'center',\n            textShadowColor: 'rgba(0,0,0,0.3)',\n            textShadowBlur: 3,\n        },\n        subtextStyle: {\n            align: 'center',\n            color:'#DDD',\n            fontSize:18,\n            textShadowColor: 'rgba(0,0,0,0.3)',\n            textShadowBlur: 5,\n        },\n        //sublink: 'https://worldcoffeeresearch.org/work/sensory-lexicon/'\n    },\n    tooltip: {},\n\n    series: {\n        type: 'sunburst',\n        highlightPolicy: 'descendant',\n        data: [],\n        radius: [0, 500],\n        sort: null,\n        center:['50%','45%'],\n        levels: [{}, {\n            //年份\n            r0: '0%',\n            r: '10%',\n            itemStyle: {\n                borderWidth: 2,\n                \n            },\n            label: {\n                rotate: 'tangential',\n                fontSize:14\n            },\n            highlight: {\n                itemStyle: {\n                    color: 'orange'\n                }\n            },\n            downplay: {\n                itemStyle: {\n                    color: '#ccc'\n                }\n            }\n        }, {\n            //分类\n            r0: '10%',\n            r: '25%',\n            itemStyle: {\n                borderWidth: 2,\n                opacity:1\n                \n            },\n            label: {\n                align: 'right',\n                fontSize: 12\n            },\n            highlight: {\n                itemStyle: {\n                    color: 'orange'\n                }\n            },\n            downplay: {\n                itemStyle: {\n                    color: '#ccc'\n                }\n            }\n        }, {\n            //国家\n            r0: '25%',\n            r: '40%',\n            label: {\n                //position: 'outside',\n                //padding: 3,\n                //silent: false\n                align: 'left',\n                fontSize: 12\n            },\n            itemStyle: {\n                //borderWidth: 3\n                opacity:0.8\n            },\n            highlight: {\n                itemStyle: {\n                    color: 'orange'\n                }\n            },\n            downplay: {\n                itemStyle: {\n                    color: '#ccc'\n                }\n            }\n        }, {\n            //作者\n            r0: '40%',\n            r: '65%',\n            label: {\n                //position: 'outside',\n                padding: 0,\n                align: 'right',\n                fontSize: 10\n            },\n            itemStyle: {\n                borderWidth: 1,\n                opacity: 0.1,\n            },\n            highlight: {\n                itemStyle: {\n                    color: 'orange'\n                }\n            },\n            downplay: {\n                itemStyle: {\n                    color: '#ccc'\n                }\n            }\n        }, {\n            //名字\n            r0: '65%',\n            r: '66%',\n\n            itemStyle: {\n                //shadowBlur: 5,\n                //shadowColor: colors[0]\n            },\n            label: {\n                //position: 'outside',\n                align:'left',\n                textShadowBlur: 5,\n                textShadowColor: '#333',\n                fontSize: 14\n            },\n            downplay: {\n                label: {\n                    opacity: 0\n                }\n            },\n            highlight: {\n                itemStyle: {\n                    color: 'orange',\n\n                },\n                label: {\n\n                    color: '#FFF',\n                    fontSize: 13\n                }\n\n            }\n        }, {\n            //day\n            r0: '120%',\n            r: '121%',\n            show: false,\n            label: {\n                position: 'outside',\n                //padding: 3,\n                //silent: false\n                fontSize: 9,\n                opacity: 0\n            },\n            itemStyle: {\n                //borderWidth: 3\n                opacity: 0\n            },\n            highlight: {\n                itemStyle: {\n                    color: 'orange'\n                }\n            },\n            downplay: {\n                itemStyle: {\n                    color: '#ccc'\n                }\n            }\n        }]\n    }\n};\noption = option1;\n$.getJSON(uploadedDataURL, function(readrecords) {\n    myChart.hideLoading();\n    var lastyearnode = { //新建年份节点\n        name: readrecords[0].yyyy,\n        value: 1,\n        itemStyle: {\n            color: colors[0]\n        },\n        children: [{\n            name: readrecords[0].type,\n            value: 1,\n            itemStyle: {\n                color: colors[1]\n            },\n            children: [{\n                name: readrecords[0].country,\n                value: 1,\n                itemStyle: {\n                    color: colors[2]\n                },\n                children: [{\n                    name: readrecords[0].writer,\n                    value: 1,\n                    itemStyle: {\n                        color: colors[3]\n                    },\n                    children: [{\n                        name: readrecords[0].name,\n                        value: 1,\n                        itemStyle: {\n                            color: colors[4]\n                        },\n                        children: [{\n                            name: readrecords[0].days + 'd',\n                            value: 1,\n                            itemStyle: {\n                                color: colors[4]\n                            },\n                        }]\n                    }]\n                }]\n            }]\n        }]\n    };\n    var lasttypenode = lastyearnode.children[0];\n    var lastcountrynode = lasttypenode.children[0];\n    var lastwriternode = lastcountrynode.children[0];\n\n    //alert(obj2string(lasttypenode));\n    for (var i = 1; i < readrecords.length; i++) { //年份层级\n        //for (var i = 1; i < 10; i++) { //年份层级\n        //每行先构建叶子节点\n        ci = (i + 5) % colors.length;\n        //alert(ci);\n        co = colors[ci];\n\n        var node = {\n            name: '《'+readrecords[i].name+'》',\n            value: 1,\n            itemStyle: {\n                color: colors[ci]\n            },\n            children: [{\n                name: readrecords[i].days + 'd',\n                value: 1,\n                itemStyle: {\n                    color: colors[ci]\n                },\n            }]\n        };\n\n        if (lastyearnode.name !== readrecords[i].yyyy) { //新年份的第一行\n            // dd.push(lastyearnode); //将上一个年份的加入数据\n            if (lastyearnode.name === 2019) {\n                //alert(lastyearnode.name+'---'+(lastyearnode.name===2019));\n                dd.push(lastyearnode); //将上一个年份的加入数据\n            }\n            lastyearnode = { //新建年份节点\n                name: readrecords[i].yyyy,\n                value: 1,\n                itemStyle: {\n                    color: colors[ci + 1]\n                },\n                children: [{\n                    name: readrecords[i].type,\n                    value: 1,\n                    itemStyle: {\n                        color: colors[ci + 2]\n                    },\n                    children: [{\n                        name: readrecords[i].country,\n                        value: 1,\n                        itemStyle: {\n                            color: colors[ci + 3]\n                        },\n                        children: [{\n                            name: readrecords[i].writer,\n                            value: 1,\n                            itemStyle: {\n                                color: colors[ci + 4]\n                            },\n                            children: [node]\n                        }]\n                    }]\n                }]\n            };\n            lasttypenode = lastyearnode.children[0];\n            lastcountrynode = lasttypenode.children[0];\n            lastwriternode = lastcountrynode.children[0];\n\n        } else {\n            //alert(lasttypenode.name+'-----'+readrecords[i].type+'-----'+(lasttypenode.name !== readrecords[i].type))\n            if (lasttypenode.name !== readrecords[i].type) { //新分类\n                //alert(obj2string(lastyearnode));\n\n                lasttypenode = {\n                    name: readrecords[i].type,\n                    value: 1,\n                    itemStyle: {\n                        color: colors[ci + 1]\n                    },\n                    children: [{\n                        name: readrecords[i].country,\n                        value: 1,\n                        itemStyle: {\n                            color: colors[ci + 2]\n                        },\n                        children: [{\n                            name: readrecords[i].writer,\n                            value: 1,\n                            itemStyle: {\n                                color: colors[ci + 3]\n                            },\n                            children: [node]\n                        }]\n                    }]\n                }; //新建分类\n                lastyearnode.children.push(lasttypenode); //上一分类插入年份节点\n                lastyearnode.value++;\n                lastcountrynode = lasttypenode.children[0];\n                lastwriternode = lastcountrynode.children[0];\n                //alert(obj2string(lasttypenode));\n                //alert(lasttypenode.name+'-----'+readrecords[i].type+'-----'+(lasttypenode.name !== readrecords[i].type))\n\n            } else {\n                if (lastcountrynode.name !== readrecords[i].country) { //新国家\n                    lastcountrynode = {\n                        name: readrecords[i].country,\n                        value: 1,\n                        itemStyle: {\n                            color: colors[ci + 1]\n                        },\n                        children: [{\n                            name: readrecords[i].writer,\n                            value: 1,\n                            itemStyle: {\n                                color: colors[ci + 2]\n                            },\n                            children: [node]\n                        }]\n                    }; //新建分类\n                    lasttypenode.children.push(lastcountrynode);\n                    lasttypenode.value++;\n                    lastyearnode.value++;\n                    lastwriternode = lastcountrynode.children[0];\n                } else {\n                    if (lastwriternode.name !== readrecords[i].writer) { //新作者\n                        lastwriternode = {\n                            name: readrecords[i].writer,\n                            value: 1,\n                            itemStyle: {\n                                color: colors[ci + 1]\n                            },\n                            children: [node]\n                        }; //新建分类\n                        lastcountrynode.children.push(lastwriternode);\n                        lastcountrynode.value++;\n                        lasttypenode.value++;\n                        lastyearnode.value++;\n                    } else {\n                        lastwriternode.children.push(node);\n                        lastcountrynode.value++;\n                        lasttypenode.value++;\n                        lastyearnode.value++;\n                        lastwriternode.value++;\n                    }\n                }\n            }\n        }\n\n        //alert(obj2string(dd));break;\n    }\n\n    if (lastyearnode.name === 2019) {\n        //alert(lastyearnode.name + '---' + (lastyearnode.name === 2019));\n        dd.push(lastyearnode); //将上一个年份的加入数据\n    }\n    //alert(obj2string(dd));\n    option1.series.data = dd;\n    //alert(obj2string(option1.series.data));\n\n    myChart.setOption(option, true);\n    //alert('111');\n});","html":"","externalScripts":"","updaterUID":"bd-3490003427","theme":"","layout":"","viewCount":1954,"userName":"j***g","commentCount":1,"starCount":11,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xlMmB30KJ.png?v=1577891734134","isCustomThumbnail":0,"builtinTags":["category-work","series-sunburst","title","tooltip"],"customTags":[],"updaterUserName":"j***g"}}