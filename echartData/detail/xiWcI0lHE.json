{"status":0,"data":{"cid":"xiWcI0lHE","authorUid":"bd-6442928284","authorUserName":"流***r","title":"饼图内阴影","description":"","latestVersion":3,"alwaysLatest":1,"createTime":"2020-01-20T11:45:48.000Z","lastUpdateTime":"2020-01-20T11:45:48.000Z","auth":2,"uid":"bd-6442928284","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":1,"echartsVersion":"4.4.0","versionCreateTime":"2020-01-21T03:07:45.000Z","code":"const createSvg = ({radius, startAngle, endAngle, shadowColor, shadowBlur}) => {\r\n    const startX = radius * (1 + Math.cos(startAngle));\r\n    const startY = radius * (1 - Math.sin(startAngle));\r\n    const endX = radius * (1 + Math.cos(endAngle));\r\n    const endY = radius * (1 - Math.sin(endAngle));\r\n    const ret = [`M${radius} ${radius}`];\r\n    ret.push(`L${startX} ${startY}`);\r\n    ret.push(`A${radius} ${radius} 0 ${Math.abs(endAngle - startAngle) > Math.PI ? 1 : 0} 1 ${endX} ${endY}`);\r\n    ret.push('Z');\r\n    const rectPath = ret.join(' ');\r\n    return (`\r\n        <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \r\n            x=\"0px\" y=\"0px\" \r\n            width=\"${radius * 2}\"\r\n            height=\"${radius * 2}\"\r\n        >\r\n            <style>\r\n                .st1 {\r\n                    fill: transparent;\r\n                    stroke: ${shadowColor};\r\n                    stroke-width: ${shadowBlur}px;\r\n                    filter: url(#chart-inset-shadow);\r\n                    clip-path: url(#chart-clip);\r\n                }\r\n\r\n            </style>\r\n            <defs>\r\n              \r\n                <clipPath id=\"chart-clip\">\r\n                    <path d=\"${rectPath}\" />\r\n                </clipPath>\r\n                \r\n                <filter id=\"chart-inset-shadow\" width=\"200%\" height=\"200%\" x=\"-50%\" y=\"-50%\">\r\n            \t\t<feGaussianBlur in=\"SourceGraphic\" result=\"gass\" stdDeviation=\"${shadowBlur * 0.75}\" />\r\n            \t\t<feMerge>\r\n            \t\t\t<feMergeNode in=\"gass\" />\r\n            \t\t</feMerge>\r\n            \t</filter>\r\n\r\n            </defs>\r\n            <g>\r\n                <path class=\"st1\" d=\"${rectPath}\" />\r\n            </g>\r\n        </svg>\r\n    `);\r\n    \r\n};\r\n\r\nconst cretateSvgUrl = (svgOption) => {\r\n    const svgString = createSvg(svgOption);\r\n    const svg = new Blob([svgString], {type: \"image/svg+xml;charset=utf-8\"});\r\n    \r\n    const DOMURL = window.URL || window.webkitURL || window;\r\n    const insetShadowUrl = DOMURL.createObjectURL(svg);\r\n    \r\n    return insetShadowUrl;\r\n};\r\n\r\nconst dataSet = [\r\n    ['项目1', '项目2','项目3', '项目4', '项目5'],\r\n    [100, 90, 80, 66, 90],\r\n];\r\n\r\n\r\nconst radius = '56%';\r\nconst center = ['50%', '50%'];\r\n\r\nconst dataToPie = (data) => {\r\n    const accData = data.reduce((acc, v, i) => {\r\n        const prev = i === 0 ? 0 : acc[i - 1];\r\n        acc.push(prev + v);\r\n        return acc;\r\n    }, []);\r\n\r\n    const total = accData[data.length - 1];\r\n    return accData.map((t, idx) => {\r\n        const endAngle = Math.PI * 0.5 - t / total * Math.PI * 2;\r\n        const startAngle = endAngle + data[idx] / total * Math.PI * 2;\r\n        return {\r\n         startAngle,\r\n         endAngle,\r\n         value: data[idx]\r\n        };\r\n    });\r\n};\r\n\r\nconst pieData = dataToPie(dataSet[1]);\r\n\r\noption = {\r\n    backgroundColor: '#000000',\r\n    tooltip: {\r\n        // trigger: 'axis',\r\n        // show: true\r\n    },\r\n    polar: {\r\n        radius,\r\n        center,\r\n    },\r\n    angleAxis: {\r\n        type: 'category',\r\n        clockwise: false,\r\n        boundaryGap: false,\r\n        splitLine: {\r\n            show: false,\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        }\r\n    },\r\n    radiusAxis: {\r\n        type: 'value',\r\n        max: 100,\r\n        splitLine: {\r\n            show: false,\r\n        },\r\n        axisTick: {\r\n            show: false,\r\n        },\r\n        axisLabel: {\r\n            show: false,\r\n        },\r\n    },\r\n   \r\n    series: [\r\n        {\r\n            type: 'custom',\r\n            name: 's1-inset-shadow',\r\n            silent: true,\r\n            coordinateSystem : 'polar', \r\n            data: dataSet[1],\r\n            renderItem: (params, api) => {\r\n                const R = params.coordSys.r;\r\n                const cx = params.coordSys.cx;\r\n                const cy = params.coordSys.cy;\r\n                \r\n                const x = cx - R;\r\n                const y = cy - R;\r\n                const width = 2 * R;\r\n                const height = 2 * R;\r\n                \r\n                const value0 = api.value(0);\r\n                const value1 = api.value(1);\r\n                \r\n                const pie = pieData[value1];\r\n                console.log(params, pie)\r\n                \r\n                return {\r\n                    type: 'image',\r\n                    style: {\r\n                        image: cretateSvgUrl({\r\n                            radius: R,\r\n                            startAngle: pie.startAngle,\r\n                            endAngle: pie.endAngle,\r\n                            shadowColor: 'rgba(13, 178, 255, 1)',\r\n                            shadowBlur: 30\r\n                        }),\r\n                        x,\r\n                        y,\r\n                        width, \r\n                        height,\r\n                    },\r\n                };\r\n            },\r\n        },\r\n        {\r\n            type: 'pie',\r\n            data: dataSet[1],\r\n            radius,\r\n            center,\r\n            itemStyle: {\r\n                color: 'transparent',\r\n                borderColor: 'yellowgreen'\r\n            }\r\n        },\r\n        \r\n       \r\n    ]\r\n\r\n\r\n};","html":"","externalScripts":"","updaterUID":"bd-6442928284","theme":"","layout":"","viewCount":302,"userName":"流***r","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xiWcI0lHE.png?v=1579576065556","isCustomThumbnail":0,"builtinTags":["category-work","polar","series-custom","series-pie","tooltip"],"customTags":["inset","内阴影","饼图"],"updaterUserName":"流***r"}}