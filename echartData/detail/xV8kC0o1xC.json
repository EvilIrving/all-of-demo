{"status":0,"data":{"cid":"xV8kC0o1xC","authorUid":"obd-oNj2zvJFkuHMgFWUoXv43O1sHezoVCz","authorUserName":"t***e","title":"可拖拽的流程图/树形图","description":"使用的是echarts/chart/graph的拖拽功能","latestVersion":2,"alwaysLatest":1,"createTime":"2021-11-25T08:35:25.000Z","lastUpdateTime":"2021-11-26T06:21:48.000Z","auth":2,"uid":"obd-oNj2zvJFkuHMgFWUoXv43O1sHezoVCz","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2021-11-26T06:21:48.000Z","code":"// ！！！echarts需要是5.0.0.版本以上\r\n// 这个示例使用的是graph的拖拽功能\r\n// 1。data必须是draggable\r\n// 2. series的layout必须是'force'\r\n// 3. 在渲染完后需要把节点设置成固定\r\nconst symbol1 = \"image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABGFJREFUeF7tmkuojVEUgL8dGWBk4lUeRcoduVfKq0h5RilEGBiICQNKmGCChAETMlGIUIripjzK5ZY8RkSUR3lNlAED0da6Z/869/ef+++1/30e7jm77uSevdbe69tr773+vZahyZtpcvtpAWh5QJMTaG2BJneA1iFYty1gYTgw2nngBwNf6uGNNQFgYQKwAljmjBbDB6QM/g18cH9XgcsGXlcbStUAWBjpjF4MLAw0pBO47mB8CtTRp1h0AM7wTcBGYFSkSX8ETgEnDUQFEQ2AhcHAjsiGp/klIA4Z+BEDbhQAFqYAJ4BpMSbloeMhsNnAU4++1d0CFlYD54tOJFB+jYELgbI9YoU8wMJeYE+RCUSQ3WdK8whqwQAsTAceBI0aX2iGge4QtUEALIwD3oQMWEWZ8QbeavWrAVgYBFwD5msHq3L/m8BSAz8144QAaIR9X8lG9XmgAuCCnEcRAxzNYvn0lThhqiZY0gJo5NVPAKm8wBvAf7D6CQCVF2gAbAOO+Phhqs8q4BtwFGjzlH8GyHhyoEmcMcdTLum23ZTGy20aAPeAWbkae3eYa+Cu/MvCJOAc0JGj4zGw1sBLJyfG31GO22Vgto+MFwALkwFZFW1bYECup57m4oezwMwKiu4D68rvc1sCJgevtrUZeJ4n5Asg9PATaKvKJ+LOkjPAvNTkbgHr0ye4hYvAyjxDMn73Ogx9AUjIK6FvSMuCMAwQCPJYIk0ePcT4r+UDFDBe1HQbmJE3YV8A74Axecr6+D0LwhAHQcTE+O8RjRdV7w2MzZuzL4BfGW94ebrTv2dBGCidDIj+v63gyid6fhvo0d9XywXgXm8/5yny/P0fCGm5SMYnakfkvTb7AGgH5GqK1SpCiGy8zLfDwJOiHtD0ACSB0bxbQNzHlg6pdCJDuyUyXd/CwIY+BB2A6Neg0ytBjpzUDX8NRg2EyoxPIrwbLgRu2EBoJ3BA6/Pu+6FXKJxhfKL2toPQK/NT4GbYZeBg3pxzr0E3YUluvspTlvH7BgOnFUGOeJp8Cf593LSlT2Ht16AMOdEnueoFwEEQN9UmOWX1LyUAPFdT7m2B8MKNG/I12Glgkc+CaQBsAY75KE31mQsMlVQWsMRTXm6Mw5Q8IeRBZKuB4z5jaQBIuruRH0QTe6vzJObcMfRdwGcxYvXxegdIBvP2AAeg0b1AtfpikwrAf+AFqtUPBSCFEHIt1aoWwHdrSM2APMKqCifUHuC8QAoi+vzM9J11xH7tIQUTQQAchHoWRqS5BRdKBANooPNAve/L6RUC4CDUs1AiuDAi6BqstF9dwuNkDWsGJNmyKaQgIm1DYQ8oi/OlcGJ3jcrk9msLISotXjQAZSAkWGq+Qsk0YZcCWwMsD0iqJuq6gCtShqcpetBcrdE9IGtwl1yVNLnUFUmhdF6xtOzxiz7JTY2xWX1rAqAClOYply+6StWUr5sHVNMoje4WAA2t/ti35QH9cVU1NrU8QEOrP/b9AypRG1BNp5A8AAAAAElFTkSuQmCC\";\r\nconst symbol2= 'image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA+hJREFUeF7tWj1MFEEU/gatLDQY1GggGlutvEXjX+UPFloZMaImorKXaKOFUhmOUhptNLkFzBmMKCYWaIgUJsZg0LBrYvwp5ZATjHAabC7R6Jhd3eNYT2Zm7y0c2b3minnve+99897Mm9lhCPmPhTx+RAREGRByBqISCHkCRItgVAJzVgIv4ltRwevAeDVQUQ3Y/6j5a38UYBngVwacZcDQC814ORe+BZsBpt4A8D0A2w3ADljllwZYHxieIpa8q6KoIhsMAVZcB4cO8JiKM/+XZRYYDMSSBg3eNAotAeSBe8OlJ4KOgCH9MhguUs9QUTyGG4gZpyhs0RBg6V3gOEbhkDwGfwatfYe8fHHJ0gmw9DQ41pbqiE/9SWjGCp+6jlppBJj6BICqUhwoWZdhBDFjnV8c/wSYTQMA2+7XMKkewy3EjON+MP0RYOmd4Djpx2BgOhxtqDWaVfHVCXC2Op5UNTQn8ozFVXsFdQLMuEnX4FDTwixoSU0FVY2Acp59N2rFLFAjoKxnP8+AUhbIE2DFD4PzOyrpNY+yR6EZt2XsyxNgxq8B/IwMKLXMkeWbUbloCfqmXiP9PSsBz1PQ2hslBBUaIVMfBuC74ZBxpphMYs0BtKze7wylsoNoTKdkoDLQDPeuYVZ5uQww9U0ALBnLlDKFwdu4reMPkRh7IGfiJ9uGLclBkbAcAUN6AgwtIjDKcW/w975aqH+vcB3A0YpaIyHySY4As6kDYNLHT7tmX+VG8S43LrJfdLzk4B1U3gmt/bTIAUkC4o8AXicCs8ev1NTj3MpdjmjDcAe6vwzJqOVlaIK34Vg/tOQ+kXFJAvQ3ADaIwOzxC6v2oq36YF70RDqFm1lhKTrydME7cG+hGRtFPssSMAVgqQjMHe9Zr+NQ5fR1YNNIFzomB2ZVJw7etvUNmrFM5HMgBNhGvSSc/dCN6xNPAqz5f6BJCZAugUI3vCScH+3B1c+PZ3gawMy7+JQlIL8IeufBS0Lzx/to+9QfRM17TJMugmrboIiES2O9WMwq8h2eLa+8z4uKm3QbJGiEvJlQ6D998HYbQNoI0bTCxUgIJHibXdJW2AYkOgwVkhBY8ADxYcghgO44rFftRI7/QFf2ubCS/QkEcRwO/YXInywo4wtRN1fULkblOkEXO/SXomWfBWqzb4ejlgG2RjlngeKVuD8CHBLC/GnMXQ9C/XE0T0KYP4/nd4YwP5CYJiHET2RcEkL9SGpGo0T5PtB7EijnZ3KFvpK/F6QPPN84+zttSWqF9qlsMX5C+VhaMlHmU0z9LDCf3gZgOyIgAFIXFGSUAQtqugJwNsqAAEhdUJChz4Df9pWPUAdijpgAAAAASUVORK5CYII='\r\n\r\n// 数据里必须设置draggable\r\nvar data = [\r\n        { name: '1', draggable: true, value: { serviceId:'crux-gateway', type: 0,category:0,url:'/crux-appmodule/api/appmodule' },x:0,y:100, draggable: true,fixed:true,symbol: symbol2 }, \r\n        { name: '2', draggable: true, value: { serviceId:'crux-gateway1', type: 1,category:1,url:'/crux-appmodule/api/appmodule'},x:100,y:100, category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n        { name: '3', draggable: true, value: { serviceId:'crux-gateway2', type: 1,category:1,url:'/crux-appmodule/api/appmodule/2' }, x:200,y:100,category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n        { name: '4', draggable: true, value: { serviceId:'crux-gateway', type: 0,category:0,url:'/crux-appmodule/api/appmodule' },x:300,y:0, draggable: true,fixed:true,symbol: symbol2 }, \r\n        { name: '5', draggable: true, value: { serviceId:'crux-gateway1', type: 1,category:1,url:'/crux-appmodule/api/appmodule'},x:300,y:100, category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n        { name: '6', draggable: true, value: { serviceId:'crux-gateway2', type: 1,category:1,url:'/crux-appmodule/api/appmodule/2' },x:300,y:200, category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n     ]\r\n\r\nconst legend = {\r\n    show: true,\r\n    itemWidth: 20,\r\n    itemHeight: 20,\r\n    data: [\r\n        { name: '成功', icon: symbol2 },\r\n        { name: '失败', icon: symbol1 },\r\n    ]\r\n}\r\nconst series = {\r\n    type: 'graph',\r\n    roam:true,\r\n    nodeScaleRatio:0,\r\n    layout: 'force', // 如果想要使用graph的拖拽功能，layout必须是force\r\n    autoCurveness:false,\r\n    scaleLimit:{\r\n      min:0.5,\r\n      max:3\r\n    },\r\n    symbolSize: 40,\r\n    categories: [ { name: \"成功\" }, { name: \"失败\" }],\r\n    label: { \r\n        show: true,\r\n        position:[-20,40],\r\n        align: 'center',\r\n        textStyle: { fontSize: 12, color: '#fff' },\r\n        \"borderRadius\": [\r\n          0,\r\n          0,\r\n          5,\r\n          5\r\n        ], \r\n        formatter: params => {\r\n            return `{label${params.value.type}|serviceId：}{value|${params.value.serviceId}}\\n{label${params.value.type}|url：}{value|${params.value.url}}`\r\n        },\r\n        rich: {\r\n              \"label0\": {\r\n                \"backgroundColor\": \"#00cc66\",\r\n                \"color\": \"#fff\",\r\n                \"width\": 60,\r\n                \"height\": 30,\r\n                \"padding\": [\r\n                  0,\r\n                  5,\r\n                  0,\r\n                  10\r\n                ],\r\n                \"align\":'left'\r\n              },\r\n              \"label1\": {\r\n                \"backgroundColor\": \"#ff0000\",\r\n                \"color\": \"#fff\",\r\n                \"width\": 60,\r\n                \"height\": 30,\r\n                \"padding\": [\r\n                  0,\r\n                  5,\r\n                  0,\r\n                  10\r\n                ],\r\n                \"align\":'left'\r\n              },\r\n              \"value\": {\r\n                \"color\": \"#888\",\r\n                \"align\": \"center\",\r\n                \"lineHeight\": 17,\r\n                \"height\": 30,\r\n                \"borderColor\": \"#eee\",\r\n                \"borderWidth\": 1,\r\n                \"padding\": [\r\n                  0,\r\n                  5,\r\n                  0,\r\n                  5\r\n                ]\r\n              }\r\n        }\r\n    },\r\n    labelLayout: function(param){\r\n        return {\r\n            moveOverlap:true,\r\n            hideOverlap:true\r\n        }\r\n    },\r\n    edgeSymbol: ['none', 'arrow'],\r\n    edgeSymbolSize: [4, 8],\r\n    data: data,\r\n    links: [\r\n        { source: 0, target: 1, value: '',}, \r\n        { source: 1, target: 2, value: '', }, \r\n        { source: 2, target: 3, value: '', }, \r\n        { source: 2, target: 4, value: '', }, \r\n        { source: 2, target: 5, value: '', }, \r\n    ],\r\n    lineStyle: {\r\n        opacity: 0.9,\r\n        width: 2,\r\n        color: '#333'\r\n    }\r\n}\r\n\r\noption = { series, legend }\r\nsetTimeout(function() {\r\n  // 源码中在dragend里将node设为了unfixed，变成了浮动\r\n  // 因此需要增加一下dragend监听，将node设置成固定\r\n  var seriesModel = myChart.getModel().getSeriesByIndex(0)\r\n  seriesModel.getData().graph.eachNode(node=>{\r\n    var el = node.getGraphicEl();\r\n    var idx = node.dataIndex;\r\n    var itemModel = node.getModel();\r\n    var draggable = itemModel.get('draggable');\r\n    if(draggable){\r\n      el.on('dragend', function () {\r\n      var forceLayout = seriesModel.forceLayout;\r\n        if (forceLayout) {\r\n          forceLayout.setFixed(idx);\r\n        }\r\n      });\r\n    }\r\n  })\r\n}, 10);","html":"","externalScripts":"","updaterUID":"obd-oNj2zvJFkuHMgFWUoXv43O1sHezoVCz","theme":"","layout":"","viewCount":0,"userName":"t***e","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xV8kC0o1xC.png?v=1637907708300","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-graph"],"customTags":[],"updaterUserName":"t***e"}}