{"status":0,"data":{"cid":"xrJQ2zui7f","authorUid":"bd-2701597763","authorUserName":"q85340813","title":"echarts map真正动态添加轨迹和消失轨迹","description":"echarts map真正动态添加轨迹和消失轨迹","latestVersion":3,"alwaysLatest":1,"createTime":"2018-01-04T09:23:55.000Z","lastUpdateTime":"2018-01-04T09:23:55.000Z","auth":2,"uid":"bd-2701597763","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"3.8.0","versionCreateTime":"2018-01-04T09:31:25.000Z","code":"var linedead=8000;\r\nvar series = [];\r\n\r\noption = {\r\n    backgroundColor: '#404a59',\r\n    tooltip: {\r\n        trigger: 'item'\r\n    },\r\n    geo: {\r\n        map: 'china',\r\n        label: {\r\n            emphasis: {\r\n                show: false\r\n            }\r\n        },\r\n        roam: true,\r\n        itemStyle: {\r\n            normal: {\r\n                areaColor: '#323c48',\r\n                borderColor: '#404a59'\r\n            },\r\n            emphasis: {\r\n                areaColor: '#2a333d'\r\n            }\r\n        }\r\n    },\r\n    series: series\r\n};\r\nvar randomstart=function(){\r\n\treturn [25*Math.random()+100,20*Math.random()+21];\r\n}\r\n//本demo实现一个轨迹只走一次，自动timer添加新轨迹，并且老轨迹自动消失\r\n//echarts巨坑，上面3点都实现，不能去删除series数组的索引，然后push，每一个轨迹都是根据索引来的\r\n//比如series[0]是北京到上海,series[1]是广州到重庆,如果删除数组splice(0,2)，又push一条，会有大BUG\r\n//这是由于setOption用了合并，如果不想用setOptions合并则更坑，虽然效果可以实现，但是地图cavase会被还原，\r\n//影响用户拖拽体验\r\n//目前缺陷是 series数组无线增大。\r\n//觉得好的点个赞吧。坑死我了\r\n\r\nsetInterval(function(){\r\n\tvar createtime=new Date().getTime();\r\n\tfor(var ii=series.length-1;ii>=0;ii--){\r\n\t\tif(createtime>series[ii].createtime+linedead){\r\n\t\t\tseries[ii].data=null;\r\n\t\t\t//series.splice(ii,1);  这里绝对禁用删除，改变索引会有bug\r\n\t\t\t//series[ii]={};    这样也无效\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tseries.push(\r\n\t\t    {\r\n\t\t        name: 'aa Top10',\r\n\t\t        type: 'lines',\r\n\t\t        zlevel: 2,\r\n\t\t        createtime:createtime,\r\n\t\t        symbol: ['none'],\r\n\t\t        symbolSize: 10,\r\n\t\t        effect: {\r\n\t\t            show: true,\r\n\t\t            period: 6,\r\n\t\t            trailLength: 0,\r\n\t\t            symbol: 'arrow',\r\n\t\t            symbolSize: 5,\r\n\t\t            loop:false\r\n\t\t        },\r\n\t\t        lineStyle: {\r\n\t\t            normal: {\r\n\t\t                color: '#46bee9',\r\n\t\t                width: 1,\r\n\t\t                opacity: 0.6,\r\n\t\t                curveness: 0.2\r\n\t\t            }\r\n\t\t        },\r\n\t\t        data: [{name:'aa',coords:[randomstart(),[106.687019,26.568304]]}]\r\n\t\t    });\r\n\t\tmyChart.setOption({series:series},false);//合并数据\r\n\t\t//myChart.setOption(option,true);//全覆盖数据，可以解决series索引过大问题，但是每次地图都会redraw重画，你没法拖拽的！\r\n},800);","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-2701597763","theme":"","layout":"","viewCount":1119,"userName":"q85340813","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrJQ2zui7f.png?v=1515058285743","isCustomThumbnail":0,"builtinTags":["category-work","geo","series-lines","tooltip"],"customTags":[],"updaterUserName":"q85340813"}}