{"status":0,"data":{"cid":"xB1WFPJCTb","authorUid":"bd-1916130272","authorUserName":"肆肆肆厮","title":"自定义toolbox修改数据分类（≈下钻）","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2017-10-25T10:29:12.000Z","lastUpdateTime":"2017-10-25T10:29:12.000Z","auth":2,"uid":"bd-1916130272","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.7.2","versionCreateTime":"2017-10-25T10:29:12.000Z","code":"var isper=false;\r\nvar xdata=['周一','周二','周三','周四'];\r\nvar ydata=['自费1', '医保1','自费2','医保2','医保3'];\r\nvar vdata=[ [101, 201, 301, 401],\r\n            [111, 211, 311, 411],\r\n            [102, 202, 302, 402],\r\n            [112, 212, 312, 412],\r\n            [113, 213, 313, 413]];\r\n\r\nvar category=[ \r\n    {name:'医保',data:['医保1','医保2', '医保3']}\r\n]\r\nvar arr_series=[]\r\n$.each(vdata,function(i,v){\r\n    arr_series.push({\r\n        name:ydata[i],\r\n        type:'bar',\r\n        stack:'all',\r\n        data:v\r\n    })\r\n    \r\n})\r\n\r\noption = {\r\n    tooltip : {\r\n        trigger: 'axis',\r\n        axisPointer : {            // 坐标轴指示器，坐标轴触发有效\r\n            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'\r\n        }\r\n    },\r\n    toolbox:{\r\n        feature:{\r\n            myTool2: {\r\n                show: true,\r\n                title: '自定义扩展方法',\r\n                icon: 'image://http://echarts.baidu.com/images/favicon.png',\r\n                onclick: function(obj,e){\r\n                    debugger\r\n                    if(!isper){\r\n                        var newseries=[];\r\n                        var newyd=[];\r\n                        var clone_ydata=$.extend(true,[], ydata);\r\n                        var clone_series=$.extend(true,[], arr_series);\r\n                        //父级分类\r\n                        $.each(category,function(ic,cate){\r\n                            var cvd=[];\r\n                            var delcount=0;\r\n                            newyd.push(cate.name);\r\n                            $.each(ydata,function(iy,v){\r\n    \r\n                                if($.inArray(v,cate.data)!=-1){\r\n                                    //合并\r\n                                    $.each(vdata[iy],function(ind,v){\r\n                                        if(cvd[ind]==null)\r\n                                        {cvd[ind]=0;}\r\n                                        cvd[ind]+=v;\r\n                                    })\r\n                                    \r\n                                    //删除合并的数据\r\n                                    clone_ydata.splice(iy-delcount,1);\r\n                                    clone_series.splice(iy-delcount,1);\r\n                                    delcount++;\r\n                                }\r\n                                \r\n                            })\r\n                            \r\n                            newseries.push({\r\n                                name:cate.name,\r\n                                type:'bar',\r\n                                stack:'all',\r\n                                data:cvd\r\n                            });\r\n                        })\r\n                        //合并array （1.原始分类，2.新的合并分类）\r\n                        newyd=clone_ydata.concat(newyd);\r\n                        newseries=clone_series.concat(newseries);\r\n                        echarts.getInstanceByDom(e.getDom()).setOption({\r\n                            yAxis:{data:newyd},\r\n                            legend:{data:newyd}\r\n                        })\r\n                        var newoption=e.getOption();\r\n                        newoption.series=newseries;\r\n                        echarts.getInstanceByDom(e.getDom()).setOption(newoption,true)\r\n                        \r\n                        isper=!isper;\r\n                    }else{\r\n\r\n                        echarts.getInstanceByDom(e.getDom()).setOption({\r\n                            series: arr_series,\r\n                            yAxis:{data:ydata},\r\n                            legend:{data:ydata}\r\n                        })\r\n                        isper=!isper;\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n        }\r\n        \r\n    },\r\n    legend: {\r\n        data: ydata\r\n    },\r\n    grid: {\r\n        left: '3%',\r\n        right: '4%',\r\n        bottom: '3%',\r\n        containLabel: true\r\n    },\r\n    xAxis:  {\r\n        type: 'category',\r\n        data: xdata\r\n        \r\n    },\r\n    yAxis: {\r\n        type: 'value'\r\n    },\r\n    series: arr_series\r\n};","html":"","externalScripts":"","updaterUID":"bd-1916130272","theme":"","layout":"","viewCount":1052,"userName":"肆肆肆厮","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xB1WFPJCTb.png?v=1508927353089","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","tooltip"],"customTags":[],"updaterUserName":"肆肆肆厮"}}