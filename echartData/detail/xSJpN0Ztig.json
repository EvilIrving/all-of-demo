{"status":0,"data":{"cid":"xSJpN0Ztig","authorUid":"bd-4278441409","authorUserName":"CathaieseAndy","title":"Intraday Chart","description":"snapshots and pnls","latestVersion":2,"alwaysLatest":1,"createTime":"2017-03-17T07:20:20.000Z","lastUpdateTime":"2017-03-17T07:20:20.000Z","auth":2,"uid":"bd-4278441409","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"3.4.0","versionCreateTime":"2017-03-17T07:20:49.000Z","code":"function randInt(range) {\n    return parseInt(range * Math.random());\n}\nfunction genData(origin, step, length) {\n    const res = [];\n    for (let i = 0; i < length; i ++) {\n        origin += step[randInt(step.length)];\n        origin = Math.abs(origin);\n        res.push([i, origin]);\n    }\n    return res;\n}\nfunction calcPnlAndPos(orders, price) {\n    return orders.reduce(\n        (prev, cur) => [\n            prev[0] + cur[2] * (price - cur[1]),\n            prev[1] + cur[2]\n        ],\n        [0, 0]\n    );\n}\n\nconst data = {};\nconst length = 600;\ndata.price = genData(3210, [-5, 0, 5], length);\ndata.vol = genData(20, [-1, 0, 1], length);\ndata.bidVol = genData(20, [-1, 0, 1], length);\ndata.askVol = genData(20, [-1, 0, 1], length);\ndata.bidPrice = data.price.map(\n    ([time, value]) => [time, value + 5 * randInt(2)]\n);\ndata.askPrice = data.price.map(\n    ([time, value]) => [time, value - 5 * randInt(2)]\n);\n\nlet com = 0;\nconst comRate = 0.001;\ndata.com = [[0, 0]];\ndata.orders = [];\ndata.pnl = [[0, 0]];\ndata.npnl = [[0, 0]];\ndata.pos = [[0, 0]];\nfor (let i = 1; i < length; i ++) {\n    if (data.price[i][1] > data.price[i - 1][1]) {\n        data.orders.push([data.price[i][0], data.price[i][1], 1]);\n        com += data.price[i][1] * comRate;\n    } else if (data.price[i][1] < data.price[i - 1][1]) {\n        data.orders.push([data.price[i][0], data.price[i][1], -1]);\n        com += data.price[i][1] * comRate;\n    }\n    data.com.push([i, com]);\n    let [pnl, pos] = calcPnlAndPos(data.orders, data.price[i][1]);\n    data.pnl.push([i, pnl]);\n    data.npnl.push([i, pnl - com]);\n    data.pos.push([i, pos]);\n}\n\noption = {\n    title: {\n        text: 'Intraday Chart',\n        x: 'center',\n        y: 0\n    },\n    dataZoom: [\n            {\n                id: 'dataZoomX',\n                type: 'slider',\n                xAxisIndex: [0, 1, 2],\n                filterMode: 'filter',\n                start: 0,\n                end: 100,\n                zoomLock: false,\n            }, {\n                type: 'inside',\n            },\n        ],\n    tooltip : {\n        trigger: 'axis',\n        axisPointer: {\n            animation: false,\n        },\n    },\n    grid: [\n        {x: '7%', y: '7%', width: '85%', height: '20%'},\n        {x: '7%', y: '32%', width: '85%', height: '30%'},\n        {x: '7%', y: '67%', width: '85%', height: '25%'}\n    ],\n    xAxis: [\n        {gridIndex: 0},\n        {gridIndex: 1},\n        {gridIndex: 2},\n    ],\n    yAxis: [\n        {gridIndex: 0, boundaryGap: ['10%', '10%']},\n        {gridIndex: 0, boundaryGap: ['10%', '10%']},\n        {gridIndex: 1, boundaryGap: ['10%', '10%'], scale: true},\n        {gridIndex: 2, min: 0, max: 100},\n        {gridIndex: 2, min: -100, max: 50},\n        {gridIndex: 2, min: -50, max: 100, inverse: true, show: false}\n    ],\n    series: [\n        {\n            name: 'pnl',\n            type: 'line',\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            showSymbol: false,\n            hoverAnimation: false,\n            data: data.pnl\n        },\n        {\n            name: 'commission',\n            type: 'line',\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            showSymbol: false,\n            hoverAnimation: false,\n            data: data.com\n        },\n        {\n            name: 'net pnl',\n            type: 'line',\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            showSymbol: false,\n            hoverAnimation: false,\n            data: data.npnl\n        },\n        {\n            name: 'position',\n            type: 'bar',\n            xAxisIndex: 0,\n            yAxisIndex: 1,\n            data: data.pos\n        },\n        {\n            name: 'orders',\n            type: 'scatter',\n            xAxisIndex: 1,\n            yAxisIndex: 2,\n            symbolSize: (value, params) => Math.abs(value[2]) * 4,\n            itemStyle: {\n                normal: {\n                    color: ({ data }) => data[2] > 0 ? 'red' : 'green'\n                }\n            },\n            hoverAnimation: false,\n            data: data.orders\n        },\n        {\n            name: 'price',\n            type: 'line',\n            xAxisIndex: 1,\n            yAxisIndex: 2,\n            showSymbol: false,\n            hoverAnimation: false,\n            data: data.price\n        },\n        {\n            name: 'bid price',\n            type: 'line',\n            xAxisIndex: 1,\n            yAxisIndex: 2,\n            showSymbol: false,\n            hoverAnimation: false,\n            data: data.bidPrice,\n        },\n        {\n            name: 'ask price',\n            type: 'line',\n            xAxisIndex: 1,\n            yAxisIndex: 2,\n            showSymbol: false,\n            hoverAnimation: false,\n            data: data.askPrice,\n        },\n        {\n            name: 'volume',\n            type: 'bar',\n            xAxisIndex: 2,\n            yAxisIndex: 3,\n            data: data.vol\n        },\n        {\n            name: 'bid volume',\n            type: 'bar',\n            xAxisIndex: 2,\n            yAxisIndex: 4,\n            data: data.bidVol\n        },\n        {\n            name: 'ask volume',\n            type: 'bar',\n            xAxisIndex: 2,\n            yAxisIndex: 5,\n            data: data.askVol\n        }\n    ]\n};","html":"","externalScripts":"","updaterUID":"bd-4278441409","theme":"","layout":"","viewCount":5525,"userName":"CathaieseAndy","commentCount":0,"starCount":9,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSJpN0Ztig.png?v=1489735249943","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","series-bar","series-line","series-scatter","title","tooltip"],"customTags":[],"updaterUserName":"CathaieseAndy"}}