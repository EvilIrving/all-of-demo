{"status":0,"data":{"cid":"xgoax_GWY1","authorUid":"obd-oNY2FYjc9LV9V8G-mzdpPmI8FemWxCK","authorUserName":"X***2","title":"组织结构图","description":"组织结构图","latestVersion":3,"alwaysLatest":1,"createTime":"2020-09-29T07:58:38.000Z","lastUpdateTime":"2020-09-29T07:58:38.000Z","auth":2,"uid":"obd-oNY2FYjc9LV9V8G-mzdpPmI8FemWxCK","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.8.0","versionCreateTime":"2020-10-21T02:15:36.000Z","code":"//引用脚本url地址https://cdn.jsdelivr.net/npm/lodash@4.17.20/lodash.min.js\r\nvar testdata = [{\r\n        mainId: '0000',\r\n        parentIds: ['0001', '0002', '0003', '0004', '0011'],\r\n        siteName: '该站点',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '8',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0001',\r\n        parentIds: ['321', '332', '0323', '2334'],\r\n        siteName: '上级1',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0002',\r\n        parentIds: ['12131', '23102'],\r\n        siteName: '上级2',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0003',\r\n        parentIds: ['2211'],\r\n        siteName: '上级3',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0004',\r\n        parentIds: ['151', '08042'],\r\n        siteName: '上级4',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0011',\r\n        parentIds: ['151', '08042'],\r\n        siteName: '上级5',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0005',\r\n        parentIds: ['0000'],\r\n        siteName: '下级1',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0006',\r\n        parentIds: ['0000', '08042'],\r\n        siteName: '下级2',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0007',\r\n        parentIds: ['0000'],\r\n        siteName: '下级3',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0008',\r\n        parentIds: ['0000'],\r\n        siteName: '下级4',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0009',\r\n        parentIds: ['0000'],\r\n        siteName: '下级5',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0010',\r\n        parentIds: ['0000'],\r\n        siteName: '下级6',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0011',\r\n        parentIds: ['0000'],\r\n        siteName: '下级7',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    },\r\n    {\r\n        mainId: '0012',\r\n        parentIds: ['0000'],\r\n        siteName: '下级8',\r\n        saleTotal: '98487',\r\n        upsite: '5',\r\n        subordinate: '14',\r\n        rank: '10'\r\n    }\r\n]\r\nvar parentsList = []\r\nvar testline = []\r\nlet upSiteNum // 上级站点个数\r\nlet nextSiteNum // 下级站点个数\r\nfor (const i in testdata) {\r\n    if (testdata[i].mainId === '0000') {\r\n        testdata[i].x = 1000 / 2\r\n        testdata[i].y = 500\r\n        parentsList = testdata[i].parentIds\r\n        upSiteNum = testdata[i].upsite > 10 ? 10 : testdata[i].upsite\r\n        nextSiteNum = testdata[i].subordinate > 10 ? 10 : testdata[i].subordinate\r\n    } else {\r\n        const res = _.includes(testdata[i].parentIds, '0000')\r\n        if (res) {\r\n            // 下级\r\n            testdata[i].x = (i - upSiteNum - 1) * (1000 / nextSiteNum)\r\n            testdata[i].y = 200\r\n\r\n            const x = testdata[0].x\r\n            const y = testdata[0].y\r\n            const coords = []\r\n            coords.push([x, y])\r\n            coords.push([x, y - 150])\r\n            coords.push([(i - upSiteNum - 1) * (1000 / nextSiteNum), y - 150])\r\n            coords.push([(i - upSiteNum - 1) * (1000 / nextSiteNum), testdata[i].y])\r\n            const a = {\r\n                coords: coords\r\n            }\r\n            testline.push(a)\r\n        } else {\r\n            testdata[i].x = (i - 1) * (1000 / (upSiteNum - 1))\r\n            testdata[i].y = 800\r\n\r\n            const x = testdata[0].x\r\n            const y = testdata[0].y\r\n            const coords = []\r\n            coords.push([x, y])\r\n            coords.push([x, y + 150])\r\n            coords.push([(i - 1) * (1000 / (upSiteNum - 1)), y + 150])\r\n            coords.push([(i - 1) * (1000 / (upSiteNum - 1)), testdata[i].y])\r\n            const a = {\r\n                coords: coords\r\n            }\r\n            testline.push(a)\r\n        }\r\n    }\r\n}\r\nvar nodes = _.cloneDeep(testdata)\r\n\r\nvar charts = {\r\n    nodes: [],\r\n    linesData: testline\r\n}\r\nfor (var j = 0; j < nodes.length; j++) {\r\n    var x = parseInt(nodes[j].x)\r\n    var y = parseInt(nodes[j].y)\r\n    var node = {\r\n        siteName: nodes[j].siteName,\r\n        value: [x, y],\r\n        symbolSize: 30,\r\n        mainId: nodes[j].mainId,\r\n        saleTotal: nodes[j].saleTotal,\r\n        upsite: nodes[j].upsite,\r\n        subordinate: nodes[j].subordinate,\r\n        rank: nodes[j].rank,\r\n        itemStyle: {\r\n            normal: {\r\n                color: '#12b5d0'\r\n            }\r\n        }\r\n    }\r\n    charts.nodes.push(node)\r\n}\r\n\r\noption = {\r\n    tooltip: {\r\n        formatter: function(params) {\r\n            let str = ''\r\n            if (params.seriesType === 'graph') {\r\n                str = '站点名称:' + params.data.siteName + '<br/>'\r\n                str += '销售总额:' + params.data.saleTotal + '元<br/>'\r\n                if (params.data.mainId === '0000') {\r\n                    str += '上级:' + params.data.upsite + '个<br/>'\r\n                    str += '下级:' + params.data.subordinate + '个<br/>'\r\n                } else {\r\n                    str += '排名:' + params.data.rank + '<br/>'\r\n                }\r\n                return str\r\n            }\r\n        }\r\n    },\r\n    xAxis: {\r\n        min: 0,\r\n        max: 1000,\r\n        show: false,\r\n        type: 'value'\r\n    },\r\n    yAxis: {\r\n        min: 0,\r\n        max: 1000,\r\n        show: false,\r\n        type: 'value'\r\n    },\r\n    series: [{\r\n        type: 'graph',\r\n        coordinateSystem: 'cartesian2d',\r\n        label: {\r\n            normal: {\r\n                show: true,\r\n                position: 'bottom',\r\n                color: '#000000'\r\n            }\r\n        },\r\n        data: charts.nodes\r\n    }, {\r\n        type: 'lines',\r\n        polyline: true,\r\n        coordinateSystem: 'cartesian2d',\r\n        lineStyle: {\r\n            normal: {\r\n                width: 2,\r\n                color: '#000000',\r\n                curveness: 0.3\r\n            }\r\n        },\r\n        data: charts.linesData\r\n    }]\r\n};","html":"","externalScripts":"https://cdn.jsdelivr.net/npm/lodash@4.17.20/lodash.min.js","updaterUID":"obd-oNY2FYjc9LV9V8G-mzdpPmI8FemWxCK","theme":"","layout":"","viewCount":1800,"userName":"X***2","commentCount":0,"starCount":8,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xgoax_GWY1.png?v=1603246536277","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-graph","series-lines","tooltip"],"customTags":["关系图","拓扑图","组织结构图"],"updaterUserName":"X***2"}}