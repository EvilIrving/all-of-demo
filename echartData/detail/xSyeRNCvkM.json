{"status":0,"data":{"cid":"xSyeRNCvkM","authorUid":"bd-4022476514","authorUserName":"wdssb1114","title":"数据分析&查询不合格来源","description":"tooltip提示内容的修改，图例之间的联动。\n本地做了一个select用与合格数与全部之间的切换数据。文中已经注释掉，有兴趣的朋友可以复制到本地试一下。select的id为pass，选项为\n<option>不合格数</option><option>全部</option>\n另外，拉动条后期会做一个适配屏幕的大小；\n注：文中除echarts外的一切code，均为js，看着不爽的大神欢迎修改","latestVersion":1,"alwaysLatest":1,"createTime":"2017-11-14T02:28:23.000Z","lastUpdateTime":"2017-11-14T02:28:23.000Z","auth":2,"uid":"bd-4022476514","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.8.0","versionCreateTime":"2017-11-14T02:28:23.000Z","code":"var xData = [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"]\nvar colors = [\"#c43b33\", \"#016299\", \"#008e9c\", \"#a42380\", \"#d09900\", \"#f2c172\", \"#009d6a\", \"#8fc41e\", \"#009dbe\", \"#f9e701\", \"#d4a7a2\", \"#5d2d69\", \"#76A32E\", \"#c33a32\", \"#de82b1\", \"#e40177\", \"#008e9c\", \"#557284\", \"#e66021\", \"#004ea2\"];\n//第一个tab\nvar itemList = ['氯霉素', '四环素类', '地塞米松', '金刚烷胺', '磺胺类', '替米考星', '克伦特罗', '沙丁胺醇', '西马特罗', '黄曲霉B1', '氟苯尼考', '莱克多巴胺'];\n//此处selectedList应该利用itemList做一个循环\nvar selectedList = {};\nvar selectedList1 = {};\nvar legendData = [];\nfor (var i = 0; i < itemList.length; i++) {\n    selectedList[itemList[i] + \"合格率\"] = false;\n    selectedList[itemList[i] + \"合格数\"] = true;\n    selectedList1[itemList[i] + \"合格率\"] = false;\n    selectedList1[itemList[i] + \"合格数\"] = false;\n    legendData.push(itemList[i] + \"合格率\");\n    legendData.push(itemList[i] + \"不合格数\")\n}\nvar serieshHegeData = [\n    ['99', '100', '90', '80', '100', '90', '80', '100', '90', '80', '100', '90', '80'],\n    ['98', '100', '90', '80', '100', '90', '80', '100', '90', '80', '100', '90', '80'],\n    ['88', '75', '67', '88', '75', '67', '88', '75', '67', '88', '75', '67', '82'],\n    ['76', '95', '83', '76', '95', '83', '76', '95', '83', '76', '95', '83', '97'],\n    ['70', '96', '45', '75', '75', '72', '92', '100', '78', '98', '72', '91', '80'],\n    ['78', '75', '91', '88', '83', '67', '80', '65', '89', '86', '75', '77', '88'],\n    ['86', '98', '100', '86', '85', '93', '86', '85', '73', '86', '85', '73', '87'],\n    ['91', '75', '67', '88', '75', '67', '88', '75', '67', '88', '75', '67', '82'],\n    ['81', '95', '83', '76', '95', '83', '76', '95', '83', '76', '95', '83', '97'],\n    ['75', '96', '45', '75', '75', '72', '92', '100', '78', '98', '72', '91', '80'],\n    ['95', '75', '91', '88', '83', '67', '80', '65', '89', '86', '75', '77', '88'],\n    ['100', '98', '100', '86', '85', '93', '86', '85', '73', '86', '85', '73', '87']\n]; //合格率\nvar serieshHegeNumData = [\n    ['8', '10', '9', '8', '10', '9', '8', '10', '9', '8', '10', '9'],\n    ['8', '10', '9', '8', '10', '9', '8', '10', '9', '8', '10', '9'],\n    ['253', '452', '234', '253', '452', '234', '253', '452', '234', '253', '452', '234'],\n    ['398', '287', '197', '398', '287', '197', '398', '287', '197', '398', '287', '197'],\n    ['8', '10', '9', '8', '10', '9', '8', '10', '9', '8', '10', '9'],\n    ['253', '452', '234', '253', '452', '234', '253', '452', '234', '253', '452', '234'],\n    ['398', '287', '197', '398', '287', '197', '398', '287', '197', '398', '287', '197'],\n    ['253', '452', '234', '253', '452', '234', '253', '452', '234', '253', '452', '234', ],\n    ['398', '287', '197', '398', '287', '197', '398', '287', '197', '398', '287', '197'],\n    ['8', '10', '9', '8', '10', '9', '8', '10', '9', '8', '10', '9'],\n    ['253', '452', '234', '253', '452', '234', '253', '452', '234', '253', '452', '234'],\n    ['398', '287', '197', '398', '287', '197', '398', '287', '197', '398', '287', '197']\n]; //合格数\nvar serieshNoHegeNumData = [\n    ['8', '100', '90', '80', '100', '90', '80', '100', '90', '80', '100', '90'],\n    ['8', '100', '90', '80', '100', '90', '80', '100', '90', '80', '100', '90'],\n    ['28', '85', '78', '28', '85', '78', '28', '85', '78', '28', '85', '78'],\n    ['38', '28', '18', '38', '28', '18', '38', '28', '18', '38', '28', '18'],\n    ['80', '100', '90', '80', '100', '90', '80', '100', '90', '80', '100', '90'],\n    ['28', '25', '78', '28', '25', '78', '28', '25', '78', '28', '25', '78'],\n    ['38', '28', '18', '38', '28', '18', '38', '28', '18', '38', '28', '18'],\n    ['28', '15', '78', '28', '15', '78', '28', '15', '78', '28', '15', '78'],\n    ['38', '28', '18', '38', '28', '18', '38', '28', '18', '38', '28', '18'],\n    ['80', '100', '90', '80', '100', '90', '80', '100', '90', '80', '100', '90'],\n    ['28', '85', '78', '28', '85', '78', '28', '85', '78', '28', '85', '78'],\n    ['38', '28', '18', '38', '28', '18', '38', '28', '18', '38', '28', '18']\n\n]; //不合格数\n//第一个tab\n\nvar seriesData = []; //初始化seriesData\n//处理数据  用于series\nvar seriesFun = function() {\n    for (var i = 0; i <= itemList.length; i++) {\n        a = {\n            name: itemList[i] + '合格率',\n            type: 'line',\n            smooth: true,\n            itemStyle: {\n                normal: {\n                    color: colors[i]\n                }\n            },\n            data: serieshHegeData[i]\n        }\n        b = {\n            name: itemList[i] + '合格数',\n            type: 'bar',\n            stack: itemList[i],\n            yAxisIndex: 1,\n            itemStyle: {\n                normal: {\n                    color: \"#009d6a\"\n                }\n            },\n            data: serieshHegeNumData[i]\n        }\n\n        c = {\n            name: itemList[i] + '不合格数',\n            type: 'bar',\n            stack: itemList[i],\n            yAxisIndex: 2,\n            itemStyle: {\n                normal: {\n                    color: colors[i]\n                }\n            },\n            data: serieshNoHegeNumData[i]\n        }\n\n        seriesData.push(a)\n        seriesData.push(b)\n        seriesData.push(c)\n\n    }\n    return seriesData;\n};\nseriesFun();\n\nvar option = {\n    title: {\n        text: '某个类型不同项目【部门一】月报表',\n        x: 'center',\n        subtext: ''\n    },\n    color: colors,\n    tooltip: {\n        trigger: 'item',\n        confine: true,\n        formatter: function(params, ticket, callback) {\n            var num = parseInt(params.seriesIndex / 3)\n            return xData[params.dataIndex] + \"【\" + itemList[num] + \"】\" + \"数据\" + \"<br />\" + \"<hr />\" +\n                itemList[num] + \"合格率\" + \":\" + serieshHegeData[num][params.dataIndex] + \"<br />\" +\n                itemList[num] + \"合格数\" + \":\" + serieshHegeNumData[num][params.dataIndex] + \"<br />\" +\n                itemList[num] + \"不合格数\" + \":\" + serieshNoHegeNumData[num][params.dataIndex] + \"<br />\";\n        }\n    },\n    grid: { //图标所占的空间位置\n        top: '10',\n        bottom: '240'\n    },\n    toolbox: { //提示框\n        orient: 'vertical',\n        itemGap: 15,\n        right: '15',\n        y: 'center',\n        feature: {\n            dataView: {\n                show: true,\n                readOnly: false\n            },\n            magicType: {\n                show: true,\n                type: ['line', 'bar']\n            },\n            restore: {\n                show: true\n            },\n            saveAsImage: {\n                show: true\n            }\n        }\n    },\n    legend: {\n        selected: selectedList,\n        // orient:\"vertical\",\n        // x: 'left',\n        y: 'bottom',\n        data: legendData\n    },\n    xAxis: [{\n        type: 'category',\n        axisTick: {\n            alignWithLabel: true\n        },\n        data: xData\n    }],\n    yAxis: [{\n        type: 'value',\n        name: '合格率',\n        min: 0,\n        max: 100,\n        position: 'left',\n        axisLabel: {\n            formatter: '{value} %'\n        }\n    }, {\n\n        type: 'value',\n        name: '不合格/合格数',\n        min: 0,\n        max: 500,\n        position: 'right',\n\n        axisLine: {\n            lineStyle: {\n                color: colors[1]\n            }\n        },\n        axisLabel: {\n            formatter: '{value} 个'\n        }\n    }, {\n        show: false,\n        type: 'value',\n        name: '不合格/合格数',\n        min: 0,\n        max: 500,\n        position: 'right',\n\n        axisLine: {\n            lineStyle: {\n                color: colors[2]\n            }\n        },\n        axisLabel: {\n            formatter: '{value} 个'\n        }\n    }],\n    dataZoom: [{ //滚动条\n        show: true,\n        height: 30,\n        xAxisIndex: [0],\n        bottom: 0,\n        type: 'slider',\n        start: 1,\n        end: 20,\n        handleSize: '110%',\n        handleStyle: {\n            color: '#9B4E4E'\n        },\n        bottom: \"180\"\n    }],\n    series: seriesData\n};\n//切换全部数据与不合格数据显示\n// \t\tvar pass = document.getElementById(\"pass\");\n// \t\tpass.onchange = function() {\n// \t\t\tif(pass.selectedIndex == \"0\") {\n// \t\t\t\toption.legend.selected = selectedList1;\n// \t\t\t\tmyChart.setOption(option);\n// \t\t\t} else {\n// \t\t\t\toption.legend.selected = selectedList;\n// \t\t\t\tmyChart.setOption(option);\n// \t\t\t}\n// \t\t}\n//合格数、不合格数与合格率间的显示联动\nmyChart.on('legendselectchanged', function(params) {\n        var str = params.name.substr(params.name.length - 4);\n        if (str == \"不合格数\") {\n            var item = params.name.split(\"不合格数\");\n            var Name = item[0] + \"合格率\";\n            var NameNoHeGe = item[0] + \"不合格数\";\n            var NameHeGe = item[0] + \"合格数\";\n            //判断不合格数的显示与否，联动合格数的现实与否\n            if (params.selected[NameNoHeGe] == true) {\n                //与option联动\n                // \tif (pass.selectedIndex == \"0\") {\n                // \t\tparams.selected[NameHeGe] = false;\n                // \t} else{\n                params.selected[NameHeGe] = true;\n                // \t}\n\n            } else {\n                params.selected[NameHeGe] = false;\n                params.selected[Name] = false;\n            }\n\n            option.legend.selected = params.selected;\n            myChart.setOption(option);\n        } else {\n            var item = params.name.split(\"合格率\");\n            var NameNoHeGe = item[0] + \"不合格数\";\n            var NameHeGe = item[0] + \"合格数\";\n            //与option联动\n            // if (pass.selectedIndex == \"0\") {\n            // \tparams.selected[NameNoHeGe] = true;\n            // \tparams.selected[NameHeGe] = false;\n            // }else{\n            params.selected[NameNoHeGe] = true;\n            params.selected[NameHeGe] = true;\n            // }\n\n            option.legend.selected = params.selected;\n            myChart.setOption(option);\n        }\n    })\n    //\nmyChart.on(\"click\", eConsole);\n\nfunction eConsole(param) {\n    // \t\t\tif (pass.selectedIndex == \"0\") {\n    if (param.seriesName.substring(param.seriesName.length - 4) == '不合格数') {\n        //留待查询时使用\n\n    }\n    // \t\t\t} \n}","html":"","externalScripts":"","updaterUID":"bd-4022476514","theme":"","layout":"","viewCount":995,"userName":"wdssb1114","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSyeRNCvkM.png?v=1510626504048","isCustomThumbnail":1,"builtinTags":["category-work","dataZoom","grid","legend","series-bar","series-line","title","toolbox","tooltip"],"customTags":["dataZoom","feature","grid","legendselectchanged","on事件","tooltip"],"updaterUserName":"wdssb1114"}}