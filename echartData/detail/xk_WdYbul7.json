{"status":0,"data":{"cid":"xk_WdYbul7","authorUid":"obd-otaAfgIp_bpJM4KWJkvID1rr6cybb8U","authorUserName":"d***懂","title":"渐变折线柱状图","description":"常用渐变折线柱状图，带显示tooltip定时器","latestVersion":2,"alwaysLatest":1,"createTime":"2020-11-30T07:41:24.000Z","lastUpdateTime":"2020-11-30T07:41:24.000Z","auth":2,"uid":"obd-otaAfgIp_bpJM4KWJkvID1rr6cybb8U","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2020-12-09T05:50:10.000Z","code":"let opt = {\r\n   xAxisData: [\"一月\", \"二月\", \"三月\", \"四月\"],\r\n   aUnit:[\"万m²\", \"%\"],\r\n   series:[\r\n     {name: \"2018年\", type: \"bar\", data:[\"75.89\", \"560.96\", \"186.41\", \"656.73\"], symbol: \"none\",normalColor:[\"#FF0007\",\"#FFAAAC\"]},\r\n     {name: \"2019年\", type: \"line\", data:[\"18.70\", \"318.75\", \"187.11\", \"147.70\"], symbol: \"none\",normalColor:[\"#23BCBA\",\"#FAD961\"]},\r\n     ]\r\n}\r\nlet mainOpt = {\r\n    color:[\r\n     [\"#FF0007\", \"#FFAAAC\"], [\"#F76B1C\", \"#FAD961\"],\r\n    ]\r\n}\r\n\r\nlet { xAxisData = [], series = [], aUnit = [] } = opt;\r\nlet { color } = mainOpt;\r\nlet legend = series.map(item => item.name);\r\n\r\n// let yAxis = baseyAxisSet(aUnit,series)\r\nlet realUnit = Array.from(new Set(aUnit))\r\nlet seriesType = Array.from(new Set(series.map(item => item.type)));\r\nlet yAxis = seriesType.map((yname, ind) => {\r\n    let defOpt = {\r\n        name:realUnit.length>1?realUnit[ind]:realUnit[0],\r\n        nameTextStyle: {\r\n            padding: ind ? [0, 0, 0, 10] : [0, 20, 0, 0],\r\n            color: \"#999\",\r\n            fontSize: 12\r\n        },\r\n        axisLabel: {\r\n            formatter: '{value}',\r\n            color: '#999',\r\n            textStyle: {\r\n                fontSize: 12\r\n            },\r\n        },\r\n        axisLine: \"none\",\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        // splitNumber : 4,\r\n        splitLine: {\r\n            show: false,\r\n            // show: ind ? false : true,\r\n            lineStyle: {\r\n                color: 'rgba(131,101,101,0.2)',\r\n                type: 'dashed',\r\n            }\r\n        }\r\n    }\r\n    return defOpt;\r\n})\r\n\r\n\r\nseries = series.map((sery, ind) => {\r\n    let newSery = {};\r\n    let { type, normalColor = [] } = sery;\r\n    let defBarOpt = {\r\n        yAxisIndex: seriesType.indexOf(sery.type),\r\n        barWidth: '10px',\r\n        ...sery,\r\n    };\r\n    // let lineInd = 0\r\n    // if (yAxis.length > 1 && ind == series.length - 1) {\r\n    //     lineInd = 1;\r\n    // }\r\n    let defLineOpt = {\r\n        yAxisIndex: seriesType.indexOf(sery.type),\r\n        symbol: \"none\",\r\n        lineStyle: {\r\n            width: 2,\r\n            color: normalColor[0]\r\n        },\r\n        itemStyle: {\r\n            color: normalColor[0]\r\n        },\r\n    }\r\n    if (type == 'bar') {\r\n        let splicePice = normalColor.length;\r\n        if (splicePice > 1) {\r\n            let linearColor = [{\r\n                offset: 0,\r\n                color: normalColor[0]\r\n            }, {\r\n                offset: 1,\r\n                color: normalColor[normalColor.length - 1]\r\n            }]\r\n            defBarOpt = {\r\n                ...defBarOpt,\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, linearColor, false),\r\n                        opacity: 0.8\r\n                    },\r\n                },\r\n            }\r\n        } else {\r\n            defBarOpt = {\r\n                ...defBarOpt,\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: normalColor[0]\r\n                    },\r\n                },\r\n            }\r\n        }\r\n\r\n        newSery = { ...sery, ...defBarOpt }\r\n    } else if (type == 'line') {\r\n        newSery = { ...sery, ...defLineOpt }\r\n    }\r\n    return newSery\r\n});\r\n\r\noption = {\r\n    backgroundColor: '#071729',\r\n    title: {\r\n        text: ''\r\n    },\r\n    color: color,\r\n    legend: {\r\n        type: 'scroll',\r\n        data: legend,\r\n        bottom: 10,\r\n        itemWidth: 11,\r\n        itemHeight: 6,\r\n        itemGap: 20,\r\n        textStyle: {\r\n            color: '#8998AC',\r\n            fontSize: 12\r\n        }\r\n    },\r\n    grid: {\r\n        top: '10%',\r\n        left: '30',\r\n        right: '30',\r\n        bottom: '5%',\r\n        containLabel: true\r\n    },\r\n    toolbox: {\r\n        feature: {\r\n        }\r\n    },\r\n    tooltip: {\r\n        \"trigger\": \"axis\",\r\n        confine: true,\r\n        formatter: function (params) {\r\n            let titleText = '';\r\n            let htmlStr = `<div class=\"jc_echarts_tooltip_box\"><div class=\"tool_axisLabel\">${params[0].axisValueLabel}${titleText}</div>`;\r\n\r\n            params.forEach((ser, ind) => {\r\n                let { seriesName, value, color, axisIndex, dataIndex } = ser;\r\n                // console.log(ser,seriesName, value, color.colorStops,color ,axisIndex,dataIndex,ind,aUnit,666)\r\n\r\n\r\n                let unit = '';\r\n                if (ind >= aUnit.length) {\r\n                    unit = aUnit[aUnit.length - 1] || '';\r\n                } else {\r\n                    unit = aUnit[ind];\r\n                }\r\n\r\n                if (value == 0 || value == null) {\r\n                    unit = '';\r\n                    value = '-';\r\n                }\r\n                if (typeof color == 'object' && color.colorStops) {\r\n                    color = color.colorStops[color.colorStops.length - 1].color;\r\n                }\r\n\r\n                htmlStr += `<div class=\"flex_b flex_align line_tootip_box\" style=\"min-width: 177px;\">\r\n                <div class=\"flex_align\"><span class=\"seriy_icon\" style=\"display:inline-block;\r\n                background-color:${color};\"></span> ${seriesName}：</div>\r\n                <span class=\"value\">${value}${unit}</span>\r\n                </div>`\r\n            })\r\n            htmlStr += `</div>`\r\n            return htmlStr\r\n        },\r\n        backgroundColor: 'transparent',\r\n        textStyle: {\r\n            color: '#8998AC',\r\n            fontSize: 10,\r\n        },\r\n        position: function (point, params, dom, rect, size) {\r\n            // 固定在顶部\r\n            // return [point[0], '10%'];\r\n            var obj = { top: '10%' };\r\n            let pst = (point[0] < size.viewSize[0] / 2) ? 'right' : 'left'\r\n            if (pst == 'left') {\r\n                obj.right = size.viewSize[0] - point[0] + 15\r\n            } else {\r\n                obj.left = point[0] + 15\r\n            }\r\n            return obj\r\n\r\n        }\r\n    },\r\n    xAxis: {\r\n        type: 'category',\r\n        boundaryGap: true,\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        splitLine: {\r\n            show: false\r\n        },\r\n        axisLabel: {\r\n            color: '#727272',\r\n            fontSize: 10,\r\n        },\r\n        axisLine: {\r\n            lineStyle: {\r\n                color: '#E9E9E9'\r\n            }\r\n        },\r\n\r\n        data: xAxisData\r\n    },\r\n    yAxis: yAxis,\r\n    series: series,\r\n    ...mainOpt\r\n};\r\n\r\nlet curDataIndex = 0;\r\nsetInterval(() => {\r\n        if(curDataIndex==xAxisData.length-1){\r\n            curDataIndex = 0;\r\n        }else{\r\n            curDataIndex++;\r\n        }\r\n        \r\n        // 高亮当前图形\r\n        myChart.dispatchAction({\r\n            type: 'highlight',\r\n            seriesIndex: 0,\r\n            dataIndex: curDataIndex,\r\n        });\r\n         myChart.dispatchAction({\r\n            type: 'showTip',\r\n            seriesIndex:0,  // 显示第几个tooltip\r\n            dataIndex: curDataIndex // 显示第几个数据\r\n        });\r\n    }, 2000);\r\n\r\n// tooltip样式\r\n// .jc_echarts_tooltip_box {\r\n//     background: rgba(255, 255, 255, 1);\r\n//     box-shadow: 0px 5px 7px -3px rgba(0, 0, 0, 0.13);\r\n//     border: 1px solid rgba(102, 107, 127, 0.1);\r\n//     padding: 15px 10px 10px 10px;\r\n//     border-radius: 4px;\r\n//     .tool_axisLabel {\r\n//         color: #666b7f;\r\n//         font-size: 12px;\r\n//         font-weight: bold;\r\n//         padding-bottom: 5px;\r\n//         display: block;\r\n//         text-align: left;\r\n//     }\r\n//     .line_tootip_box {\r\n//         line-height: 20px;\r\n//         color: #666b7f;\r\n//         .seriy_icon {\r\n//             width: 5px;\r\n//             height: 5px;\r\n//             border-radius: 100%;\r\n//             margin-right: 5px;\r\n//         }\r\n//         .value {\r\n//             color: #000000;\r\n//             font-size: 10px;\r\n//             font-weight: bold;\r\n//             &.emit_value {\r\n//                 float: right;\r\n//                 text-align: right;\r\n//             }\r\n//         }\r\n//     }\r\n//     .trade-block-month {\r\n//         width: 132px;\r\n//         height: 24px;\r\n//         line-height: 24px;\r\n//         background: #f6f6f6;\r\n//         border-radius: 2px;\r\n//         margin-top: 9px;\r\n//         text-align: center;\r\n//         font-size: 12px;\r\n//         color: #8998ac;\r\n//         margin-left: auto;\r\n//         margin-right: auto;\r\n//     }\r\n//     .scatter_tootip_box {\r\n//         line-height: 20px;\r\n//         .seriy_icon {\r\n//             width: 8px;\r\n//             height: 8px;\r\n//             border-radius: 100%;\r\n//             margin-right: 5px;\r\n//         }\r\n//         .value {\r\n//             color: #000000;\r\n//             font-size: 10px;\r\n//             font-weight: bold;\r\n//         }\r\n//     }\r\n// }\r\n","html":"","externalScripts":"","updaterUID":"obd-otaAfgIp_bpJM4KWJkvID1rr6cybb8U","theme":"","layout":"","viewCount":32,"userName":"d***懂","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xk_WdYbul7.png?v=1607493010784","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","series-line","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"d***懂"}}