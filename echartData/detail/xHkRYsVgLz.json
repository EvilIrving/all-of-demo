{"status":0,"data":{"cid":"xHkRYsVgLz","authorUid":"bd-3323870131","authorUserName":"秋***飞","title":"虚拟地图区域数据统计-柱状图","description":"虚拟地图区域数据统计-柱状图（求修改：将柱状图修改到对应省显示）","latestVersion":1,"alwaysLatest":1,"createTime":"2018-02-01T07:02:30.000Z","lastUpdateTime":"2018-02-01T07:02:30.000Z","auth":1,"uid":"bd-3323870131","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.8.0","versionCreateTime":"2018-02-01T07:02:30.000Z","code":"var typeArr = [\"鲜花\",\"星星\",\"香蕉\",\"嫌弃\"];\r\nvar typeIndex = 1;\r\nvar selectedRange = null;\r\nvar option = null;\r\nvar str = \"\";\r\nvar data = [];\r\nvar geoCoordMap = {};\r\nvar name = \"虚拟地图区域柱状图\"\r\nvar mapName = 'china'\r\n// 地图特征\r\nvar mapFeatures = echarts.getMap(mapName).geoJson.features;\r\nmapFeatures.forEach(function(v){\r\n    // 地区名称\r\n    var name = v.properties.name;\r\n    // 地区经纬度\r\n    geoCoordMap[name] = v.properties.cp;\r\n    data.push({\r\n    \t// 需要挨个处理各地区数据（不使用随机产生的数）：另外需要构造的数据是柱图数据\r\n    \t\"name\":name,\r\n    \t\"value\":[\r\n    \t{name:\"鲜花\",value:Math.round(Math.random() * 100 + 10)},\r\n    \t{name:\"星星\",value:Math.round(Math.random() * 100 + 10)},\r\n    \t{name:\"香蕉\",value:Math.round(Math.random() * 100 + 10)},\r\n    \t{name:\"嫌弃\",value:Math.round(Math.random() * 100 + 10)}\r\n    \t]\r\n    })\r\n});\r\n// 地理坐标图(打印出来方便查看)\r\nconsole.log(\"===========geoCoordMap===============\");\r\nfor (var i in geoCoordMap) {\r\n\tconsole.log(geoCoordMap[i]);\r\n}\r\nconsole.log(geoCoordMap);\r\nconsole.log(\"==============data===============\");\r\nconsole.log(data);\r\n\r\n//变换地图数据（格式）：pie\r\n// function convertMapDta(type,data){\r\n// \tvar mapData = [];\r\n// \tdata.forEach(function(v){\r\n// \t\tv.value.forEach(function(v1){\r\n// \t\t\tif(String(v1.name) === String(type)){\r\n// \t\t\t\tmapData.push({\r\n// \t\t\t\t\t\"name\":v.name,\"value\":v1.value\r\n// \t\t\t\t})\r\n// \t\t\t}\r\n// \t\t})\r\n// \t});\r\n// \tmapData.push({\r\n// \t\tname: '南海诸岛',\r\n// \t\titemStyle: {\r\n// \t\t\tnormal: {\r\n// \t\t\t\topacity:0\r\n// \t\t\t}\r\n// \t\t},\r\n// \t\tlabel: {\r\n// \t\t\tnormal: {\r\n// \t\t\t\tshow: false\r\n// \t\t\t}\r\n// \t\t}\r\n// \t});\r\n\r\n//变换地图数据（格式）：bar\r\nfunction convertMapDta_bar(type,data){\r\n\tvar mapData = [];\r\n\tdata.forEach(function(v){\r\n\t\tv.value.forEach(function(v1){\r\n\t\t\tif(String(v1.name) === String(type)){\r\n                // 数据格式：data: [120, 200, 150, 80]\r\n                mapData.push({\r\n                \t\"name\":v.name,\"value\":v1.value\r\n                })\r\n            }\r\n        })\r\n\t});\r\n\treturn mapData;\r\n}\r\nconsole.log(\"================mapData==================\")\r\nconsole.log(convertMapDta_bar(typeArr[typeIndex],data))\r\nconsole.log(\"=========================================\")\r\n\r\n/*resetPie*/\r\n// function resetPie(myChart,params,geoCoordMap,typeIndex){\r\n// \tvar op = myChart.getOption();\r\n// \tvar ops = op.series;\r\n// \tops.forEach(function(v,i){\r\n// \t\tif(i > 0){\r\n// \t\t\tvar geoCoord = geoCoordMap[v.name];\r\n// \t\t\tvar p = myChart.convertToPixel({seriesIndex: 0}, geoCoord);\r\n// \t\t\tv.center = p; \r\n// \t\t\tif(params != 0 && params.zoom){\r\n// \t\t\t\tv.radius = v.radius * params.zoom;\r\n// \t\t\t}\r\n// \t\t\tif(params != 0 && params.selected){\r\n// \t\t\t\tvar rangeFirstNumber = params.selected[0];\r\n// \t\t\t\tvar rangeSecondNumber = params.selected[1];\r\n// \t\t\t\tvar pd = v.data[typeIndex].value;\r\n// \t\t\t\tif(pd < rangeFirstNumber || pd > rangeSecondNumber){\r\n// \t\t\t\t\tv.itemStyle.normal.opacity = 0;\r\n// \t\t\t\t}else{\r\n// \t\t\t\t\tv.itemStyle.normal.opacity = 1;\r\n// \t\t\t\t}\r\n// \t\t\t}\r\n// \t\t}\r\n// \t});\r\n// \tmyChart.setOption(op,true);\r\n// }\r\n\r\nfunction resetBar(myChart,params,geoCoordMap,typeIndex){\r\n\tvar op = myChart.getOption();\r\n\tvar ops = op.series;\r\n\tops.forEach(function(v,i){\r\n\t\tif(i > 0){\r\n\t\t\tvar geoCoord = geoCoordMap[v.name];\r\n\t\t\tvar p = myChart.convertToPixel({seriesIndex: 0}, geoCoord);\r\n\t\t\tv.center = p; \r\n\t\t\tif(params != 0 && params.zoom){\r\n\t\t\t\tv.radius = v.radius * params.zoom;\r\n\t\t\t}\r\n\t\t\tif(params != 0 && params.selected){\r\n\t\t\t\tvar rangeFirstNumber = params.selected[0];\r\n\t\t\t\tvar rangeSecondNumber = params.selected[1];\r\n\t\t\t\tvar pd = v.data[typeIndex].value;\r\n\t\t\t\tif(pd < rangeFirstNumber || pd > rangeSecondNumber){\r\n\t\t\t\t\tv.itemStyle.normal.opacity = 0;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tv.itemStyle.normal.opacity = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tmyChart.setOption(op,true);\r\n}\r\n/*addPie*/\r\n// function addPie(chart,data) {\r\n// \tvar op = chart.getOption();\r\n// \tvar sd = option.series;\r\n// \tfor (var i = 0; i < data.length; i++) {\r\n// \t\tvar randomValue = Math.round(Math.random() * 30);\r\n// \t\tvar radius = randomValue <= 10 ? 10 : randomValue;\r\n// \t\tvar geoCoord = geoCoordMap[data[i].name];\r\n// \t\tif (geoCoord) {\r\n// \t\t\tvar vr = [];\r\n// \t\t\t(data[i].value).map(function(v,j){\r\n// \t\t\t\tvr.push({name:v.name,value:v.value});\r\n// \t\t\t});\r\n// \t\t\tvar p = chart.convertToPixel({seriesIndex: 0}, geoCoord);\r\n// \t\t\tsd.push(\r\n// \t\t\t{\r\n// \t\t\t\tname:data[i].name,\r\n// \t\t\t\ttype:'pie',\r\n// \t\t\t\ttooltip:{\r\n// \t\t\t\t\tformatter:function(params){\r\n// \t\t\t\t\t\treturn params.seriesName + \"<br/>\" + params.name + \" : \" + params.value;\r\n// \t\t\t\t\t}\r\n// \t\t\t\t},\r\n// \t\t\t\tradius : radius,\r\n// \t\t\t\tcenter: p,\r\n// \t\t\t\tdata:vr,\r\n// \t\t\t\tzlevel:4,\r\n// \t\t\t\tlabel: {\r\n// \t\t\t\t\tnormal: {\r\n// \t\t\t\t\t\tshow: false,\r\n// \t\t\t\t\t},\r\n// \t\t\t\t},\r\n// \t\t\t\tlabelLine: {\r\n// \t\t\t\t\tnormal: {\r\n// \t\t\t\t\t\tshow: false\r\n// \t\t\t\t\t}\r\n// \t\t\t\t},\r\n// \t\t\t\titemStyle:{\r\n// \t\t\t\t\tmormal:{\r\n// \t\t\t\t\t\topacity:1 \r\n// \t\t\t\t\t}\r\n// \t\t\t\t}\r\n// \t\t\t}\r\n// \t\t\t);\r\n// \t\t}\r\n// \t}\r\n// \treturn sd;\r\n// };\r\n\r\n/*addBar*/\r\nfunction addBar(chart,data) {\r\n\tvar op = chart.getOption();\r\n\tvar sd = option.series;\r\n\tfor (var i = 0; i < data.length; i++) {\r\n\t\tvar randomValue = Math.round(Math.random() * 30);\r\n\t\tvar radius = randomValue <= 10 ? 10 : randomValue;\r\n\t\tvar geoCoord = geoCoordMap[data[i].name];\r\n\t\tif (geoCoord) {\r\n\t\t\tvar vr = [];\r\n\t\t\t(data[i].value).map(function(v,j){\r\n\t\t\t\t// vr.push({name:v.name,value:v.value});\r\n\t\t\t\tvr.push(v.value);\r\n\t\t\t});\r\n\t\t\tvar p = chart.convertToPixel({seriesIndex: 0}, geoCoord);\r\n\t\t\tconsole.log(\"================柱图数据==================\")\r\n\t\t\tconsole.log(vr)\r\n\t\t\tconsole.log(\"================柱图位置==================\")\r\n\t\t\tconsole.log(p)\r\n\t\t\tconsole.log(\"================option操作数==================\")\r\n\t\t\top.xAxis = {\r\n\t\t\t\ttype: 'category',\r\n\t\t\t\tdata: ['鲜花', '星星', '香蕉', '嫌弃']\r\n\t\t\t}\r\n\t\t\top.yAxis = {\r\n\t\t\t\ttype: 'value'\r\n\t\t\t}\r\n\t\t\tconsole.log(op)\r\n\t\t\tsd.push(\r\n\t\t\t\t{\r\n\t\t\t\t\tname:data[i].name,\r\n\t\t\t\t\ttype:'bar',\r\n\t\t\t\t\ttooltip:{\r\n\t\t\t\t\t\tformatter:function(params){\r\n\t\t\t\t\t\t\treturn params.seriesName + \"<br/>\" + params.name + \" : \" + params.value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\tradius : radius,\r\n\t\t\t\tcenter: p,\r\n\t\t\t\tdata:vr,\r\n\t\t\t\tzlevel:4,\r\n\t\t\t\tlabel: {\r\n\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\tshow: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tlabelLine: {\r\n\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\tshow: false\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\titemStyle:{\r\n\t\t\t\t\tmormal:{\r\n\t\t\t\t\t\topacity:1\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t//配置样式\r\n\t\t\t\titemStyle: {\r\n\t\t            //通常情况下：\r\n\t\t            normal:{\r\n\t\t　　　　　　　　　　　　//每个柱子的颜色即为colorList数组里的每一项，如果柱子数目多于colorList的长度，则柱子颜色循环使用该数组\r\n\t\tcolor: function (params){\r\n\t\t\tvar colorList = ['rgb(164,205,238)','rgb(42,170,227)','rgb(25,46,94)','rgb(195,229,235)'];\r\n\t\t\treturn colorList[params.dataIndex];\r\n\t\t}\r\n\t},\r\n\t\t            //鼠标悬停时：\r\n\t\t            emphasis: {\r\n\t\t            \tshadowBlur: 10,\r\n\t\t            \tshadowOffsetX: 0,\r\n\t\t            \tshadowColor: 'rgba(0, 0, 0, 0.5)'\r\n\t\t            }\r\n\t\t        }\r\n\t\t        //设置柱子的宽度\r\n\t\t        // barWidth : 120,\r\n\t\t    });\r\n\t\t}\r\n\t}\r\n\treturn sd;\r\n};\r\n\r\n/* 指定图表的配置项和数据:pie*/\r\n// var option = {\r\n//     title: {\r\n//         text: 'test',\r\n//         left: 'center',\r\n//         textStyle: {\r\n//             color: '#fff'\r\n//         }\r\n//     },\r\n//     tooltip : {\r\n//         trigger: 'item',\r\n//         formatter:function(params){\r\n//             if(params.value){\r\n//                 return params.name + \"<br/>\"+ typeArr[typeIndex] +\": \"+ params.value;\r\n//             }\r\n//         }\r\n//     },\r\n//     visualMap: {\r\n//         min: 0,\r\n//         max: 120,\r\n//         left: 'right',\r\n//         top: 'bottom',\r\n//         seriesIndex:0,\r\n//         text: [\"高\", \"低\"],\r\n//         calculable: true,\r\n//         color: ['#c05050','#e5cf0d','#5ab1ef'],\r\n//     },\r\n//     series : [{\r\n//         name: 'chinaMap',\r\n//         type: 'map',\r\n//         mapType: '楚雄彝族自治州',\r\n//         roam:true,\r\n//         label: {\r\n//             normal: {\r\n//                 show: true\r\n//             },\r\n//             emphasis: {\r\n//                 show: true\r\n//             }\r\n//         },\r\n//         itemStyle:{\r\n//             normal:{\r\n//                 areaColor:\"#eee\"\r\n//             }\r\n//         },\r\n//         data:convertMapDta(typeArr[typeIndex],data),\r\n//         /*zlevel:3*/\r\n//     }]\r\n// };\r\n\r\n// 指定图表的配置项和数据:bar\r\noption = {\r\n\txAxis: {\r\n\t\ttype: 'category',\r\n\t\tdata: ['鲜花', '星星', '香蕉', '嫌弃']\r\n\t},\r\n\tyAxis: {\r\n\t\ttype: 'value'\r\n\t},\r\n\ttitle: {\r\n\t\ttext: name,\r\n\t\tleft: 'center',\r\n\t\ttextStyle: {\r\n\t\t\tcolor: 'black'\r\n\t\t}\r\n\t},\r\n\ttooltip : {\r\n\t\ttrigger: 'item',\r\n\t\tformatter:function(params){\r\n\t\t\tif(params.value){\r\n\t\t\t\treturn params.name + \"<br/>\"+ typeArr[typeIndex] +\": \"+ params.value;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tvisualMap: {\r\n\t\tmin: 0,\r\n\t\tmax: 120,\r\n\t\tleft: 'right',\r\n\t\ttop: 'bottom',\r\n\t\tseriesIndex:0,\r\n\t\ttext: [\"高\", \"低\"],\r\n\t\tcalculable: true,\r\n\t\tcolor: ['#c05050','#e5cf0d','#5ab1ef'],\r\n\t},\r\n\tseries: [\r\n\t{\r\n\t\tname: 'chinaMap',\r\n\t\ttype: 'map',\r\n\t\tmapType: mapName,\r\n\t\troam:true,\r\n\t\tlabel: {\r\n\t\t\tnormal: {\r\n\t\t\t\tshow: true\r\n\t\t\t},\r\n\t\t\temphasis: {\r\n\t\t\t\tshow: true\r\n\t\t\t}\r\n\t\t},\r\n\t\titemStyle:{\r\n\t\t\tnormal:{\r\n\t\t\t\tareaColor:\"#eee\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata:convertMapDta_bar(typeArr[typeIndex],data),\r\n\t\t/*zlevel:3*/\r\n\t}\r\n]\r\n};\r\nif (option && typeof option === \"object\") {\r\n\tmyChart.setOption(option, true);\r\n}\r\n/*pie*/\r\n// addPie(myChart,data);\r\n/*bar*/\r\naddBar(myChart,data);\r\nconsole.log(\"===========option=================\");\r\nconsole.log(option);\r\nmyChart.setOption(option,true);\r\n\r\n/*饼图跟着地图移动:pie*/\r\n// myChart.on('georoam', function (params) {\r\n// \tresetPie(myChart,params,geoCoordMap,typeIndex);\r\n// });\r\n// myChart.on('datarangeselected', function (params) {\r\n// \tresetPie(myChart,params,geoCoordMap,typeIndex);\r\n// });\r\n// window.addEventListener(\"resize\",function(){\r\n// \tmyChart.resize();\r\n// \tresetPie(myChart,0,geoCoordMap);\r\n// })\r\n\r\n/*饼图跟着地图移动:bar*/\r\nmyChart.on('georoam', function (params) {\r\n\tresetBar(myChart,params,geoCoordMap,typeIndex);\r\n});\r\nmyChart.on('datarangeselected', function (params) {\r\n\tresetBar(myChart,params,geoCoordMap,typeIndex);\r\n});\r\nwindow.addEventListener(\"resize\",function(){\r\n\tmyChart.resize();\r\n\tresetBar(myChart,0,geoCoordMap);\r\n})\r\n\r\n// 使用刚指定的配置项和数据显示图表。\r\nmyChart.setOption(option);","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-3323870131","theme":"","layout":"","viewCount":740,"userName":"秋***飞","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHkRYsVgLz.png?v=1517468550633","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-bar","series-map","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"秋***飞"}}