{"status":0,"data":{"cid":"xH1kUesyiG","authorUid":"bd-1611848849","authorUserName":"宋京洲","title":"关系图折叠","description":"点击关系图的节点，使点击的节点的所有子节点隐藏或显示","latestVersion":1,"alwaysLatest":1,"createTime":"2018-04-02T12:21:27.000Z","lastUpdateTime":"2018-04-02T12:21:27.000Z","auth":2,"uid":"bd-1611848849","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.0.4","versionCreateTime":"2018-04-02T12:21:27.000Z","code":"var globalSeriesData = []; //用来存放被收起的某节点的子节点\r\nvar seriesData = [{\r\n    \"name\": \"1110011\",\r\n    \"x\": 220,\r\n    \"y\": 1,\r\n    \"symbolSize\": 20,\r\n    \"category\": \"1110011\",\r\n    \"value\": 16,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"name\": \"1100007\",\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"symbolSize\": 18,\r\n    \"category\": \"1110011\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1100008\",\r\n    \"symbolSize\": 12,\r\n    \"category\": \"1100007\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"name\": \"1110018\",\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"symbolSize\": 18,\r\n    \"category\": \"1110011\",\r\n    \"value\": 5,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110016\",\r\n    \"symbolSize\": 12,\r\n    \"category\": \"1110018\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110099\",\r\n    \"symbolSize\": 8,\r\n    \"category\": \"1110016\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110075\",\r\n    \"symbolSize\": 12,\r\n    \"category\": \"1110018\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110070\",\r\n    \"symbolSize\": 8,\r\n    \"category\": \"1110075\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"name\": \"1110013\",\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"symbolSize\": 18,\r\n    \"category\": \"1110011\",\r\n    \"value\": 3,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110089\",\r\n    \"symbolSize\": 12,\r\n    \"category\": \"1110013\",\r\n    \"value\": 2,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110090\",\r\n    \"symbolSize\": 8,\r\n    \"category\": \"1110089\",\r\n    \"value\": 2,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"name\": \"1110012\",\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"symbolSize\": 18,\r\n    \"category\": \"1110011\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"name\": \"1110076\",\r\n    \"symbolSize\": 12,\r\n    \"category\": \"1110012\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}, {\r\n    \"name\": \"1110088\",\r\n    \"x\": 0,\r\n    \"y\": 0,\r\n    \"symbolSize\": 18,\r\n    \"category\": \"1110011\",\r\n    \"value\": 1,\r\n    \"symbol\": \"circle\",\r\n    \"draggable\": \"true\"\r\n}];\r\n\r\nvar seriesLinks = [{\r\n\r\n    \"source\": \"1110011\",\r\n    \"target\": \"1100007\"\r\n}, {\r\n    \"source\": \"1100007\",\r\n    \"target\": \"1100008\"\r\n}, {\r\n    \"source\": \"1100008\",\r\n    \"target\": \"1100009\"\r\n}, {\r\n    \"source\": \"1110011\",\r\n    \"target\": \"1110018\"\r\n}, {\r\n    \"source\": \"1110018\",\r\n    \"target\": \"1110016\"\r\n}, {\r\n    \"source\": \"1110016\",\r\n    \"target\": \"1110099\"\r\n}, {\r\n    \"source\": \"1110018\",\r\n    \"target\": \"1110075\"\r\n}, {\r\n    \"source\": \"1110075\",\r\n    \"target\": \"1110070\"\r\n}, {\r\n    \"source\": \"1110075\",\r\n    \"target\": \"1110003\"\r\n}, {\r\n    \"source\": \"1110011\",\r\n    \"target\": \"1110013\"\r\n}, {\r\n    \"source\": \"1110013\",\r\n    \"target\": \"1110089\"\r\n}, {\r\n    \"source\": \"1110089\",\r\n    \"target\": \"1110090\"\r\n}, {\r\n    \"source\": \"1110011\",\r\n    \"target\": \"1110012\"\r\n}, {\r\n    \"source\": \"1110012\",\r\n    \"target\": \"1110076\"\r\n}, {\r\n    \"source\": \"1110076\",\r\n    \"target\": \"1110004\"\r\n}, {\r\n    \"source\": \"1110011\",\r\n    \"target\": \"1110088\"\r\n}];\r\nvar seriesCategories = [{\r\n    \"name\": \"1110011\"\r\n}, {\r\n    \"name\": \"1100007\"\r\n}, {\r\n    \"name\": \"1110018\"\r\n}, {\r\n    \"name\": \"1110013\"\r\n}, {\r\n    \"name\": \"1110012\"\r\n}, {\r\n    \"name\": \"1110088\"\r\n}, {\r\n    \"name\": \"1100008\"\r\n}, {\r\n    \"name\": \"1110016\"\r\n}, {\r\n    \"name\": \"1110076\"\r\n}, {\r\n    \"name\": \"1110089\"\r\n}, {\r\n    \"name\": \"1110075\"\r\n}, {\r\n    \"name\": \"1100009\"\r\n}, {\r\n    \"name\": \"1110099\"\r\n}, {\r\n    \"name\": \"1110070\"\r\n}, {\r\n    \"name\": \"1110003\"\r\n}, {\r\n    \"name\": \"1110004\"\r\n}, {\r\n    \"name\": \"1110090\"\r\n}];\r\n\r\n\r\nvar option = {\r\n    title: {\r\n        text: 'title',\r\n        bottom: \"bottom\",\r\n        left: \"center\",\r\n        textStyle: {\r\n            color: '#ccc'\r\n        }\r\n    },\r\n    tooltip: {\r\n        formatter: '{b}'\r\n    },\r\n    toolbox: {\r\n        show: true,\r\n        feature: {\r\n            restore: {\r\n                show: true\r\n            },\r\n            saveAsImage: {\r\n                show: true\r\n            }\r\n        },\r\n        right: 15\r\n    },\r\n    //backgroundColor: '#000000',\r\n    animationDuration: 1000,\r\n    animationEasingUpdate: 'quinticInOut',\r\n    series: [{\r\n        //name: '', //用于tooltip的显示\r\n        type: 'graph',\r\n        layout: 'force',\r\n        force: {\r\n            initLayout: 'circular',\r\n            repulsion: 50,\r\n            gravity: 0.1,\r\n            edgeLength: 0.01,\r\n            layoutAnimation: true,\r\n        },\r\n        data: seriesData,\r\n        links: seriesLinks,\r\n        categories: seriesCategories,\r\n        roam: true,\r\n        label: {\r\n            normal: {\r\n                show: true,\r\n                position: 'top', //inside\r\n                formatter: '{b}',\r\n                fontSize: 16,\r\n                fontStyle: '100',\r\n            }\r\n        },\r\n        height: 3,\r\n        lineStyle: {\r\n            normal: {\r\n                width: 3,\r\n                color: {\r\n                    type: 'linear',\r\n                    x: 0,\r\n                    y: 0,\r\n                    x2: 0,\r\n                    y2: 1,\r\n                    colorStops: [{\r\n                        offset: 0,\r\n                        color: 'white' // 0% 处的颜色red\r\n                    }, {\r\n                        offset: 1,\r\n                        color: 'green' // 100% 处的颜色blue\r\n                    }]\r\n                },\r\n                curveness: 0,\r\n                type: \"solid\"\r\n            }\r\n        }\r\n    }]\r\n};\r\n\r\n\r\nmyChart.setOption(option);\r\n\r\n\r\n//点击隐藏节点实现,定义数组globalSeriesData用来存储被隐藏的节点的子节点\r\nmyChart.on('click', function(params) {\r\n    if (params.dataType === \"node\") {\r\n        var deletedFlag = false; // 标记点击的此节点是否存在子节点,若不存在则说明可能在上次的操作中已经删除,这时就需要尝试把之前删除的节点重新添加进去\r\n        for (var i = seriesData.length - 1; i >= 0; i--) {\r\n            if (seriesData[i].category == params.name) {\r\n                if (seriesData[i].category != seriesData[i].name) { //排除删除根元素的可能\r\n                    deletedFlag = true;\r\n                    for (var ii = seriesData.length - 1; ii >= 0; ii--) { //删除第一级节点的子节点\r\n                        if (seriesData[ii].category == seriesData[i].name) {\r\n                            for (var iii = seriesData.length - 1; iii >= 0; iii--) { //删除第二级节点的子节点\r\n                                if (seriesData[iii].category == seriesData[ii].name) {\r\n                                    globalSeriesData.push(seriesData[iii]);\r\n                                    seriesData.splice(iii, 1);\r\n                                }\r\n                            }\r\n                            globalSeriesData.push(seriesData[ii]);\r\n                            seriesData.splice(ii, 1);\r\n                        }\r\n                    }\r\n                    globalSeriesData.push(seriesData[i]);\r\n                    seriesData.splice(i, 1); //删除该元素的第一级子节点,最多需删除三级\r\n                }\r\n            }\r\n        }\r\n        if (!deletedFlag) { //这种情况下需要恢复该节点的子节点\r\n            var nodeChildren = []; //存放本次恢复的数据,然后将它们从globalSeriesData中删除\r\n            for (var n = globalSeriesData.length - 1; n >= 0; n--) {\r\n                if (params.name == globalSeriesData[n].category) { //显示该节点第一级子节点\r\n                    seriesData.push(globalSeriesData[n]);\r\n                    nodeChildren.push(globalSeriesData[n]);\r\n                    for (var nn = globalSeriesData.length - 1; nn >= 0; nn--) {\r\n                        if (globalSeriesData[n].name == globalSeriesData[nn].category) { //显示该节点第二级子节点\r\n                            seriesData.push(globalSeriesData[nn]);\r\n                            nodeChildren.push(globalSeriesData[nn]);\r\n                            for (var nnn = globalSeriesData.length - 1; nnn >= 0; nnn--) {\r\n                                if (globalSeriesData[nn].name == globalSeriesData[nnn].category) { //显示该节点第三级子节点\r\n                                    seriesData.push(globalSeriesData[nnn]);\r\n                                    nodeChildren.push(globalSeriesData[nnn]);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (nodeChildren.length > 0) {\r\n                for (var s = 0; s < nodeChildren.length; s++) {\r\n                    for (var n = globalSeriesData.length - 1; n >= 0; n--) {\r\n                        if (nodeChildren[s].name == globalSeriesData[n].name) {\r\n                            globalSeriesData.splice(n, 1);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        myChart.setOption(option);\r\n    }\r\n});","html":"","externalScripts":"","updaterUID":"bd-1611848849","theme":"","layout":"","viewCount":4231,"userName":"宋京洲","commentCount":0,"starCount":7,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xH1kUesyiG.png?v=1522671687584","isCustomThumbnail":1,"builtinTags":["category-work","series-graph","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"宋京洲"}}