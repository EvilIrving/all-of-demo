{"status":0,"data":{"cid":"xSygaUrsXX","authorUid":"bd-2953846579","authorUserName":"f***0","title":"百分比占比","description":"","latestVersion":4,"alwaysLatest":1,"createTime":"2018-07-17T10:36:39.000Z","lastUpdateTime":"2018-07-17T10:36:39.000Z","auth":2,"uid":"bd-2953846579","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"4.4.0","versionCreateTime":"2019-12-30T04:13:55.000Z","code":"const data  = [50,10,15,15,10] ; // 左侧的百分比\r\nconst data2 = [10,20,15,15,40]; // 右侧的百分比\r\n\r\n\r\nfunction getZuobiao(arr,h=100,w=100,left=10,bottom=10){ //取正立坐标,顺时针方向\r\n  let zuobiaoArr = [];\r\n  let per = 0;\r\n  arr.forEach( (val,index) => {\r\n    let array = [];\r\n    per += val;\r\n    let bottomLeft = { x:left + (1 - per)/2 * w, y:bottom + (1 - per) * h };\r\n    let bottomRight = { x:left + (1 + per)/2 * w, y:bottom + (1 - per) * h };\r\n    if(index === 0){\r\n      array.push({ x: left + 1/2*w, y:bottom + h});\r\n      array.push(bottomRight);\r\n      array.push(bottomLeft);\r\n    }else{\r\n      let preArray = zuobiaoArr[index - 1];\r\n      let upLeft = preArray[index == 1 ? preArray.length - 1 : preArray.length - 2];\r\n      let upRight = preArray[1];\r\n     \r\n      array.push(upRight);\r\n      array.push(bottomRight);\r\n      array.push(bottomLeft);\r\n\t  array.push(upLeft);\r\n    }\r\n    zuobiaoArr.push(array);\r\n  });\r\n  let obj = {};\r\n  obj.arr = zuobiaoArr;\r\n  obj.center = zuobiaoArr.map( (item,index) => {\r\n\t  return { x: (item[0].x + item[1].x) / 2, y:(item[0].y + item[1].y) / 2};\r\n  });\r\n  return obj;\r\n}\r\n\r\nfunction getDaoZuobiao(arr,h=100,w=100,left=10,bottom=10){\r\n  let zuobiaoArr = [];\r\n  let per = 0;\r\n  arr.forEach( (val,index) => {\r\n    let array = [];\r\n    per += val;\r\n    let bottomLeft = { x:left + (2 + per)/2 * w, y:bottom + (1 - per) * h };\r\n    let bottomRight = { x:left + (4 - per)/2 * w, y:bottom + (1 - per) * h };\r\n    if(index === 0){\r\n      array.push({ x: left + w, y:bottom + h});\r\n      array.push({ x: left + 2*w, y:bottom + h });\r\n      array.push(bottomRight);\r\n      array.push(bottomLeft);\r\n    }else if(index != arr.length - 1){\r\n      let preArray = zuobiaoArr[index - 1];\r\n      let upLeft = preArray[preArray.length - 1];\r\n      let upRight = preArray[preArray.length - 2];\r\n      array.push(upLeft);\r\n      array.push(upRight);\r\n      array.push(bottomRight);\r\n      array.push(bottomLeft);\r\n    }else{\r\n      let preArray = zuobiaoArr[index - 1];\r\n      let upLeft = preArray[preArray.length - 1];\r\n      let upRight = preArray[preArray.length - 2];\r\n      array.push(upLeft);\r\n      array.push(upRight);\r\n      array.push({ x:left + 3/2 * w, y:bottom + 0,});\r\n    }\r\n    zuobiaoArr.push(array);\r\n  });\r\n  let obj = {};\r\n  obj.arr = zuobiaoArr;\r\n  obj.center = zuobiaoArr.map( (item,index) => {\r\n\t  return { x: (item[0].x + item[item.length - 1].x) / 2, y:(item[0].y + item[item.length - 1].y) / 2};\r\n  });\r\n  return obj;\r\n}\r\n\r\nconst COLORS=[\"blue\",\"#ddd\",\"red\",\"#333\",\"yellow\",\"grey\"]\r\n\r\n//const points =[...getDaoZuobiao(data.map(item=>item/100))]\r\nconst left = getZuobiao(data.map(item=>item/100));\r\nconst right = getDaoZuobiao(data2.map(item=>item/100));\r\nconst Leftpoints =[... left.arr,...right.arr]\r\n\r\nfunction createRenderItem(points){\r\n    return function (params, api) {\r\n    let colors = [...COLORS].splice(0,data.length)\r\n    console.info(params.dataIndex)\r\n    var coords = points[params.dataIndex].map(item=>[item.x,item.y])\r\n    var _points = coords.map(item=>api.coord(item));\r\n    console.info(_points)\r\n    \r\n    return {\r\n        // 表示这个图形元素是矩形。还可以是 'circle', 'sector', 'polygon' 等等。\r\n        type:'polygon',\r\n        shape:{\r\n            points:_points\r\n        },\r\n        style: api.style({\r\n            fill: colors[params.dataIndex%colors.length],\r\n            stroke: \"#fff\"\r\n        })\r\n    }\r\n}\r\n}\r\n\r\nvar series = [{\r\n        type: 'custom',\r\n        renderItem:createRenderItem(left.arr),\r\n        data: data,\r\n        tooltip:{\r\n            formatter:function(item,index){\r\n                console.info(item,index)\r\n                return `${item.data}%`\r\n            }\r\n        }\r\n    },\r\n    {\r\n        type: 'custom',\r\n        renderItem:createRenderItem(right.arr),\r\n        data: data2,\r\n        tooltip:{\r\n            formatter:function(item,index){\r\n                console.info(item,index)\r\n                return `${item.data}%`\r\n            }\r\n        }\r\n    }];\r\n    \r\nleft.center.forEach( (item,index) => {\r\n   series.push({\r\n       type:'line',\r\n       lineStyle:{\r\n         color: COLORS[index],\r\n         type:\"dashed\"\r\n       },\r\n       itemStyle:{\r\n         borderStyle:\"dashed\"  \r\n       },\r\n       showSymbol:false,\r\n       data:[\r\n           [item.x,item.y],\r\n           [right.center[index].x,right.center[index].y]\r\n           ]\r\n   }) \r\n});\r\noption = {\r\n    tooltip:{trigger:\"item\"},\r\n    xAxis: {min:0,max:220},\r\n    yAxis: {min:0,max:120},\r\n    series: series\r\n}","html":"","externalScripts":"","updaterUID":"bd-2953846579","theme":"","layout":"","viewCount":77,"userName":"f***0","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSygaUrsXX.png?v=1577679236044","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-custom","series-line","tooltip"],"customTags":[],"updaterUserName":"f***0"}}