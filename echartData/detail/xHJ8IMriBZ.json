{"status":0,"data":{"cid":"xHJ8IMriBZ","authorUid":"bd-1025214267","authorUserName":"d***e","title":"极坐标Polar，饼图Pie","description":"使用polar与custom组件完成此图。","latestVersion":3,"alwaysLatest":1,"createTime":"2017-07-18T08:09:49.000Z","lastUpdateTime":"2017-07-18T08:09:49.000Z","auth":2,"uid":"bd-1025214267","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"3.7.1","versionCreateTime":"2017-09-25T08:31:57.000Z","code":"//本例基于极坐标和custom，代码不太规范。请谅解！\r\n\r\nvar innerPieRadius = 80;\r\nvar polarRadius = innerPieRadius * 1.2;\r\nvar outerPieRadius = innerPieRadius * 3;\r\n\r\nvar names = [];\r\nvar data = [];\r\nfor(var i = 0; i < 28; i++){\r\n    var name = \"name\"+i;\r\n    var value = Math.round(Math.random() * 30);\r\n    names.push(\"name\"+i);\r\n    var group = 0;\r\n    var showLine = 0;\r\n    if(i > 13){\r\n       group = 1;\r\n    }\r\n    if(Math.round(Math.random() * 20) % 2 == 0){\r\n        showLine = 1;\r\n    }\r\n    data.push([1,name,value,group,showLine]);\r\n}\r\n\r\n\r\nfunction renderItem(params, api) {\r\n    var centerPoint = params.coordSys;\r\n    var values = [api.value(0), api.value(1)];\r\n    var coord = api.coord(values);\r\n    var size = api.size([1, 1], values);\r\n    var cx = coord[0];\r\n    var cy = coord[1];\r\n    var r = size[0] / 20;\r\n    var colors = [\"#f7ab3a\",\"#2cade9\"];\r\n\r\n    //compute circle point\r\n    var nr = 40;\r\n    cx = Math.cos(coord[3]) * nr + cx;\r\n    cy = -Math.sin(coord[3]) * nr + cy;\r\n\r\n    //compute text point\r\n    tx = Math.cos(coord[3]) * nr / 3 + cx;\r\n    ty = -Math.sin(coord[3]) * nr / 3 + cy;  \r\n\r\n    //compute control point\r\n    var angle = coord[3] /Math.PI * 180;\r\n    var nAngle = angle - nr;\r\n    var n = nAngle / 180 * Math.PI;\r\n    var cpx = Math.cos(n) * nr * -1.5 + coord[0];\r\n    var cpy = -Math.sin(n) * nr * -1.5 + coord[1];\r\n\r\n    var color = colors[data[params.dataIndex][3]];\r\n    var serie =  {\r\n            type: 'group',\r\n            children: [\r\n                    {\r\n                        type: 'circle',\r\n                        shape: {\r\n                            cx: cx,\r\n                            cy: cy,\r\n                            r: r\r\n                        },\r\n                        style: {\r\n                            fill: color\r\n                        },\r\n                        zlevel:5,\r\n                        z:5\r\n                    },\r\n                    {\r\n                        type: 'text',\r\n                        position: [tx, ty],\r\n                        rotation: coord[3],   \r\n                        style: {\r\n                            text: data[params.dataIndex][1],\r\n                            textVerticalAlign:'middle',\r\n                            fill: '#939494'\r\n                        },\r\n                        zlevel:5,\r\n                        z:5\r\n                    },\r\n            ]\r\n        }\r\n    if(data[params.dataIndex][4] == 1){\r\n        var line = {\r\n                        type: 'bezierCurve',\r\n                        shape: {\r\n                            x1: centerPoint.cx,\r\n                            y1: centerPoint.cy,\r\n                            x2: cx,\r\n                            y2: cy,\r\n                            cpx1: cpx,\r\n                            cpy1: cpy\r\n                        },\r\n                        style: {\r\n                            fill:'rgba(0,0,0,0)',\r\n                            stroke:color,\r\n                            lineWidth:1.5\r\n                        },\r\n                        zlevel:3,\r\n                        z:3\r\n            };\r\n         serie.children.unshift(line);  \r\n    }\r\n\r\n    return serie;\r\n}\r\n\r\n\r\nvar option = {\r\n        color:[\"#f7ab3a\",\"#2cade9\"],\r\n        tooltip:{\r\n            formatter:function(params){\r\n                return \"Pie <br>\" + params.data[1] + \": \" + params.data[2];\r\n            }\r\n        },\r\n        angleAxis: {\r\n            type: 'category',\r\n            data: names,\r\n            boundaryGap: false,\r\n            splitLine: {\r\n                show: true,\r\n                lineStyle: {\r\n                    color: '#ddd',\r\n                    type: 'dashed'\r\n                }\r\n            },\r\n            axisLine:{\r\n                show:false\r\n            },\r\n            axisTick:{\r\n                show:false\r\n            },\r\n            axisLabel:{\r\n                show:false\r\n            },\r\n            splitLine:{\r\n                show:false\r\n            }\r\n        },\r\n        radiusAxis: {\r\n            type: 'value',\r\n            data: [1],\r\n            z: 100,\r\n            axisLine:{\r\n                show:false\r\n            },\r\n            axisTick:{\r\n                show:false\r\n            },\r\n            axisLabel:{\r\n                show:false\r\n            },\r\n            splitLine:{\r\n                show:false\r\n            }\r\n        },\r\n        polar: {\r\n            radius:polarRadius\r\n        },\r\n        series: [\r\n            {\r\n                name:'outerPie',\r\n                type:'pie',\r\n                radius: [outerPieRadius, outerPieRadius + 30],\r\n                avoidLabelOverlap: false,\r\n                label: {\r\n                    normal: {\r\n                        show: false,\r\n                    }\r\n                },\r\n                data:[1,1],\r\n                silent:true,\r\n                zlevel:2,\r\n                animation:false\r\n            },\r\n            {\r\n                name:'innerPie',\r\n                type:'pie',\r\n                radius: [0, innerPieRadius],\r\n                avoidLabelOverlap: false,\r\n                label: {\r\n                    normal: {\r\n                        show: false,\r\n                    }\r\n                },\r\n                data:[1],\r\n                silent:true,\r\n                zlevel:3,\r\n                animation:false,\r\n                itemStyle:{\r\n                    normal:{\r\n                        color:'#dfe3e5'\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                name: 'circle-line-text',\r\n                type: 'custom',\r\n                coordinateSystem: 'polar',\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: '#d14a61'\r\n                    }\r\n                },\r\n                renderItem: renderItem,\r\n                data: data,\r\n                zlevel:4\r\n            }\r\n        ]\r\n    };\r\n","html":"","externalScripts":"","updaterUID":"bd-1025214267","theme":"","layout":"","viewCount":2567,"userName":"d***e","commentCount":0,"starCount":12,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHJ8IMriBZ.png?v=1506328317766","isCustomThumbnail":0,"builtinTags":["category-work","polar","series-custom","series-pie","tooltip"],"customTags":[],"updaterUserName":"d***e"}}