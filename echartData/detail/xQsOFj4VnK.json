{"status":0,"data":{"cid":"xQsOFj4VnK","authorUid":"bd-1800740195","authorUserName":"思***法","title":"复合饼图","description":"","latestVersion":5,"alwaysLatest":0,"createTime":"2021-05-11T01:39:19.000Z","lastUpdateTime":"2021-05-11T01:39:19.000Z","auth":1,"uid":"bd-1800740195","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"5.1.1","versionCreateTime":"2021-05-11T02:01:24.000Z","code":"let markLineData = []\nlet source = [\n    ['product', '2015', '2016'],\n    ['京东方', 103.3],\n    ['北方华创', 83.1],\n    ['电子城', 86.4],\n    ['七星', 2.4],\n    ['正东', 7.4],\n    ['益泰', 3.9],\n    ['燕东', 15.8],\n    ['北广', 5.8],\n]\n\nlet a = (source[4][1]+source[5][1]+source[6][1]+source[7][1]+source[8][1])/(source[2][1]+source[3][1]+source[4][1]+source[5][1]+source[6][1]+source[7][1]+source[8][1])*360/2\n// 添加“其他”\naddOtherData(source, 5);\n\noption = {\n    legend: {},\n    tooltip: {},\n    dataset: {\n        source: source\n    },\n    series: [{\n            type: 'pie',\n            radius: \"50%\",\n            center: ['25%', '50%'],\n            label: {\n                show: true,\n                position: \"inside\",\n            },\n            startAngle: a, // 起始角度 45 \n            clockwise: false, // 逆时针 \n            markLine: {\n                lineStyle: {\n                    type: 'solid',\n                    color: \"#BFBFBF\"\n                },\n                symbol: 'none',\n                data: markLineData\n            }\n        },\n        {\n            type: 'pie',\n            radius: \"30%\",\n            center: ['75%', '50%'],\n            encode: {\n                itemName: 'product',\n                value: '2016',\n            },\n            label: {\n                show: true,\n                position: \"inside\"\n            },\n        }\n    ]\n};\n\n// 获取表标线 对应点坐标\nfunction getMarkLineData(percent) {\n    // 1.获取画布 width,height\n    let height = myChart.getHeight()\n    let width = myChart.getWidth()\n\n    // 2.  根据 series[0].center 获取圆心坐标\n    let x0 = width * 0.25 // 圆心x轴坐标\n\n    //3.圆边上点坐标\n    // let x1   =   x0   +   r   *   cos(ao   *   3.14   /180   )\n    // let y1   =   y0   +   r   *   sin(ao   *   3.14   /180   )\n\n    // “其他” 终点坐标series[0].startAngle 45\n    let x1 = x0 + (height / 4) * Math.cos(a * 3.14 / 180)\n    let y1 = (height * 0.5) - (height / 4) * Math.sin(a * 3.14 / 180)\n\n    let ao = 360 * (percent / 100) // 扇形角度\n\n    let ao1 = 0 // 用来计算的坐标角度\n    ao1 = (ao <= a) ? (a - ao) : (360 - (ao - a))\n    if (ao1 < 270 && ao1 > a) ao1 = 270 // 角度当270用，要不样式不好看\n\n    let x2 = 0,\n        y2 = 0;\n    x2 = x0 + (height / 4) * Math.cos(ao1 * 3.14 / 180)\n    y2 = (height * 0.5) - (height / 4) * Math.sin(ao1 * 3.14 / 180)\n\n    return [\n        [{\n            x: x1,\n            y: y1\n        }, {\n            x: \"75%\",\n            y: \"35%\"\n        }],\n        [{\n            x: x2,\n            y: y2\n        }, {\n            x: \"75%\",\n            y: \"65%\"\n        }]\n    ]\n}\n// 添加其他 \nfunction addOtherData(datasetSource, len) {\n    let percent = 0\n    let sum = 0 // 总计\n    datasetSource.forEach((data, rowIndex) => {\n        if (rowIndex > 0) { // 第一行数据不算\n            let count = 0\n            for (let key of data) {\n                let value = isNaN(key) ? 0 : Number(key)\n                if (count === 1) sum += value\n                count++\n            }\n        }\n    })\n    let endData = datasetSource.slice(datasetSource.length - len)\n    let other = [\"其他\"]\n    for (let i = 0; i < endData.length; i++) {\n        let j = 0;\n        for (let key of endData[i]) {\n            let value = isNaN(key) ? 0 : key\n            if (j) other[j] ? (other[j] += value) : other.push(value)\n            j++\n        }\n        endData[i].splice(1, 0, \"\")\n    }\n    datasetSource.push(other)\n    // \"其他\"占比\n    percent = sum ? ((other[1] / sum) * 100).toFixed(2) : 100\n    markLineData = getMarkLineData(percent)\n}","html":"","externalScripts":"","updaterUID":"bd-1800740195","theme":"","layout":"","viewCount":0,"userName":"思***法","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xQsOFj4VnK.png?v=1620698485057","isCustomThumbnail":0,"builtinTags":["category-work","dataset","legend","markLine","series-pie","tooltip"],"customTags":[],"updaterUserName":"思***法"}}