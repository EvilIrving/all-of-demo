{"status":0,"data":{"cid":"xByMbusdiz","authorUid":"bd-442035385","authorUserName":"小***了","title":"自动化瀑布图且按时间顺序出现瀑布","description":"","latestVersion":17,"alwaysLatest":1,"createTime":"2018-04-09T08:44:41.000Z","lastUpdateTime":"2018-04-11T06:24:15.000Z","auth":2,"uid":"bd-442035385","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":17,"parentVersion":16,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-06T13:50:02.000Z","code":"//在yourdata中填入数据，增加为正数，减少为负数\n// var yourdata=[91, 526, 423, 2404, -473, 11178, -5174, 1970, 791, -843, 2847, 2908, -690, 225, -812, 1921, -11223, -523, 2624, 277, 800, 777, -205, -657, -462, 883, 434, 539, 2014, 882, 1622, -2241, 299, -1635, 1110, -2633, 598, -2298, 1628, 378, 782, 284, -3713, 761, 338, 799, -926, -459, 996, -208, 546, 250, 888, 568, 891, 998, -355, 929, 550, -246, -399, -292, -566, -182, -799, -97, -455, -484, 308, 329, 533, -485, -1753, 227, -4103, 319, 818, 1297, 482, 819, 964, 790, -888, 964, -133, 557, 751, 431, 766, -137, 682, -261, 768, 671, 146, -2205, -977, -723, -29, -486, -181, 965, -194, -113, 517, -603, -451, 948, 806, 673, -308, -340, -2425, 822, 820, 900, -308, 946, 253, 459, 30, 923, 249, 3153, -550, -72, 374, 809, -251, -147, 140, -3707, -535, 954, 431, 172, -381, 345, -536, -818, -495, 2438, -788, 782, 836, -668, -312, -151, -33, 539, -492, 49, 934, -635, 237, -361, -19, 967, -965, -603, -145, -642, -397, 825, -785, -123, -875, 395, 450, -234, -296, -278, -304, 819, -253, 307, -902, -938, 912, -896, 311, -48, -110, -842, -484, -658, -165, 519, -284, 21, 512, 527, -114, 936, -470, -385, -630, 775, 743, -450, -250, 663, 872, -249, 799, 660, 401, -396, -384, 674, -145, 768, 717, 934, 62, 111, 117, 10, 6, 551, 641, -37, 903, -426, 35, 632, -566, 639, -521, -653, -447, 380, -481, 868, -977, 834, -862, -37, -853, -612, 137, -867, 82, 577, -907, -268, 722, 220, 390, 385, -832, 579, 468, -181, -407, 775, 448, 528, 768, 402, -318, -6, -563, -303, -597, 502, -492, 36, -766, -24, 44, 233, 688, -647, -328, 25, 582, 494, 219, 362, 829, 641, 290, 696, 940, 598, 470, -125, -234, -386, -800, -326, 415, 494, -487, -79, 79, 897, -171, -99, 376, -39, -919, -160, 580, -19, -894, 347, -957, 294, -289, -518, -311, -124, 765, 922, 145, 349, -111, 50, 399, -693, 696, -964, 121, 99, -844, 117, -98, 110, 654, 411, -571, -238, -291, 92, -624, 291, 188, -147, 136, 117, -498, 944, 916, -988, -583, -50, 225, -822, 170, -34, 849, -920, -379, -644, 393, -908, -835, 895, 16, -682, 836, 967, 572, 333]\n//在xaxisdata中填入x轴的数据\nvar yourdata=[]\nvar dep=[-65.17, -66.35, -71.54, -69.94, -77.82, -87.15, -96.63, -103.23, -119, -111.16, -124.77, -134.47, -137.01, -150.38]\nvar fcs=[97.43, 105.72, 108.44, 109.06, 123.54, 133.95, 146.27, 140.12, 163.79, 166.96, 165.11, 185.32, 192.77, 200.13]\nvar xaxisdata=['2001_fcs', '2001_dep', '2002_fcs', '2002_dep', '2001_fcs', '2001_dep', '2002_fcs', '2002_dep', '2001_fcs', '2001_dep', '2002_fcs', '2002_dep', '2001_fcs', '2001_dep', '2002_fcs', '2002_dep', '2001_fcs', '2001_dep', '2002_fcs', '2002_dep', '2001_fcs', '2001_dep', '2002_fcs', '2002_dep', '2001_fcs', '2001_dep', '2002_fcs', '2002_dep']\n//出现时间间隔\nvar timeinterval=300\n//是否出现标签\nvar yesorno=true\nfor (var i=0;i<dep.length;i++){\n    yourdata.push(Math.round(fcs[i],0))\n    yourdata.push(Math.round(dep[i],0))\n}\nconsole.log(yourdata)\nconsole.log(xaxisdata)\n//求出右图中的顶点，为确定y轴的最大值做准备\nfunction maxsum(data) {\n    var x = 0;\n    var list = []\n    for (var i = 0; i < data.length; i++) {\n        x = x + data[i];\n        list.push(x)\n    };\n    return Math.max.apply(null, list)\n}\n//求出y轴的最大值\nfunction getymax() {\n    var data = maxsum(yourdata)\n    var length = Math.floor(Math.log10(data)) -1\n    var yaxismax = Math.ceil(data / Math.pow(10, length)) * Math.pow(10, length)\n    return yaxismax\n\n}\nfunction mean(arr,sign){\n    var count1=0;\n    var count2=0;\n    var sum1=0;\n    var sum2=0;\n    for(var i = 0; i < arr.length; i++){\n        if (arr[i]>0){\n            count1+=1\n            sum1 += arr[i];\n        }else{\n            count2+=1\n            sum2 +=arr[i]\n        }\n    }\n    if (sign==0){\n        return Math.round(sum1/count1)\n    }else{\n        return Math.round(Math.abs(sum2/count2))\n    }\n\n}\n\nvar ymax = getymax()\nvar updata = [];\nvar downdata = [];\nvar auxdata = [];\nvar sum = 0\n//求出各个系列的值\nfor (var i = 0; i < yourdata.length; i++) {\n    auxdata.push(sum)\n    if (yourdata[i] > 0) {\n        updata.push(yourdata[i])\n        downdata.push('-')\n    } else {\n        updata.push('-')\n        downdata.push(Math.abs(yourdata[i]))\n    }\n    sum = sum + yourdata[i]\n};\n// console.log(mean(yourdata,1))\nauxdata.slice(0, yourdata.length - 1)\n\noption = {\n    title: [{\n        text: '阶梯瀑布图',\n        subtext: '修改自官网by小白高'\n    },\n\n    ],\n    //     dataZoom: [\n    //     {\n    //         type: 'inside',\n    //         start: 0,\n    //         end: 10\n    //     },\n    //     {\n    //         show: true,\n    //         type: 'slider',\n    //         y: '90%',\n    //         start: 50,\n    //         end: 100\n    //     }\n    // ],\n    toolbox: {\n        feature: {\n            magicType: {\n                type: ['line','bar']\n            },\n            saveAsImage: {\n                show: true,\n            }\n        }\n    },\n    tooltip: {\n        trigger: 'axis',\n        axisPointer: { // 坐标轴指示器，坐标轴触发有效\n            type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'\n        },\n        formatter: function(params) {\n            var tar;\n            if (params[1].value != '-') {\n                tar = params[1];\n            } else {\n                tar = params[2];\n            }\n            return tar.name + '<br/>' + tar.seriesName + ' : ' + tar.value;\n        }\n    },\n    legend: {\n        data: ['支出', '收入']\n    },\n    grid: {\n        left: '3%',\n        right: '4%',\n        bottom: '3%',\n        containLabel: true\n    },\n    xAxis: {\n        type: 'category',\n        splitLine: {\n            show: false\n        },\n        data: xaxisdata\n    },\n    yAxis: [{\n        splitLine:{\n            show:false\n        },\n            type: 'value',\n            max: ymax\n        },\n        {\n            type: 'value',\n            max: ymax,\n            inverse: true,\n            show: false\n        }\n    ],\n    series: [{\n            name: '辅助',\n            type: 'bar',\n            stack: '总量',\n            itemStyle: {\n                normal: {\n                    barBorderColor: 'rgba(0,0,0,0)',\n                    color: 'rgba(0,0,0,0)'\n                },\n                emphasis: {\n                    barBorderColor: 'rgba(0,0,0,0)',\n                    color: 'rgba(0,0,0,0)'\n                }\n            },\n            data: auxdata,\n        },\n        {\n            name: '收入',\n            type: 'bar',\n            stack: '总量',\n            label: {\n                normal: {\n                    show: yesorno,\n                    fontSize:10,\n                    position: 'top'\n                }\n            },\n            data: updata,\n            animationDelay: function(idx) {\n                return idx * timeinterval;\n            }\n\n        },\n        {\n            name: '支出',\n            type: 'bar',\n            yAxisIndex: 1,\n            stack: '总量',\n            label: {\n                normal: {\n                    fontSize:10,\n                    show: yesorno,\n                    position: 'bottom'\n                }\n            },\n            data: downdata,\n            animationDelay: function(idx) {\n                return idx * timeinterval;\n            }\n        }\n    ],\n    animationEasing: 'elasticOut',\n    animationDelayUpdate: function(idx) {\n        return idx * 5;\n    }\n};","html":"","externalScripts":"","updaterUID":"bd-442035385","theme":"infographic","layout":"","viewCount":3320,"userName":"小***了","commentCount":0,"starCount":7,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xByMbusdiz.png?v=1594043402774","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","legend","series-bar","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"小***了"}}