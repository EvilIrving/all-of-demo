{"status":0,"data":{"cid":"xp228WMsvi","authorUid":"obd-o0eO8nf1WwkETQ8akx-Kk79MtvKiEFw","authorUserName":"K***2","title":"é¡¹ç›®å·¥ç¨‹å·¥åºç”˜ç‰¹å›¾","description":"æ˜“ç®¡ç”˜ç‰¹å›¾ç®€æ˜“ç‰ˆ\nä¾§è¾¹æ å±•å¼€æ”¶èµ·\næ›´å¤æ‚ç‰ˆæœ¬æš‚ä¸å¼€æ”¾","latestVersion":3,"alwaysLatest":0,"createTime":"2021-11-18T06:10:13.000Z","lastUpdateTime":"2021-11-19T07:14:43.000Z","auth":2,"uid":"obd-o0eO8nf1WwkETQ8akx-Kk79MtvKiEFw","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"5.2.2","versionCreateTime":"2021-11-19T07:13:02.000Z","code":"const projectData = {\n  'projectName': 'é¡¹ç›®',\n  'startDate': '2021-08-01T00:00:00.000+0800',\n  'endDate': '2022-08-31T00:00:00.000+0800',\n  'status': 1,\n  'actuleRatio': 7.0000,\n  'emergencyDegree': 1,\n  'engineeringScheduleList': [{\n    'engineeringScheduleId': 14116,\n    'milestoneId': 916,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹1',\n    'startDate': '2021-08-01T00:00:00.000+0800',\n    'endDate': '2021-08-31T00:00:00.000+0800',\n    'status': 1,\n    'actuleRatio': 10.000,\n    'emergencyDegree': 1,\n    'actualScheduleWorkday': 3,\n    'planningScheduleWorkDays': 31,\n    'processSchedules': [{\n      'processScheduleId': 579,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº1-1ğŸ˜‚ğŸ˜„',\n      'startDate': '2021-08-01T00:00:00.000+0800',\n      'endDate': '2021-08-31T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }]\n  }, {\n    'engineeringScheduleId': 14132,\n    'milestoneId': 916,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹2ğŸ˜‚ğŸ˜‚',\n    'startDate': '2021-08-01T00:00:00.000+0800',\n    'endDate': '2021-08-31T00:00:00.000+0800',\n    'status': 2,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 8,\n    'planningScheduleWorkDays': 133,\n    'processSchedules': [{\n      'processScheduleId': 594,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº2-1',\n      'startDate': '2021-08-01T00:00:00.000+0800',\n      'endDate': '2021-08-31T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }, {\n      'processScheduleId': 593,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº2-2',\n      'startDate': '2021-08-04T00:00:00.000+0800',\n      'endDate': '2021-08-05T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }]\n  }, {\n    'engineeringScheduleId': 14131,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹3',\n    'startDate': '2021-08-09T00:00:00.000+0800',\n    'endDate': '2022-08-31T00:00:00.000+0800',\n    'status': 2,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 7,\n    'planningScheduleWorkDays': 18,\n    'processSchedules': [{\n      'processScheduleId': 592,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº3-1',\n      'startDate': '2021-08-08T00:00:00.000+0800',\n      'endDate': '2021-08-16T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }]\n  }, {\n    'engineeringScheduleId': 14136,\n    'milestoneId': 916,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹4',\n    'startDate': '2021-08-11T00:00:00.000+0800',\n    'endDate': '2021-08-31T00:00:00.000+0800',\n    'status': 2,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 1,\n    'planningScheduleWorkDays': 7,\n    'processSchedules': [{\n      'processScheduleId': 595,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº4-1',\n      'startDate': '2021-08-11T00:00:00.000+0800',\n      'endDate': '2021-08-11T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }]\n  }, {\n    'engineeringScheduleId': 14137,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹5',\n    'startDate': '2021-08-11T00:00:00.000+0800',\n    'endDate': '2022-08-31T00:00:00.000+0800',\n    'status': 0,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 0,\n    'processSchedules': []\n  }, {\n    'engineeringScheduleId': 14138,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹6',\n    'startDate': '2021-08-11T00:00:00.000+0800',\n    'endDate': '2022-08-31T00:00:00.000+0800',\n    'status': 1,\n    'actuleRatio': 3.0000,\n    'emergencyDegree': 1,\n    'actualScheduleWorkday': 6,\n    'planningScheduleWorkDays': 204,\n    'processSchedules': [{\n      'processScheduleId': 634,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº6-1',\n      'startDate': '2021-08-11T00:00:00.000+0800',\n      'endDate': '2021-08-19T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }, {\n      'processScheduleId': 640,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº6-2',\n      'startDate': '2021-08-11T00:00:00.000+0800',\n      'endDate': '2021-10-11T00:00:00.000+0800',\n      'status': 1,\n      'actuleRatio': 3.0000,\n      'emergencyDegree': 1\n    }]\n  }, {\n    'engineeringScheduleId': 14182,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹7',\n    'startDate': '2021-08-20T00:00:00.000+0800',\n    'endDate': '2022-08-31T00:00:00.000+0800',\n    'status': 0,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 0,\n    'processSchedules': []\n  }, {\n    'engineeringScheduleId': 14183,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹8',\n    'startDate': '2021-08-23T00:00:00.000+0800',\n    'endDate': '2021-10-31T00:00:00.000+0800',\n    'status': 1,\n    'actuleRatio': 0.000,\n    'emergencyDegree': 1,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 78,\n    'processSchedules': [{\n      'processScheduleId': 649,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº8-1',\n      'startDate': '2021-08-23T00:00:00.000+0800',\n      'endDate': '2021-09-30T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }]\n  }, {\n    'engineeringScheduleId': 14184,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹9',\n    'startDate': '2021-08-24T00:00:00.000+0800',\n    'endDate': '2021-12-31T00:00:00.000+0800',\n    'status': 1,\n    'actuleRatio': 21.0000,\n    'emergencyDegree': 1,\n    'actualScheduleWorkday': 13,\n    'planningScheduleWorkDays': 62,\n    'processSchedules': [{\n      'processScheduleId': 655,\n      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº9-1',\n      'startDate': '2021-08-24T00:00:00.000+0800',\n      'endDate': '2021-10-24T00:00:00.000+0800',\n      'status': 2,\n      'actuleRatio': null,\n      'emergencyDegree': 0\n    }]\n  }, {\n    'engineeringScheduleId': 14185,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹10',\n    'startDate': '2021-08-24T00:00:00.000+0800',\n    'endDate': '2021-11-30T00:00:00.000+0800',\n    'status': 0,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 0,\n    'processSchedules': []\n  }, {\n    'engineeringScheduleId': 14352,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹11',\n    'startDate': '2021-10-13T00:00:00.000+0800',\n    'endDate': '2022-08-31T00:00:00.000+0800',\n    'status': 0,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 0,\n    'processSchedules': []\n  }, {\n    'engineeringScheduleId': 14355,\n    'milestoneId': 0,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹12',\n    'startDate': '2021-10-14T00:00:00.000+0800',\n    'endDate': '2022-08-31T00:00:00.000+0800',\n    'status': 0,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 0,\n    'processSchedules': []\n  }, {\n    'engineeringScheduleId': 14504,\n    'milestoneId': 917,\n    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹13',\n    'startDate': '2021-10-25T00:00:00.000+0800',\n    'endDate': '2021-12-30T00:00:00.000+0800',\n    'status': 0,\n    'actuleRatio': null,\n    'emergencyDegree': 0,\n    'actualScheduleWorkday': 0,\n    'planningScheduleWorkDays': 0,\n    'processSchedules': []\n  }],\n  'projectMilestoneList': [{\n    'name': 'å¼€å·¥',\n    'code': '7',\n    'deadline': '2021-08-01T00:00:00.000+0800',\n    'emergencyDegree': 0,\n    'milestoneRate': 0\n  }, {\n    'name': 'å‡ºÂ±0',\n    'code': '1',\n    'deadline': '2021-11-23T00:00:00.000+0800',\n    'emergencyDegree': 1,\n    'milestoneRate': 0.0702\n  }, {\n    'name': 'ä¸»ä½“ç»“æ„å®Œæˆ',\n    'code': '2',\n    'deadline': '2021-12-30T00:00:00.000+0800',\n    'emergencyDegree': 0,\n    'milestoneRate': 0\n  }]\n};\n\nlet engineeringScheduleList = projectData.engineeringScheduleList.map((item) => ({\n  ...item,\n  _type: 'engineering',\n  _id: item.engineeringScheduleId,\n  _name: item.engineeringName,\n  _isExpanded: false,\n  processSchedules: item.processSchedules.map((processItem) => ({\n    ...processItem,\n    _type: 'process',\n    _id: processItem.processScheduleId,\n    _parentId: item.engineeringScheduleId,\n    _name: processItem.processScheduleName,\n    _isExpanded: false,\n  })),\n}));\nconst projectMilestoneList = [...projectData.projectMilestoneList.map((item) => ({\n  name: item.name,\n  xAxis: new Date(item.deadline).getTime(),\n})), {\n  name: 'ä»Šæ—¥',\n  xAxis: new Date().getTime(),\n}];\n\n// è®°ä½datazoomçš„xè½´åç§»é‡\nlet dataZoomStart = 0;\nconst valueSpanIndex = 5;\n\nconst renderChart = start => {\n  // dataZoom\n  const dayTimestamp = 24 * 60 * 60 * 1000;\n  // å…¨å±æ—¶æ‰‹åŠ¿æ›´æ”¹çš„æ—¶é—´èŒƒå›´\n  const VALUE_SPAN_ARRAY = Array.from({ length: 6 }, (_, i) => dayTimestamp * 30 * 6.5 / Math.pow(2, 5 - i));\n  const dataZoomX = [\n    {\n      type: 'slider',\n      show: false,\n      filterMode: 'none', // ä¸è¿‡æ»¤æ•°æ®ï¼Œåªæ”¹å˜æ•°è½´èŒƒå›´ã€‚\n      xAxisIndex: [0, 1],\n      start,\n      // end: 100,\n      // åæ ‡è½´ä¸Šæœ€å¤§å’Œæœ€å°é—´éš”ç›¸åŒ ä¿è¯å›ºå®šå±•ç¤ºæ•°é‡ ä¸”.5å¸¦æ¥å¯æ»‘åŠ¨çš„è§‚æ„Ÿ\n      minValueSpan: VALUE_SPAN_ARRAY[valueSpanIndex],\n      maxValueSpan: VALUE_SPAN_ARRAY[valueSpanIndex],\n    },\n    {\n      id: 'zoomX',\n      type: 'inside',\n      filterMode: 'none',\n      xAxisIndex: [0, 1],\n      zoomLock: true,\n      preventDefaultMouseMove: false,\n    },\n  ];\n  const dataZoomY = [\n    {\n      type: 'slider',\n      show: false,\n      filterMode: 'none', // ä¸è¿‡æ»¤æ•°æ®ï¼Œåªæ”¹å˜æ•°è½´èŒƒå›´ã€‚\n      yAxisIndex: 0,\n      // å…¨å±æ—¶Yè½´å¯ä»¥æ»‘åŠ¨\n      minValueSpan: window.innerHeight / 80,\n      maxValueSpan: window.innerHeight / 80,\n    },\n    {\n      type: 'inside',\n      filterMode: 'none',\n      yAxisIndex: 0,\n      zoomLock: true,\n      // å…¨å±æ—¶Yè½´å¯ä»¥æ»‘åŠ¨\n      moveOnMouseMove: true,\n      preventDefaultMouseMove: true,\n    }\n  ];\n  const dataZoom = [\n    ...dataZoomX,\n    ...dataZoomY,\n  ];\n  \n  // grid\n  const FULLSCREEN_GRID_LEFT = 210;\n  // ä¸ºäº†å…¨å±æ—¶å·¦ä¾§è®¾ç½®èƒŒæ™¯è‰² å°†å·¦å³ä¸¤ä¾§æ–¹å‘è®¾ç½®0\n  const grid = {\n    top: 6,\n    right: 0,\n    bottom: 0,\n    left: FULLSCREEN_GRID_LEFT,\n    containLabel: true,\n  };\n  \n  // xAxis\n  const xAxisMin = new Date(new Date(projectData.startDate).setDate(1)).getTime(); // å½“æœˆ1å·\n  const xAxisBase = {\n    type: 'time',\n    position: 'top',\n    // z: 10,\n    min: xAxisMin,\n    // min: 1609430400000, // 2021-01-01\n    // max: 1640880000000, // 2021-12-31\n    axisLabel: {\n      margin: 6,\n      formatter: '{yyyy}.{MM}',\n      color: '#6F6F6F',\n      fontSize: 10,\n      align: 'left',\n    },\n    axisLine: {\n      show: false,\n    },\n    axisTick: {\n      show: false,\n    },\n    splitArea: {\n      show: false,\n    },\n  };\n  const xAxis = [\n    {\n      ...xAxisBase,\n      minInterval: dayTimestamp * 7,\n      // maxInterval: dayTimestamp * 7,\n      // splitNumber: 3,\n      axisLabel: {\n        show: true,\n        margin: 12,\n        // formatter: '{yyyy}.{MM}',\n        formatter() {\n          return valueSpanIndex >= 5 ? '{yyyy}.{MM}' : '{yyyy}.{MM}.{dd}';\n        },\n        hideOverlap: true, // é¿å…é‡å \n        color: '#848484',\n        fontSize: 10,\n        align: 'left',\n      },\n      axisLine: {\n        show: true,\n        lineStyle: {\n          color: '#DCDFE7',\n          width: 18,\n          cap: 'butt',\n        },\n      },\n    },\n    {\n      ...xAxisBase,\n      offset: 28,\n      // æ—¶é—´åŒºé—´è¾ƒå°æ—¶(valueSpanIndex <= 3) ç›´æ¥èµ‹å€¼splitNumberæœ€å° é¿å…å±•ç¤ºè¿‡å¤š è¿™é‡Œæœ€å¥½è¿˜æ˜¯æŠŠå­£åº¦å»æ‰ æ²¡æœ‰ä»»ä½•æ„ä¹‰\n      minInterval: valueSpanIndex > 3 ? dayTimestamp * 30 * 4 : undefined,\n      maxInterval: valueSpanIndex > 3 ? dayTimestamp * 30 * 4 : undefined,\n      splitNumber: valueSpanIndex <= 3 && 1,\n      axisLabel: {\n        margin: 4,\n        // echartsè‡ªå¸¦å­£åº¦æœ‰bug\n        // formatter: 'Q{Q}',\n        formatter(value) {\n          const month = new Date(value).getMonth();\n          if (month < 3) {\n            return 'Q1';\n          } else if (month < 6) {\n            return 'Q2';\n          } else if (month < 9) {\n            return 'Q3';\n          } else {\n            return 'Q4';\n          }\n        },\n        // showMinLabel: false,\n        // showMaxLabel: false,\n        color: '#848484',\n        fontSize: 12,\n        align: 'left',\n      },\n      axisLine: {\n        show: true,\n        lineStyle: {\n          color: '#EAEAEA',\n          width: 0.5,\n        },\n      },\n    },\n  ];\n  \n  // yAxis\n  const yAxis = {\n    // è¿™é‡Œè®¾ç½®falseä¼šå½±å“splitAreaå±•ç¤º\n    // show: false,\n    // è¿™è¡Œdataå»æ‰æ»‘åŠ¨å°±å¾ˆé¡ºç•… é€šè¿‡min & maxå‚æ•°å®šä¹‰Yè½´\n    // data: engineeringScheduleList.value.map((item) => item._name),\n    inverse: true,\n    interval: 1,\n    axisLabel: {\n      show: false,\n    },\n    axisLine: {\n      show: false,\n    },\n    axisTick: {\n      show: false,\n    },\n    splitLine: {\n      show: false,\n    },\n    splitArea: {\n      show: true,\n      areaStyle: {\n        color: engineeringScheduleList.map((item) => {\n          if (item._type === 'engineering' && !item._isExpanded) {\n            return 'white';\n          } else {\n            return item.status === 1 ? '#FFEEEE' : '#EBF3FE';\n          }\n        }),\n      },\n    },\n    min: 0,\n    max: engineeringScheduleList.length,\n  };\n  \n  // series\n  const STATUS_MAP = ['æœªå¼€å§‹', 'è¿›è¡Œä¸­', 'å·²å®Œå·¥', 'å¾…ç¡®è®¤', 'å·²æ‹’ç»'];\n  const renderCircleItem = (isShowCircle, isExpanded, status) => {\n    return {\n      type: 'circle',\n      z2: 3,\n      textContent: {\n        style: {\n          y: -1.6,\n          text: isExpanded ? '-' : '+',\n          textFill: status === 1 ? '#FF6E6E' : '#3688F6',\n          fontSize: '16px',\n        },\n      },\n      textConfig: {\n        position: 'inside',\n      },\n      shape: {\n        // cx: 0,\n        // cy: 0,\n        r: 8,\n      },\n      style: {\n        fill: status === 1 ? '#FFEEEE' : '#EBF3FE',\n      },\n      ignore: !isShowCircle,\n    };\n  };\n  // for more details, see https://echarts.apache.org/examples/zh/editor.html?c=custom-gantt-flight\n  const renderGanttItem = (params, api) => {\n    // clip rect outside canvas when dragging!\n    // function clipRectByRect(params, rect) {\n    //   return echarts.graphic.clipRectByRect(rect, {\n    //     x: params.coordSys.x,\n    //     y: params.coordSys.y,\n    //     width: params.coordSys.width,\n    //     height: params.coordSys.height,\n    //   });\n    // }\n    const yIndex = params.dataIndexInside; // yè½´æ•°æ®indexå€¼\n    const { _type, _name, _isExpanded, actuleRatio: actualRatio = 0, status, processSchedules } = engineeringScheduleList[yIndex];\n    const isShowCircle = _type === 'engineering' && !!processSchedules.length;\n    const startDate = api.coord([api.value(0), yIndex]); // å¼€å§‹æ—¶é—´æ•°å€¼è½¬æ¢æˆåæ ‡ç³»ä¸Šçš„ç‚¹\n    const endDate = api.coord([api.value(1), yIndex]); // ç»“æŸæ—¶é—´æ•°å€¼è½¬æ¢æˆåæ ‡ç³»ä¸Šçš„ç‚¹\n    const barLength = endDate[0] - startDate[0]; // é•¿åº¦\n    const yIntervalHeight = api.size([0, 1])[1]; // yè½´é—´éš”è·ç¦»ï¼Œå•ä½ä¸º1åº”å¾—åˆ°çš„é•¿åº¦ï¼›xè½´ä¸º0å¾—åˆ°0ç•¥è¿‡\n    const barHeight = yIntervalHeight * (_type === 'engineering' ? 0.48 : 0.24); // æŸ±çŠ¶å›¾é«˜åº¦ç”±yè½´é—´éš”é«˜åº¦ä¹˜ä»¥ç³»æ•°å¾—åˆ°\n    const [x, y] = startDate;\n    const text = `${actualRatio || 0}% (${STATUS_MAP[status]})`;\n    const textWidth = text.length * 11 + (isShowCircle ? 24 : 4); // è®¡ç®—pathçš„é•¿åº¦ è¿™é‡Œæ— æ³•æ‰¾åˆ°æ–¹æ³•è‡ªé€‚åº” within my capacity oops~\n  \n    return {\n      type: 'group',\n      id: 'ganttItem',\n      position: [x, y + (yIntervalHeight - barHeight) / 2],\n      children: [\n        {\n          type: 'rect',\n          textContent: {\n            style: {\n              text,\n              textFill: '#323232',\n            },\n            ignore: _type === 'process',\n          },\n          textConfig: {\n            position: 'insideLeft',\n          },\n          shape: {\n            width: barLength,\n            height: barHeight,\n            r: 3, // è®¾ç½®åœ†è§’çŸ©å½¢\n          },\n          style: {\n            fill: status === 1 ? (_type === 'engineering' ? '#FF6E6E' : '#FFA8A8') : (_type === 'engineering' ? '#378DFF' : '#9AC3FA'),\n          },\n        },\n        {\n          type: 'rect',\n          shape: {\n            width: barLength * actualRatio / 100,\n            height: barHeight / 3,\n            r: 3, // è®¾ç½®åœ†è§’çŸ©å½¢\n          },\n          style: {\n            fill: status === 1 ? '#E64A4A' : '#006CCF',\n          },\n          ignore: !actualRatio, // éå…¨å±æ—¶å±•ç¤º; å…¨å±ä¸”å‹¾é€‰å®é™…è¿›åº¦æ˜ç»†æ—¶å±•ç¤º;\n        },\n      ],\n    };\n  };\n  const renderAxisLabelItem = (params, api) => {\n    const yIndex = params.dataIndexInside; // yè½´æ•°æ®indexå€¼\n    const { _type, _name, _isExpanded, status, processSchedules } = engineeringScheduleList[yIndex];\n    const isShowCircle = _type === 'engineering' && !!processSchedules.length;\n    const y = api.coord([0, api.value(0)])[1];\n  \n    const AXIS_LABEL_LEFT = 24;\n    const AXIS_LABEL_RIGHT = 6;\n    const AXIS_LABEL_HEIGHT = api.size([0, 1])[1] * 0.8;\n  \n    // è£æ‰è¶…å‡ºyè½´åæ ‡ç³»çš„éƒ¨åˆ†\n    if (y < params.coordSys.y - AXIS_LABEL_HEIGHT) {\n      return;\n    }\n  \n    return {\n      type: 'group',\n      position: [AXIS_LABEL_LEFT, y + AXIS_LABEL_HEIGHT / 8 /* é«˜åº¦å æ¯”0.8 å±…ä¸­ä¸Šä¸‹å„ç•™0.1 æ‰€ä»¥é™¤ä»¥8 */],\n      children: [\n        _type === 'engineering' ? {\n          type: 'rect',\n          z2: 1,\n          shape: {\n            width: FULLSCREEN_GRID_LEFT - AXIS_LABEL_LEFT - AXIS_LABEL_RIGHT,\n            height: AXIS_LABEL_HEIGHT,\n            r: 3,\n          },\n          style: {\n            fill: 'white',\n          },\n        } : {\n          type: 'group',\n          children: [\n            {\n              type: 'polyline',\n              shape: {\n                points: [[10, -48], [10, AXIS_LABEL_HEIGHT / 2], [16, AXIS_LABEL_HEIGHT / 2]],\n              },\n              style: {\n                fill: 'transparent',\n                stroke: '#D6D6D6',\n              },\n            },\n            {\n              type: 'circle',\n              shape: {\n                cx: 20,\n                cy: AXIS_LABEL_HEIGHT / 2,\n                r: 2,\n              },\n              style: {\n                fill: status === 1 ? '#FF5252' : '#3688F6',\n              },\n            },\n          ],\n        },\n        {\n          type: 'group',\n          position: [12, AXIS_LABEL_HEIGHT / 2],\n          children: [\n            renderCircleItem(isShowCircle, _isExpanded, status),\n            {\n              type: 'text',\n              z2: 3,\n              style: {\n                x: _type === 'engineering' ? 12 : 16,\n                y: -6,\n                text: _name,\n                textFill: _type === 'engineering' ? '#323232' : '#5B5B5B',\n                fontWeight: _type === 'engineering' && 'bold',\n              },\n            },\n          ],\n        },\n        {\n          type: 'text',\n          z2: 5,\n          style: {\n            x: FULLSCREEN_GRID_LEFT - AXIS_LABEL_LEFT - AXIS_LABEL_RIGHT - 12,\n            y: AXIS_LABEL_HEIGHT / 2 - 8,\n            text: '>',\n            textFill: '#D6D6D6',\n          },\n        },\n      ],\n    };\n  };\n  const markLine = {\n    symbol: ['emptyCircle'],\n    animation: false,\n    data: projectMilestoneList.map((item) => ({\n      ...item,\n      y: 40,\n      label: {\n        show: false,\n        silent: true, // ä¸å“åº”å’Œè§¦å‘é¼ æ ‡äº‹ä»¶\n        position: 'start',\n      },\n      lineStyle: {\n        color: '#F2BA40',\n        opacity: 0.5,\n      },\n      emphasis: {\n        label: {\n          show: true,\n          opacity: 1,\n          formatter(params) {\n            return `{a|${params.name}}` + '\\n' + `{b|${new Date(params.value).getMonth() + 1}.${new Date(params.value).getDate()}}`;\n          },\n          rich: {\n            a: {\n              color: '#464646',\n              fontSize: 16,\n            },\n            b: {\n              color: '#999',\n              fontSize: 10,\n              padding: [2, 0, 2, 0],\n            },\n          },\n        },\n        lineStyle: {\n          color: '#205294',\n        },\n      },\n    })),\n  };\n  const seriesBase = {\n    type: 'custom',\n    clip: true, // è£æ‰æ‰€æœ‰è¶…å‡ºåæ ‡ç³»çš„éƒ¨åˆ†\n    // custom can only use Array but not Object data format! \n    // dimensions: 0 startDate 1 endDate\n    data: engineeringScheduleList.map((item) => [new Date(item.startDate).getTime(), new Date(item.endDate).getTime()]),\n    renderItem: renderGanttItem,\n    xAxisIndex: 0,\n    encode: { // ä¸å¯åˆ  å¯¹åº”zoomdata\n      x: [0, 1],\n      y: 0,\n    },\n    markLine,\n  };\n  const series = [\n    {\n      ...seriesBase,\n      markLine: {\n        ...markLine,\n        data: markLine.data.map((item) => ({\n          ...item,\n          y: 44,\n          emphasis: {\n            label: {\n              show: false,\n            },\n          },\n        })),\n      },\n    },\n    // just for xAxis Q1-4\n    {\n      type: 'custom',\n      data: engineeringScheduleList.map((item) => [new Date(item.startDate).getTime(), new Date(item.endDate).getTime()]),\n      renderItem: () => { return null },\n      xAxisIndex: 1,\n      encode: {\n        x: [0, 1],\n        y: 0,\n      },\n    },\n    {\n      type: 'custom',\n      data: engineeringScheduleList.map((_, index) => [index]),\n      renderItem: renderAxisLabelItem,\n      encode: {\n        x: -1,\n        y: 0\n      },\n    },\n  ];\n  \n  myChart.setOption({\n    dataZoom,\n    grid,\n    xAxis,\n    yAxis,\n    series,\n    backgroundColor: '#F8F9FB',\n  });\n};\nconst resizeChart = () => {\n  setTimeout(() => {\n    myChart.resize({ height: window.innerHeight });\n  });\n};\n\nrenderChart();\nresizeChart();\n\nmyChart.on('click', 'series.custom', event => {\n  // ä»…å·¥ç¨‹å·¥åºé¡¹\n  if (event.componentSubType !== 'custom') return;\n  const index = event.dataIndex;\n  const selectedItem = engineeringScheduleList[index];\n  if (selectedItem._type === 'engineering') {\n    // å·¥ç¨‹ä¸‹æ— å·¥åºæƒ…å†µ\n    if (!selectedItem.processSchedules.length) return;\n\n    if (selectedItem._isExpanded) {\n      engineeringScheduleList = engineeringScheduleList.filter(item => item._parentId !== selectedItem._id);\n    } else {\n      engineeringScheduleList.splice(index + 1, 0, ...selectedItem.processSchedules);\n    }\n    engineeringScheduleList[index]._isExpanded = !engineeringScheduleList[index]._isExpanded;\n    renderChart(dataZoomStart);\n    resizeChart();\n  } else {\n    emit('clickProcess', selectedItem);\n  }\n});\nmyChart.on('dataZoom', event => {\n  if (!event.batch) return;\n  dataZoomStart = event.batch[0].start;\n});","html":"","externalScripts":"","updaterUID":"obd-o0eO8nf1WwkETQ8akx-Kk79MtvKiEFw","theme":"default","layout":"","viewCount":0,"userName":"K***2","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xp228WMsvi.png?v=1637305982467","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","markLine","series-custom"],"customTags":[],"updaterUserName":"K***2"}}