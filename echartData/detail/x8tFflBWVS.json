{"status":0,"data":{"cid":"x8tFflBWVS","authorUid":"bd-1631520711","authorUserName":"孤***回","title":"点击力导向关系图--实现点击节点展开折叠","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2019-08-26T03:44:51.000Z","lastUpdateTime":"2019-08-26T03:44:51.000Z","auth":2,"uid":"bd-1631520711","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2019-08-26T03:44:51.000Z","code":"var graph = {\n    \"nodes\": [{\n            \"name\": \"A\",\n            \"value\": [\n                \"教授\",\n                \"在职\",\n                \"党委办公室、校长办公室\"\n            ],\n            \"category\": \"中心教师\",\n            \"symbolSize\": 50,\n            \"tooltip\": {\n                \"formatter\": \"{b0}:{c0}\"\n            }\n        },\n        {\n            \"name\": \"B\",\n            \"category\": \"论文\",\n            \"value\": [\n                \"期刊论文\",\n                \"2005\"\n            ],\n            \"symbolSize\": 20,\n            \"tooltip\": {\n                \"formatter\": \"{b0}:{c0}\"\n            }\n        },\n        {\n            \"name\": \"C\",\n            \"category\": \"论文合作教师\",\n            \"symbolSize\": 50\n        },\n\n        {\n            \"name\": \"D\",\n            \"category\": \"项目\",\n            \"value\": [\n                \"信息与通信工程学院\",\n                \"立项日期：20131101\"\n            ],\n            \"symbolSize\": 20,\n            \"tooltip\": {\n                \"formatter\": \"{b0}:{c0}\"\n            }\n        },\n        {\n            \"name\": \"N\",\n            \"category\": \"项目合作教师\",\n            \"symbolSize\": 50\n        },\n         {\n            \"name\": \"Q\",\n            \"category\": \"项目\",\n            \"symbolSize\": 20\n        },\n         \n         {\n            \"name\": \"S\",\n            \"category\": \"项目\",\n            \"symbolSize\": 20\n        },\n        {\n            \"name\": \"E\",\n            \"category\": \"专著专利\",\n            \"symbolSize\": 20,\n            \"value\": [\n                \"专利文献\",\n                \"2009-07-21\"\n            ],\n            \"tooltip\": {\n                \"formatter\": \"{b0}:{c0}\"\n            }\n        },\n        {\n            \"name\": \"W\",\n            \"category\": \"专著专利\",\n            \"symbolSize\": 20\n        },\n        {\n            \"name\": \"Y\",\n            \"category\": \"专著专利\",\n            \"symbolSize\": 20\n        },\n        {\n            \"name\": \"Z\",\n            \"category\": \"专著专利\",\n            \"symbolSize\": 20\n        },\n        {\n            \"name\": \"F\",\n            \"category\": \"专著专利合作教师\",\n            \"symbolSize\": 50\n        },\n        {\n            \"name\": \"O\",\n            \"category\": \"专著专利合作教师\",\n            \"symbolSize\": 50\n        },\n        {\n            \"name\": \"P\",\n            \"category\": \"专著专利合作教师\",\n            \"symbolSize\": 50\n        },\n        {\n            \"value\": [\n                \"信息与通信工程学院\",\n                \"信息工程 \"\n            ],\n            \"name\": \"G\",\n            \"category\": \"课程\",\n            \"symbolSize\": 20,\n            \"tooltip\": {\n                \"formatter\": \"{b0}:{c0}\"\n            }\n        },\n        {\n            \"name\": \"I\",\n            \"category\": \"课程\",\n            \"symbolSize\": 20\n        },\n        {\n            \"name\": \"L\",\n            \"category\": \"课程\",\n            \"symbolSize\": 20\n        },\n        {\n            \"name\": \"H\",\n            \"category\": \"课程合作教师\",\n            \"symbolSize\": 50\n        },\n         {\n            \"name\": \"M\",\n            \"category\": \"课程合作教师\",\n            \"symbolSize\": 50\n        }\n             \n         \n    ],\n    \"links\": [{\n            \"source\": \"A\",\n            \"target\": \"B\"\n        },\n        {\n            \"source\": \"B\",\n            \"target\": \"C\"\n        },\n        {\n            \"source\": \"A\",\n            \"target\": \"D\"\n        },\n         {\n            \"source\": \"D\",\n            \"target\": \"N\"\n        },\n        {\n            \"source\": \"N\",\n            \"target\": \"Q\"\n        },\n        {\n            \"source\": \"N\",\n            \"target\": \"R\"\n        },\n        {\n            \"source\": \"A\",\n            \"target\": \"E\"\n        },\n        {\n            \"source\": \"E\",\n            \"target\": \"F\"\n        },\n        {\n            \"source\": \"F\",\n            \"target\": \"W\"\n        },\n        {\n            \"source\": \"F\",\n            \"target\": \"Y\"\n        },\n        {\n            \"source\": \"P\",\n            \"target\": \"Z\"\n        },\n        {\n            \"source\": \"E\",\n            \"target\": \"O\"\n        },\n         {\n            \"source\": \"E\",\n            \"target\": \"P\"\n        },\n        {\n            \"source\": \"A\",\n            \"target\": \"G\"\n        },\n        {\n            \"source\": \"G\",\n            \"target\": \"H\"\n        },\n         {\n            \"source\": \"G\",\n            \"target\": \"M\"\n        },\n        {\n            \"source\": \"M\",\n            \"target\": \"I\"\n        },\n        {\n            \"source\": \"M\",\n            \"target\": \"L\"\n        }\n    ]\n};\nconst defaultCategory = \"中心教师\";\nconst graphTitle = \"力导向关系图--实现点击节点展开折叠\";\nconst currentGraph = {\n    nodes: {},\n    links: {},\n};\nconst nodeMap = {};\n// 页面加载时，第一次初始化图\nfunction init() {\n    // 根据定义的常量，产生currentGraph的默认数据\n    // 遍历全部nodes和links，产生node映射map\n    for (let i = 0; i < graph.nodes.length; i++) {\n        if (graph.nodes[i].category === defaultCategory) {\n            currentGraph.nodes[graph.nodes[i].name] = graph.nodes[i];\n        }\n        nodeMap[graph.nodes[i].name] = graph.nodes[i];\n        nodeMap[graph.nodes[i].name]['links'] = {};\n        nodeMap[graph.nodes[i].name]['nodes'] = {};\n        nodeMap[graph.nodes[i].name]['hasAppend'] = false;\n    }\n    for (let i = 0; i < graph.links.length; i++) {\n        let link = graph.links[i];\n        if (nodeMap[link.source] !== undefined && nodeMap[link.target] !== undefined) {\n            nodeMap[link.source].links[link.target] = link;\n            nodeMap[link.source].nodes[nodeMap[link.target].name] = nodeMap[link.target];\n        }\n    }\n   \n    for (let i = 0; i < graph.nodes.length; i++) {\n        graph.nodes[i].itemStyle = null;\n        graph.nodes[i].label = {\n            normal: {\n                show: graph.nodes[i].symbolSize > 15\n            }\n        };\n    }\n    redrawGraph();\n}\n// 处理点击节点展开\nfunction append(nodeName) {\n    // 根据nodeName从nodeMap里拿出对应的nodes和links，并append到currentGraph.nodes currentGraph.links\n    let node = nodeMap[nodeName];\n    if (node.hasAppend === true || Object.keys(node.nodes).length === 0 || Object.keys(node.links).length === 0) {\n         alert(\"无法继续展开\");\n        return\n    }\n    Object.values(node.nodes).forEach(n => {\n        currentGraph.nodes[n.name] = n;\n    });\n    Object.values(node.links).forEach(l => {\n        currentGraph.links[l.source + \"_\" + l.target] = l;\n    });\n    node.hasAppend = true;\n    redrawGraph();\n}\n// 处理点击节点收缩\nfunction remove(nodeName) {\n    //根据nodeName从nodeMap里拿出对应的nodes和links，从currentGraph.nodes currentGraph.links删除当前节点的nodes和links并且递归\n    let node = nodeMap[nodeName];\n    Object.values(node.nodes).forEach(n => {\n        delete currentGraph.nodes[n.name];\n        if (n.hasAppend === true && Object.keys(n.nodes).length > 0) {\n            remove(n.name);\n        }\n    });\n    Object.values(node.links).forEach(l => {\n        delete currentGraph.links[l.source + '_' + l.target];\n    });\n    // 设置flag 等于false\n    node.hasAppend = false;\n\n    redrawGraph();\n}\n// 根据更新后的option重新画图\nfunction redrawGraph() {\n    option.series[0].data = Object.values(currentGraph.nodes);\n    option.series[0].links = Object.values(currentGraph.links);\n    console.log(option);\n    myChart.setOption(option);\n}\nconst option = {\n    title: {\n        text: graphTitle,\n        top: 'top',\n        left: 'center',\n    },\n    tooltip: {},\n    legend: [],\n    animation: false,\n    series: [{\n        type: 'graph',\n        layout: 'force',\n        data: Object.values(currentGraph.nodes),\n        links: Object.values(currentGraph.links),\n        categories: [{\n                name: '中心教师',\n                itemStyle: {\n                    color: '#c23531'\n                },\n\n            },\n            {\n                name: '专著专利合作教师',\n                itemStyle: {\n                    color: '#749f83'\n                },\n\n\n            },\n            {\n                name: '课程合作教师',\n                itemStyle: {\n                    color: '#6e7074'\n                },\n\n            },\n            {\n                name: '论文合作教师',\n                itemStyle: {\n                    color: '#2f4554'\n                },\n\n            },\n            {\n                name: '论文',\n                itemStyle: {\n                    color: '#61a0a8'\n                },\n\n            },\n            {\n                name: '专著专利',\n                itemStyle: {\n                    color: '#91c7ae'\n                },\n\n            },\n            {\n                name: '课程',\n                itemStyle: {\n                    color: '#999ea4'\n                },\n\n\n            },\n            {\n                name: '项目合作教师',\n                itemStyle: {\n                    color: '#DEB887'\n                },\n\n            },\n            {\n                name: '项目',\n                itemStyle: {\n                    color: '#bda29a'\n                },\n\n            }\n        ],\n        roam: true,\n        focusNodeAdjacency: false,\n        itemStyle: {\n            normal: {\n                borderColor: '#fff',\n                borderWidth: 1,\n                shadowBlur: 10,\n                shadowColor: 'rgba(0, 0, 0, 0.3)'\n            }\n        },\n        label: {\n            position: 'right',\n            formatter: '{b}'\n        },\n        lineStyle: {\n            color: 'target',\n            opacity: 0.6,\n            curveness: 0.3\n        },\n        emphasis: {\n            lineStyle: {\n                width: 10\n            }\n        },\n        force: {\n            layoutAnimation: false,\n            repulsion: 500\n        }\n    }]\n};\ninit();\nmyChart.on('click', function(params) {\n    if (params.dataType === \"node\") {\n        const node = nodeMap[params.data.name];\n        if (node.hasAppend === true) {\n            remove(node.name)\n        } else {\n            append(node.name);\n        }\n    }\n});","html":"","externalScripts":"","updaterUID":"bd-1631520711","theme":"","layout":"","viewCount":551,"userName":"孤***回","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x8tFflBWVS.png?v=1566791091581","isCustomThumbnail":0,"builtinTags":["category-work","series-graph","title","tooltip"],"customTags":["graph"],"updaterUserName":"孤***回"}}