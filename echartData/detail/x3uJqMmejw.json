{"status":0,"data":{"cid":"x3uJqMmejw","authorUid":"bd-142485545","authorUserName":"梦***殇","title":"饼图动效","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-12-17T03:00:46.000Z","lastUpdateTime":"2021-12-17T03:00:46.000Z","auth":2,"uid":"bd-142485545","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.2","versionCreateTime":"2021-12-17T03:00:46.000Z","code":"const series = [\n    {\n        name: 'One',\n        value: 230\n    },\n    {\n        name: 'Two',\n        value: 48\n    },\n    {\n        name: 'Three',\n        value: 111\n    },\n    {\n        name: 'Four',\n        value: 150\n    }\n]\nconst ringC = ['#66ccff', '#ffec8c', '#33ffbb', '#ffab66', '#7cff33', '#5470c6']\nconst color = [\n    setColor('#9fe8ff', '#66ccff'),\n    setColor('#fff7c0', '#ffec8c'),\n    setColor('#62ffdf', '#33ffbb'),\n    setColor('#ffd59f', '#ffab66'),\n    '#7cff33',\n    '#5470c6'\n]\nconst centerX = '50%'\n\nfunction setColor(start, end) {\n    return {\n        type: 'linear',\n        x: 0,\n        y: 0,\n        x2: 0,\n        y2: 1,\n        colorStops: [\n            {\n                offset: 0,\n                color: start // 0% 处的颜色\n            },\n            {\n                offset: 1,\n                color: end // 100% 处的颜色\n            }\n        ]\n    }\n}\n\nlet inter = null\nlet timer = null\nlet dataIndex = 0\nlet countToNum = series\n.map(item => item.value)\n.reduce((prev, next) => {\n    return prev + next\n}, 0)\n\nlet oldAllRate = 0\nseries.forEach((o, index) => {\n    o.oldAllRate = oldAllRate.toFixed(1)\n    if (index === series.length - 1) {\n        o.rate = oldAllRate === 0 && o.value === 0 ? 0 : (100 - oldAllRate).toFixed(1)\n    } else {\n        o.rate = countToNum > 0 ? ((o.value / countToNum) * 100).toFixed(1) : 0\n        oldAllRate += Number(o.rate)\n    }\n})\n\nfunction setRing() {\n    dataIndex = series.length\n    clearInterval(inter)\n    setPieData(100, 5, 100)\n    timer = setTimeout(() => {\n        setPieData(0, 5, 100)\n        setCarousel()\n    }, 2000)\n}\n\nfunction setCarousel(val = 0) {\n    clearInterval(inter)\n    dataIndex = val\n    inter = setInterval(() => {\n        if (dataIndex !== series.length) {\n            setPieData(series[dataIndex].rate, dataIndex, series[dataIndex].oldAllRate)\n            const i = dataIndex === series.length ? 0 : dataIndex\n            const timeCar = setTimeout(() => {\n                setPieData(0, i, Number(series[i].oldAllRate))\n\n                const timeReset = setTimeout(() => {\n                    setPieData(0, i, Number(series[i].rate) + Number(series[i].oldAllRate))\n                    clearTimeout(timeReset)\n                }, 500)\n\n                clearTimeout(timeCar)\n            }, 2000)\n        }\n        if (dataIndex === series.length) {\n            setPieData(0, 0, 100)\n            setRing()\n        } else {\n            dataIndex++\n        }\n    }, 3000)\n}\nfunction setPieData(v, i, start) {\n    myChart.setOption({\n        series: [\n            {\n                data: series\n            },\n            {\n                startAngle:90 - start * 3.6,\n                clockwise: true,\n                data: [\n                    {\n                        value: v,\n                        name: '',\n                        // animationTypeUpdate: 'expansion',\n                        itemStyle: {\n                            color: color[i]\n                        }\n                    },\n                    {\n                        value: 100 - v,\n                        name: '',\n                        itemStyle: {\n                            color: 'rgba(0,0,0,0)'\n                        }\n                    }\n                ]\n            }\n        ]\n    })\n}\n\nsetCarousel()\n\noption = {\n    backgroundColor: '#0E1327',\n    fontSize: 16,\n    tooltip: {\n        trigger: 'item',\n        textStyle: {\n            color: '#fff'\n        },\n        backgroundColor: 'rgba(16, 32, 40, 0.88)',\n        borderRadius: 4,\n        borderColor: '#20749e',\n        formatter: params => {\n            return params.marker + params.name + ': ' + params.value\n        }\n    },\n    legend: {\n        right: '0%',\n        width: '10%',\n        itemGap: 10,\n        itemWidth: 14,\n        itemHeight: 14,\n        top: 'center',\n        textStyle: {\n            color: '#fff',\n            rich: {\n                a: {\n                    fontSize: 12,\n                    padding: [1, 0, 0, 0],\n                    width: 85\n                },\n                b: {\n                    fontSize: 10,\n                    width: 55\n                }\n            }\n        },\n        data: series.map((o, i) => {\n            o.itemStyle = {\n                color: color[i]\n            }\n            return o\n        })\n    },\n    series: [\n        {\n            type: 'pie',\n            hoverAnimation: false,\n            color: color,\n            center: [centerX, '50%'],\n            radius: ['43%', '70%'],\n            startAngle: 90,\n            avoidLabelOverlap: false,\n            label: null,\n            emphasis: null,\n            labelLine: null,\n            itemStyle: {\n                borderWidth: 5, // 间距的宽度\n                borderColor: 'rgba(0, 0, 0, 0.6)' //背景色\n            },\n            data: series\n        },\n        {\n            type: 'pie',\n            clockWise: true,\n            hoverAnimation: false,\n            center: [centerX, '50%'],\n            radius: ['75%', '80%'],\n            startAngle: 90,\n            label: null,\n            emphasis: null,\n            labelLine: null,\n            data: [\n                {\n                    value: 0,\n                    name: ''\n                },\n                {\n                    value: 100,\n                    name: '',\n                    itemStyle: {\n                        color: 'rgba(0,0,0,0)'\n                    }\n                }\n            ]\n        }\n    ]\n};\n","html":"","externalScripts":"","updaterUID":"bd-142485545","theme":"","layout":"","viewCount":0,"userName":"梦***殇","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x3uJqMmejw.png?v=1639710046396","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-pie","tooltip"],"customTags":[],"updaterUserName":"梦***殇"}}