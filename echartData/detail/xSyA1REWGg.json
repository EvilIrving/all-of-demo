{"status":0,"data":{"cid":"xSyA1REWGg","authorUid":"bd-3305117732","authorUserName":"夸父逐光","title":"仪表盘","description":"","latestVersion":4,"alwaysLatest":1,"createTime":"2016-11-22T03:39:17.000Z","lastUpdateTime":"2016-11-22T03:39:17.000Z","auth":2,"uid":"bd-3305117732","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"3.3.1","versionCreateTime":"2016-11-22T06:41:55.000Z","code":"var data1 = [{\n    \"q\": [{\n        \"y\": \"西二旗\",\n        \"x\": \"13号线\",\n        \"id\": \"1\",\n        \"z\": \"3.87\",\n        \"t\": \"201601\",\n        \"time\": \"6-8时\",\n        \"r\": \"第1行\"\n    }, {\n        \"y\": \"西二旗\",\n        \"x\": \"13号线\",\n        \"id\": \"2\",\n        \"z\": \"30.20\",\n        \"t\": \"201601\",\n        \"time\": \"12-14时\",\n        \"r\": \"第1行\"\n    }, {\n        \"y\": \"西二旗\",\n        \"x\": \"13号线\",\n        \"id\": \"3\",\n        \"z\": \"30.61\",\n        \"t\": \"201601\",\n        \"time\": \"18-20时\",\n        \"r\": \"第1行\"\n    }, {\n        \"y\": \"西二旗\",\n        \"x\": \"13号线\",\n        \"id\": \"4\",\n        \"z\": \"6.46\",\n        \"t\": \"201601\",\n        \"time\": \"6-8时\",\n        \"r\": \"第2行\"\n    }, {\n        \"y\": \"西二旗\",\n        \"x\": \"13号线\",\n        \"id\": \"5\",\n        \"z\": \"56.19\",\n        \"t\": \"201601\",\n        \"time\": \"12-14时\",\n        \"r\": \"第2行\"\n    }, {\n        \"y\": \"西二旗\",\n        \"x\": \"13号线\",\n        \"id\": \"6\",\n        \"z\": \"57.24\",\n        \"t\": \"201601\",\n        \"time\": \"18-20时\",\n        \"r\": \"第2行\"\n    }]\n}, {\n    \"q\": [{\n        \"y\": \"天通苑\",\n        \"x\": \"5号线\",\n        \"id\": \"13\",\n        \"z\": \"0.93\",\n        \"t\": \"201601\",\n        \"time\": \"6-8时\",\n        \"r\": \"第1行\"\n    }, {\n        \"y\": \"天通苑\",\n        \"x\": \"5号线\",\n        \"id\": \"14\",\n        \"z\": \"5.66\",\n        \"t\": \"201601\",\n        \"time\": \"12-14时\",\n        \"r\": \"第1行\"\n    }, {\n        \"y\": \"天通苑\",\n        \"x\": \"5号线\",\n        \"id\": \"15\",\n        \"z\": \"7.19\",\n        \"t\": \"201601\",\n        \"time\": \"18-20时\",\n        \"r\": \"第1行\"\n    }, {\n        \"y\": \"天通苑\",\n        \"x\": \"5号线\",\n        \"id\": \"16\",\n        \"z\": \"1.53\",\n        \"t\": \"201601\",\n        \"time\": \"6-8时\",\n        \"r\": \"第2行\"\n    }, {\n        \"y\": \"天通苑\",\n        \"x\": \"5号线\",\n        \"id\": \"17\",\n        \"z\": \"11.41\",\n        \"t\": \"201601\",\n        \"time\": \"12-14时\",\n        \"r\": \"第2行\"\n    }, {\n        \"y\": \"天通苑\",\n        \"x\": \"5号线\",\n        \"id\": \"18\",\n        \"z\": \"13.71\",\n        \"t\": \"201601\",\n        \"time\": \"18-20时\",\n        \"r\": \"第2行\"\n    }]\n}];\nobj = createGaugeOption(data1, \"q\", [\"x\", \"y\"], \"z\", [\"r\", \"time\"]);\noption = {\n    title: {\n        text: '长宽比必须是2比1\\n另外legend处echars还是有bug'\n    },\n    legend: obj.legend,\n    series: obj.series\n};\n\nfunction createGaugeOption(datas, colName, legColName, dataColName, categoryColName) {\n    console.log(JSON.stringify(datas))\n    var colors = ['#3374b4', '#f23b67', '#04a0ea', '#aad529', '#f0b503', '#12b5b2'];\n    var obj = {};\n    var series = new Array();\n    var legs = new Array();\n    var rows = new Array();\n    var cols = new Array();\n    for (var n = 0; n < datas.length; n++) {\n        var data = datas[n];\n        var d = eval(\"data.\" + colName);\n        for (var i = 0; i < d.length; i++) {\n            var rowname = ArrToStr(d[i], categoryColName[0]);\n            var colname = ArrToStr(d[i], categoryColName[1]);\n            if ($.inArray(rowname, rows) < 0) {\n                rows.push(rowname);\n            }\n            if ($.inArray(colname, cols) < 0) {\n                cols.push(colname);\n            }\n        }\n    }\n    rows = rows.sort(fncSort);\n    cols = cols.sort(fncSort);\n    for (var n = 0; n < datas.length; n++) {\n        var data = datas[n];\n        var d = eval(\"data.\" + colName);\n        if (d.length > 0) {\n            var lstr = \"\";\n            lstr = ArrToStr(d[0], legColName);\n            legs.push({\n                name: lstr,\n                textStyle: {\n                    color: colors[n]\n                }\n            });\n        }\n        for (var i = 0; i < d.length; i++) {\n            var rowname = ArrToStr(d[i], categoryColName[0]);\n            var colname = ArrToStr(d[i], categoryColName[1]);\n            var x = ($.inArray(colname, cols) + 1) / (cols.length + 1);\n            var y = ($.inArray(rowname, rows) + 1) / (rows.length + 1);\n            var size = 0;\n            size = 1 / rows.length - 0.05 - 0.15 * n;\n            var offset = [];\n            if (($.inArray(rowname, rows) * cols.length + $.inArray(colname, cols)) % 2 == 0) {\n                offset = [0, titleOffset(0.15, y, size) + '%'];\n            } else {\n                // offset=[titleOffset(0.15,x,size),0];\n                offset = [titleOffset(0.15, x, size) * 2 + '%', -10];\n\n            }\n\n            var o = {\n                name: lstr,\n                type: 'gauge',\n                z: 100 - n,\n                min: 0,\n                max: 100,\n                splitNumber: 10,\n                center: [x * 100 + '%', y * 100 + '%'],\n                startAngle: 180,\n                endAngle: 0,\n                radius: size * 100 + '%',\n                axisLine: { // 坐标轴线\n                    lineStyle: { // 属性lineStyle控制线条样式\n                        width: 8,\n                        color: [\n                            [100, colors[n]]\n                        ]\n                    }\n                },\n                axisTick: { // 坐标轴小标记\n                    length: 5, // 属性length控制线长\n                    lineStyle: { // 属性lineStyle控制线条样式\n                        color: 'auto'\n                    }\n                },\n                splitLine: { // 分隔线\n                    length: 15, // 属性length控制线长\n                    lineStyle: { // 属性lineStyle（详见lineStyle）控制线条样式\n                        color: 'auto'\n                    }\n                },\n                pointer: {\n                    width: 4\n                },\n                title: {\n                    show: (n == 0) ? true : false,\n                    offsetCenter: offset,\n                    textStyle: { // 其余属性默认使用全局文本样式，详见TEXTSTYLE\n                        fontWeight: 'bolder',\n                        fontSize: 20,\n                        fontStyle: 'italic'\n                    }\n                },\n                detail: {\n                    show: false\n                },\n                data: [{\n                    value: eval(\"d[i].\" + dataColName),\n                    name: (($.inArray(rowname, rows) * cols.length + $.inArray(colname, cols)) % 2 == 0) ? colname : rowname\n                }]\n            }\n            series.push(o);\n        }\n    }\n\n    obj.series = series;\n    obj.legend = {\n        selectedMode: false,\n        data: legs\n    };\n    return obj;\n}\n\nfunction ReservedDecimal(data, digit) {\n    var num = data + \"\";\n    if (num.indexOf(\".\") < 0) {\n        return num;\n    }\n    return num.substring(0, num.indexOf(\".\") + digit + 1);\n}\n\nfunction ArrToStr(data, arr) {\n    var str = \"\";\n    if (isArray(arr)) {\n        for (var i = 0; i < arr.length; i++) {\n            if (i != 0) {\n                str += \",\";\n            }\n            str += eval(\"data.\" + arr[i]);\n        }\n    } else {\n        str = eval(\"data.\" + arr);\n    }\n\n    return str;\n}\n\nfunction fncSort(a, b) {\n    var x = parseInt(a);\n    var y = parseInt(b);\n    if (x != y) {\n        return x - y;\n    } else {\n        return a - b;\n    }\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction titleOffset(final, center, size) {\n    return ((final - center * 2) / size) * 100\n}","html":"","externalScripts":"","updaterUID":"bd-3305117732","theme":"","layout":"","viewCount":3153,"userName":"夸父逐光","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSyA1REWGg.png?v=1479796915762","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-gauge","title"],"customTags":[],"updaterUserName":"夸父逐光"}}