{"status":0,"data":{"cid":"xr-eaJrfvZ","authorUid":"bd-4077488867","authorUserName":"w***0","title":"折线连通图","description":"","latestVersion":5,"alwaysLatest":1,"createTime":"2020-04-08T09:47:24.000Z","lastUpdateTime":"2021-12-13T09:30:23.000Z","auth":2,"uid":"bd-4077488867","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"4.9.0","versionCreateTime":"2021-12-13T09:30:23.000Z","code":"// 遇到一些没头绪的图表时，换一种思路也许也可以做的出来\n// 当时是想着是关系图做，但是结尾不知道怎么聚集，\n// 最后突然想着折线图也能实现出来\n// ps. 一些细节没去处理（箭头旋转）\nconst resource = [{\n        \"pageIdName\": \"步骤一,步骤二,步骤三\",\n        \"calcDateH\": null,\n        \"viewCnt\": 313652,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"82.3%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四\",\n        \"calcDateH\": null,\n        \"viewCnt\": 24454,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"6.4%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四,步骤五\",\n        \"calcDateH\": null,\n        \"viewCnt\": 11946,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"3.1%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四\",\n        \"calcDateH\": null,\n        \"viewCnt\": 7124,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"1.9%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四,步骤五\",\n        \"calcDateH\": null,\n        \"viewCnt\": 6727,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"1.8%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二\",\n        \"calcDateH\": null,\n        \"viewCnt\": 5893,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"1.5%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四,步骤五\",\n        \"calcDateH\": null,\n        \"viewCnt\": 3192,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"0.8%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四,步骤五\",\n        \"calcDateH\": null,\n        \"viewCnt\": 3101,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"0.8%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三\",\n        \"calcDateH\": null,\n        \"viewCnt\": 2544,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"0.7%\"\n    },\n    {\n        \"pageIdName\": \"步骤一,步骤二,步骤三,步骤四,步骤五\",\n        \"calcDateH\": null,\n        \"viewCnt\": 2397,\n        \"sum\": 381030,\n        \"calcDate\": null,\n        \"percent\": \"0.6%\"\n    }\n];\n\nconst textColor = '#000';\nconst textBg = '#ffffff';\nconst lineNumber = resource.length;\n// 定义刻度\nconst yAxisTick = 2;\n// 生成Y轴刻度表\nconst yAxisTickArray = Array(lineNumber).fill(1).map((d, i) => lineNumber - 1 - yAxisTick * i);\n// 找出路径最多的（掐头去尾）\n// const maxPathNumber = Math.max(...resource.map(d => d.pageIdName ? d.pageIdName.split(',').length - 2 : 0));\n// 设置路径最多6个\nconst maxPathNumber = 6;\n// 生成X轴刻度表（maxPathNumber多于8的时候，取前四后四的路径，中间用“……”，所以是9个x坐标值）\n// const xAxisTickArray = Array((maxPathNumber > 8 ? 9 : maxPathNumber) + 4).fill(1).map((d, i) => `x${i}`);\nconst xAxisTickArray = Array(maxPathNumber + 4).fill(1).map((d, i) => `x${i}`);\n// 生成series数据\nconst seriesArray = yAxisTickArray.map((y, i) => {\n  const seriesData = [0, ...Array(maxPathNumber + 2).fill(y), 0];\n  return {\n    data: seriesData,\n    type: 'line',\n    smooth: 0.7,\n    smoothMonotone: 'x',\n    symbol: 'none',\n    lineStyle: {\n      normal: {\n        width: i ? 2 : 5 // 第一条线加粗\n      }\n    },\n    markPoint: { // 每条路径的标注\n      cursor: 'default',\n      label: {\n        normal: {\n          show: true,\n          fontSize: 13,\n          formatter(params) {\n            return ['percent', 'viewCnt'].includes(params.name) ? params.value : params.name;\n          }\n        }\n      },\n      data: (function() {\n        // 定义：用每条线（resource）的 pageIdName 遍历出 该条线有几个路径标识（掐头去尾）\n        let __pageIdName = [];\n        if (resource[i].pageIdName) {\n            const arr = resource[i].pageIdName.split(',');\n            __pageIdName = arr.concat();\n        //  掐头去尾的时候，应用以下代码\n        //  arr.pop();\n        //  arr.shift();\n        //  if (arr.length > 5) {\n        //    __pageIdName = [...arr.slice(0, 4), '······'];\n        //  } else {\n        //    __pageIdName = arr.concat();\n        //  }\n        } else {\n            __pageIdName = [];\n        }\n        const __path = __pageIdName.map((d, dIndex) => (\n          {\n            name: d,\n            value: yAxisTickArray[i],\n            coord: [`x${2 + dIndex}`, yAxisTickArray[i]],\n            symbol: 'triangle',\n            symbolSize: 10,\n            symbolRotate: -90,\n            symbolOffset: (function() {\n              // console.log(d, d.length * 13 + 20)\n              return [((d.length * 13) / 2 + 10 + 5), 0];\n            }()),\n            // symbol: 'rect',\n            // symbolSize: 1,\n            label: {\n              normal: {\n                position: 'inside',\n                color: textColor,\n                backgroundColor: textBg,\n                offset: (function() {\n                  // console.log(d, d.length * 13 + 20)\n                  return [-((d.length * 13) / 2 + 10 + 5), 0];\n                }()),\n                padding: [9, 10, 7]\n              }\n            }\n          }\n        ));\n        // 定义：百分比\n        const __percent = {\n          name: 'percent',\n          value: resource[i].percent,\n          coord: ['x1', yAxisTickArray[i]], // 百分比位于每条路径x轴的'x1'位置\n          symbol: 'pin',\n          symbolSize: 1,\n          symbolOffset: [0, -15],\n          itemStyle: {\n            normal: {\n              color: textBg\n            },\n            emphasis: {\n              color: textBg\n            }\n          },\n          label: {\n            normal: {\n              position: 'right',\n              color: textColor,\n              fontWeight: '600'\n            }\n          }\n        };\n        // 定义：统计数\n        const __viewCnt = {\n          name: 'viewCnt',\n          value: resource[i].viewCnt,\n          coord: [xAxisTickArray[xAxisTickArray.length - 2], yAxisTickArray[i]], // 统计数位于每条路径x轴的倒数第二位置\n          symbol: 'triangle',\n          symbolSize: i ? 10 : 14,\n          symbolRotate: -90,\n          symbolOffset: [-10, 0],\n          label: {\n            normal: {\n              position: 'left',\n              color: textColor,\n              fontWeight: '600',\n              offset: [-5, -15]\n            }\n          }\n        };\n        return [__percent, ...__path, __viewCnt];\n      }())\n    }\n  };\n});\n\noption = {\n    grid: {\n        top: 240,\n        right: 0,\n        bottom: 240,\n        left: 0\n    },\n    title: {\n        text: '折线连通图'\n    },\n    xAxis: {\n        type: 'category',\n        show: false,\n        boundaryGap: false,\n        data: xAxisTickArray\n    },\n    yAxis: {\n        type: 'value',\n        show: false,\n        splitLine: {\n            show: false\n        }\n    },\n    animation: false,\n    series: seriesArray\n};\n\n// module.exports = {\n//   root: true,\n//   parserOptions: {\n//     parser: 'babel-eslint',\n//     sourceType: 'module'\n//   },\n//   env: {\n//     browser: true,\n//     node: true,\n//     es6: true,\n//   },\n//   extends: ['plugin:vue/recommended', 'eslint:recommended'],\n//   globals: {\n//     CryptoJS: true,\n//     SM2CipherMode: true,\n//     SM2Cipher: true,\n//     isGray: true,\n//     _: true\n//   },\n\n//   // add your custom rules here\n//   //it is base on https://github.com/vuejs/eslint-config-vue\n//   rules: {\n//     \"vue/max-attributes-per-line\": [2, {\n//       \"singleline\": 10,\n//       \"multiline\": {\n//         \"max\": 1,\n//         \"allowFirstLine\": false\n//       }\n//     }],\n//     \"vue/name-property-casing\": [\"error\", \"PascalCase\"],\n//     'accessor-pairs': 2,\n//     'arrow-spacing': [2, {\n//       'before': true,\n//       'after': true\n//     }],\n//     'block-spacing': [2, 'always'],\n//     'brace-style': [2, '1tbs', {\n//       'allowSingleLine': true\n//     }],\n//     'camelcase': [0, {\n//       'properties': 'always'\n//     }],\n//     'comma-dangle': [2, 'never'],\n//     'comma-spacing': [2, {\n//       'before': false,\n//       'after': true\n//     }],\n//     'comma-style': [2, 'last'],\n//     'constructor-super': 2,\n//     'curly': [2, 'multi-line'],\n//     'dot-location': [2, 'property'],\n//     'eol-last': 2,\n//     'eqeqeq': [2, 'allow-null'],\n//     'generator-star-spacing': [2, {\n//       'before': true,\n//       'after': true\n//     }],\n//     'handle-callback-err': [2, '^(err|error)$'],\n//     // 'indent': [2, 2, {\n//     //   'SwitchCase': 1\n//     // }],\n//     'jsx-quotes': [2, 'prefer-single'],\n//     'key-spacing': [2, {\n//       'beforeColon': false,\n//       'afterColon': true\n//     }],\n//     'keyword-spacing': [2, {\n//       'before': true,\n//       'after': true\n//     }],\n//     'new-cap': [2, {\n//       'newIsCap': true,\n//       'capIsNew': false\n//     }],\n//     'new-parens': 2,\n//     'no-array-constructor': 2,\n//     'no-caller': 2,\n//     'no-console': 'off',\n//     'no-class-assign': 2,\n//     'no-cond-assign': 2,\n//     'no-const-assign': 2,\n//     'no-control-regex': 0,\n//     'no-delete-var': 2,\n//     'no-dupe-args': 2,\n//     'no-dupe-class-members': 2,\n//     'no-dupe-keys': 2,\n//     'no-duplicate-case': 2,\n//     'no-empty-character-class': 2,\n//     'no-empty-pattern': 2,\n//     'no-eval': 2,\n//     'no-ex-assign': 2,\n//     'no-extend-native': 2,\n//     'no-extra-bind': 2,\n//     'no-extra-boolean-cast': 2,\n//     'no-extra-parens': [2, 'functions'],\n//     'no-fallthrough': 2,\n//     'no-floating-decimal': 2,\n//     'no-func-assign': 2,\n//     'no-implied-eval': 2,\n//     'no-inner-declarations': [2, 'functions'],\n//     'no-invalid-regexp': 2,\n//     'no-irregular-whitespace': 2,\n//     'no-iterator': 2,\n//     'no-label-var': 2,\n//     'no-labels': [2, {\n//       'allowLoop': false,\n//       'allowSwitch': false\n//     }],\n//     'no-lone-blocks': 2,\n//     'no-mixed-spaces-and-tabs': 2,\n//     'no-multi-spaces': 2,\n//     'no-multi-str': 2,\n//     'no-multiple-empty-lines': [2, {\n//       'max': 1\n//     }],\n//     'no-native-reassign': 2,\n//     'no-negated-in-lhs': 2,\n//     'no-new-object': 2,\n//     'no-new-require': 2,\n//     'no-new-symbol': 2,\n//     'no-new-wrappers': 2,\n//     'no-obj-calls': 2,\n//     'no-octal': 2,\n//     'no-octal-escape': 2,\n//     'no-path-concat': 2,\n//     'no-proto': 2,\n//     'no-redeclare': 2,\n//     'no-regex-spaces': 2,\n//     'no-return-assign': [2, 'except-parens'],\n//     'no-self-assign': 2,\n//     'no-self-compare': 2,\n//     'no-sequences': 2,\n//     'no-shadow-restricted-names': 2,\n//     'no-spaced-func': 2,\n//     'no-sparse-arrays': 2,\n//     'no-this-before-super': 2,\n//     'no-throw-literal': 2,\n//     'no-trailing-spaces': 2,\n//     'no-undef': 2,\n//     'no-undef-init': 2,\n//     'no-unexpected-multiline': 2,\n//     'no-unmodified-loop-condition': 2,\n//     'no-unneeded-ternary': [2, {\n//       'defaultAssignment': false\n//     }],\n//     'no-unreachable': 2,\n//     'no-unsafe-finally': 2,\n//     'no-unused-vars': [2, {\n//       'vars': 'all',\n//       'args': 'none'\n//     }],\n//     'no-useless-call': 2,\n//     'no-useless-computed-key': 2,\n//     'no-useless-constructor': 2,\n//     'no-useless-escape': 0,\n//     'no-whitespace-before-property': 2,\n//     'no-with': 2,\n//     'one-var': [2, {\n//       'initialized': 'never'\n//     }],\n//     'operator-linebreak': [2, 'after', {\n//       'overrides': {\n//         '?': 'before',\n//         ':': 'before'\n//       }\n//     }],\n//     'padded-blocks': [2, 'never'],\n//     'quotes': [2, 'single', {\n//       'avoidEscape': true,\n//       'allowTemplateLiterals': true\n//     }],\n//     'semi': [2, 'never'],\n//     'semi-spacing': [2, {\n//       'before': false,\n//       'after': true\n//     }],\n//     'space-before-blocks': [2, 'always'],\n//     // 'space-before-function-paren': [2, 'never'],\n//     'vue/html-indent': [\"error\", {\n//       'attributes': 1\n//     }],\n//     'vue/max-attributes-per-line': 'off',\n//     'space-in-parens': [2, 'never'],\n//     'space-infix-ops': 2,\n//     'space-unary-ops': [2, {\n//       'words': true,\n//       'nonwords': false\n//     }],\n//     'spaced-comment': [2, 'always', {\n//       'markers': ['global', 'globals', 'eslint', 'eslint-disable', '*package', '!', ',']\n//     }],\n//     'template-curly-spacing': [2, 'never'],\n//     'use-isnan': 2,\n//     'valid-typeof': 2,\n//     'wrap-iife': [2, 'any'],\n//     'yield-star-spacing': [2, 'both'],\n//     'yoda': [2, 'never'],\n//     'prefer-const': 2,\n//     'no-debugger': process.env.NODE_ENV === 'production' ? 2 : 0,\n//     // 'object-curly-spacing': [2, 'always', {\n//     //   objectsInObjects: false\n//     // }],\n//     'array-bracket-spacing': [2, 'never'],\n//     \"no-var\": 0\n//   }\n// }\n","html":"","externalScripts":"","updaterUID":"bd-4077488867","theme":"","layout":"","viewCount":2237,"userName":"w***0","commentCount":0,"starCount":19,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xr-eaJrfvZ.png?v=1586339244847","isCustomThumbnail":1,"builtinTags":["category-work","grid","markPoint","series-line","title"],"customTags":[],"updaterUserName":"w***0"}}