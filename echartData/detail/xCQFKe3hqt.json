{"status":0,"data":{"cid":"xCQFKe3hqt","authorUid":"bd-3766368350","authorUserName":"V***s","title":"渐变中心为圆心的径向渐变饼图","description":"没什么可以说的...","latestVersion":1,"alwaysLatest":1,"createTime":"2018-12-04T07:58:44.000Z","lastUpdateTime":"2018-12-04T07:58:44.000Z","auth":2,"uid":"bd-3766368350","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.0","versionCreateTime":"2018-12-04T07:58:44.000Z","code":"// Echarts的Pie图的径向渐变不是很方便, 如果有人需要指向圆心的径向渐变可以直接用\r\n// 需要注意的是:\r\n// 1.legend会变得很奇怪, 最好自己重写\r\n// 2.legend在点击之后(少了一个弧之后)也会不对, 最后在点击之后重新用calc来计算\r\n//   (或者)干脆别让他点...\r\nvar data = [\r\n    {value:20, name:'直接访问', color0: '#F45D67', color1: '#E2332B'},\r\n    {value:20, name:'邮件营销', color0: '#F0C35E', color1: '#D45900'},\r\n    {value:20, name:'联盟广告', color0: '#15E09B', color1: '#1DBD6B'},\r\n    {value:20, name:'视频广告', color0: '#0E58D4', color1: '#093ED9'},\r\n    {value:20, name:'搜索引擎', color0: 'yellow', color1: 'green'}\r\n]\r\n\r\n// 计算总数\r\nvar total = data.map(v => v.value).reduce((o, n) => o + n );\r\n\r\n// 计算每一个data的其实角度和末了角度 θ1和θ2\r\ndata.reduce((o, v) => {\r\n    v.theta1 = o;\r\n    v.theta2 = o + v.value / total;\r\n    return v.theta2\r\n}, 0);\r\n// 添加渐变\r\ndata.forEach((v, i) => {\r\n    var ops = calc(v.theta1 * 2 * Math.PI, v.theta2 * 2 * Math.PI);\r\n    if (v.value) v.itemStyle = {\r\n        color: {\r\n            type: 'radial',\r\n            x: ops.center[0],\r\n            y: ops.center[1],\r\n            r: ops.radius,\r\n            colorStops: [{\r\n                offset: 0, color: v.color0\r\n            },{\r\n                offset: 0.7, color: v.color0\r\n            },{\r\n                offset: 0.6, color: v.color1\r\n            }, {\r\n                offset: 1, color: v.color1\r\n            }],\r\n            globalCoord: false // 缺省为 false\r\n        }\r\n    }\r\n})\r\n\r\n// 计算渐变中心以及渐变半径\r\nfunction calc (theta1, theta2) {\r\n    var r = 0.5; // 半径是0.5 其实表示0.5个直径\r\n    var inner = 0.6; // 里面镂空部分占60%  option中radius为[33%, 55%]  55 * 0.6 == 33\r\n\r\n    var cos = Math.cos;\r\n    var sin = Math.sin;\r\n    var PI = Math.PI;\r\n    var min = Math.min;\r\n    var max = Math.max;\r\n\r\n    var bottom = 0;\r\n    var left = 2 * r;\r\n    var right = 0;\r\n\r\n    // y0: θ1对应的外部点的y值\r\n    // y1: θ2对应的外部点的y值\r\n    // _y0: θ1对应的内部点的y值\r\n    // _y1: θ2对应的内部点的y值\r\n    // x0: θ1对应的外部点的x值\r\n    // x1: θ2对应的外部点的x值\r\n    // _x0: θ1对应的内部点的x值\r\n    // _x1: θ2对应的内部点的x值\r\n    var y0 = r * (1 - cos(theta1));\r\n    var y1 = r * (1 - cos(theta2));\r\n\r\n    var _y0 = r * (1 - inner * cos(theta1));\r\n    var _y1 = r * (1 - inner * cos(theta2));\r\n\r\n    // 如果这个弧经过θ == PI的点  则bottom = 2PI\r\n    // bottom用于之后的max计算中\r\n    if (theta1 < PI && theta2 > PI) {\r\n        bottom = 2 * r;\r\n    }\r\n    // 计算这几个点的最大最小值\r\n    var ymin = min(_y0, _y1, y0, y1);\r\n    var ymax = max(_y0, _y1, y0, y1, bottom);\r\n\r\n    var x0 = r * (1 + sin(theta1));\r\n    var x1 = r * (1 + sin(theta2));\r\n\r\n    var _x0 = r * (1 + inner * sin(theta1));\r\n    var _x1 = r * (1 + inner * sin(theta2));\r\n\r\n    // 如果这个弧经过θ == PI / 2的点  则right = 2PI\r\n    if (theta1 < PI / 2 && theta2 > PI / 2) {\r\n        right = 2 * r;\r\n    }\r\n    // 如果这个弧经过θ == PI / 2 * 3的点  则left = 0\r\n    if (theta1 < PI / 2 * 3 && theta2 > PI / 2 * 3) {\r\n        left = 0;\r\n    }\r\n    xmin = min(_x0, _x1, x0, x1, left);\r\n    xmax = max(_x0, _x1, x1, x0, right);\r\n\r\n    return {\r\n        // 计算圆心以及半径\r\n        center: [(r - xmin) / (xmax - xmin), (r - ymin) / (ymax - ymin)],\r\n        radius: r / min(xmax - xmin, ymax - ymin)\r\n    }\r\n}\r\n\r\noption = {\r\n    title : {\r\n        text: '某站点用户访问来源',\r\n        subtext: '纯属虚构',\r\n        x:'center'\r\n    },\r\n    tooltip : {\r\n        trigger: 'item',\r\n        formatter: \"{a} <br/>{b} : {c} ({d}%)\"\r\n    },\r\n    legend: {\r\n        orient: 'vertical',\r\n        left: 'left',\r\n        data: ['直接访问','邮件营销','联盟广告','视频广告','搜索引擎']\r\n    },\r\n    series : [\r\n        {\r\n            name: '访问来源',\r\n            type: 'pie',\r\n            radius : ['33%', '55%'],\r\n            center: ['50%', '60%'],\r\n            data:data,\r\n            itemStyle: {\r\n                emphasis: {\r\n                    shadowBlur: 10,\r\n                    shadowOffsetX: 0,\r\n                    shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n                }\r\n            },\r\n            // animation: false\r\n        }\r\n    ]\r\n};","html":"","externalScripts":"","updaterUID":"bd-3766368350","theme":"","layout":"","viewCount":528,"userName":"V***s","commentCount":0,"starCount":5,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xCQFKe3hqt.png?v=1543910324501","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-pie","title","tooltip"],"customTags":[],"updaterUserName":"V***s"}}