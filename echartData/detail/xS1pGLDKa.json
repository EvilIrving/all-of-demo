{"status":0,"data":{"cid":"xS1pGLDKa","authorUid":"bd-1192091434","authorUserName":"s***2","title":"pie calculable","description":"饼图的『拖拽重计算』的简单示例。","latestVersion":4,"alwaysLatest":1,"createTime":"2016-09-28T15:47:33.000Z","lastUpdateTime":"2016-09-28T15:47:33.000Z","auth":2,"uid":"bd-1192091434","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"3.3.0","versionCreateTime":"2016-11-02T07:36:31.000Z","code":"var colorList = [\n    '#c23531', '#2f4554', '#61a0a8',\n    '#d48265', '#91c7ae','#749f83',\n    '#ca8622', '#bda29a','#6e7074',\n    '#546570', '#c4ccd3'\n];\n\nvar originalData = [\n    {value: 335, name: '直接访问'},\n    {value: 310, name: '邮件营销'},\n    {value: 234, name: '联盟广告'},\n    {value: 135, name: '视频广告'},\n    {value: 1548, name: '搜索引擎'}\n];\necharts.util.each(originalData, function (item, index) {\n    item.itemStyle = {\n        normal: {color: colorList[index]}\n    };\n});\n\nvar data = [];\nvar legendData = [];\n\nvar dragging;\nvar draggingDataIndex;\nvar dx;\nvar dy;\nvar zr = myChart.getZr();\n\nresetOption();\n\nmyChart.on('mousedown', function (params) {\n    draggingDataIndex = getHoveredDataIndex(params);\n    if (draggingDataIndex != null) {\n\n        var srcSector = params.event.target;\n        dragging = new echarts.graphic.Sector({\n            shape: echarts.util.extend({}, srcSector.shape),\n            style: {\n                fill: srcSector.style.fill,\n                opacity: 0.5\n            },\n            silent: true,\n            z: 10000\n        });\n\n        dx = params.event.offsetX - srcSector.shape.cx;\n        dy = params.event.offsetY - srcSector.shape.cy;\n\n        zr.add(dragging);\n    }\n});\n\nmyChart.on('mouseup', function (params) {\n    if (dragging) {\n        var targetDataIndex = getHoveredDataIndex(params);\n        if (targetDataIndex != null\n            && targetDataIndex !== draggingDataIndex\n        ) {\n            data[targetDataIndex].value += data[draggingDataIndex].value;\n            data[targetDataIndex].name += '\\n' + data[draggingDataIndex].name;\n            legendData[targetDataIndex] = data[targetDataIndex].name;\n            data.splice(draggingDataIndex, 1);\n            legendData.splice(draggingDataIndex, 1);\n            myChart.setOption({\n                legend: {data: legendData},\n                series: {data: data}\n            });\n        }\n    }\n});\n\nzr.on('mousemove', function (e) {\n    if (dragging) {\n        dragging.setShape({\n            cx: e.offsetX - dx,\n            cy: e.offsetY - dy\n        });\n    }\n});\n\nzr.on('mouseup', function (e) {\n    if (dragging) {\n        zr.remove(dragging);\n        dragging = null;\n    }\n});\n\nfunction getHoveredDataIndex(params) {\n    return params.componentType === 'series'\n        && params.componentSubType === 'pie'\n        && params.dataIndex;\n}\n\nfunction resetOption() {\n    data.length = 0;\n    legendData.length = 0;\n    echarts.util.each(originalData, function (item, index) {\n        data.push({\n            value: item.value, \n            name: item.name,\n            itemStyle: {\n                normal: {color: item.itemStyle.normal.color}\n            }\n        });\n        legendData.push(item.name);\n    });\n    \n    option = {\n        legend: {\n            data: legendData,\n            formatter: function (name) {\n                return name.replace(/\\n/g, ' + ');\n            }\n        },\n        title: {\n            bottom: 0,\n            left: 'center',\n            text: '将一个扇区拖到另一个扇区 可以合并它们',\n            textStyle: {\n                fontSize: 14,\n                color: '#777'\n            }\n        },\n        toolbox: {\n            left: 'left',\n            feature: {\n                dataView: {},\n                saveAsImage: {},\n                myRestore: {\n                    show: true,\n                    title: '还原',\n                    icon: 'M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5',\n                    onclick: resetOption\n                },\n            }\n        },\n        tooltip: {},\n        series: [{\n            name: 'pie',\n            type: 'pie',\n            selectedMode: 'single',\n            selectedOffset: 30,\n            clockwise: true,\n            label: {\n                normal: {\n                    textStyle: {\n                        fontSize: 18,\n                        color: '#333'\n                    }\n                }\n            },\n            labelLine: {\n                normal: {\n                    lineStyle: {\n                        color: '#333'\n                    }\n                }\n            },\n            data: data\n        }]\n    };  \n    myChart.setOption(option, true);\n}","html":"","externalScripts":"","updaterUID":"bd-1192091434","theme":"","layout":"","viewCount":3024,"userName":"s***2","commentCount":4,"starCount":5,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xS1pGLDKa.png?v=1478072192121","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-pie","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"s***2"}}