{"status":0,"data":{"cid":"xaFAWFI48d","authorUid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","authorUserName":"157*****625","title":"模仿excel复合饼图","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-08-11T09:46:50.000Z","lastUpdateTime":"2021-08-11T09:46:50.000Z","auth":2,"uid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.1.2","versionCreateTime":"2021-08-11T09:46:50.000Z","code":"let markLineData = []\r\nlet source =  [\r\n            ['product', '2015', '2016'],\r\n            ['系列1-1', 43.3],\r\n            ['系列1-2', 83.1],\r\n            ['系列1-3', 86.4],\r\n            ['系列1-4', 72.4],\r\n            ['系列1-5', 72.4],\r\n            ['系列2-1', 53.9],\r\n            ['系列2-2', 85.8],\r\n            ['系列2-3', 145.8],\r\n        ]\r\n\r\n // 添加“其他”\r\n addOtherData(source,3);\r\n\r\noption = {\r\n    legend: {},\r\n    tooltip: {},\r\n    dataset: {\r\n        source: source\r\n    },\r\n    series: [{\r\n            type: 'pie',\r\n            radius: \"50%\",\r\n            center: ['25%', '50%'],\r\n            label: {\r\n                show: true,\r\n                position: \"inside\",\r\n            },\r\n            startAngle: 45, // 起始角度 45 \r\n            clockwise: false, // 逆时针 \r\n            markLine:{\r\n              lineStyle: {\r\n                type: 'solid',\r\n                color:\"#BFBFBF\"\r\n              },\r\n              symbol: 'none',\r\n              data:markLineData\r\n            }\r\n        },\r\n        {\r\n            type: 'pie',\r\n            radius: \"30%\",\r\n            center: ['75%', '50%'],\r\n            encode: {\r\n                itemName: 'product',\r\n                value: '2016',\r\n            },\r\n            label: {\r\n                show: true,\r\n                position: \"inside\"\r\n            },\r\n        }\r\n    ]\r\n};\r\n\r\n// 获取表标线 对应点坐标\r\nfunction getMarkLineData(percent) {\r\n    // 1.获取画布 width,height\r\n      let height = myChart.getHeight()\r\n      let width = myChart.getWidth() \r\n        \r\n    // 2.  根据 series[0].center 获取圆心坐标\r\n      let x0 = width*0.25 // 圆心x轴坐标\r\n    \r\n    //3.圆边上点坐标\r\n      // let x1   =   x0   +   r   *   cos(ao   *   3.14   /180   )\r\n      // let y1   =   y0   +   r   *   sin(ao   *   3.14   /180   )\r\n    \r\n    // “其他” 终点坐标series[0].startAngle 45\r\n      let x1 = x0 + (height/4) * Math.cos(45 * 3.14 / 180)\r\n      let y1 = (height*0.5)   -   (height/4)   *   Math.sin(45   *   3.14   /180   )\r\n      \r\n      let ao = 360 * (percent/100) // 扇形角度\r\n      \r\n      let ao1 = 0 // 用来计算的坐标角度\r\n      ao1=(ao<=45)?(45-ao):(360-(ao-45))\r\n      if(ao1<270 && ao1>45)ao1=270 // 角度当270用，要不样式不好看\r\n      \r\n      let x2=0,y2=0;\r\n      x2=x0 + (height/4) * Math.cos(ao1 * 3.14 / 180)\r\n      y2 = (height*0.5)  -   (height/4)   *   Math.sin(ao1   *   3.14   /180   )\r\n      \r\n      return [[{x:x1,y:y1},{x: \"75%\", y: \"35%\"}],[{x:x2,y:y2},{x: \"75%\", y: \"65%\"}]]\r\n}\r\n// 添加其他 \r\nfunction addOtherData(datasetSource,len){\r\n     let percent = 0\r\n      let sum=0 // 总计\r\n      datasetSource.forEach((data,rowIndex)=>{\r\n          if(rowIndex>0){ // 第一行数据不算\r\n                let count=0\r\n                for(let key of data){\r\n                  let value = isNaN(key)?0:Number(key)\r\n                  if(count===1)sum+=value\r\n                  count++\r\n                }\r\n          }\r\n      })\r\n      let endData = datasetSource.slice(datasetSource.length-len)\r\n      let other = [\"其他\"]\r\n      for(let i=0;i<endData.length;i++){\r\n        let j=0;\r\n          for(let key of endData[i]){\r\n            let value = isNaN(key)?0:key\r\n            if(j)other[j]?(other[j]+=value):other.push(value)\r\n            j++\r\n          }\r\n        endData[i].splice(1,0,\"\")\r\n      }\r\n      datasetSource.push(other)\r\n      // \"其他\"占比\r\n      percent = sum?((other[1]/sum)*100).toFixed(2):100\r\n      markLineData = getMarkLineData(percent)\r\n    }","html":"","externalScripts":"","updaterUID":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","theme":"","layout":"","viewCount":0,"userName":"157*****625","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xaFAWFI48d.png?v=1628675210524","isCustomThumbnail":1,"builtinTags":["category-work","dataset","legend","markLine","series-pie","tooltip"],"customTags":[],"updaterUserName":"157*****625"}}