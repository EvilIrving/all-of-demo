{"status":0,"data":{"cid":"xz93JtdEi3","authorUid":"obd-oFbGqlEY7yUtHmSV7OesBYzmiWbiH59","authorUserName":"f***9","title":"非均匀刻度仪表盘","description":"非均匀刻度","latestVersion":1,"alwaysLatest":0,"createTime":"2021-12-07T09:02:53.000Z","lastUpdateTime":"2021-12-07T09:02:53.000Z","auth":2,"uid":"obd-oFbGqlEY7yUtHmSV7OesBYzmiWbiH59","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.2","versionCreateTime":"2021-12-07T09:02:53.000Z","code":"/**\n * 渲染非均匀刻度仪表盘\n * @param chart 仪表盘对象\n * @param ruler 仪表盘刻度数组(包含起始值)\n * @param val 仪表盘当前显示值\n */\nfunction setGaugeOption(chart, ruler, val) {\n    console.log(val, 'val');\n    ruler = ruler.sort((a, b) => a - b);\n    let chartMaxVal = 100000; //仪表盘对应0--100的最大刻度，越大越精确\n    let unitStep = chartMaxVal / (ruler.length - 1);\n\n    //将仪表盘数据转换为实际数据  0--chartMaxVal 范围 到刻度范围的转换\n    let valConvert = (value) => {\n        for (let i = 0; i < ruler.length - 1; i++) {\n            if (value <= (i + 1) * unitStep) {\n                let lastRuler = ruler[i];\n                let rulerSpan = ruler[i + 1] - ruler[i];\n                let valSpan = value - i * unitStep;\n                valSpan = (valSpan * rulerSpan) / unitStep;\n                return Math.round(lastRuler + valSpan);\n            }\n        }\n        return ruler[ruler.length - 1];\n    };\n\n    let valText = (value) => {\n        return `${val}\\n下载速度Mbps`;\n    };\n\n    //将实际数据转换为仪表盘数据 刻度范围到 0--chartMaxVal 范围的转换\n    let getGaugeData = (value) => {\n        if (value <= ruler[0]) return 0;\n        for (let i = 1; i < ruler.length; i++) {\n            if (value <= ruler[i]) {\n                let startVal = unitStep * (i - 1);\n                let rulerSpan = ruler[i] - ruler[i - 1];\n                let lastRuler = ruler[i - 1];\n                let ret = startVal + ((value - lastRuler) / rulerSpan) * unitStep;\n                return Math.round(ret);\n            }\n        }\n        return chartMaxVal;\n    };\n\n    let gaugeData = getGaugeData(val);\n\n    let option = {\n        series: [\n            {\n                name: 'test speed',\n                type: 'gauge',\n                radius: '95%',\n                splitNumber: ruler.length - 1, //仪表盘平均分配分段刻度\n                max: chartMaxVal,\n\n                axisLine: {\n                    lineStyle: {\n                        width: 30,\n                        color: [\n                            [0.5, '#67e0e3'],\n                            [0.875, '#37a2da'],\n                            [1, '#fd666d'],\n                        ],\n                    },\n                },\n                pointer: {\n                    itemStyle: {\n                        color: 'auto',\n                    },\n                },\n                splitLine: {\n                    distance: -30,\n                    length: 30,\n                    lineStyle: {\n                        color: '#fff',\n                        width: 4,\n                    },\n                },\n                axisTick: {\n                    distance: -30,\n                    length: 8,\n                    lineStyle: {\n                        color: '#fff',\n                        width: 2,\n                    },\n                },\n                axisLabel: {\n                    color: 'auto',\n                    distance: 40,\n                    fontSize: 16,\n                    //仪表盘刻度设置\n                    formatter: valConvert,\n                },\n                detail: {\n                    fontSize: 14,\n                    formatter: valText,\n                    offsetCenter: [0, '70%'],\n                    valueAnimation: true,\n                    color: 'auto',\n                },\n                data: [\n                    {\n                        value: gaugeData,\n                    },\n                ],\n            },\n        ],\n    };\n\n    chart.setOption(option);\n}\n\nfunction run() {\n    let ruler = [0, 10, 50, 100, 500, 1000, 10000, 100000, 200000]; //仪表盘刻度\n\n    setInterval(function () {\n        let val = 1865.25;\n        setGaugeOption(myChart, ruler, val);\n    }, 1000);\n}\n\nrun();\n","html":"","externalScripts":"","updaterUID":"obd-oFbGqlEY7yUtHmSV7OesBYzmiWbiH59","theme":"","layout":"","viewCount":0,"userName":"f***9","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xz93JtdEi3.png?v=1638867774006","isCustomThumbnail":0,"builtinTags":["category-work","series-gauge"],"customTags":[],"updaterUserName":"f***9"}}