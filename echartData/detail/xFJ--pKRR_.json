{"status":0,"data":{"cid":"xFJ--pKRR_","authorUid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","authorUserName":"157*****625","title":"阶梯图","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-10-21T00:58:21.000Z","lastUpdateTime":"2021-10-21T00:58:21.000Z","auth":2,"uid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.1","versionCreateTime":"2021-10-21T00:58:21.000Z","code":"let originalData = [105101, 436039, 393569, -236854, -56312, 934709, 12345]; // 原数据 用于label显示\nlet seriesData = originalData.concat(); // 数据处理过程中用到的数据，值会做改变\n\n// 判断两个数据是不是一正一负\nfunction isSymbolConsistent(data1, data2) {\n    return data1 * data2 < 0;\n}\n\n// 获取当前值颜色,是否变红，绝对值\nfunction getValueColor(value, red, abs) {\n    let obj = {\n        value: abs ? Math.abs(value) : value,\n        itemStyle: {\n            color: '#a90000',\n        },\n        label: {\n            position: 'bottom',\n        },\n    };\n\n    return red ? obj : value;\n}\n\nlet helpValus = [];\nlet NumberSums = [];\nlet NumberSum = 0;\n// 获取所有辅助值\nfunction getAllHelpValue(data) {\n    data.forEach((cell, index) => {\n        if (index === 0) {\n            helpValus.push(0); // 第一个辅助值为0\n            NumberSum += cell;\n            NumberSums.push(NumberSum);\n            if (data[index] < 0) data[index] = getValueColor(data[index], true, false);\n        } else if (isSymbolConsistent(NumberSum, cell)) {\n            // 一正一负\n            if (NumberSum < 0 && Math.abs(NumberSum) > cell) {\n                // 前面和<0,当前值大于0.相加之后还是小于0\n                helpValus.push(NumberSum + cell);\n                data[index] = -cell;\n            } else if (NumberSum < 0 && Math.abs(NumberSum) < cell) {\n                // 前面和<0,当前值大于0.相加之后还是大于0\n                helpValus.push(0);\n                data[index] = NumberSum + cell;\n                NumberSum += cell;\n                NumberSums.push(NumberSum);\n            } else if (NumberSum > 0 && NumberSum > Math.abs(cell)) {\n                // 和大于0， 当前值小于0 ,相加之后大于0\n                helpValus.push(NumberSum + cell);\n                data[index] = -cell;\n                NumberSum += cell;\n                data[index] = getValueColor(data[index], true, false);\n            } else if (NumberSum > 0 && cell < 0) {\n                helpValus.push(0); // 辅助值为 0\n                data[index] = NumberSum + cell;\n                NumberSum += cell;\n                NumberSums.push(NumberSum);\n                data[index] = getValueColor(data[index], true, false);\n            } else {\n                helpValus.push(0); // 辅助值为 0\n                data[index] = NumberSum + cell;\n                NumberSum += cell;\n                NumberSums.push(NumberSum);\n                data[index] = getValueColor(data[index]);\n            }\n        } else if (!isSymbolConsistent(NumberSum, cell)) {\n            // 符号相同\n            helpValus.push(NumberSum);\n            NumberSum += cell;\n            NumberSums.push(NumberSum);\n            if (data[index] < 0) data[index] = getValueColor(data[index], true, false);\n        }\n    });\n}\ngetAllHelpValue(seriesData);\n\noption = {\n    \n    grid: {\n        left: '3%',\n        right: '4%',\n        bottom: '3%',\n        containLabel: true,\n    },\n    xAxis: {\n        type: 'category',\n        data: (function () {\n            let list = [];\n            for (let i = 1; i <= seriesData.length; i++) {\n                list.push('Nov ' + i);\n            }\n            return list;\n        })(),\n    },\n    yAxis: {\n        type: 'value',\n    },\n    series: [\n        {\n            name: 'Placeholder',\n            type: 'bar',\n            stack: 'Total',\n            itemStyle: {\n                borderColor: 'transparent',\n                color: 'transparent',\n            },\n            emphasis: {\n                itemStyle: {\n                    borderColor: 'transparent',\n                    color: 'transparent',\n                },\n            },\n            data: helpValus,\n        },\n        {\n            name: 'Income',\n            type: 'bar',\n            stack: 'Total',\n            label: {\n                show: true,\n                position: 'top',\n                formatter: (params) => {\n                    return originalData[params.dataIndex];\n                },\n            },\n            data: seriesData,\n\n            // data:  data.map(row=>Math.abs(row))\n        },\n    ],\n};\n","html":"","externalScripts":"","updaterUID":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","theme":"","layout":"","viewCount":0,"userName":"157*****625","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xFJ--pKRR_.png?v=1634777901979","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-bar"],"customTags":[],"updaterUserName":"157*****625"}}