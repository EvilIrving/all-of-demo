{"status":0,"data":{"cid":"xeyxqD5RPy","authorUid":"bd-101698999","authorUserName":"Z***8","title":"用柱/线图图「仿制」一个图例","description":"版本 1 是柱图仿制\n版本 2-5 是用线图 symbol 仿制（隐藏连接线 lineStyle.opacity = 0）","latestVersion":5,"alwaysLatest":1,"createTime":"2020-06-23T09:14:32.000Z","lastUpdateTime":"2020-07-01T07:52:15.000Z","auth":2,"uid":"bd-101698999","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-01T07:50:11.000Z","code":"app.title = '用柱图「仿制」一个图例';\n\n// 用于 option.color，以及自建图例的 data.itemStyle.color\ncolorList = ['#c23531', '#2f4554', '#61a0a8', '#d48265', '#91c7ae', '#749f83', '#ca8622', '#bda29a', '#6e7074', '#546570', '#c4ccd3'];\n\noption1 = {\n    title: {\n        text: '用柱图「仿制」一个图例'\n    },\n    color: colorList,\n    xAxis: {\n        data: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\n    },\n    yAxis: {},\n    tooltip: {},\n    series: [{\n        type: 'bar',\n        name: 'seriesA',\n        data: [220, 182, 191, 234, 290, 330, 310]\n    }, {\n        type: 'line',\n        name: 'seriesB',\n        data: [234, 290, 182, 330, 220, 191, 310]\n    }]\n};\n\n// 传入原 option，返回新 option\nfunction addLegend(src) {\n\n    let dst = JSON.parse(JSON.stringify(src));\n\n    let legendSymbol = 'roundRect';\n    let legendSymbolSize = [40, 25];\n\n    let legendSeries = {\n        type: 'line',\n        name: 'legendSeries',\n        //symbolSize: [40, 25],\n        tooltip: {\n            show: false\n        },\n        symbolKeepAspect: true,\n        lineStyle: {\n            opacity: 0\n        },\n        label: {\n            show: true,\n            position: 'right',\n            formatter: '{b}'\n        },\n        hoverAnimation: false,\n        data: []\n    };\n\n    // 设置一个隐藏的默认图例\n    dst.legend = {\n        show: false\n    };\n    \n    // 如果原 option 没配置 color ，则直接设置为默认颜色\n    typeof dst.color === 'undefined' ?\n        dst.color = ['#c23531', '#2f4554', '#61a0a8', '#d48265', '#91c7ae', '#749f83', '#ca8622', '#bda29a', '#6e7074', '#546570', '#c4ccd3'] :\n        null;\n\n    // 根据原 option.grid 的情况，添加自制图例所需的直角坐标\n    if (typeof dst.grid === 'object') {\n\n        typeof dst.grid.length === 'undefined' ?\n            dst.grid = [dst.grid, {\n                top: '5%',\n                bottom: '90%',\n                left: '60%',\n                right: '20%'\n            }] :\n            dst.grid.push({\n                top: '5%',\n                bottom: '90%',\n                left: '60%',\n                right: '20%'\n            });\n    } else {\n        dst.grid = [{},\n            {\n                top: '5%',\n                bottom: '90%',\n                left: '60%',\n                right: '20%'\n            }\n        ];\n    }\n\n    // 根据原 option.xAxis 的情况，添加自制图例所需的 x 轴\n    if (typeof dst.xAxis === 'object') {\n        typeof dst.xAxis.length === 'undefined' ?\n            dst.xAxis = [dst.xAxis, {\n                gridIndex: dst.grid.length - 1,\n                type: 'category',\n                show: false\n            }] :\n            dst.xAxis.push({\n                gridIndex: dst.grid.length - 1,\n                type: 'category',\n                show: false\n            });\n    } else {\n        dst.xAxis = [{\n            gridIndex: dst.grid.length - 1,\n            type: 'category',\n            show: false\n        }];\n    }\n\n    // 根据原 option.yAxis 的情况，添加自制图例所需的 y 轴\n    if (typeof dst.yAxis === 'object') {\n        typeof dst.yAxis.length === 'undefined' ?\n            dst.yAxis = [dst.yAxis, {\n                gridIndex: dst.grid.length - 1,\n                show: false\n            }] :\n            dst.yAxis.push({\n                gridIndex: dst.grid.length - 1,\n                show: false\n            });\n    } else {\n        dst.yAxis = [{\n            gridIndex: dst.grid.length - 1,\n            show: false\n        }];\n    }\n\n    legendSeries.xAxisIndex = dst.xAxis.length - 1;\n    legendSeries.yAxisIndex = dst.yAxis.length - 1;\n\n    for (let i = 0; i < dst.series.length; i++) {\n\n        if (dst.series[i].type === 'line') {\n            legendSymbolSize = [40, 40];\n            typeof dst.series[i].symbol !== 'undefined' ?\n                legendSymbol = dst.series[i].symbol :\n                legendSymbol = 'path://M0 29 L30 29 L30 31 L0 31 Z \\\n                M100 29 L70 29 L70 31 L100 31 Z \\\n                M 50 10 A 20 20 0 1 0 50 50 A 20 20 0 1 0 50 10 Z \\\n                M 50 12 A 18 18 0 1 1 50 48 A 18 18 0 1 1 50 12 Z'; \n                // 线图图例线条太细不容易点中，可以考虑将上面 svg path 的最后一行去掉，\n                // 这样就是实心的了。\n                \n        } else {\n            legendSymbolSize = [40, 25];\n            legendSymbol = 'roundRect';\n        }\n\n\n        legendSeries.data.push({\n            name: dst.series[i].name,\n            itemStyle: {\n                color: dst.color[i],\n            },\n            value: [i, 1],\n            symbol: legendSymbol,\n            symbolSize: legendSymbolSize\n        });\n    }\n\n    if (typeof dst.series === 'object') {\n        typeof dst.series.length === 'undefined' ?\n            dst.series = [dst.series, legendSeries] :\n            dst.series.push(legendSeries);\n    }\n\n    console.log(dst);\n    return dst;\n\n}\n\noption = addLegend(option1);\n\n// 监听处理自制图例的点击事件\nmyChart.on('click', {\n    seriesName: 'legendSeries'\n}, function(params) {\n\n\n    if (params.color === '#CCC') {\n        myChart.dispatchAction({\n            type: 'legendSelect',\n            // 图例名称\n            name: params.name\n        });\n        option.series[params.seriesIndex].data[params.dataIndex].itemStyle.color = colorList[params.dataIndex];\n        myChart.setOption(option);\n\n    } else {\n        myChart.dispatchAction({\n            type: 'legendUnSelect',\n            // 图例名称\n            name: params.name\n        });\n        option.series[params.seriesIndex].data[params.dataIndex].itemStyle.color = '#CCC';\n        myChart.setOption(option);\n\n    }\n});\n\n// 监听处理自制图例的鼠标滑过事件\nmyChart.on('mouseover', {\n    seriesName: 'legendSeries'\n}, function(params) {\n\n    myChart.dispatchAction({\n        type: 'highlight',\n        seriesName: params.name\n    });\n});\n\nmyChart.on('mouseout', {\n    seriesName: 'legendSeries'\n}, function(params) {\n\n    myChart.dispatchAction({\n        type: 'downplay',\n        seriesName: params.name\n    });\n});","html":"","externalScripts":"","updaterUID":"bd-101698999","theme":"default","layout":"","viewCount":114,"userName":"Z***8","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xeyxqD5RPy.png?v=1593589811218","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","title"],"customTags":[],"updaterUserName":"Z***8"}}