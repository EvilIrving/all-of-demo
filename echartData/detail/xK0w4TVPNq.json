{"status":0,"data":{"cid":"xK0w4TVPNq","authorUid":"bd-2451952737","authorUserName":"马***6","title":"成都地图","description":"成都地图","latestVersion":3,"alwaysLatest":0,"createTime":"2021-09-28T07:58:37.000Z","lastUpdateTime":"2021-09-28T08:39:27.000Z","auth":2,"uid":"bd-2451952737","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"5.2.1","versionCreateTime":"2021-09-28T08:39:27.000Z","code":"var parentJson = null;\nvar parentInfo = [\n  {\n    cityName: '成都市',\n    level: 'city',\n    code: 510100,\n  },\n];\ngetGeoJson(510100);\nvar timeFn = null;\n// 利用高德api获取行政区边界geoJson\n// adcode 行政区code 编号\nfunction getGeoJson(adcode) {\n  AMapUI.loadUI(['geo/DistrictExplorer'], (DistrictExplorer) => {\n    var districtExplorer = new DistrictExplorer();\n    districtExplorer.loadAreaNode(adcode, function (error, areaNode) {\n      if (error) {\n        console.error(error);\n        return;\n      }\n      let Json = areaNode.getSubFeatures();\n      if (Json.length > 0) {\n        parentJson = Json;\n      } else if (Json.length === 0) {\n        Json = parentJson.filter((item) => {\n          if (item.properties.adcode == adcode) {\n            return item;\n          }\n        });\n        if (Json.length === 0) return;\n      }\n      proceData(Json);\n    });\n  });\n}\n\n//处理数据\nfunction proceData(Json) {\n  let mapData = [\n    {\n      name: '甘孜藏族自治州',\n      cityCode: '513300',\n      value: '460',\n    },\n    {\n      name: '简阳市',\n      cityCode: '511100',\n      value: '11372'\n    },\n    {\n      name: '成都市',\n      cityCode: '510100',\n      value: '4543',\n    }\n  ];\n  Json.map((item) => {\n    mapData.forEach((ele) => {\n      if (item.properties.adcode == ele.cityCode) {\n        ele.level = item.properties.level;\n      }\n    });\n  });\n  let mapJson = {};\n  //geoJson必须这种格式\n  mapJson.features = Json;\n\n  //去渲染echarts\n  initEcharts(mapData, mapJson);\n}\n\nfunction initEcharts(mapData, mapJson) {\n  let valArr = [];\n  mapData.map(function (i) {\n    valArr.push(i.value);\n  });\n  // 计算数据最大与最小值用于数据映射组件\n  let max = Math.max.apply(null, valArr);\n  let min = Math.min.apply(null, valArr);\n  //注册\n  echarts.registerMap('Map', mapJson);\n\n  //这里加true是为了让地图重新绘制，不然如果你有筛选的时候地图会飞出去\n  myChart.setOption(\n    {\n      backgroundColor: 'rgb(20,28,52)',\n      tooltip: {\n        trigger: 'item',\n      },\n      visualMap: {\n        type: 'piecewise',\n        min: min,\n        max: max,\n        splitNumber: 5,\n        left: 35,\n        bottom: 50,\n        itemWidth: 21,\n        itemHeight: 8,\n        showLabel: false,\n        orient: 'horizontal',\n        text: ['高', '低'],\n        itemGap: 2,\n        textStyle: {\n          color: '#fff',\n        },\n        inRange: '',\n        color: [\n          'rgba(7, 83, 114,0.8)',\n          'rgba(7, 183, 114,0.8)',\n          'rgba(33, 122, 168,0.8)',\n          'rgba(28, 138, 187,0.7)',\n          '#02e1ff',\n        ],\n        show: true,\n      },\n  \n      series: [\n        // {\n        //     name: '青羊a',\n        //     type: 'effectScatter',\n        //     coordinateSystem: 'geo',\n        //     data: [\n        //         {\n        //           name: \"四川\",\n        //           value:[104.06154145214842, 30.647892249117188, 100]\n        //         }\n        //     ],\n        //     showEffectOn: 'render',\n        //     rippleEffect: { brushType: 'stroke' },\n        //     hoverAnimation: true,\n        //     label: {\n        //         normal: { position: 'top', show: true, fontSize: 24 },\n        //         emphasis: { color: '#fff', fontSize: 30, position: 'top' },\n        //     },\n        //     itemStyle: { normal: { color: '#d0cb40' } },\n        // },\n        //地图点的动画效果\n        {\n            //  name: 'Top 5',\n            type: 'effectScatter',\n            coordinateSystem: 'geo',\n            data: [{\n                name: \"四川\",\n                 value:[104.06154145214842, 30.647892249117188, 100]\n            }],\n            symbolSize: function(val) {\n                return val[2] / 10;\n            },\n            showEffectOn: 'render',\n            rippleEffect: {\n                brushType: 'stroke'\n            },\n            hoverAnimation: true,\n            label: {\n                normal: {\n                    formatter: '{b}',\n                    position: 'right',\n                    show: true\n                }\n            },\n            itemStyle: {\n                normal: {\n                    color:  '#a1edf6',\n                    shadowBlur: 10\n                }\n            },\n            zlevel: 1\n        },\n        {\n          name: '地图',\n          type: 'map',\n          map: 'Map',\n          roam: true, //是否可缩放\n          zoom: 1, //缩放比例\n          aspectScale: 0.9, //长宽比0.75\n          data: mapData,\n          // itemStyle: {\n          //   normal: {\n          //     show: true,\n          //     areaColor: '#a1edf6',\n          //     borderColor: '#fff',\n          //     borderWidth: '1',\n          //   },\n          // },\n          itemStyle: {\n              normal: {\n                  borderColor: '#fff',\n                  borderWidth: 1,\n                  areaColor: \"#a1edf6\",\n                  shadowColor: 'rgba(128, 217, 248, 1)',\n                  // shadowColor: 'rgba(255, 255, 255, 1)',\n                  shadowOffsetX: -2,\n                  shadowOffsetY: 2,\n                  shadowBlur: 10\n              },\n              emphasis: {\n                  areaColor: '#389BB7',\n                  borderWidth: 0\n              }\n          },\n          label: {\n            normal: {\n              show: true, //显示省份标签\n              textStyle: {\n                color: '#000', //省份标签字体颜色\n                fontSize: 12,\n              },\n            },\n            emphasis: {\n              //对应的鼠标悬浮效果\n              areaColor:\"#02e1ff\",\n              show: true,\n              textStyle: {\n                color: '#000',\n              },\n            },\n          },\n        },\n      ],\n    },\n    true\n  );\n  // 单击下钻\n}\n\n","html":"","externalScripts":"https://webapi.amap.com/maps?v=1.3&key=d5082f6c0dda55d9966c2e3ad7d37af3&plugin=AMap.DistrictSearch,https://webapi.amap.com/ui/1.0/main.js","updaterUID":"bd-2451952737","theme":"","layout":"","viewCount":0,"userName":"马***6","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xK0w4TVPNq.png?v=1632818367389","isCustomThumbnail":0,"builtinTags":["category-work","series-effectScatter","series-map","tooltip","visualMap"],"customTags":[],"updaterUserName":"马***6"}}