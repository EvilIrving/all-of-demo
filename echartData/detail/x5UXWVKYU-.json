{"status":0,"data":{"cid":"x5UXWVKYU-","authorUid":"bd-696783921","authorUserName":"n***人","title":"定位与区域掩模","description":"调用高德定位，动态定位到用户所在区域并将相关区域掩模处理","latestVersion":8,"alwaysLatest":1,"createTime":"2018-10-25T07:29:17.000Z","lastUpdateTime":"2021-11-08T07:42:38.000Z","auth":2,"uid":"bd-696783921","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":8,"parentVersion":7,"echartsVersion":"4.9.0","versionCreateTime":"2021-11-08T07:42:38.000Z","code":"option = {\n    title: {\n        text: '位置获取中。。。。。',\n        left: 'center',\n        top: '0',\n        textStyle: {\n            color: 'rgba(18,89,147,1)',\n            fontSize: 21\n        },\n        backgroundColor: 'rgba(255,255,255,0.8)'\n    },\n    bmap: {\n        roam: true,\n        mapStyle: {\n            style: \"grayscale\"\n        }\n    },\n    series: [{\n        coordinateSystem: 'bmap',\n        type: 'effectScatter',\n        symbol: 'arrow',\n        itemStyle: {\n            normal: {\n                color: 'rgba(18,89,147,1)'\n            }\n        },\n        data: []\n    }]\n};\nsetTimeout(function() {\n    var map = myChart.getModel().getComponent('bmap').getBMap();\n    map.addControl(new BMap.NavigationControl({})); // 添加平移缩放控件\n    map.addControl(new BMap.ScaleControl({})); // 添加比例尺控件\n    map.enableScrollWheelZoom(); //启用滚轮放大缩小\n    map.addControl(new BMap.MapTypeControl()); //添加地图类型控件\n    new AMap.Geolocation().getCurrentPosition(function(status, r) {\n        var address = r.addressComponent;\n        if (!address.city) {\n            address.city = address.province.replace('市', '城区');\n        }\n        addBoundary(address.province, address.city, address.district);\n\n        function addBoundary(province, city, district) {\n            new AMap.DistrictSearch({\n                level: 'province',\n                subdistrict: 1, //返回下一级行政区\n                showbiz: false, //最后一级返回街道信息\n                extensions: 'base'\n            }).search('中国', function(status, result) {\n                if (status == 'complete') {\n                    result.districtList[0].districtList.forEach(function(item) {\n                        if (item.name != province) {\n                            draw(item.name);\n                        } else\n                        if (city) {\n                            new AMap.DistrictSearch({\n                                level: 'city',\n                                subdistrict: 1, //返回下一级行政区\n                                showbiz: false, //最后一级返回街道信息\n                                extensions: 'base'\n                            }).search(item.name, function(status, result) {\n                                if (status == 'complete') {\n                                    result.districtList[0].districtList.forEach(function(item) {\n\n                                        if (item.name != city) {\n                                            draw(item.name);\n                                        } else if (district) {\n\n                                            new AMap.DistrictSearch({\n                                                level: 'district',\n                                                subdistrict: 1, //返回下一级行政区\n                                                showbiz: false, //最后一级返回街道信息\n                                                extensions: 'base'\n                                            }).search(item.name, function(status, result) {\n                                                if (status == 'complete') {\n                                                    result.districtList[0].districtList.forEach(function(item) {\n                                                        if (item.name != district) {\n                                                            draw(item.name);\n                                                        }\n\n                                                    });\n                                                }\n                                            });\n\n                                        }\n\n                                    });\n                                }\n                            });\n                        }\n\n\n\n                    });\n                }\n\n                function draw(address) {\n\n                    new BMap.Boundary().get(address, function(rs) { //获取行政区域\n                        rs.boundaries.forEach(function(item) {\n                            map.addOverlay(new BMap.Polygon(item, {\n                                strokeColor: 'white',\n                                fillColor: 'black',\n                                strokeWeight: 1,\n                                strokeOpacity: .01,\n                                fillOpacity: .521,\n                                //\t\t\t\t\t\tstrokeStyle: 'dashed'\n                            }));\n                        });\n                    });\n\n                }\n            });\n        }\n        map.centerAndZoom(address.city);\n        setTimeout(function() {\n            myChart.setOption({\n                title: {\n                    text: '当前位置：' + r.formattedAddress,\n                },\n                tooltip: {\n                    show: true,\n                    backgroundColor: option.title.backgroundColor,\n                    formatter: function(params) {\n                        var infoWindow = new BMap.InfoWindow();\n                        infoWindow.setWidth(0);\n                        infoWindow.setHeight(0);\n                        infoWindow.setTitle(r.formattedAddress);\n                        infoWindow.setContent('<ul style=\"color:' + option.title.textStyle.color + ';\"><li>省市区：' + address.province + '</li>' +\n                            '<li>地级市：' + address.city + '</li>' +\n                             '<li>区 县：' + address.district + '</li>' +\n                            '<li>街 道：' + (address.street ? address.street : '未知') + '</li>' +\n                            '<li>经 度：' + r.position.lng + '</li>' +\n                            '<li>纬 度：' + r.position.lat + '</li></ul>');\n                        map.openInfoWindow(infoWindow, new BMap.Point(r.position.lng, r.position.lat));\n                    }\n                },\n                series: [{\n                    data: [{\n                        name: address,\n                        value: [r.position.lng, r.position.lat]\n                    }]\n                }]\n            });\n            setTimeout(function() {\n                //map.centerAndZoom(new BMap.Point(r.position.lng, r.position.lat), 16);\n                myChart.dispatchAction({\n                    type: 'showTip',\n                    seriesIndex: 0,\n                    dataIndex: 0\n                })\n            }, 100);\n\n        }, 100);\n\n    });\n\n\n\n}, 2000);","html":"","externalScripts":"//webapi.amap.com/maps?v=1.4.10&key=35a871e5905ecfd749bd998448b9cd03&plugin=AMap.DistrictSearch&plugin=AMap.Geolocation,//api.map.baidu.com/api?v=2.0&ak=bA8ttqluwMG4ksk3jv3yycLnXhUL7yBB,https://cdn.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js","updaterUID":"bd-696783921","theme":"default","layout":"","viewCount":212397,"userName":"n***人","commentCount":0,"starCount":11,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x5UXWVKYU-.png?v=1567593896171","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":["amap","bmap","effectScatter","infowindow","symbol","title"],"updaterUserName":"n***人"}}