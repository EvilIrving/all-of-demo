{"status":0,"data":{"cid":"xrkR8yOaaW","authorUid":"bd-1195124638","authorUserName":"你***毛","title":"藏彝走廊少数民族分布","description":"无法生成图表用谷歌浏览器打开即可生成","latestVersion":1,"alwaysLatest":1,"createTime":"2017-10-25T01:56:38.000Z","lastUpdateTime":"2017-10-25T01:56:38.000Z","auth":2,"uid":"bd-1195124638","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.7.2","versionCreateTime":"2017-10-25T01:56:38.000Z","code":"var districts = {\r\n    \"曲靖\": {\r\n        \"lat\": 25.5,\r\n        \"lng\": 103.8\r\n    },\r\n    \"玉溪\": {\r\n        \"lat\": 24.35,\r\n        \"lng\": 102.55\r\n    },\r\n    \"保山\": {\r\n        \"lat\": 25.12,\r\n        \"lng\": 99.17\r\n    },\r\n    \"丽江\": {\r\n        \"lat\": 26.88,\r\n        \"lng\": 100.23\r\n    },\r\n    \"普洱\": {\r\n        \"lat\": 22.79,\r\n        \"lng\": 100.98\r\n    },\r\n    \"临沧\": {\r\n        \"lat\": 23.88,\r\n        \"lng\": 100.08\r\n    },\r\n    \"大理\": {\r\n        \"lat\": 25.6,\r\n        \"lng\": 100.23\r\n    },\r\n    \"红河\": {\r\n        \"lat\": 23.37,\r\n        \"lng\": 103.4\r\n    },\r\n    \"版纳\": {\r\n        \"lat\": 22.02,\r\n        \"lng\": 100.8\r\n    },\r\n    \"楚雄\": {\r\n        \"lat\": 25.03,\r\n        \"lng\": 101.55\r\n    },\r\n    \"德宏\": {\r\n        \"lat\": 24.43,\r\n        \"lng\": 98.58\r\n    },\r\n    \"怒江\": {\r\n        \"lat\": 25.85,\r\n        \"lng\": 98.85\r\n    },\r\n    \"迪庆\": {\r\n        \"lat\": 27.83,\r\n        \"lng\": 99.7\r\n    },\r\n    \"文山\": {\r\n        \"lat\": 23.37,\r\n        \"lng\": 104.25\r\n    },\r\n    \"昭通\": {\r\n        \"lat\": 27.33,\r\n        \"lng\": 103.72\r\n    },\r\n    \"乐山\": {\r\n        \"lat\": 29.57,\r\n        \"lng\": 103.77\r\n    },\r\n    \"甘孜\": {\r\n        \"lat\": 30.05,\r\n        \"lng\": 101.97\r\n    },\r\n    \"阿坝\": {\r\n        \"lat\": 31.9,\r\n        \"lng\": 102.22\r\n    },\r\n    \"凉山\": {\r\n        \"lat\": 27.9,\r\n        \"lng\": 102.27\r\n    },\r\n};\r\n\r\nvar allData = {\r\n        \"白族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"曲靖\",\r\n                \"count\": 5572\r\n            }, {\r\n                \"district\": \"玉溪\",\r\n                \"count\": 11822\r\n            }, {\r\n                \"district\": \"保山\",\r\n                \"count\": 45890\r\n            }, {\r\n                \"district\": \"临沧\",\r\n                \"count\": 30904\r\n            }, {\r\n                \"district\": \"大理\",\r\n                \"count\": 1112000\r\n            }, {\r\n                \"district\": \"楚雄\",\r\n                \"count\": 16474\r\n            }, {\r\n                \"district\": \"怒江\",\r\n                \"count\": 139164\r\n            }, {\r\n                \"district\": \"文山\",\r\n                \"count\": 9130\r\n            }]\r\n        },\r\n        \"哈尼族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"曲靖\",\r\n                \"count\": 2114\r\n            }, {\r\n                \"district\": \"玉溪\",\r\n                \"count\": 130279\r\n            }, {\r\n                \"district\": \"普洱\",\r\n                \"count\": 45466\r\n            }, {\r\n                \"district\": \"红河\",\r\n                \"count\": 789700\r\n            }, {\r\n                \"district\": \"版纳\",\r\n                \"count\": 215434\r\n            }, {\r\n                \"district\": \"楚雄\",\r\n                \"count\": 6176\r\n            }]\r\n        },\r\n        \"景颇族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"德宏\",\r\n                \"count\": 134373\r\n            }]\r\n        },\r\n        \"拉祜族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"玉溪\",\r\n                \"count\": 7027\r\n            }, {\r\n                \"district\": \"普洱\",\r\n                \"count\": 393037\r\n            }, {\r\n                \"district\": \"临沧\",\r\n                \"count\": 84818\r\n            }, {\r\n                \"district\": \"大理\",\r\n                \"count\": 1000\r\n            }, {\r\n                \"district\": \"红河\",\r\n                \"count\": 11400\r\n            }, {\r\n                \"district\": \"版纳\",\r\n                \"count\": 61504\r\n            }]\r\n        },\r\n        \"傈僳族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"玉溪\",\r\n                \"count\": 556\r\n            }, {\r\n                \"district\": \"保山\",\r\n                \"count\": 34423\r\n            }, {\r\n                \"district\": \"丽江\",\r\n                \"count\": 115730\r\n            }, {\r\n                \"district\": \"临沧\",\r\n                \"count\": 84818\r\n            }, {\r\n                \"district\": \"大理\",\r\n                \"count\": 34000\r\n            }, {\r\n                \"district\": \"楚雄\",\r\n                \"count\": 53114\r\n            }, {\r\n                \"district\": \"德宏\",\r\n                \"count\": 31430\r\n            }, {\r\n                \"district\": \"怒江\",\r\n                \"count\": 257620\r\n            }, {\r\n                \"district\": \"迪庆\",\r\n                \"count\": 106910\r\n            }]\r\n        },\r\n        \"纳西族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"丽江\",\r\n                \"count\": 240580\r\n            }, {\r\n                \"district\": \"大理\",\r\n                \"count\": 5000\r\n            }, {\r\n                \"district\": \"迪庆\",\r\n                \"count\": 46402\r\n            }]\r\n        },\r\n        \"羌族\": {\r\n            \"district_count\": [{\r\n                \"district\": \"阿坝\",\r\n                \"count\": 157959\r\n            }]\r\n        },\r\n        \"彝族\": {\r\n            \"district_count\": [{\r\n                        \"district\": \"曲靖\",\r\n                        \"count\": 226733\r\n                    }, {\r\n                        \"district\": \"玉溪\",\r\n                        \"count\": 446764\r\n                    }, {\r\n                        \"district\": \"保山\",\r\n                        \"count\": 81524\r\n                    }, {\r\n                        \"district\": \"丽江\",\r\n                        \"count\": 246282\r\n                    }, {\r\n                        \"district\": \"普洱\",\r\n                        \"count\": 451052\r\n                    }, {\r\n                        \"district\": \"临沧\",\r\n                        \"count\": 355266\r\n                    }, {\r\n                        \"district\": \"大理\",\r\n                        \"count\": 450000\r\n                    }, {\r\n                        \"district\": \"红河\",\r\n                        \"count\": 1043300\r\n                    }, {\r\n                        \"district\": \"版纳\",\r\n                        \"count\": 66731\r\n                    }, {\r\n                        \"district\": \"楚雄\",\r\n                        \"count\": 716627\r\n                    }, {\r\n                        \"district\": \"怒江\",\r\n                        \"count\": 11578\r\n                    }, {\r\n                        \"district\": \"迪庆\",\r\n                        \"count\": 716627\r\n                    }, {\r\n                        \"district\": \"文山\",\r\n                        \"count\": 351318\r\n                    }, {\r\n                        \"district\": \"昭通\",\r\n                        \"count\": 161302\r\n                    }, {\r\n                        \"district\": \"乐山\",\r\n                        \"count\": 153092\r\n                    }, {\r\n                        \"district\": \"凉山\",\r\n                        \"count\": 2226755\r\n            }]\r\n        },\r\n        \"藏族\": {\r\n            \"district_count\": [{\r\n            \"district\": \"大理\",\r\n            \"count\": 1000\r\n        }, {\r\n            \"district\": \"迪庆\",\r\n            \"count\": 129496\r\n        }, {\r\n            \"district\": \"甘孜\",\r\n            \"count\": 854860\r\n        }, {\r\n            \"district\": \"阿坝\",\r\n            \"count\": 48982\r\n            }]\r\n        },\r\n        };\r\n\r\n        var option = {\r\n            // color: ['#85b6b2', '#6d4f8d','#cd5e7e', '#e38980','#f7db88'],\r\n            bmap: {\r\n                center: [101.722423,26.587571],\r\n                zoom: 7,\r\n                roam: true,\r\n                enableMapClick: false,\r\n                mapStyle: {\r\n                    styleJson: [{\r\n                        \"featureType\": \"all\",\r\n                        \"elementType\": \"all\",\r\n                        \"stylers\": {\r\n                            \"lightness\": 61,\r\n                            \"saturation\": -70\r\n                        }\r\n\r\n                    }, {\r\n                        \"featureType\": \"poi\",\r\n                        \"elementType\": \"all\",\r\n                        \"stylers\": {\r\n                            \"visibility\": \"off\"\r\n                        }\r\n                    }]\r\n                }\r\n            },\r\n            legend: {\r\n                show: false,\r\n                orient: 'vertical',\r\n                right: 20,\r\n                top: 15,\r\n                padding: 10,\r\n                backgroundColor: \"rgba(255,255,255,0.8)\",\r\n                data: []\r\n            },\r\n            series: [{\r\n                type: 'pie',\r\n                data: []\r\n            }]\r\n        };\r\n\r\n        myChart.setOption(option);\r\n\r\n        myChart.on('legendselectchanged', function(params) {\r\n            console.log(params.name);\r\n            for (var prop in districtChart) {\r\n                districtChart[prop].dispatchAction({\r\n                    type: 'legendToggleSelect',\r\n                    name: params.name\r\n                });\r\n            }\r\n        });\r\n        setTimeout(init, 0);\r\n\r\n\r\n        function init() {\r\n            initMap();\r\n            initPieDistrict(myChart, getMap());\r\n            showPie([\"白族\", \"哈尼族\", \"景颇族\", \"拉祜族\", \"傈僳族\", \"纳西族\", \"羌族\", \"彝族\", \"藏族\"]);\r\n            //showPie([\"直接访问\", \"联盟广告\", \"视频广告\"]);\r\n\r\n        }\r\n\r\n        function initMap() {\r\n            var top_left_navigation = new BMap.NavigationControl({\r\n                //type: BMAP_NAVIGATION_CONTROL_SMALL\r\n            });\r\n            var map = getMap();\r\n            //map.centerAndZoom(\"苏州\", 13);\r\n            map.addControl(top_left_navigation);\r\n            map.disableDoubleClickZoom();\r\n            map.removeEventListener(\"click\");\r\n            return map;\r\n        }\r\n\r\n\r\n        function getMap() {\r\n            return myChart.getModel().getComponent('bmap').getBMap();\r\n        }\r\n\r\n        // function initPieMarker(id, position) {\r\n        //     var htm = '<div id=\"' + id + '\" style=\"width:200px;height:200px;\"></div>';\r\n        //     var point = new BMap.Point(position.lng, position.lat);\r\n        //     var myRichMarkerObject = new BMapLib.RichMarker(htm, point, {\r\n        //         \"anchor\": new BMap.Size(-100, -100),\r\n        //         barkground: \"transparent\"\r\n        //     });\r\n        //     var map = getMap();\r\n        //     map.addOverlay(myRichMarkerObject);\r\n        //     document.getElementById(id).parentNode.style.backgroundColor = \"transparent\";\r\n        //     document.getElementById(id).parentNode.style.zIndex = \"1\";\r\n        //     var myChart = echarts.init(document.getElementById(id), \"macarons\");\r\n        //     var option = {\r\n        //         tooltip: {\r\n        //             trigger: 'item',\r\n        //             formatter: \"{a} <br/>{b}: {c} ({d}%)\"\r\n        //         },\r\n        //         title: {\r\n        //             text: \"园区\",\r\n        //             left: \"center\",\r\n        //             top: \"center\",\r\n        //             textStyle: {\r\n        //                 fontSize: 16,\r\n        //                 fontWeight: \"bold\"\r\n        //             }\r\n        //         },\r\n\r\n        //         series: [{\r\n        //             name: '园区',\r\n        //             type: 'pie',\r\n        //             backgroundColor: \"rgba(255,255,255,0.8)\",\r\n        //             avoidLabelOverlap: false,\r\n        //             label: {\r\n        //                 normal: {\r\n        //                     show: false,\r\n        //                     position: 'center',\r\n        //                     formatter: \"{a}\"\r\n\r\n        //                 }\r\n        //             },\r\n        //             radius: ['25', '40'],\r\n        //             data: [{\r\n        //                 value: 235,\r\n        //                 name: '直接访问'\r\n        //             }, {\r\n        //                 value: 310,\r\n        //                 name: '邮件营销'\r\n        //             }, {\r\n        //                 value: 234,\r\n        //                 name: '联盟广告'\r\n        //             }, {\r\n        //                 value: 135,\r\n        //                 name: '视频广告'\r\n        //             }, {\r\n        //                 value: 1548,\r\n        //                 name: '搜索引擎'\r\n        //             }]\r\n        //         }]\r\n        //     }\r\n        //     myChart.setOption(option);\r\n        // }\r\n        var districtPoint = districts;\r\n        var districtChart = {};\r\n        var districtLabels = [];\r\n        var parentChart = null;\r\n\r\n        var initPieDistrict = function(chart, map) {\r\n            parentChart = chart;\r\n            var count = 0;\r\n            for (var prop in districtPoint) {\r\n                var district = prop;\r\n                var position = districtPoint[prop];\r\n                var id = \"districtPoint\" + count++;\r\n                districtLabels.push(district);\r\n                districtChart[district] = initPieMarker(map, id, district, position);\r\n            }\r\n            //console.log(districtLabels);\r\n            //console.log(districtChart);\r\n        }\r\n\r\n\r\n\r\n        function initPieMarker(map, id, district, position) {\r\n            var htm = '<div id=\"' + id + '\" style=\"width:100px;height:100px;\"></div>';\r\n            var point = new BMap.Point(position.lng, position.lat);\r\n            var myRichMarkerObject = new BMapLib.RichMarker(htm, point, {\r\n                \"anchor\": new BMap.Size(-30, -30),\r\n                barkground: \"transparent\"\r\n            });\r\n            map.addOverlay(myRichMarkerObject);\r\n            document.getElementById(id).parentNode.style.backgroundColor = \"transparent\";\r\n            document.getElementById(id).parentNode.style.zIndex = \"1\";\r\n            var myChart = echarts.init(document.getElementById(id), \"macarons\");\r\n            var option = {\r\n                tooltip: {\r\n                    trigger: 'item',\r\n                    formatter: \"{a} <br/>{b}: {c} ({d}%)\"\r\n                },\r\n\r\n                title: {\r\n                    left: \"center\",\r\n                    top: \"center\",\r\n                    textStyle: {\r\n                        fontSize: 14,\r\n                        fontWeight: \"bold\"\r\n                    }\r\n                },\r\n                series: [{\r\n                    name: district,\r\n                    type: 'pie',\r\n                    avoidLabelOverlap: false,\r\n                    label: {\r\n                        normal: {\r\n                            show: false,\r\n                            position: 'center',\r\n                            formatter: \"{a}\"\r\n                        }\r\n                    },\r\n                    radius: ['25', '40'],\r\n                    data: []\r\n\r\n                }]\r\n            }\r\n            myChart.setOption(option);\r\n            return myChart;\r\n        }\r\n\r\n        function showPie(arr) {\r\n            let obj = {};\r\n            console.log(arr.length, \"len\")\r\n            districtLabels.forEach((i) => {\r\n                obj[i] = {};\r\n                arr.forEach((j) => {\r\n                    console.log(j, \"xxx\")\r\n                    obj[i][j] = 0;\r\n                });\r\n            });\r\n\r\n            console.log(obj, \"AA\")\r\n                //数据降维\r\n            for (let prop in allData) {\r\n                allData[prop].district_count.forEach((i) => {\r\n                    if (obj[i.district][prop] === 0) {\r\n                        obj[i.district][prop] = i.count;\r\n                    }\r\n                });\r\n            }\r\n            console.log(obj);\r\n            setData(obj, arr);\r\n        }\r\n\r\n        var placeHolderStyle = {\r\n            normal: {\r\n                color: 'rgba(255,255,255,0.8)',\r\n                label: {\r\n                    show: false\r\n                },\r\n\r\n                labelLine: {\r\n                    show: false\r\n                }\r\n            },\r\n            emphasis: {\r\n                color: 'rgba(0,0,0,0)'\r\n            }\r\n        };\r\n\r\n        function setData(data, label) {\r\n\r\n            districtLabels.forEach((district) => {\r\n                var count = 0;\r\n                var dt = (data[district]);\r\n                var newPieData = [];\r\n                for (let prop in dt) {\r\n                    newPieData.push({\r\n                        name: prop,\r\n                        value: dt[prop]\r\n                    });\r\n                    count += dt[prop];\r\n                }\r\n                console.log(newPieData);\r\n\r\n                if (count === 0) {\r\n                    newPieData = [];\r\n                }\r\n                districtChart[district].setOption({\r\n                    title: {\r\n                        show: count > 0,\r\n                        text: district\r\n                    },\r\n                    legend: {\r\n                        show: false,\r\n                        data: label\r\n                    },\r\n                    series: [{\r\n                        data: newPieData\r\n                    }, {\r\n                        tooltip: {\r\n                            show: false\r\n                        },\r\n                        type: 'pie',\r\n                        radius: [0, 25],\r\n                        data: [{\r\n                            value: 0,\r\n                            itemStyle: placeHolderStyle\r\n                        }]\r\n                    }]\r\n                })\r\n            });\r\n            let labelName = label.map((i) => {\r\n                return {\r\n                    name: i\r\n                };\r\n            });\r\n\r\n            //修改parentChart\r\n            parentChart.setOption({\r\n                legend: {\r\n                    show: (label.length > 0),\r\n                    data: label\r\n                },\r\n                series: [{\r\n                    data: labelName\r\n                }]\r\n            });\r\n        }","html":"","externalScripts":"/dep/echarts/latest/extension/bmap.min.js,http://api.map.baidu.com/api?v=2.0&ak=8708f7c232f552fc5c31d491301ff1f1,http://api.map.baidu.com/library/RichMarker/1.2/src/RichMarker_min.js","updaterUID":"bd-1195124638","theme":"","layout":"","viewCount":242,"userName":"你***毛","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrkR8yOaaW.png?v=1508896599369","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"你***毛"}}