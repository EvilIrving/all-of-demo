{"status":0,"data":{"cid":"xUBze_8-Lw","authorUid":"obd-o2-aTjNCXh_ADELOPM4d70VB1G3Oy6I","authorUserName":"衰***命","title":"堆砌合计选择图例动态排名","description":"","latestVersion":2,"alwaysLatest":1,"createTime":"2020-11-09T07:52:30.000Z","lastUpdateTime":"2020-11-09T07:52:30.000Z","auth":2,"uid":"obd-o2-aTjNCXh_ADELOPM4d70VB1G3Oy6I","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2020-11-09T07:54:40.000Z","code":"var getname = ['数据学院', '测试学院', '联奕学院', 'BI学院', '旺旺学院']; //数据点名称\r\nvar getvalue = [20, 96, 55, 65, 36]; //科研项目\r\nvar getvalue1 = [27, 56, 95, 57, 38]; //专利成果\r\nvar getvalue2 = [73, 56, 33, 70, 60]; //获奖成果\r\nvar getvalue3 = [57, 76, 55, 57, 88]; //论文成果\r\nvar getvalue4 = [37, 56, 35, 77, 68]; //著作成果\r\nfunction multi_bubbleSort(obj) {\r\n    let data0 = obj.data0; //横坐标数组\r\n    let data = new Array(data0.length).fill(0); //定义一组与横坐标数组相同大小的且全部为0的数组，用来存储堆积柱状图的和\r\n    let len = obj.data0.length; //横坐标数组长度\r\n    for (let k = 0; k < len; k++) {\r\n        for (let m = 0; m < obj.data1.length; m++) {\r\n            data[k] = Number(data[k]) + Number(obj.data1[m][k]); //求和，用来排序\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < len; i++) {\r\n        for (let j = 0; j < len - 1 - i; j++) {\r\n            if (Number(data[j]) < Number(data[j + 1])) { //相邻元素两两对比\r\n                let temp = data[j + 1]; //元素交换\r\n                data[j + 1] = data[j];\r\n                data[j] = temp;\r\n                let te = obj.data0[j + 1]; //元素交换\r\n                obj.data0[j + 1] = obj.data0[j];\r\n                obj.data0[j] = te;\r\n                for (let m = 0; m < obj.data2.length; m++) {\r\n                    let tem = obj.data2[m][j + 1];\r\n                    obj.data2[m][j + 1] = obj.data2[m][j];\r\n                    obj.data2[m][j] = tem;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return obj;\r\n}\r\n\r\nlet obj = {\r\n    \"data0\": getname,\r\n    \"data1\": [getvalue, getvalue1, getvalue2, getvalue3, getvalue4],\r\n    \"data2\": [getvalue, getvalue1, getvalue2, getvalue3, getvalue4]\r\n};\r\n\r\nlet multi_obj = multi_bubbleSort(obj);\r\n\r\noption = {\r\n    backgroundColor: '#000',\r\n    grid: {\r\n        top: '15',\r\n        right: '60',\r\n        left: '100',\r\n        bottom: '15'\r\n    },\r\n    tooltip: {\r\n        trigger: 'axis',\r\n        axisPointer: {\r\n            type: 'none'\r\n        },\r\n    },\r\n    legend: {\r\n        type: \"scroll\",\r\n        icon: 'circle',\r\n        right: '10',\r\n        top: '0',\r\n        data: ['科研项目', '专利成果', '获奖成果', '论文成果', '著作成果'],\r\n        itemGap: 20,\r\n        itemWidth: 11,\r\n        itemHeight: 11,\r\n        textStyle: {\r\n            fontSize: '13',\r\n            color: '#A9C1E5',\r\n        },\r\n\r\n    },\r\n    yAxis: [{\r\n        show: true,\r\n        inverse: true,\r\n        data: multi_obj.data0,\r\n        axisLabel: {\r\n            color: '#C5DCFF',\r\n            textStyle: {\r\n                fontSize: 14,\r\n            },\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n    }],\r\n    xAxis: [{\r\n        axisLabel: {\r\n            show: false\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        splitLine: {\r\n            show: false\r\n        }\r\n    }],\r\n    //animation: false,\r\n    series: [{\r\n        type: 'bar',\r\n        name: '科研项目',\r\n        data: multi_obj.data2[0],\r\n        barWidth: '10px',\r\n        stack: '科研分析',\r\n        label: {\r\n            show: false,\r\n            position: 'right',\r\n            color: '#FFFFFF',\r\n            fontSize: 15,\r\n            offset: [5, 0]\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                color: new echarts.graphic.LinearGradient(1, 0, 0, 0, [{\r\n                    offset: 0,\r\n                    color: '#065ADA' // 0% 处的颜色\r\n                }, {\r\n                    offset: 1,\r\n                    color: '#22CFF5' // 100% 处的颜色\r\n                }], false),\r\n                barBorderRadius: 5,\r\n            }\r\n        },\r\n        z: 50,\r\n    }, {\r\n        type: 'bar',\r\n        name: '专利成果',\r\n        data: multi_obj.data2[1],\r\n        barWidth: '10px',\r\n        stack: '科研分析',\r\n        label: {\r\n            show: false,\r\n            position: 'right',\r\n            color: '#FFFFFF',\r\n            fontSize: 15,\r\n            offset: [5, 0]\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{\r\n                    offset: 0,\r\n                    color: '#2CFFBA' // 0% 处的颜色\r\n                }, {\r\n                    offset: 1,\r\n                    color: '#1B856D' // 100% 处的颜色\r\n                }], false),\r\n                barBorderRadius: 5,\r\n                shadowBlur: [0, 0, 0, 5],\r\n                shadowColor: '#2CFFBA',\r\n                shadowOffsetX: -5,\r\n            }\r\n        },\r\n        z: 40,\r\n    }, {\r\n        type: 'bar',\r\n        name: '获奖成果',\r\n        data: multi_obj.data2[2],\r\n        barWidth: '10px',\r\n        stack: '科研分析',\r\n        label: {\r\n            show: false,\r\n            position: 'right',\r\n            color: '#FFFFFF',\r\n            fontSize: 15,\r\n            offset: [5, 0]\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{\r\n                    offset: 0,\r\n                    color: '#FF7E7C' // 0% 处的颜色\r\n                }, {\r\n                    offset: 1,\r\n                    color: '#FF6061' // 100% 处的颜色\r\n                }], false),\r\n                barBorderRadius: 5,\r\n                shadowBlur: [0, 0, 0, 5],\r\n                shadowColor: '#FF7E7C',\r\n                shadowOffsetX: -5,\r\n            }\r\n        },\r\n        z: 30,\r\n    }, {\r\n        type: 'bar',\r\n        name: '论文成果',\r\n        data: multi_obj.data2[3],\r\n        barWidth: '10px',\r\n        stack: '科研分析',\r\n        label: {\r\n            show: false,\r\n            position: 'right',\r\n            color: '#FFFFFF',\r\n            fontSize: 15,\r\n            offset: [5, 0]\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{\r\n                    offset: 0,\r\n                    color: '#27F8F6' // 0% 处的颜色\r\n                }, {\r\n                    offset: 1,\r\n                    color: '#209ECD' // 100% 处的颜色\r\n                }], false),\r\n                barBorderRadius: 5,\r\n                shadowBlur: [0, 0, 0, 5],\r\n                shadowColor: '#27F8F6',\r\n                shadowOffsetX: -5,\r\n            }\r\n        },\r\n        z: 20,\r\n    }, {\r\n        type: 'bar',\r\n        name: '著作成果',\r\n        data: multi_obj.data2[4],\r\n        barWidth: '10px',\r\n        stack: '科研分析',\r\n        label: {\r\n            show: false,\r\n            position: 'right',\r\n            color: '#FFFFFF',\r\n            fontSize: 15,\r\n            offset: [5, 0]\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{\r\n                    offset: 0,\r\n                    color: '#9F9BFF' // 0% 处的颜色\r\n                }, {\r\n                    offset: 1,\r\n                    color: '#826CFF' // 100% 处的颜色\r\n                }], false),\r\n                barBorderRadius: 5,\r\n                shadowBlur: [0, 0, 0, 5],\r\n                shadowColor: '#9F9BFF',\r\n                shadowOffsetX: -5,\r\n            }\r\n        },\r\n        z: 10,\r\n    }]\r\n};\r\nvar series = option[\"series\"];\r\nvar fun = function(params) {\r\n    var datavalue = 0;\r\n    for (var i = 0; i < series.length; i++) {\r\n        datavalue += series[i].data[params.dataIndex]\r\n    }\r\n    return datavalue;\r\n}\r\n\r\nif (series[series.length - 1]) {\r\n    series[series.length - 1][\"label\"][\"show\"] = true;\r\n    series[series.length - 1][\"label\"][\"formatter\"] = fun;\r\n}\r\n\r\nmyChart.on(\"legendselectchanged\", function(object) {\r\n    let one = object.selected.科研项目;\r\n    let two = object.selected.专利成果;\r\n    let three = object.selected.获奖成果;\r\n    let four = object.selected.论文成果;\r\n    let five = object.selected.著作成果;\r\n\r\n    //获取option对象\r\n    let option1 = this.getOption();\r\n    //清空需要重新渲染的数据\r\n    option1.yAxis[0].data = [];\r\n    option1.series[0].data = [];\r\n    option1.series[1].data = [];\r\n    option1.series[2].data = [];\r\n    option1.series[3].data = [];\r\n    option1.series[4].data = [];\r\n\r\n    //定义一个对象，data0：X轴坐标数组；data1：二维数组，存legend为true的series数组；data2：二维数组，存储所有的series数组\r\n    let obj = {\r\n        \"data0\": getname,\r\n        \"data1\": [],\r\n        \"data2\": [getvalue, getvalue1, getvalue2, getvalue3, getvalue4]\r\n    };\r\n    //判断legend图例是否为true，是就给对象obj的data1追加相应的series数组\r\n    if (one) {\r\n        obj.data1.push(getvalue);\r\n    }\r\n    if (two) {\r\n        obj.data1.push(getvalue1);\r\n    }\r\n    if (three) {\r\n        obj.data1.push(getvalue2);\r\n    }\r\n    if (four) {\r\n        obj.data1.push(getvalue3);\r\n    }\r\n    if (five) {\r\n        obj.data1.push(getvalue4);\r\n    }\r\n    //调用排序方法，返回排序好的对象\r\n    let multi_obj = multi_bubbleSort(obj);\r\n    //给上面清空的数据添加值\r\n    option1.yAxis[0].data = multi_obj.data0;\r\n    option1.series[0].data = multi_obj.data2[0];\r\n    option1.series[1].data = multi_obj.data2[1];\r\n    option1.series[2].data = multi_obj.data2[2];\r\n    option1.series[3].data = multi_obj.data2[3];\r\n    option1.series[4].data = multi_obj.data2[4];\r\n    var b = object.selected, //图例的选中情况，key是图例的name，value是true或false\r\n        d = []; //选中的series的index列表\r\n    for (var key in b) {\r\n        if (b[key]) { //选中的图例\r\n            for (var i = 0; i < series.length; i++) {\r\n                var changename = series[i][\"name\"];\r\n                if (changename == key) {\r\n                    d.push(i); //选中的series的index列表\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    var fn = function(params) {\r\n        var datavalue = 0;\r\n        for (var i = 0; i < d.length; i++) {\r\n            for (var j = 0; j < series.length; j++) {\r\n                if (d[i] == j) {\r\n                    datavalue += series[j].data[params.dataIndex];\r\n                }\r\n            }\r\n        }\r\n\r\n        return datavalue;\r\n    }\r\n\r\n    for (var j = 0; j < series.length; j++) {\r\n        series[j][\"label\"][\"show\"] = false;\r\n    }\r\n\r\n    var l_s = series[d[d.length - 1]]; //选中的series的最后一个\r\n    if (l_s != null && l_s != \"\" && l_s != undefined) {\r\n        l_s[\"label\"][\"show\"] = true; //显示label\r\n        l_s[\"label\"][\"formatter\"] = fn; //绑定formatter\r\n    }\r\n    myChart.setOption(option)\r\n})","html":"","externalScripts":"","updaterUID":"obd-o2-aTjNCXh_ADELOPM4d70VB1G3Oy6I","theme":"","layout":"","viewCount":191,"userName":"衰***命","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xUBze_8-Lw.png?v=1604908480490","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","tooltip"],"customTags":[],"updaterUserName":"衰***命"}}