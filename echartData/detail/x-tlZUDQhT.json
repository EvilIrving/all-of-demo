{"status":0,"data":{"cid":"x-tlZUDQhT","authorUid":"bd-167860219","authorUserName":"n***1","title":"上海职住可视化","description":"3Dbar高度为人口数，颜色为就业岗位数","latestVersion":4,"alwaysLatest":1,"createTime":"2020-05-24T03:34:08.000Z","lastUpdateTime":"2021-11-05T02:01:33.000Z","auth":2,"uid":"bd-167860219","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"4.9.0","versionCreateTime":"2021-11-05T02:01:33.000Z","code":"//关于这个图表我做的视频简介：https://www.bilibili.com/video/BV1pD4y127tW\n//各位观众老爷们一键三连，下次一定！\nvar uploadedDataURL = \"/asset/get/s/data-1590291019662-Pukz5wykJ.json\";\n\n //原始数据为栅格数据，需将栅格转化为经纬度后可视化\n\nmapboxgl.accessToken = mapboxglToken;\n\nmyChart.showLoading();\n\nfunction coltowgs(LONCOL, LATCOL) { //定义栅格转换经纬度的函数\nvar lon1 = 118.36;\nvar lon2 = 121.986379;\nvar lat1 = 30.67;\nvar lat2 = 33.402324;\n    var accuracy = 500;\n    var latStart = Math.min(lat1, lat2);\n    var lonStart = Math.min(lon1, lon2);\n    var deltaLon = accuracy * 360 / (2 * Math.PI * 6371004 * Math.cos((lat1 + lat2) * Math.PI / 360));\n    var deltaLat = accuracy * 360 / (2 * Math.PI * 6371004);\n    var HBLON = LONCOL * deltaLon + (lonStart - deltaLon / 2)\n    var HBLAT = LATCOL * deltaLat + (latStart - deltaLat / 2)\n    return [HBLON, HBLAT]\n}\n//读取MapboxStyle数据\nvar option = {\n    title: {\n        text: \"上海职住可视化\",\n        subtext: '3Dbar高度为人口数，颜色为就业岗位数',\n        textStyle: {\n            color: '#000',\n            fontSize: 30\n        },\n        subtextStyle: {\n            color: '#000',\n            fontSize: 15\n        },\n        right: '0%'\n    },\n\n    visualMap: {\n        show: false,\n        calculable: true,\n        realtime: false,\n        dimension:3,\n        inRange: {\n            color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']\n        },\n        outOfRange: {\n            colorAlpha: 0\n        }\n\n    },\n\n\n    mapbox3D      : {\n    center          : [121.4293, 31.203070],\n    zoom            : 11,\n    pitch           : 50,\n    bearing:30,\n    style: 'mapbox://styles/mapbox/light-v9',\n    // altitudeScale: 1,\n    postEffect      : {\n    enable          : true,\n    FXAA            : {\n    enable          : true\n            }\n        },\n        light: {\n            main: {\n                intensity: 1,\n                shadow: true,\n                shadowQuality: 'high'\n            },\n            ambient: {\n                intensity: 0.\n            },\n            ambientCubemap: {\n                texture: '/asset/get/s/data-1491838644249-ry33I7YTe.hdr',\n                exposure: 1,\n                diffuseIntensity: 0.5,\n                specularIntensity: 2\n            }\n        }\n    },\n    series: [{\n        type: 'bar3D',\n        shading: 'realistic',\n        coordinateSystem: 'mapbox3D',\n        barSize: 0.4,\n        silent: true\n    }]\n}\n\n\n$.getJSON(uploadedDataURL, function(linedata) { //读取可视化数据\nmyChart.hideLoading();\n\n\n    var data = []\n    for (var i = 0; i < linedata.length; i += 1) {\n        loncol = linedata[i][0]\n        latcol = linedata[i][1]\n        homecount = linedata[i][2]\n        workcount = linedata[i][3]\n        coor = coltowgs(loncol, latcol)\n        data.push({\n            'value': [coor[0], coor[1], homecount*5,workcount*5]\n        })\n    }\n\n    option.visualMap.max = 30000\n    option.series[0].data = data\n\n\n\nif (option && typeof option === \"object\") {\n    myChart.setOption(option, true);\n    \n//Mapbox实例获取\nvar map = myChart.getModel()\n    .getComponent(\"mapbox3D\")\n    .getMapbox();\n//map.addControl(new mapboxgl.NavigationControl());\nconsole.log(map)\n\n//相机旋转\nfunction rotate() {\n    map.easeTo({ bearing: 0, duration: 8000, pitch: 0, zoom: 9 });\n    t = window.setTimeout(() => {\n        map.easeTo({ bearing: 180, duration: 10000, pitch: 80, zoom: 12 });\n        t2 = window.setTimeout(() => {\n            map.easeTo({ bearing: -120, duration: 10000, pitch: 60, zoom: 10 });\n            t3 = window.setTimeout(() => {\n                rotate();\n            }, 10000);\n        }, 10000);\n    }, 10000);\n}\nrotate()\n}\n});\n","html":"","externalScripts":"http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js,http://echarts.baidu.com/resource/echarts-gl-latest/mapboxgl-token.js,https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js,https://cdn.jsdelivr.net/npm/maptalks@0.39.3/dist/maptalks.min.js,https://deyihu.github.io/src/lib/echarts-gl.1.1.3.js?tdsourcetag=s_pctim_aiomsg,https://cdnjs.cloudflare.com/ajax/libs/tween.js/r14/Tween.js,https://code.jquery.com/jquery-2.1.1.js","updaterUID":"bd-167860219","theme":"default","layout":"","viewCount":33251,"userName":"n***1","commentCount":11,"starCount":100,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x-tlZUDQhT.png?v=1590291607527","isCustomThumbnail":1,"builtinTags":["category-work","maptalks3D","series-bar3D","title","visualMap"],"customTags":[],"updaterUserName":"n***1"}}