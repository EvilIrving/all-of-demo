{"status":0,"data":{"cid":"x_3QhfKQv0","authorUid":"obd-oCutHLMJDV3_7Eud_jdtl8_PdF9ZS3g","authorUserName":"借***孩","title":"高亮子孙节点 demo","description":"点击节点可以高亮子孙节点和边，双击显示原先样式","latestVersion":2,"alwaysLatest":0,"createTime":"2021-08-23T04:27:14.000Z","lastUpdateTime":"2021-08-23T04:27:40.000Z","auth":2,"uid":"obd-oCutHLMJDV3_7Eud_jdtl8_PdF9ZS3g","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"5.1.2","versionCreateTime":"2021-08-23T04:27:40.000Z","code":"var ROOT_PATH = 'https://cdn.jsdelivr.net/gh/apache/echarts-website@asf-site/examples';\n\nmyChart.showLoading();\n$.get(ROOT_PATH + '/data/asset/data/energy.json', function (data) {\n    myChart.hideLoading();\n\n    myChart.setOption(option = {\n        title: {\n            text: 'Sankey Diagram'\n        },\n        tooltip: {\n            trigger: 'item',\n            triggerOn: 'mousemove'\n        },\n        series: [\n            {\n                type: 'sankey',\n                data: data.nodes,\n                links: data.links,\n                emphasis: {\n                    focus: 'adjacency'\n                },\n                lineStyle: {\n                    color: 'source',\n                    curveness: 0.5\n                }\n            }\n        ]\n    });\n    let sourceNodes = [];\n    let getNodes = (links) => {\n        let empty = true;\n        links.forEach(link => {\n            if (sourceNodes.includes(link.source)&&!sourceNodes.includes(link.target)) {\n                empty = false\n                sourceNodes.push(link.target);\n            }\n        })\n        if (empty) return;\n        else getNodes(links);\n    }\n    \n    let isSelected = false, cacheName = '';\n    myChart.on('click',(e) => {\n        // console.log(e,drawData)\n        if(e.data.source) return;\n        let {name} = e;\n        let {links,nodes} = _.cloneDeep(data);\n        let options = myChart.getOption();\n        if(cacheName !== name){\n            isSelected = false;\n        }\n        cacheName = name;\n        sourceNodes = [name];\n        getNodes(links);\n        if(!isSelected){\n            let selectedNodes = [],selectedLinks = [];\n            selectedNodes = links.filter(item => {\n                return sourceNodes.includes(item.source);\n            }).map(item => {\n                return [{\n                    name: item.source,\n                    itemStyle: {\n                        // color: '#1DFA7C',\n                        opacity: 1\n                    },\n                    label: {\n                        fontSize: 12,\n                    }\n                },{\n                    name: item.target,\n                    itemStyle: {\n                        // color: '#1DFA7C',\n                        opacity: 1\n                    },\n                    label: {\n                        fontSize: 12,\n                    }\n                }];\n            }).flat();\n            nodes = _.unionBy(selectedNodes, nodes, 'name').map(item => {\n                if(!item.itemStyle){\n                    item.itemStyle = {\n                        opacity: 0.3\n                    };\n                    item.label = {\n                        show: false\n                    };\n                }\n                return item;\n            });\n            selectedLinks = links.map(item => {\n                if(sourceNodes.includes(item.source)){\n                    return {\n                        ...item,\n                        lineStyle: {\n                            // color: '#FFD700',\n                            opacity: .8\n                        }\n                    }\n                }else{\n                    return {\n                        ...item,\n                        lineStyle: {\n                            color: 'transparent',\n                            opacity: 0.3\n                        }\n                    }\n                }\n            });\n            options.series[0].data = nodes;\n            options.series[0].links = selectedLinks;\n            isSelected = true;\n        }else{\n            options.series[0].data = nodes;\n            options.series[0].links = links;\n            isSelected = false;\n        }\n        myChart.setOption(options);\n    })\n    \n});\n","html":"","externalScripts":"https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.min.js","updaterUID":"obd-oCutHLMJDV3_7Eud_jdtl8_PdF9ZS3g","theme":"","layout":"","viewCount":0,"userName":"借***孩","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x_3QhfKQv0.png?v=1629692861080","isCustomThumbnail":0,"builtinTags":["category-work","series-sankey","title","tooltip"],"customTags":["highlight"],"updaterUserName":"借***孩"}}