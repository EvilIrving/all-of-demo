{"status":0,"data":{"cid":"xoSZSHG5J","authorUid":"bd-657564173","authorUserName":"了***文","title":"知识图谱-关系图","description":"关联关系","latestVersion":3,"alwaysLatest":1,"createTime":"2020-02-25T01:56:00.000Z","lastUpdateTime":"2020-02-25T01:56:00.000Z","auth":2,"uid":"bd-657564173","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.4.0","versionCreateTime":"2020-02-25T02:24:37.000Z","code":"var graph = {\r\n    nodes: [{\r\n            \"name\": \"客户A\",\r\n            \"value\": [\r\n                \"高管\",\r\n                \"\"\r\n            ],\r\n            \"category\": \"高信誉白名单\",\r\n            \"symbolSize\": 50,\r\n            \"tooltip\": {\r\n                \"formatter\": \"{b0}:{c0}\"\r\n            }\r\n        },\r\n        {\r\n            \"name\": \"客户B\",\r\n            \"category\": \"白名单\",\r\n            \"value\": [\r\n                \"员工\",\r\n                \"\"\r\n            ],\r\n            \"symbolSize\": 20,\r\n            \"tooltip\": {\r\n                \"formatter\": \"{b0}:{c0}\"\r\n            }\r\n        },\r\n        {\r\n            \"name\": \"客户C\",\r\n            \"category\": \"黑名单\",\r\n            \"value\": [\r\n                \"员工\",\r\n                \"\"\r\n            ],\r\n            \"symbolSize\": 50\r\n        },\r\n\r\n        {\r\n            \"name\": \"客户D\",\r\n            \"category\": \"白名单\",\r\n            \"value\": [\r\n                \"控股人\",\r\n                \"\"\r\n            ],\r\n            \"symbolSize\": 50,\r\n            \"tooltip\": {\r\n                \"formatter\": \"{b0}:{c0}\"\r\n            }\r\n        },\r\n        {\r\n            \"name\": \"客户E\",\r\n            \"category\": \"白名单\",\r\n            \"symbolSize\": 20,\r\n            \"value\": [\r\n                \"股东\",\r\n            \r\n            ],\r\n            \"tooltip\": {\r\n                \"formatter\": \"{b0}:{c0}\"\r\n            }\r\n        },\r\n\r\n        {\r\n            \"name\": \"客户F\",\r\n            \"category\": \"白名单\",\r\n            \"symbolSize\": 50,\r\n            \"value\": [\r\n                \"白名单\",\r\n                \"员工 \"\r\n            ],\r\n        },\r\n        {\r\n            \"name\": \"客户O\",\r\n            \"category\": \"白名单\",\r\n            \"symbolSize\": 50,\r\n            \"value\": [\r\n                \"白名单\",\r\n                \"员工 \"\r\n            ],\r\n        },\r\n        {\r\n            \"name\": \"客户P\",\r\n            \"category\": \"白名单\",\r\n            \"symbolSize\": 50,\r\n            \"value\": [\r\n                \"白名单\",\r\n                \"员工 \"\r\n            ],\r\n        },\r\n        {\r\n            \"name\": \"客户G\",\r\n            \"category\": \"类别B\",\r\n            \"symbolSize\": 20,\r\n            \"value\": [\r\n                \"白名单\",\r\n                \"员工 \"\r\n            ],\r\n            \"tooltip\": {\r\n                \"formatter\": \"{b0}:{c0}\"\r\n            }\r\n        }\r\n\r\n\r\n    ],\r\n    links: [{\r\n            \"source\": \"客户A\",\r\n            \"target\": \"客户B\",\r\n            \"value\": '担保金额：1万'\r\n        },\r\n        {\r\n            \"source\": \"客户B\",\r\n            \"target\": \"客户C\",\r\n            \"value\": '持股比例：30%'\r\n        },\r\n        {\r\n            \"source\": \"客户A\",\r\n            \"target\": \"客户D\",\r\n            \"value\": ['担保金额：2万',\r\n            '持股比例：60%']\r\n        },\r\n\r\n\r\n        {\r\n            \"source\": \"客户A\",\r\n            \"target\": \"客户E\",\r\n            \"value\": '持股比例：10%'\r\n        },\r\n\r\n        {\r\n            \"source\": \"客户E\",\r\n            \"target\": \"客户F\",\r\n            \"value\": '持股比例：1%'\r\n        },\r\n\r\n        {\r\n            \"source\": \"客户C\",\r\n            \"target\": \"客户O\",\r\n            \"value\": '持股比例：1%'\r\n        },\r\n        {\r\n            \"source\": \"客户E\",\r\n            \"target\": \"客户P\",\r\n            \"value\": '持股比例：1%'\r\n        },\r\n        {\r\n            \"source\": \"客户D\",\r\n            \"target\": \"客户G\",\r\n            \"value\": '持股比例：1%'\r\n        }\r\n\r\n    ]\r\n};\r\nconst defaultCategory = \"高信誉白名单\";\r\nconst graphTitle = \"关系图\";\r\nconst currentGraph = {\r\n    nodes: {},\r\n    links: {},\r\n};\r\nconst nodeMap = {};\r\n// 页面加载时，第一次初始化图\r\nfunction init() {\r\n    // 根据定义的常量，产生currentGraph的默认数据\r\n    // 遍历全部nodes和links，产生node映射map\r\n    for (let i = 0; i < graph.nodes.length; i++) {\r\n        if (graph.nodes[i].category === defaultCategory) {\r\n            currentGraph.nodes[graph.nodes[i].name] = graph.nodes[i];\r\n        }\r\n        nodeMap[graph.nodes[i].name] = graph.nodes[i];\r\n        nodeMap[graph.nodes[i].name]['links'] = {};\r\n        nodeMap[graph.nodes[i].name]['nodes'] = {};\r\n        nodeMap[graph.nodes[i].name]['hasAppend'] = false;\r\n    }\r\n    for (let i = 0; i < graph.links.length; i++) {\r\n        let link = graph.links[i];\r\n        if (nodeMap[link.source] !== undefined && nodeMap[link.target] !== undefined) {\r\n            nodeMap[link.source].links[link.target] = link;\r\n            nodeMap[link.source].nodes[nodeMap[link.target].name] = nodeMap[link.target];\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < graph.nodes.length; i++) {\r\n        graph.nodes[i].itemStyle = null;\r\n        graph.nodes[i].label = {\r\n            normal: {\r\n                show: graph.nodes[i].symbolSize > 15\r\n            }\r\n        };\r\n    }\r\n    redrawGraph();\r\n}\r\n// 处理点击节点展开\r\nfunction append(nodeName) {\r\n    // 根据nodeName从nodeMap里拿出对应的nodes和links，并append到currentGraph.nodes currentGraph.links\r\n    let node = nodeMap[nodeName];\r\n    if (node.hasAppend === true || Object.keys(node.nodes).length === 0 || Object.keys(node.links).length === 0) {\r\n        alert(\"无法继续展开\");\r\n        return\r\n    }\r\n    Object.values(node.nodes).forEach(n => {\r\n        currentGraph.nodes[n.name] = n;\r\n    });\r\n    Object.values(node.links).forEach(l => {\r\n        currentGraph.links[l.source + \"_\" + l.target] = l;\r\n    });\r\n    node.hasAppend = true;\r\n    redrawGraph();\r\n}\r\n// 处理点击节点收缩\r\nfunction remove(nodeName) {\r\n    //根据nodeName从nodeMap里拿出对应的nodes和links，从currentGraph.nodes currentGraph.links删除当前节点的nodes和links并且递归\r\n    let node = nodeMap[nodeName];\r\n    Object.values(node.nodes).forEach(n => {\r\n        delete currentGraph.nodes[n.name];\r\n        if (n.hasAppend === true && Object.keys(n.nodes).length > 0) {\r\n            remove(n.name);\r\n        }\r\n    });\r\n    Object.values(node.links).forEach(l => {\r\n        delete currentGraph.links[l.source + '_' + l.target];\r\n    });\r\n    // 设置flag 等于false\r\n    node.hasAppend = false;\r\n\r\n    redrawGraph();\r\n}\r\n// 根据更新后的option重新画图\r\nfunction redrawGraph() {\r\n    option.series[0].data = Object.values(currentGraph.nodes);\r\n    option.series[0].links = Object.values(currentGraph.links);\r\n    console.log(option);\r\n    myChart.setOption(option);\r\n}\r\n\r\n\r\nvar categories = [{\r\n        name: '高信誉白名单',\r\n        itemStyle: {\r\n           color: '#10a050'\r\n        },\r\n    },\r\n    {\r\n        name: '白名单',\r\n        itemStyle: {\r\n            color: '#ff7d18'\r\n        },\r\n\r\n    },\r\n    {\r\n        name: '黑名单',\r\n        itemStyle: {\r\n            color: '#c23531'\r\n        },\r\n    }\r\n]\r\n\r\nconst option = {\r\n    title: {\r\n        text: graphTitle,\r\n        top: 'bottom',\r\n        left: 'center',\r\n    },\r\n    tooltip: {\r\n        show: true, // 默认显示\r\n        showContent: true, // 是否显示提示框浮层\r\n        trigger: 'item', // 触发类型，默认数据项触发\r\n        triggerOn: 'mousemove', // 提示触发条件，mousemove鼠标移至触发，还有click点击触发\r\n        alwaysShowContent: false, // 默认离开提示框区域隐藏，true为一直显示\r\n        showDelay: 100, // 浮层显示的延迟，单位为 ms，默认没有延迟，也不建议设置。在 triggerOn 为 'mousemove' 时有效。\r\n        hideDelay: 2000, // 浮层隐藏的延迟，单位为 ms，在 alwaysShowContent 为 true 的时候无效。\r\n        enterable: false, // 鼠标是否可进入提示框浮层中，默认为false，如需详情内交互，如添加链接，按钮，可设置为 true。\r\n        position: 'right', // 提示框浮层的位置，默认不设置时位置会跟随鼠标的位置。只在 trigger 为'item'的时候有效。\r\n        confine: false, // 是否将 tooltip 框限制在图表的区域内。\r\n        // 外层的 dom 被设置为 'overflow: hidden'，或者移动端窄屏，导致 tooltip 超出外界被截断时，此配置比较有用。\r\n        transitionDuration: 0.2, // 提示框浮层的移动动画过渡时间，单位是秒，设置为 0 的时候会紧跟着鼠标移动。\r\n    },\r\n    legend: {\r\n        left: 'left',\r\n        data: categories.map(x => x.name)\r\n    },\r\n    animation: false,\r\n    series: [{\r\n        type: 'graph',\r\n        layout: 'force',\r\n        // name: '客户信息:', // 系列名称，用于tooltip的显示，legend 的图例筛选，在 setOption 更新数据和配置项时用于指定对应的系列。\r\n        symbolSize: 48,\r\n        data: Object.values(currentGraph.nodes),\r\n        links: Object.values(currentGraph.links),\r\n        categories: categories,\r\n        roam: true,\r\n        itemStyle: {\r\n            normal: {\r\n                borderColor: '#fff',\r\n                borderWidth: 1,\r\n                shadowBlur: 10,\r\n                shadowColor: 'rgba(0, 0, 0, 0.3)'\r\n            }\r\n        },\r\n        label: {\r\n            position: 'inside',\r\n            formatter: '{b}'\r\n        },\r\n        focusNodeAdjacency: true, //是否在鼠标移到节点上的时候突出显示节\r\n        edgeSymbol: ['none', 'arrow'], //两端的标记类型\r\n        edgeLabel: {\r\n            normal: {\r\n                show: true,\r\n                textStyle: {\r\n                    fontSize: 10\r\n                },\r\n                formatter: \"{c}\"\r\n            }\r\n        },\r\n        lineStyle: {\r\n            color: 'target',\r\n            opacity: 0.6,\r\n            curveness: 0.3\r\n        },\r\n        emphasis: {\r\n            lineStyle: {\r\n                width: 5\r\n            }\r\n        },\r\n        force: {\r\n            layoutAnimation: false,\r\n            repulsion: 500\r\n        }\r\n    }]\r\n};\r\ninit();\r\nmyChart.on('click', function(params) {\r\n    if (params.dataType === \"node\") {\r\n        const node = nodeMap[params.data.name];\r\n        if (node.hasAppend === true) {\r\n            remove(node.name)\r\n        } else {\r\n            append(node.name);\r\n        }\r\n    }\r\n});","html":"","externalScripts":"","updaterUID":"bd-657564173","theme":"","layout":"","viewCount":140,"userName":"了***文","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xoSZSHG5J.png?v=1582597477420","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-graph","title","tooltip"],"customTags":[],"updaterUserName":"了***文"}}