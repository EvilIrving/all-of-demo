{"status":0,"data":{"cid":"xHytUpchHZ","authorUid":"bd-554080228","authorUserName":"t***0","title":"豆瓣近期活动","description":"豆瓣近期活动","latestVersion":1,"alwaysLatest":1,"createTime":"2017-07-19T08:50:24.000Z","lastUpdateTime":"2017-07-19T08:50:24.000Z","auth":2,"uid":"bd-554080228","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.6.2","versionCreateTime":"2017-07-19T08:50:24.000Z","code":"\tmyChart.showLoading();\n\tvar cityEvents = [];\n\tvar setData = (function() {\n\t    var option = {\n\t        title: {\n\t            text: '近期活动',\n\t            left: '50%',\n\t            textAlign: 'center'\n\t        },\n\t        tooltip: {\n\t            show: true\n\t        },\n\t        geo: {\n\t            map: 'china',\n\t            label: {\n\t                emphasis: {\n\t                    show: false\n\t                }\n\t            },\n\t            roam: true,\n\t            itemStyle: {\n\t                normal: {\n\t                    areaColor: '#093B47', //区域颜色\n\t                    borderColor: '#ffffff' //区域划分边框颜色\n\t                },\n\t                emphasis: {\n\t                    areaColor: '#093B47' //鼠标Havor颜色\n\t                }\n\t            }\n\t        },\n\t        series: [{\n\t            type: 'scatter',\n\t            coordinateSystem: 'geo',\n\t            data: [],\n\t            hoverAnimation: true,\n\t            label: {\n\t                normal: {\n\t                    formatter: '{b}',\n\t                    position: 'top',\n\t                    show: true\n\t                }\n\t            },\n\t            itemStyle: {\n\t                normal: {\n\t                    color: '#36D2FD',\n\t                    shadowBlur: 10,\n\t                    shadowColor: 'black'\n\t                }\n\t            },\n\t            tooltip: {\n\t                formatter: function(params) {\n\t                    console.warn(params);\n\t                    var event = params.data.value[2];\n\t                    return '<div>' + event.loc_name + ' - ' + event.title + '</div>' +\n\t                        '<div>' + event.address + '</div>' +\n\t                        '<div>' + event.begin_time + '</div>' +\n\t                        '<div>' + event.time_str + '</div>' +\n\t                        '<div>' + event.fee_str + '</div>';\n\t                }\n\t            },\n\t            zlevel: 1\n\t        }]\n\t    };\n\t    return function() {\n\t        var locs = [];\n\t        cityEvents.forEach(function(city) {\n\t            city.events.forEach(function(event) {\n\t                var loc = event.geo.split(' ');\n\t                locs.push({\n\t                    value: [loc[1], loc[0], event]\n\t                });\n\t            });\n\t        });\n\t        console.warn(locs);\n\t        option.series[0].data = locs;\n\t        myChart.hideLoading();\n\t        myChart.setOption(option);\n\t    }\n\t})();\n\t$.ajax({\n\t    type: \"GET\",\n\t    url: \"https://api.douban.com/v2/loc/list\",\n\t    dataType: \"jsonp\",\n\t    success: function(data) {\n\t        data.locs.forEach(function(item, index) {\n\t            $.ajax({\n\t                type: \"GET\",\n\t                url: \"https://api.douban.com/v2/event/list?loc=\" + item.id,\n\t                dataType: \"jsonp\",\n\t                success: function(eventData) {\n\t                    cityEvents.push({\n\t                        city: item.name,\n\t                        events: eventData.events\n\t                    });\n\t                    if (index === data.locs.length - 1) {\n\t                        console.warn(cityEvents);\n\t                        setData();\n\t                    }\n\t                },\n\t                error: function() {\n\t                    setData();\n\t                }\n\t            });\n\t        });\n\t    },\n\t    error: function() {\n\t        setData();\n\t    }\n\t});","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-554080228","theme":"","layout":"","viewCount":610,"userName":"t***0","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHytUpchHZ.png?v=1500454224946","isCustomThumbnail":0,"builtinTags":["category-work","geo","series-scatter","title","tooltip"],"customTags":[],"updaterUserName":"t***0"}}