{"status":0,"data":{"cid":"xLZLO6g9tT","authorUid":"bd-2083917125","authorUserName":"筱***5","title":"全国游客来源 [可点击]","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2020-11-05T08:29:33.000Z","lastUpdateTime":"2020-11-05T08:29:33.000Z","auth":2,"uid":"bd-2083917125","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.8.0","versionCreateTime":"2020-11-05T08:29:33.000Z","code":"$('<div class=\"back\">返 回</div>').appendTo(\n    $('#chart-panel')\n);\n\n$('.back').css({\n    'position': 'absolute',\n    'left': '25px',\n    'top': '25px',\n    'color': 'rgb(179, 239, 255)',\n    'font-size': '16px',\n    cursor: 'pointer',\n    'z-index': '100'\n})\n\n$('.back').click(function() {\n    if (parentInfo.length === 1) {\n        return;\n    }\n    myChart.showLoading()\n    parentInfo.pop()\n    getGeoJson(parentInfo[parentInfo.length - 1].code)\n})\n\n\n\nvar geoJson = {\n    features: []\n}\n\nvar parentInfo = [{\n    cityName: '全国',\n    level: 'china',\n    code: 100000\n}]\n\nvar timeTitle = ['10.1', '10.2', '10.3', '10.4', '10.5', '10.6', '10.7', '10.8']\ngetGeoJson(100000)\n\n\nfunction getGeoJson(adcode) {\n    AMapUI.loadUI(['geo/DistrictExplorer'], DistrictExplorer => {\n        var districtExplorer = new DistrictExplorer()\n        districtExplorer.loadAreaNode(adcode, function(error, areaNode) {\n            if (error) {javascript:;\n                console.error(error);\n                return;\n            }\n            let Json = areaNode.getSubFeatures()\n            if (Json.length > 0) {\n                geoJson.features = Json\n            } else if (Json.length === 0) {\n                geoJson.features = geoJson.features.filter(item => item.properties.adcode == adcode)\n                if (geoJson.features.length === 0) return\n            }\n            getMapData()\n        });\n    })\n}\n\n//获取数据    拼接，获取近五年的数据\nfunction getMapData() {\n     const mapData = [\n        {\n            \"name\": \"青海省\",\n            \"value\": 2983.3048524592427,\n            \"level\": \"province\",\n            \"cityCode\": 630000\n        }, {\n            \"name\": \"吉林省\",\n            \"value\": 2959.2463688315747,\n            \"level\": \"province\",\n            \"cityCode\": 220000\n        }, {\n            \"name\": \"黑龙江省\",\n            \"value\": 2959.178718812589,\n            \"level\": \"province\",\n            \"cityCode\": 230000\n        }, {\n            \"name\": \"贵州省\",\n            \"value\": 2858.6789806023394,\n            \"level\": \"province\",\n            \"cityCode\": 520000\n        }, {\n            \"name\": \"上海市\",\n            \"value\": 2843.096833606342,\n            \"level\": \"province\",\n            \"cityCode\": 310000\n        }, {\n            \"name\": \"江西省\",\n            \"value\": 2751.6483389204977,\n            \"level\": \"province\",\n            \"cityCode\": 360000\n        }, {\n            \"name\": \"山东省\",\n            \"value\": 2718.7679846534443,\n            \"level\": \"province\",\n            \"cityCode\": 370000\n        }, {\n            \"name\": \"湖南省\",\n            \"value\": 2532.564233676725,\n            \"level\": \"province\",\n            \"cityCode\": 430000\n        }, {\n            \"name\": \"安徽省\",\n            \"value\": 2409.668140637018,\n            \"level\": \"province\",\n            \"cityCode\": 340000\n        }, {\n            \"name\": \"北京市\",\n            \"value\": 2255.462183846231,\n            \"level\": \"province\",\n            \"cityCode\": 110000\n        }, {\n            \"name\": \"海南省\",\n            \"value\": 2173.1543156242155,\n            \"level\": \"province\",\n            \"cityCode\": 460000\n        }, {\n            \"name\": \"浙江省\",\n            \"value\": 2097.5994824633253,\n            \"level\": \"province\",\n            \"cityCode\": 330000\n        }, {\n            \"name\": \"天津市\",\n            \"value\": 1580.3501393263246,\n            \"level\": \"province\",\n            \"cityCode\": 120000\n        }, {\n            \"name\": \"新疆维吾尔自治区\",\n            \"value\": 1554.4750533682477,\n            \"level\": \"province\",\n            \"cityCode\": 650000\n        }, {\n            \"name\": \"西藏自治区\",\n            \"value\": 1551.4412913554345,\n            \"level\": \"province\",\n            \"cityCode\": 540000\n        }, {\n            \"name\": \"辽宁省\",\n            \"value\": 1274.1176670000025,\n            \"level\": \"province\",\n            \"cityCode\": 210000\n        }, {\n            \"name\": \"台湾省\",\n            \"value\": 1238.0339612705866,\n            \"level\": \"province\",\n            \"cityCode\": 710000\n        }, {\n            \"name\": \"湖北省\",\n            \"value\": 1096.4835151753957,\n            \"level\": \"province\",\n            \"cityCode\": 420000\n        }, {\n            \"name\": \"山西省\",\n            \"value\": 1091.9852147176646,\n            \"level\": \"province\",\n            \"cityCode\": 140000\n        }, {\n            \"name\": \"广东省\",\n            \"value\": 1080.453819241357,\n            \"level\": \"province\",\n            \"cityCode\": 440000\n        }, {\n            \"name\": \"河南省\",\n            \"value\": 1037.9121531812843,\n            \"level\": \"province\",\n            \"cityCode\": 410000\n        }, {\n            \"name\": \"福建省\",\n            \"value\": 880.5542725330653,\n            \"level\": \"province\",\n            \"cityCode\": 350000\n        }, {\n            \"name\": \"四川省\",\n            \"value\": 680.1758456201347,\n            \"level\": \"province\",\n            \"cityCode\": 510000\n        }, {\n            \"name\": \"云南省\",\n            \"value\": 577.1151680087661,\n            \"level\": \"province\",\n            \"cityCode\": 530000\n        }, {\n            \"name\": \"宁夏回族自治区\",\n            \"value\": 564.3971876251948,\n            \"level\": \"province\",\n            \"cityCode\": 640000\n        }, {\n            \"name\": \"甘肃省\",\n            \"value\": 439.0259400077368,\n            \"level\": \"province\",\n            \"cityCode\": 620000\n        }, {\n            \"name\": \"河北省\",\n            \"value\": 419.7815882423199,\n            \"level\": \"province\",\n            \"cityCode\": 130000\n        }, {\n            \"name\": \"陕西省\",\n            \"value\": 375.3413856375156,\n            \"level\": \"province\",\n            \"cityCode\": 610000\n        }, {\n            \"name\": \"澳门特别行政区\",\n            \"value\": 155.79857787302132,\n            \"level\": \"province\",\n            \"cityCode\": 820000\n        }, {\n            \"name\": \"内蒙古自治区\",\n            \"value\": 73.30315291206003,\n            \"level\": \"province\",\n            \"cityCode\": 150000\n        }, {\n            \"name\": \"江苏省\",\n            \"value\": 50.730242810774094,\n            \"level\": \"province\",\n            \"cityCode\": 320000\n        }, {\n            \"name\": \"香港特别行政区\",\n            \"value\": 34.46993969299128,\n            \"level\": \"province\",\n            \"cityCode\": 810000\n        }, {\n            \"name\": \"广西壮族自治区\",\n            \"value\": 14.17476652327565,\n            \"level\": \"province\",\n            \"cityCode\": 450000\n        }, {\n            \"name\": \"重庆市\",\n            \"value\": 0.8685779809038952,\n            \"level\": \"province\",\n            \"cityCode\": 500000\n        }\n    ]\n    const sum = 111111\n    const pointData = [{\n        \"name\": \"北京市\",\n        \"value\": [116.405285, 39.904989, 1286.2885765930978],\n        \"cityCode\": 110000\n    }, {\n        \"name\": \"天津市\",\n        \"value\": [117.190182, 39.125596, 1438.1524781957098],\n        \"cityCode\": 120000\n    }, {\n        \"name\": \"河北省\",\n        \"value\": [114.502461, 38.045474, 1616.412384315042],\n        \"cityCode\": 130000\n    }, {\n        \"name\": \"山西省\",\n        \"value\": [112.549248, 37.857014, 871.2879620328589],\n        \"cityCode\": 140000\n    }, {\n        \"name\": \"内蒙古自治区\",\n        \"value\": [111.670801, 40.818311, 2408.624788163257],\n        \"cityCode\": 150000\n    }, {\n        \"name\": \"辽宁省\",\n        \"value\": [123.429096, 41.796767, 2900.75270134033],\n        \"cityCode\": 210000\n    }, {\n        \"name\": \"吉林省\",\n        \"value\": [125.3245, 43.886841, 1437.095494033697],\n        \"cityCode\": 220000\n    }, {\n        \"name\": \"黑龙江省\",\n        \"value\": [126.642464, 45.756967, 2142.2714831906674],\n        \"cityCode\": 230000\n    }, {\n        \"name\": \"上海市\",\n        \"value\": [121.472644, 31.231706, 2690.8121695012296],\n        \"cityCode\": 310000\n    }, {\n        \"name\": \"江苏省\",\n        \"value\": [118.767413, 32.041544, 90.1037448387092],\n        \"cityCode\": 320000\n    }, {\n        \"name\": \"浙江省\",\n        \"value\": [120.153576, 30.287459, 2805.927176075527],\n        \"cityCode\": 330000\n    }, {\n        \"name\": \"安徽省\",\n        \"value\": [117.283042, 31.86119, 1033.9567749510265],\n        \"cityCode\": 340000\n    }, {\n        \"name\": \"福建省\",\n        \"value\": [119.306239, 26.075302, 2661.944864907178],\n        \"cityCode\": 350000\n    }, {\n        \"name\": \"江西省\",\n        \"value\": [115.892151, 28.676493, 1884.3595178046317],\n        \"cityCode\": 360000\n    }, {\n        \"name\": \"山东省\",\n        \"value\": [117.000923, 36.675807, 2354.2444264349806],\n        \"cityCode\": 370000\n    }, {\n        \"name\": \"河南省\",\n        \"value\": [113.665412, 34.757975, 2561.0729188262058],\n        \"cityCode\": 410000\n    }, {\n        \"name\": \"湖北省\",\n        \"value\": [114.298572, 30.584355, 2020.0464532115154],\n        \"cityCode\": 420000\n    }, {\n        \"name\": \"湖南省\",\n        \"value\": [112.982279, 28.19409, 393.0939464512297],\n        \"cityCode\": 430000\n    }, {\n        \"name\": \"广东省\",\n        \"value\": [113.280637, 23.125178, 2341.8961608335626],\n        \"cityCode\": 440000\n    }, {\n        \"name\": \"广西壮族自治区\",\n        \"value\": [108.320004, 22.82402, 1971.3160894719774],\n        \"cityCode\": 450000\n    }, {\n        \"name\": \"海南省\",\n        \"value\": [110.33119, 20.031971, 667.9173732191856],\n        \"cityCode\": 460000\n    }, {\n        \"name\": \"重庆市\",\n        \"value\": [106.504962, 29.533155, 424.91008227581204],\n        \"cityCode\": 500000\n    }, {\n        \"name\": \"四川省\",\n        \"value\": [104.065735, 30.659462, 488.9481808365865],\n        \"cityCode\": 510000\n    }, {\n        \"name\": \"贵州省\",\n        \"value\": [106.713478, 26.578343, 2410.221845388686],\n        \"cityCode\": 520000\n    }, {\n        \"name\": \"云南省\",\n        \"value\": [102.712251, 25.040609, 726.5999979582824],\n        \"cityCode\": 530000\n    }, {\n        \"name\": \"西藏自治区\",\n        \"value\": [91.132212, 29.660361, 2208.6740655369986],\n        \"cityCode\": 540000\n    }, {\n        \"name\": \"陕西省\",\n        \"value\": [108.948024, 34.263161, 1736.7350174435087],\n        \"cityCode\": 610000\n    }, {\n        \"name\": \"甘肃省\",\n        \"value\": [103.823557, 36.058039, 896.2127177839492],\n        \"cityCode\": 620000\n    }, {\n        \"name\": \"青海省\",\n        \"value\": [101.778916, 36.623178, 2729.7735894888438],\n        \"cityCode\": 630000\n    }, {\n        \"name\": \"宁夏回族自治区\",\n        \"value\": [106.278179, 38.46637, 1146.2827101631633],\n        \"cityCode\": 640000\n    }, {\n        \"name\": \"新疆维吾尔自治区\",\n        \"value\": [87.617733, 43.792818, 1204.9773707295383],\n        \"cityCode\": 650000\n    }, {\n        \"name\": \"台湾省\",\n        \"value\": [121.509062, 25.044332, 2016.1856418414018],\n        \"cityCode\": 710000\n    }, {\n        \"name\": \"香港特别行政区\",\n        \"value\": [114.173355, 22.320048, 1152.1638602322766],\n        \"cityCode\": 810000\n    }, {\n        \"name\": \"澳门特别行政区\",\n        \"value\": [113.54909, 22.198951, 16.545942804256477],\n        \"cityCode\": 820000\n    }\n    ]\n    initEchartMap(mapData, pointData)\n}\n\n\n//渲染echarts\nfunction initEchartMap(mapData, pointData) {\n\n    //这里做个切换，全国的时候才显示南海诸岛  只有当注册的名字为china的时候才会显示南海诸岛\n    if (parentInfo.length === 1) {\n        echarts.registerMap('china', geoJson); //注册\n    } else {\n        echarts.registerMap('map', geoJson); //注册\n    }\n    const xData = [],\n        yData = []\n    var min = 1\n    var max = 10000\n    if (mapData.length === 1) {\n        min = 0\n    }\n    mapData.forEach(c => {\n        xData.unshift(c.name)\n        yData.unshift(c.value)\n    })\n    var options = {\n        backgroundColor: '#012248',\n        title: [{\n            left: 'center',\n            top: 10,\n            text: parentInfo[parentInfo.length - 1].cityName + '游客来源',\n            textStyle: {\n                color: 'rgb(179, 239, 255)',\n                fontSize: 16\n            },\n        },\n\n        ],\n\n        tooltip: {\n            trigger: 'axis',\n            axisPointer: {\n                type: 'shadow'\n            },\n        },\n        grid: {\n            right: '2%',\n            top: '12%',\n            bottom: '8%',\n            width: '20%'\n        },\n\n        geo: {\n            map: parentInfo.length === 1 ? 'china' : 'map',\n            zoom: 1.1,\n            roam: true,\n            center: parentInfo.length === 1 ? ['118.83531246', '32.0267395887'] : false,\n            tooltip: {\n                trigger: 'item',\n                formatter: (p) => {\n                    let val = p.value[2];\n                    if (window.isNaN(val)) {\n                        val = 0;\n                    }\n                    let txtCon =\n                        \"<div style='text-align:left'>\" + p.name + \":<br />销售额：\" + val + '万</div>';\n                    return txtCon;\n                }\n            },\n            label: {\n                normal: {\n                    show: true,\n                    color: \"rgb(249, 249, 249)\", //省份标签字体颜色\n                    formatter: p => {\n                        switch (p.name) {\n                            case '内蒙古自治区':\n                                p.name = \"内蒙古\"\n                                break;\n                            case '西藏自治区':\n                                p.name = \"西藏\"\n                                break;\n                            case '新疆维吾尔自治区':\n                                p.name = \"新疆\"\n                                break;\n                            case '宁夏回族自治区':\n                                p.name = \"宁夏\"\n                                break;\n                            case '广西壮族自治区':\n                                p.name = \"广西\"\n                                break;\n                            case '香港特别行政区':\n                                p.name = \"香港\"\n                                break;\n                            case '澳门特别行政区':\n                                p.name = \"澳门\"\n                                break;\n                            default:\n                                break;\n                        }\n                        return p.name;\n                    }\n                },\n                emphasis: {\n                    show: true,\n                    color: '#f75a00',\n                }\n            },\n            itemStyle: {\n                normal: {\n                    areaColor: '#24CFF4',\n                    borderColor: '#53D9FF',\n                    borderWidth: 1.3,\n                    shadowBlur: 15,\n                    shadowColor: 'rgb(58,115,192)',\n                    shadowOffsetX: 7,\n                    shadowOffsetY: 6,\n                },\n                emphasis: {\n                    areaColor: '#8dd7fc',\n                    borderWidth: 1.6,\n                    shadowBlur: 25,\n                }\n\n            },\n        },\n        visualMap: {\n            min: min,\n            max: max,\n            left: '3%',\n            bottom: '5%',\n            calculable: true,\n            seriesIndex: [0],\n            inRange: {\n                color: ['#24CFF4', '#2E98CA', '#1E62AC']\n            },\n            textStyle: {\n                color: '#24CFF4'\n            }\n        },\n        xAxis: {\n            type: 'value',\n            scale: true,\n            position: 'top',\n            boundaryGap: false,\n            splitLine: {\n                show: false\n            },\n            axisLine: {\n                show: true,\n                lineStyle: {\n                    color: '#455B77'\n                }\n            },\n            axisTick: {\n                show: false\n            },\n            axisLabel: {\n                margin: 2,\n                textStyle: {\n                    color: '#c0e6f9'\n                }\n            },\n        },\n        yAxis: {\n            type: 'category',\n            nameGap: 16,\n            axisLine: {\n                show: true,\n                lineStyle: {\n                    color: '#455B77'\n                }\n            },\n            axisTick: {\n                show: false,\n            },\n            axisLabel: {\n                interval: 0,\n                textStyle: {\n                    color: '#c0e6f9'\n                }\n            },\n            data: xData\n        },\n        series: [{\n            name: '游客来源',\n            type: 'map',\n            geoIndex: 0,\n            map: parentInfo.length === 1 ? 'china' : 'map',\n            roam: true,\n            zoom: 1.3,\n            tooltip: {\n                trigger: \"item\",\n                formatter: p => {\n                    let val = p.value;\n                    if (p.name == '南海诸岛') return\n                    if (window.isNaN(val)) {\n                        val = 0;\n                    }\n                    let txtCon =\n                        \"<div style='text-align:left'>\" + p.name + \":\" + val + '人</div>';\n                    return txtCon;\n                }\n            },\n            label: {\n                normal: {\n                    show: false,\n                },\n                emphasis: {\n                    show: false,\n                }\n            },\n            data: mapData,\n\n        }, {\n            name: '散点',\n            type: 'effectScatter',\n            coordinateSystem: 'geo',\n            rippleEffect: {\n                brushType: 'fill'\n            },\n            itemStyle: {\n                normal: {\n                    color: '#F4E925',\n                    shadowBlur: 10,\n                    shadowColor: '#333'\n                }\n            },\n            // data: pointData[item],\n            // symbolSize: 8,\n            symbolSize: function (val) {\n                let value = val[2]\n                if (value == max) {\n                    return 27\n                }\n                return 10\n            },\n            showEffectOn: 'render', //加载完毕显示特效\n        },\n            {\n                type: 'bar',\n                barGap: '-100%',\n                barCategoryGap: '60%',\n                itemStyle: {\n                    normal: {\n                        color: '#11AAFE'\n                    },\n                    emphasis: {\n                        show: false\n                    }\n                },\n                data: yData\n            }\n\n        ]\n    }\n\n    myChart.setOption(options , true)\n\n    myChart.hideLoading()\n    //点击前解绑，防止点击事件触发多次\n    myChart.off('click');\n    myChart.on('click', echartsMapClick);\n}\n\n//echarts点击事件\nfunction echartsMapClick(params) {\n    if (!params.data) {\n        return\n    } else {\n        //如果当前是最后一级，那就直接return\n        if (parentInfo[parentInfo.length - 1].code == params.data.cityCode) {\n            return\n        }\n        myChart.showLoading()\n        let data = params.data\n        parentInfo.push({\n            cityName: data.name,\n            level: data.level,\n            code: data.cityCode\n        })\n        getGeoJson(data.cityCode)\n    }\n}","html":"","externalScripts":"https://webapi.amap.com/maps?v=1.3&key=8cc0313a26ad1fd2d280a3f1a021862c&plugin=AMap.DistrictSearch,https://webapi.amap.com/maps?v=1.3&key=8cc0313a26ad1fd2d280a3f1a021862c,https://webapi.amap.com/ui/1.0/main.js,https://echarts.baidu.com/resource/echarts-gl-latest/dist/echarts-gl.min.js","updaterUID":"bd-2083917125","theme":"","layout":"","viewCount":785,"userName":"筱***5","commentCount":0,"starCount":14,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xLZLO6g9tT.png?v=1604564973390","isCustomThumbnail":0,"builtinTags":["category-work","geo","grid","series-bar","series-effectScatter","series-map","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"筱***5"}}