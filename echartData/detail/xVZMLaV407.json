{"status":0,"data":{"cid":"xVZMLaV407","authorUid":"bd-540836030","authorUserName":"霸***y","title":"分段矩形树图","description":"三段式矩形树图","latestVersion":3,"alwaysLatest":1,"createTime":"2021-11-02T02:58:32.000Z","lastUpdateTime":"2021-11-02T08:02:35.000Z","auth":2,"uid":"bd-540836030","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"5.2.2","versionCreateTime":"2021-11-02T08:02:35.000Z","code":"/*\n重点代码：\n\nseries配置里面\nleft: \"70%\",\nwidth:\"31.5%\",\n// right: \"0%\",\n\nlet arr = e.data.data || e.data.children; tooltip时需要注意item的取值\n*/\n\n// convert #hex notation to rgb array\nvar parseColor = function (hexStr) {\n    return hexStr.length === 4 ? hexStr.substr(1).split('')\n              .map(function (s) {\n                  return 0x11 * parseInt(s, 16);\n              })\n        : [hexStr.substr(1, 2), hexStr.substr(3, 2), hexStr.substr(5, 2)].map(function (s) {\n              return parseInt(s, 16);\n          });\n};\n// zero-pad 1 digit to 2\nvar pad = function (s) {\n    return s.length === 1 ? '0' + s : s;\n};\n// console.log(gradientColors('#00ff00', '#ff0000', 100));\n// console.log(gradientColors('#000', '#fff', 100, 2.2));\n// 两个颜色之间的渐变色值\nvar gradientColors = function (start, end, steps, gamma) {\n    var i,j,ms,me,output = [],so = [];\n    gamma = gamma || 1;\n    var normalize = function (channel) {\n        return Math.pow(channel / 255, gamma);\n    };\n    start = parseColor(start).map(normalize);\n    end = parseColor(end).map(normalize);\n    for (i = 0; i < steps; i++) {\n        ms = i / (steps - 1);\n        me = 1 - ms;\n        for (j = 0; j < 3; j++) {\n            so[j] = pad(Math.round(Math.pow(start[j] * me + end[j] * ms, 1 / gamma) * 255).toString(16));\n        }\n        output.push('#' + so.join(''));\n    }\n    return output;\n};\n\nfunction getData(param){\n    let {\n        len = 100\n    } = param;\n    let arr = [];\n    let ColorArr = gradientColors('#0BE6FF', '#0E58F8', len);\n    let signIndex = 10+Math.ceil(Math.random()*20);\n    console.log(\"52 signIndex\",signIndex);\n    for (let i = 0; i < len; i++) {\n        let itemStyle = {\n            // colorAlpha:[0.3, 0.5],// 渐变色,结合option的color一起使用\n            // colorSaturation:  0.03+0.04*i,// 渐变色,结合option的color一起使用\n            color: ColorArr[i],\n            borderWidth: 0.5,\n            borderColor: '#121E35',\n        };\n        i == signIndex && (itemStyle.color = '#FFF400'); // 设置特殊颜色\n        arr.push({\n            name: 'name' + i,\n            value: [10, i],\n            itemStyle,\n            data: [\n                { name: 'test1', num: '1.71', status: 'top', baseNum: 1.6 },\n                { name: 'test2', num: '1.71', status: 'top', baseNum: 1.6 },\n                { name: 'test3', num: '1.71', status: 'top', baseNum: 1.6 },\n                { name: 'test4', num: '1.71', status: 'top', baseNum: 1.6 },\n            ],\n        });\n    }\n    return arr.reverse();\n}\n\nfunction initChart(){\n    let arr = getData({\n        //len:120+Math.ceil(Math.random()*200),\n        len:810\n    })\n    arr = arr.reverse();\n    let arr1 = arr.slice(0,270);\n    let arr2 = arr.slice(270,540);\n    let arr3 = arr.slice(540,810);\n    // 分模块的数据显示是从右到左，所以要进行一下翻转\n    // 在实际工作中自己注意数据顺序\n    arr1 = arr1.reverse();\n    arr2 = arr2.reverse();\n    arr3 = arr3.reverse();\n    \n    let h = 'CMI';\n    var option = {\n        backgroundColor: '#121E35',\n        leafDepth: false, // 是否可以下钻\n        title:[\n            {\n                text: h + \">1.5\",\n                textStyle: {\n                    color: \"#fff\",\n                    fontSize: 15\n                },\n                left: \"12%\",\n                bottom: -3\n            }, \n            {\n                text: \"0.8\\u2264\" + h + \"\\u22641.5\",\n                textStyle: {\n                    color: \"#fff\",\n                    fontSize: 15\n                },\n                right: \"41%\",\n                bottom: -3\n            }, {\n                text: h + \"<0.8\",\n                textStyle: {\n                    color: \"#fff\",\n                    fontSize: 15\n                },\n                right: \"13%\",\n                bottom: -3\n            },\n        ],\n        tooltip: {\n            backgroundColor: '#222',\n            padding: 5,\n            borderColor: '#222',\n            borderRadius: 8,\n            appendToBody: true, // position锁死了状态,且父元素不能overflow:hidden\n            // position: (point) => [point[0] + 5, point[1] + 5],\n            textStyle: {\n                align: 'left',\n            },\n            formatter: function (e) {\n                console.log(103,e);\n                if (!e.data.name) return '';\n                let html = '';\n                let arr = e.data.data || e.data.children;\n                arr.forEach((item) => {\n                    html += `<div>${item.name}--${item.num}--${item.status}--${item.baseNum}</div>`;\n                });\n                return `\n                        <div style=\"min-height:32px;line-height:32px;font-size: 16px;color:#fff;text-indent:9px;border-bottom: 1px solid #B3BFD2;\">${e.data.name}</div>\n                        ${html}\n                      `;\n            },\n        },\n        series: [\n            {\n                name:'treemap1',\n                type: 'treemap',\n                top: 0,\n                bottom: 40,\n                left: \"0%\",\n                width:'31.5%',\n                // right: \"70%\",\n                roam: false, // 关闭平移和缩放\n                nodeClick: false,\n                breadcrumb: false, //不显示当前节点\n                label: false,\n                itemStyle: {\n                    show: true,\n                    borderWidth: 1,\n                    borderColor: '#202C4C',\n                },\n                emphasis: {\n                    itemStyle: {\n                        color: '#FFF400',\n                    },\n                },\n                data: arr1,\n            },\n            {\n                name:'treemap2',\n                type: 'treemap',\n                top: 0,\n                bottom: 40,\n                left: \"34.25%\",\n                width:'31.5%',\n                // right: \"0%\",\n                roam: false, // 关闭平移和缩放\n                nodeClick: false,\n                breadcrumb: false, //不显示当前节点\n                label: false,\n                itemStyle: {\n                    show: true,\n                    borderWidth: 1,\n                    borderColor: '#202C4C',\n                },\n                emphasis: {\n                    itemStyle: {\n                        color: '#FFF400',\n                    },\n                },\n                data: arr2,\n            },\n            {\n                name:'treemap3',\n                type: 'treemap',\n                top: 0,\n                bottom: 40,\n                left: \"70%\",\n                width:\"31.5%\",\n                // right: \"0%\",\n                roam: false, // 关闭平移和缩放title\n                nodeClick: false,\n                breadcrumb: false, //不显示当前节点\n                label: false,\n                itemStyle: {\n                    show: true,\n                    borderWidth: 1,\n                    borderColor: '#202C4C',\n                },\n                emphasis: {\n                    itemStyle: {\n                        color: '#FFF400',\n                    },\n                },\n                data: arr3,\n            },\n        ],\n    };\n    myChart.setOption(option,{\n        notMerge:true,\n        lazyUpdate:false\n    })\n}\ninitChart();\n\n// setInterval(function() {\n//     initChart();\n// }, 2000);\n\n// myChart.on(\"click\",e => {\n//   console.log(e);\n//   signIndex = e.data.value[1];\n// })\n/*\n还有一种方案是：\noption.color = ['yellowgreen'] // 固定一种颜色\nlet itemStyle = {\n    //colorAlpha:[0.3, 0.5],// 渐变色,结合option的color一起使用\n    colorSaturation:  0.03+0.04*i,// 渐变色,结合option的color一起使用\n    borderWidth: 0.5,\n    borderColor: '#121E35',\n}\n*/\n","html":"","externalScripts":"","updaterUID":"bd-540836030","theme":"","layout":"","viewCount":0,"userName":"霸***y","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xVZMLaV407.png?v=1635840155173","isCustomThumbnail":0,"builtinTags":["category-work","series-treemap","tooltip"],"customTags":["多","矩形","矩形树图"],"updaterUserName":"霸***y"}}