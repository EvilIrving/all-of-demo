{"status":0,"data":{"cid":"xByrU4aD5b","authorUid":"bd-662148189","authorUserName":"非***农","title":"扫雷","description":"扫雷","latestVersion":5,"alwaysLatest":1,"createTime":"2017-09-14T08:56:45.000Z","lastUpdateTime":"2017-09-14T09:17:07.000Z","auth":2,"uid":"bd-662148189","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"3.7.1","versionCreateTime":"2017-09-14T09:15:44.000Z","code":"var markUrl = \"/asset/get/s/data-1502962358603-HkJ6fkX_b.png\";\n\nvar xDotCnt = 20;\nvar yDotCnt = 16;\nvar mineCnt = 50;\nvar markedCnt = 0;\nvar startTime = null;\n\nvar mines = [];\nvar isMarking = false;\n\nvar series = [{\n    name: 'isNotOpen',\n    type: 'scatter',\n    symbol: 'rect',\n    symbolSize: 23,\n    data: [],\n    itemStyle: {\n        normal: {\n            color: '#c0c0c0',\n            shadowColor: '#747474',\n            shadowOffsetX: 3,\n            shadowOffsetY: 3\n        }\n    }\n}, {\n    name: 'mines',\n    type: 'scatter',\n    symbol: 'path://M1.04147922,4 C1.11795272,3.5441717 1.29721854,3.12319909 1.55462604,2.76173282 L0.818019485,2.02512627 L1.52512627,1.31801948 L2.26173282,2.05462604 C2.62319909,1.79721854 3.0441717,1.61795272 3.5,1.54147922 L3.5,0.5 L4.5,0.5 L4.5,1.54147922 C4.9558283,1.61795272 5.37680091,1.79721854 5.73826718,2.05462604 L6.47487373,1.31801948 L7.18198052,2.02512627 L6.44537396,2.76173282 C6.70278146,3.12319909 6.88204728,3.5441717 6.95852078,4 L8,4 L8,5 L6.95852078,5 C6.88204728,5.4558283 6.70278146,5.87680091 6.44537396,6.23826718 L7.18198052,6.97487373 L6.47487373,7.68198052 L5.73826718,6.94537396 C5.37680091,7.20278146 4.9558283,7.38204728 4.5,7.45852078 L4.5,8.5 L3.5,8.5 L3.5,7.45852078 C3.0441717,7.38204728 2.62319909,7.20278146 2.26173282,6.94537396 L1.52512627,7.68198052 L0.818019485,6.97487373 L1.55462604,6.23826718 C1.29721854,5.87680091 1.11795272,5.4558283 1.04147922,5 L0,5 L0,4 L1.04147922,4 Z M3,5 C3.55228475,5 4,4.55228475 4,4 C4,3.44771525 3.55228475,3 3,3 C2.44771525,3 2,3.44771525 2,4 C2,4.55228475 2.44771525,5 3,5 Z',\n    symbolSize: [16, 16],\n    data: [],\n    itemStyle: {\n        normal: {\n            color: '#000'\n        }\n    },\n    z: 10\n}, {\n    type: 'scatter',\n    name: 'marker',\n    data: [],\n    symbol: 'image://' + markUrl,\n    symbolSize: 20,\n    z: 100\n}];\n\nvar numColors = ['#0B02B7', '#147A14', '#B61A1D', '#0A0677',\n    '#6A030C', '#187C79', '#000', '#7A7A7A'];\nfor (var i = -1; i < numColors.length; ++i) {\n    series.push({\n        name: 'isOpen-' + (i + 1),\n        type: 'scatter',\n        symbol: 'rect',\n        symbolSize: 24,\n        data: [],\n        itemStyle: {\n            normal: {\n                color: '#ccc'\n            }\n        },\n        label: {\n            normal: {\n                show: true,\n                formatter: function (param) {\n                    return param.data[2] || '';\n                },\n                textStyle: {\n                    color: numColors[i]\n                }\n            }\n        },\n        z: 5\n    });\n}\nseries.push({\n    type: 'scatter',\n    name: '标记',\n    data: []\n});\n\noption = {\n    grid: {\n        width: 500,\n        height: 500,\n        top:50,\n        left: 0,\n        backgroundColor: '#eee',\n        borderColor: '#fefefe',\n        show: true\n    },\n    xAxis: {\n        min: -0.5,\n        max: xDotCnt - 0.5,\n        type: 'value',\n        show: false\n    },\n    yAxis: {\n        min: -0.5,\n        max: yDotCnt - 0.5,\n        type: 'value',\n        inverse: true,\n        show: false\n    },\n    series: series,\n    title: [{\n        text: '扫雷 ——'\n    }, {\n        text: '剩余雷数：' + mineCnt,\n        top: 0,\n        left: 85\n    }],\n    animation: false,\n    legend: {\n        show: true,\n        itemWidth: 25,\n        itemHeight: 25,\n        left: 300,\n        data: [{\n            name: '标记',\n            icon: 'image://' + markUrl\n        }],\n        selected: {\n            '标记': false\n        }\n    }\n};\n\nsetTimeout(function() {\n    mines = initMines();\n    setOption();\n}, 0);\n\nvar btn = document.createElement('button');\nbtn.style.position = 'absolute';\nbtn.style.top = '15px';\nbtn.style.left = '430px';\nbtn.style.marginLeft = '10px';\nbtn.setAttribute('onclick', 'restart()');\nbtn.innerHTML = '重新开始';\ndocument.body.appendChild(btn);\n\nmyChart.on('click', function (param) {\n    var x = param.data[0];\n    var y = param.data[1];\n    \n    if (isMarking) {\n        var s = series[2];\n        var hasMarked = false;\n        console.log(s.data);\n        for (var i = 0, len = s.data.length; i < len; ++i) {\n            if (s.data[i][0] === x && s.data[i][1] === y) {\n                // Unmark\n                s.data[i] = '-';\n                hasMarked = true;\n                mines[y][x].isMarked = false;\n                --markedCnt;\n                break;\n            }\n        }\n        \n        if (!hasMarked && !mines[y][x].isOpen) {\n            // Mark\n            s.data.push([x, y]);\n            mines[y][x].isMarked = true;\n            ++markedCnt;\n        }\n        \n        myChart.setOption({\n            series: s,\n            title: [{\n            }, {\n                text: '剩余雷数：' + (mineCnt - markedCnt)\n            }]\n        });\n    }\n    else {\n        var mine = mines[y][x];\n        if (mine.isMarked) {\n            // Do nothing when click on marked mine\n            return;\n        }\n        if (mine.isMine) {\n            gameOver(x, y);\n        }\n        else {\n            clearSeries();\n            open(x, y);\n            setOption();\n            checkWin();\n        }\n    }\n});\n\nmyChart.on('legendselectchanged', function (e) {\n    isMarking = e.selected['标记'];\n});\n\n\nfunction open(x, y) {\n    if (!startTime) {\n        startTime = new Date();\n    }\n    \n    var mine = mines[y][x];\n    if (!mine.isOpen) {\n        mine.isOpen = true;\n        \n        if (mine.mineNeighbors === 0) {\n            // Open neighbors\n            if (x > 0) {\n                open(x - 1, y);\n                if (y > 0) {\n                    open(x - 1, y - 1);\n                }\n                if (y < yDotCnt - 1) {\n                    open(x - 1, y + 1);\n                }\n            }\n            if (y > 0) {\n                open(x, y - 1);\n            }\n            if (y < yDotCnt - 1) {\n                open(x, y + 1);\n            }\n            if (x < xDotCnt - 1) {\n                open(x + 1, y);\n                if (y > 0) {\n                    open(x + 1, y - 1);\n                }\n                if (y < yDotCnt - 1) {\n                    open(x + 1, y + 1);\n                }\n            }\n        }\n    }\n}\n\nfunction gameOver(x, y) {\n    // Show mines series\n    var mineData = [];\n    for (var j = 0; j < yDotCnt; ++j) {\n        for (var i = 0; i < xDotCnt; ++i) {\n            if (mines[j][i].isMine) {\n                mineData.push([i, j]);\n            }\n        }\n    }\n    series[1].data = mineData;\n    \n    if (x !== null) {\n        // Set backgroundColor of (x, y) to be red\n        var data = getSeries(mines[y][x].mineNeighbors).data;\n        data.push({\n            value: [x, y],\n            itemStyle: {\n                normal: {\n                    color: '#f00'\n                }\n            }\n        });\n    }\n    \n    myChart.setOption({\n        series: series\n    });\n}\n\nwindow.restart = function () {\n    initMines();\n    setOption();\n    \n    series[2].data = [];\n    \n    isMarking = false;\n    markedCnt = 0;\n    startTime = null;\n    \n    myChart.setOption({\n        series: series,\n        legend: {\n            selected: {\n                '标记': false\n            }\n        },\n        title: [{\n        }, {\n            text: '剩余雷数：' + mineCnt\n        }]\n    })\n};\n\nfunction initMines() {\n    mines = [];\n    for (var y = 0; y < yDotCnt; ++y) {\n        var line = [];\n        for (var x = 0; x < xDotCnt; ++x) {\n            line.push({\n                isMine: false,\n                isOpen: false,\n                mineNeighbors: 0\n            });\n        }\n        mines.push(line);\n    }\n    \n    for (var i = 0; i < mineCnt; ++i) {\n        var x = Math.ceil(Math.random() * xDotCnt) - 1;\n        var y = Math.ceil(Math.random() * yDotCnt) - 1;\n        if (mines[y][x].isMine) {\n            // Reassign the same mine\n            --i;\n            continue;\n        }\n        \n        mines[y][x].isMine = true;\n        if (x > 0) {\n            ++mines[y][x - 1].mineNeighbors;\n            if (y > 0) {\n                ++mines[y - 1][x - 1].mineNeighbors;\n            }\n            if (y < yDotCnt - 1) {\n                ++mines[y + 1][x - 1].mineNeighbors;\n            }\n        }\n        if (y > 0) {\n            ++mines[y - 1][x].mineNeighbors;\n        }\n        if (y < yDotCnt - 1) {\n            ++mines[y + 1][x].mineNeighbors;\n        }\n        if (x < xDotCnt - 1) {\n            ++mines[y][x + 1].mineNeighbors;\n            if (y > 0) {\n                ++mines[y - 1][x + 1].mineNeighbors;\n            }\n            if (y < yDotCnt - 1) {\n                ++mines[y + 1][x + 1].mineNeighbors;\n            }\n        }\n    }\n    return mines;\n}\n\n\nfunction setOption() {\n    clearSeries();\n    var notOpenData = series[0].data;\n    \n    for (var y = 0; y < yDotCnt; ++y) {\n        for (var x = 0; x < xDotCnt; ++x) {\n            var mine = mines[y][x];\n            if (mine.isOpen) {\n                var data = getSeries(mine.mineNeighbors).data;\n                data.push([x, y, mine.mineNeighbors]);\n            }\n            else {\n                notOpenData.push([x, y]);\n            }\n        }\n    }\n    \n    myChart.setOption({\n        series: series\n    });\n}\n\nfunction clearSeries() {\n    for (var i = 0; i < series.length; ++i) {\n        if (i === 2) {\n            continue;\n        }\n        series[i].data = [];\n    }\n}\n\nfunction getSeries(neighbors) {\n    return series[3 + neighbors];\n}\n\nfunction checkWin() {\n    var isWin = true;\n    for (var i = 0; i < xDotCnt && isWin; ++i) {\n        for (var j = 0; j < yDotCnt; ++j) {\n            var mine = mines[j][i];\n            if (!mine.isMine && !mine.isOpen) {\n                console.log(i, j, mine);\n                isWin = false;\n                break;\n            }\n        }\n    }\n    if (isWin) {\n        var end = new Date();\n        var sec = (end - startTime) / 1000;\n        alert('赢啦！用时 ' + sec + '秒，很不错哦！');\n        gameOver(null);\n    }\n}\n","html":"","externalScripts":"","updaterUID":"bd-662148189","theme":"default","layout":"","viewCount":701,"userName":"非***农","commentCount":1,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xByrU4aD5b.png?v=1505380628097","isCustomThumbnail":1,"builtinTags":["category-work","grid","legend","series-scatter","title"],"customTags":[],"updaterUserName":"非***农"}}