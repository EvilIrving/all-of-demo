{"status":0,"data":{"cid":"x-kQ2sct12","authorUid":"bd-3162399108","authorUserName":"188*****815","title":"项目进度表","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-07-07T07:50:30.000Z","lastUpdateTime":"2021-07-07T07:50:30.000Z","auth":2,"uid":"bd-3162399108","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.1.2","versionCreateTime":"2021-07-07T07:50:30.000Z","code":"// 指定图表的配置项和数据\n/**\n * 基本思路就是把分类名映射成数值\n */\n// 阶段分类与数值的映射\nvar phaseParent = [{\n        name: '方案制定阶段',\n        color: '#3b1a40',\n        order: 1,\n        children: [{\n                name: '收到业务需求',\n                order: 1\n            },\n            {\n                name: '需求评审',\n                order: 2\n            },\n            {\n                name: '提交建设方案',\n                order: 3\n            },\n        ]\n    },\n    {\n        name: '立项阶段',\n        color: '#463793',\n        order: 2,\n        children: [{\n                name: '建设方案评审',\n                order: 4\n            },\n            {\n                name: '立项决策会',\n                order: 5\n            },\n            {\n                name: '可研评审',\n                order: 6\n            },\n            {\n                name: '可研批复',\n                order: 7\n            },\n        ]\n    },\n    {\n        name: '采购准备阶段',\n        color: '#3c6df0',\n        order: 3,\n        children: [{\n                name: '采购材料编制提交',\n                order: 8\n            },\n            {\n                name: '采购材料评审',\n                order: 9\n            },\n            {\n                name: '采购预申请',\n                order: 10\n            },\n            {\n                name: '采购正式申请',\n                order: 11\n            },\n        ]\n    },\n    {\n        name: '采购发生阶段',\n        color: '#ffab18',\n        order: 4,\n        children: [{\n                name: '采购方案决策',\n                order: 12\n            },\n            {\n                name: '采购结果公布',\n                order: 13\n            },\n            {\n                name: '合同签订',\n                order: 14\n            },\n        ]\n    },\n    {\n        name: '设计阶段',\n        color: '#9dff6b',\n        order: 5,\n        children: [{\n            name: '设计批复',\n            order: 15\n        }, ]\n    },\n    {\n        name: '工程实施阶段',\n        color: '#7ed2c6',\n        order: 6,\n        children: [{\n                name: '项目开工',\n                order: 16\n            },\n            {\n                name: '设备到货',\n                order: 17\n            },\n            {\n                name: '设备安装',\n                order: 18\n            },\n            {\n                name: '需求分析',\n                order: 19\n            },\n            {\n                name: '系统设计',\n                order: 20\n            },\n            {\n                name: '开发阶段',\n                order: 21\n            },\n            {\n                name: '集成测试',\n                order: 22\n            },\n            {\n                name: '验收测试',\n                order: 23\n            },\n            {\n                name: '割接上线',\n                order: 24\n            },\n            {\n                name: '试运行',\n                order: 25\n            },\n            {\n                name: '竣工验收',\n                order: 26\n            },\n        ]\n    }\n];\nvar allSubPhase = [];\nfor (var i = 0; i < phaseParent.length; i++) {\n    var children = phaseParent[i].children;\n    for (var j = 0; j < children.length; j++) {\n        var child = children[j];\n        child.color = phaseParent[i].color;\n        allSubPhase.push(child)\n    }\n}\nvar all_phase_cnt = allSubPhase.length;\nvar projectPhase = [\n    ['收到业务需求', 'ERP集中化项目'],\n    ['需求评审', '430项目'],\n    ['建设方案评审', '可视化大屏项目'],\n    ['立项决策会', '资产管理系统扩容改造项目'],\n    ['项目开工', '大数据架构升级项目'],\n    ['收到业务需求', 'ERP集中化项目1'],\n    ['需求评审', '430项目2'],\n    ['建设方案评审', '可视化大屏项目3'],\n    ['立项决策会', '资产管理系统扩容改造项目4'],\n    ['合同签订', '大数据架构升级项目5'],\n    ['收到业务需求', 'ERP集中化项目7'],\n    ['需求评审', '430项目7'],\n];\nvar yData = projectPhase.map(data => data[1]);\n\n/**\n * 把数据的分类阶段转换成数值\n * @param arr\n * @returns {[]}\n */\nfunction getBarData(arr) {\n    var res = [];\n    for (var i = 0; i < arr.length; i++) {\n        var cur = arr[i];\n        for (var j = 0; j < allSubPhase.length; j++) {\n            if (cur[0] === allSubPhase[j].name) {\n                res.push([allSubPhase[j].order, cur[1]])\n                break;\n            }\n        }\n    }\n    return res;\n}\n\nfunction toPercent(decimal) {\n    return (decimal * 100).toFixed(4) + '%'\n}\n\nvar option = {\n    title: {\n        text: ''\n    },\n    tooltip: {\n        show: true,\n        formatter: function(params) {\n            if (params.seriesIndex > 0) {\n                return null;\n            }\n            const phaseOrder = params.data[0];\n            return params.data[1] + \"：\"\n                // 获取阶段名称\n                +\n                allSubPhase.find(phase => phaseOrder === phase.order).name;\n        }\n    },\n    grid: [{\n            top: 100,\n            bottom: 101,\n        },\n        // 展示一级阶段\n        {\n            height: 50,\n            top: 0\n        },\n        // 展示二级阶段\n        {\n            height: 50,\n            top: 50\n        },\n        // 第四个网格没有实际数据，仅用于辅助展示网格线\n        {\n            top: 100,\n            bottom: 101\n        },\n    ],\n    xAxis: [{\n            type: 'value',\n            position: 'top',\n            min: 0,\n            max: 26,\n            gridIndex: 0,\n            axisLabel: {\n                show: false\n            },\n            axisLine: {\n                show: false\n            },\n            splitLine: {\n                show: false,\n            },\n            axisTick: {\n                show: false\n            }\n        },\n        {\n            type: 'category',\n            position: 'top',\n            gridIndex: 1,\n            axisLine: {\n                show: false\n            },\n            zlevel: 1\n        },\n        {\n            type: 'category',\n            position: 'top',\n            gridIndex: 2,\n            axisLine: {\n                show: false\n            },\n            zlevel: 2\n        },\n        // 第四个网格没有实际数据，仅用于辅助展示网格线\n        {\n            type: 'category',\n            position: 'bottom',\n            gridIndex: 3,\n            data: allSubPhase.map(phase => phase.name),\n            zlevel: 0,\n            axisLabel: {\n                show: false\n            },\n            axisLine: {\n                show: false\n            },\n            splitLine: {\n                show: true,\n                interval: 0,\n                lineStyle: {\n                    type: 'dotted'\n                }\n            },\n            axisTick: {\n                show: false\n            }\n        }\n    ],\n    yAxis: [{\n            type: 'category',\n            gridIndex: 0,\n            data: yData,\n            axisLine: {\n                show: false,\n            },\n            axisTick: {\n                show: false\n            }\n        },\n        {\n            type: 'value',\n            gridIndex: 1,\n            axisLabel: {\n                show: false\n            },\n            axisLine: {\n                show: false\n            },\n            splitLine: {\n                show: false\n            },\n            axisTick: {\n                show: false\n            }\n        },\n        {\n            type: 'value',\n            gridIndex: 2,\n            axisLabel: {\n                show: false\n            },\n            axisLine: {\n                show: false\n            },\n            splitLine: {\n                show: false\n            },\n            axisTick: {\n                show: false\n            }\n        },\n        // 第四个网格没有实际数据，仅用于辅助展示网格线\n        {\n            type: 'value',\n            gridIndex: 3,\n            axisLabel: {\n                show: false\n            },\n            axisLine: {\n                show: false\n            },\n            splitLine: {\n                show: false\n            },\n            axisTick: {\n                show: false\n            }\n        },\n    ],\n    series: [{\n        type: 'bar',\n        data: getBarData(projectPhase),\n        xAxisIndex: 0,\n        yAxisIndex: 0,\n        itemStyle: {\n            normal: {\n                color: (params) => {\n                    let colors = ['#4150d8', '#28bf7e', '#ed7c2f', '#f2a93b', '#f9cf36', '#4a5bdc', '#4cd698', '#f4914e', '#fcb75b', '#ffe180', '#b6c2ff', '#96edc1']\n                    return colors[params.dataIndex]\n                }\n            }\n        },\n    }],\n};\n\n// 增加一级阶段\nfor (var i = 0; i < phaseParent.length; i++) {\n    option.series.push({\n        data: [{\n            name: phaseParent[i].name,\n            value: 1\n        }],\n        label: {\n            show: true,\n            position: 'inside',\n            formatter: '{b}',\n            textStyle: {\n                color: '#fff',\n                fontWeight: 'bold',\n            }\n        },\n        type: 'bar',\n        barGap: 0,\n        barWidth: toPercent(phaseParent[i].children.length / all_phase_cnt),\n        itemStyle: {\n            color: phaseParent[i].color,\n            borderColor: '#efefef',\n            borderWidth: 1,\n        },\n        xAxisIndex: 1,\n        yAxisIndex: 1\n    })\n}\n// 增加二级阶段\nfor (var i = 0; i < allSubPhase.length; i++) {\n    var curPhase = allSubPhase[i];\n    // 把二级阶段名分两行展示\n    var phaseName = curPhase.name;\n    var halfLen = phaseName.length / 2;\n    var showName = phaseName.substr(0, halfLen) + '\\n' + phaseName.substr(halfLen);\n    option.series.push({\n        data: [{\n            name: showName,\n            value: 1\n        }],\n        label: {\n            show: true,\n            position: 'inside',\n            formatter: '{b}',\n            textStyle: {\n                fontSize: 10,\n                lineHeight: 12,\n                color: '#fff',\n            }\n        },\n        type: 'bar',\n        barGap: 0,\n        barWidth: toPercent(1 / all_phase_cnt),\n        itemStyle: {\n            color: curPhase.color,\n            borderColor: '#efefef',\n            borderWidth: 1,\n        },\n        xAxisIndex: 2,\n        yAxisIndex: 2\n    })\n}","html":"","externalScripts":"","updaterUID":"bd-3162399108","theme":"","layout":"","viewCount":0,"userName":"188*****815","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x-kQ2sct12.png?v=1625644230679","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-bar","title","tooltip"],"customTags":[],"updaterUserName":"188*****815"}}