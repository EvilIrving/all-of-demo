{"status":0,"data":{"cid":"xrSfuXlW_q","authorUid":"bd-3951734745","authorUserName":"花***4","title":"地图柱状图结合","description":"","latestVersion":2,"alwaysLatest":1,"createTime":"2019-02-15T14:42:48.000Z","lastUpdateTime":"2019-02-15T14:42:48.000Z","auth":2,"uid":"bd-3951734745","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.2.1","versionCreateTime":"2019-02-15T14:45:23.000Z","code":"// 市区坐标\r\nvar geoCoordMap = {\r\n    \"北京市\": [116.41433, 39.91095],\r\n    \"天津市\": [117.191041, 39.134857],\r\n    \"河北省\": [114.511934, 38.058785],\r\n    \"山西省\": [112.543424, 37.887658],\r\n    \"内蒙古\": [111.694848, 40.836106],\r\n    \"辽宁省\": [123.425425, 41.819004],\r\n    \"吉林省\": [126.322646, 43.871432],\r\n    \"黑龙江省\": [128.60352, 47.758573],\r\n    \"上海市\": [121.477611, 31.226174],\r\n    \"江苏省\": [118.799398, 32.045042],\r\n    \"浙江省\": [120.158498, 30.291092],\r\n    \"安徽省\": [117.293119, 31.87839],\r\n    \"福建省\": [119.307623, 26.068211],\r\n    \"江西省\": [115.92252, 28.68553],\r\n    \"山东省\": [116.989563, 36.682589],\r\n    \"河南省\": [113.627458, 34.762387],\r\n    \"湖北省\": [114.305858, 30.605913],\r\n    \"湖南省\": [112.93296, 28.236376],\r\n    \"广东省\": [113.261811, 23.118408],\r\n    \"广西\": [108.326736, 22.824533],\r\n    \"海南省\": [110.290648, 20.012453],\r\n    \"重庆市\": [107.546798, 30.978004],\r\n    \"四川省\": [102.063163, 30.667561],\r\n    \"贵州省\": [106.661781, 27.609054],\r\n    \"云南省\": [102.702913, 25.050202],\r\n    \"西藏\": [88.112616, 31.668426],\r\n    \"陕西省\": [108.925798, 34.296079],\r\n    \"甘肃省\": [103.834346, 36.072614],\r\n    \"青海省\": [95.778449, 36.625145],\r\n    \"宁夏\": [106.230594, 38.490587],\r\n    \"新疆\": [83.61023, 40.83845],\r\n    \"台湾省\": [121.511849, 25.060677],\r\n    \"香港\": [114.179376, 22.318339],\r\n    \"澳门\": [113.546969, 22.202741]\r\n};\r\nvar rawData = {\r\n    \"北京市\": [10, 20, 30],\r\n    \"天津市\": [10, 20, 30],\r\n    \"河北省\": [10, 20, 30],\r\n    \"山西省\": [10, 20, 30],\r\n    \"内蒙古\": [10, 20, 30],\r\n    \"辽宁省\": [10, 20, 30],\r\n    \"吉林省\": [10, 20, 30],\r\n    \"黑龙江省\": [20, 50, 30],\r\n    \"上海市\": [10, 20, 30],\r\n    \"江苏省\": [10, 20, 30],\r\n    \"浙江省\": [10, 20, 30],\r\n    \"安徽省\": [10, 20, 30],\r\n    \"福建省\": [10, 20, 30],\r\n    \"江西省\": [10, 20, 30],\r\n    \"山东省\": [10, 20, 30],\r\n    \"河南省\": [10, 20, 30],\r\n    \"湖北省\": [10, 20, 30],\r\n    \"湖南省\": [10, 20, 30],\r\n    \"广东省\": [10, 20, 30],\r\n    \"广西\": [10, 20, 30],\r\n    \"海南省\": [10, 20, 30],\r\n    \"重庆市\": [10, 20, 30],\r\n    \"四川省\": [10, 20, 30],\r\n    \"贵州省\": [10, 20, 30],\r\n    \"云南省\": [10, 20, 30],\r\n    \"西藏\": [10, 20, 30],\r\n    \"陕西省\": [10, 20, 30],\r\n    \"甘肃省\": [10, 20, 30],\r\n    \"青海省\": [10, 20, 30],\r\n    \"宁夏\": [10, 20, 30],\r\n    \"新疆\": [10, 20, 30],\r\n    \"台湾省\": [10, 20, 30],\r\n    \"香港\": [10, 20, 30],\r\n    \"澳门\": [10, 20, 30]\r\n};\r\n\r\n\r\nfunction makeMapData(rawData) {\r\n    var mapData = [];\r\n    for (var i = 0; i < rawData.length; i++) {\r\n        var geoCoord = geoCoordMap[rawData[i][0]];\r\n        if (geoCoord) {\r\n            mapData.push({\r\n                name: rawData[i][0],\r\n                value: geoCoord.concat(rawData[i].slice(1))\r\n            });\r\n        }\r\n    }\r\n    return mapData;\r\n};\r\n\r\noption = {\r\n    animation: false,\r\n    // 地图背景颜色\r\n    backgroundColor: new echarts.graphic.RadialGradient(0.5, 0.5, 0.4, [{\r\n        offset: 0,\r\n        color: '#eee'\r\n    }, {\r\n        offset: 1,\r\n        color: '#eee'\r\n    }]),\r\n\r\n    geo: {\r\n        scaleLimit: {\r\n            min: 1,\r\n            max: 1\r\n        },\r\n        map: 'china',\r\n        // silent: true,\r\n        roam: true,\r\n        zoom: 1.155, // 地图初始大小\r\n        center: [102.925798, 35.296079], // 初始中心位置\r\n        label: {\r\n            emphasis: {\r\n                show: false,\r\n                areaColor: '#eee'\r\n            }\r\n        },\r\n\r\n        // 地区块儿颜色\r\n        itemStyle: {\r\n            normal: {\r\n                areaColor: '#999',\r\n                borderColor: '#fff'\r\n            },\r\n            emphasis: {\r\n                areaColor: '#999'\r\n            }\r\n        }\r\n    },\r\n    // tooltip: {\r\n    //     padding: 0,\r\n    //     enterable: true,\r\n    //     transitionDuration: 1,\r\n    //     textStyle: {\r\n    //         color: '#000',\r\n    //         decoration: 'none',\r\n    //     },\r\n\r\n    //     // formatter: function(params) {\r\n\r\n    //     //     var tipHtml = '';\r\n    //     //     tipHtml = '<div style=\"height:360px;width:400px;border-radius:5px;background:#fff;box-shadow:0 0 10px 5px #aaa\">' +\r\n    //     //         '    111</div>';\r\n    //     //     setTimeout(function() {\r\n    //     //         tooltipCharts(params.name);\r\n    //     //     }, 10);\r\n    //     //     return tipHtml;\r\n    //     // }\r\n    // },\r\n    series: []\r\n};\r\n\r\nfunction renderEachCity() {\r\n    var option = {\r\n        xAxis: [],\r\n        yAxis: [],\r\n        grid: [],\r\n        // tooltip:[],\r\n        //  legend: {\r\n        //     data: ['数据A','数据B','数据C']\r\n        // },\r\n\r\n        series: []\r\n    };\r\n\r\n    echarts.util.each(rawData, function(dataItem, idx) {\r\n        // console.log('dataItem, idx',dataItem, idx)\r\n        //geoCoord 经纬度\r\n        var geoCoord = geoCoordMap[idx];\r\n        var coord = myChart.convertToPixel('geo', geoCoord);\r\n\r\n        // var boundL = -12.782788213627585;\r\n        // var boundR = 35.92763028872384;\r\n        // var boundT = 32.22854555899493;\r\n        // var boundB = 95.18817097360194;\r\n        // if (!coord ||\r\n        //     geoCoord[0] < boundL ||\r\n        //     geoCoord[0] > boundR ||\r\n        //     geoCoord[1] > boundB ||\r\n        //     geoCoord[1] < boundT\r\n        // ) {\r\n        //     return;\r\n        // }\r\n        idx += '';\r\n\r\n        inflationData = dataItem;\r\n        // for (var k = 0; k < inflationYearCount; k++) {\r\n        //     inflationData.push(dataItem[inflationStartIdx + k]);\r\n        // }\r\n\r\n        // option.tooltip.push({\r\n        //     padding: 0,\r\n        //     enterable: true,\r\n        //     transitionDuration: 1,\r\n        //     textStyle: {\r\n        //         color: '#000',\r\n        //         decoration: 'none',\r\n        //     },\r\n\r\n        //     formatter: function(params) {\r\n        //         // console.log(params)\r\n        //         var tipHtml = '';\r\n        //         tipHtml = '<div style=\"height:360px;width:400px;border-radius:5px;background:#fff;box-shadow:0 0 10px 5px #aaa\">' +\r\n        //             '    111</div>';\r\n        //         setTimeout(function() {\r\n        //             tooltipCharts(params.name);\r\n        //         }, 10);\r\n        //         return tipHtml;\r\n        //     }\r\n        // });\r\n        option.xAxis.push({\r\n            id: idx,\r\n            gridId: idx,\r\n            type: 'category',\r\n            name: idx,\r\n            // nameStyle: {\r\n            //     color: 'red',\r\n            //     fontSize: 12\r\n            // },\r\n            nameLocation: 'middle',\r\n            nameGap: 3,\r\n            splitLine: {\r\n                show: false\r\n            },\r\n            axisTick: {\r\n                show: false\r\n            },\r\n            axisLabel: {\r\n                show: false\r\n            },\r\n            axisLine: {\r\n                onZero: false,\r\n                lineStyle: {\r\n                    color: '#666'\r\n                }\r\n            },\r\n            // data: xAxisCategory,\r\n            data: [\"数据A\", \"数据B\", \"数据C\"],\r\n            z: 100\r\n\r\n        });\r\n\r\n\r\n        option.yAxis.push({\r\n            id: idx,\r\n            gridId: idx,\r\n            splitLine: {\r\n                show: false\r\n            },\r\n            axisTick: {\r\n                show: false\r\n            },\r\n            axisLabel: {\r\n                show: false\r\n            },\r\n            axisLine: {\r\n                show: false,\r\n                lineStyle: {\r\n                    color: '#1C70B6'\r\n                }\r\n            },\r\n            z: 100\r\n        });\r\n        option.grid.push({\r\n            id: idx,\r\n            width: 30,\r\n            height: 40,\r\n            left: coord[0] - 15,\r\n            top: coord[1] - 15,\r\n            z: 100\r\n        });\r\n        option.series.push({\r\n            id: idx,\r\n            type: 'bar',\r\n            xAxisId: idx,\r\n            yAxisId: idx,\r\n            barGap: 0,\r\n            barCategoryGap: 0,\r\n            // data: inflationData,\r\n            data: inflationData,\r\n            z: 100,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: function(params) {\r\n                        // 柱状图每根柱子颜色\r\n                        var colorList = ['#F75D5D', 'yellow', '#4C60E3'];\r\n                        return colorList[params.dataIndex];\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n    // console.time('a');\r\n    myChart.setOption(option);\r\n    // console.timeEnd('a');\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nsetTimeout(renderEachCity, 0);\r\n// 缩放和拖拽\r\nfunction throttle(fn, delay, debounce) {\r\n\r\n    var currCall;\r\n    var lastCall = 0;\r\n    var lastExec = 0;\r\n    var timer = null;\r\n    var diff;\r\n    var scope;\r\n    var args;\r\n\r\n    delay = delay || 0;\r\n\r\n    function exec() {\r\n        lastExec = (new Date()).getTime();\r\n        timer = null;\r\n        fn.apply(scope, args || []);\r\n    }\r\n\r\n    var cb = function() {\r\n        currCall = (new Date()).getTime();\r\n        scope = this;\r\n        args = arguments;\r\n        diff = currCall - (debounce ? lastCall : lastExec) - delay;\r\n\r\n        clearTimeout(timer);\r\n\r\n        if (debounce) {\r\n            timer = setTimeout(exec, delay);\r\n        } else {\r\n            if (diff >= 0) {\r\n                exec();\r\n            } else {\r\n                timer = setTimeout(exec, -diff);\r\n            }\r\n        }\r\n\r\n        lastCall = currCall;\r\n    };\r\n\r\n    return cb;\r\n}\r\n\r\nvar throttledRenderEachCity = throttle(renderEachCity, 0);\r\n\r\n// // 点击显示柱状图\r\nmyChart.on('click', function(e) {\r\n    console.log('点击显示柱状图', e)\r\n\r\n\r\n    if (e.seriesId) {\r\n        console.log('图表', e.seriesId)\r\n    } else {\r\n        console.log('地图', e.region.name)\r\n\r\n    }\r\n\r\n    // if(e.componentSubType == \"bar\"){\r\n    //     // 先清除所有柱状图\r\n    $('.tongJiTu').remove();\r\n\r\n \r\n\r\n\r\n    // }\r\n    return;\r\n});","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-3951734745","theme":"","layout":"","viewCount":8535,"userName":"花***4","commentCount":2,"starCount":17,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrSfuXlW_q.png?v=1550241923856","isCustomThumbnail":0,"builtinTags":["category-work","geo","grid","series-bar"],"customTags":[],"updaterUserName":"花***4"}}