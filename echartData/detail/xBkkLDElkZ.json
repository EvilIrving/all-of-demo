{"status":0,"data":{"cid":"xBkkLDElkZ","authorUid":"bd-2215764494","authorUserName":"p***g","title":"Music Visualization","description":"","latestVersion":3,"alwaysLatest":1,"createTime":"2017-04-28T03:30:14.000Z","lastUpdateTime":"2017-04-28T03:31:16.000Z","auth":2,"uid":"bd-2215764494","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"3.8.0","versionCreateTime":"2019-05-22T09:05:02.000Z","code":"var UPDATE_DURATION = 100;\n\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext;\n\nvar audioContext = new AudioContext();\n\nvar oReq = new XMLHttpRequest();\noReq.open('GET', '/asset/get/s/data-1493350085456-S1p6LNlyZ.mp3', true);\noReq.responseType = 'arraybuffer';\n\noReq.onload = function(e) {\n    audioContext.decodeAudioData(oReq.response, initVisualizer);\n};\noReq.send();\n\nfunction initVisualizer(audioBuffer) {\n    inited = true;\n\n    var source = audioContext.createBufferSource();\n    source.buffer = audioBuffer;\n\n    // Must invoked right after click event\n    if (source.noteOn) {\n        source.noteOn(0);\n    }\n    else {\n        source.start(0);\n    }\n\n    var analyzer = audioContext.createAnalyser();\n    var gainNode = audioContext.createGain();\n    analyzer.fftSize = 4096;\n\n    gainNode.gain.value = 1;\n    source.connect(gainNode);\n    gainNode.connect(analyzer);\n    analyzer.connect(audioContext.destination);\n\n    var frequencyBinCount = analyzer.frequencyBinCount;\n    var dataArray = new Uint8Array(frequencyBinCount);\n\n\n    var beta = 0;\n    function update() {\n        analyzer.getByteFrequencyData(dataArray);\n\n        var item = [];\n        var size = 50;\n        var dataProvider = [];\n        \n        for (var i = 0; i < size * size; i++) {\n            var x = i % size;\n            var y = Math.floor(i / size);\n            var dx = x - size / 2;\n            var dy = y - size / 2;\n    \n            var angle = Math.atan2(dy, dx);\n            if (angle < 0) {\n                angle = Math.PI * 2 + angle;\n            }\n            var dist = Math.sqrt(dx * dx + dy * dy);\n            var idx = Math.min(\n                frequencyBinCount - 1, Math.round(angle / Math.PI / 2 * 60 + dist * 60) + 100\n            );\n    \n            var val = Math.pow(dataArray[idx] / 100, 3);\n            dataProvider.push([x, y, Math.max(val, 0.1)]);\n        }\n        \n        myChart.setOption({\n            grid3D: {\n                viewControl: {\n                    beta: beta,\n                    alpha: Math.sin(beta / 10 + 40) * (beta % 10 + 5) / 15 * 30 + 30,\n                    distance: Math.cos(beta / 50 + 20) * (beta % 10 + 5) / 15 * 50 + 80,\n                    animationDurationUpdate: UPDATE_DURATION,\n                    animationEasingUpdate: 'linear'\n                }\n            },\n            series: [{\n                data: dataProvider\n            }]\n        });\n        beta += 2;\n\n        setTimeout(update, UPDATE_DURATION);\n    };\n\n    update();\n}\n\noption = {\n    tooltip: {},\n    visualMap: {\n        show: false,\n        min: 0.1,\n        max: 4,\n        inRange: {\n            color: ['#010103', '#2f490c', '#b0b70f', '#fdff44', '#fff']\n        }\n    },\n    xAxis3D: {\n        type: 'value'\n    },\n    yAxis3D: {\n        type: 'value'\n    },\n    zAxis3D: {\n        type: 'value',\n        min: -6,\n        max: 6\n    },\n    grid3D: {\n        show: false,\n        environment: '#000',\n        viewControl: {\n            distance: 100\n        },\n        postEffect: {\n            enable: true,\n            FXAA: {\n                enable: true\n            }\n        },\n        light: {\n            main: {\n                shadow: true,\n                intensity: 10,\n                quality: 'high'\n            },\n            ambientCubemap: {\n                texture: '/asset/get/s/data-1491896094618-H1DmP-5px.hdr',\n                exposure: 0,\n                diffuseIntensity: 0.2\n            }\n        }\n    },\n    series: [{\n        type: 'bar3D',\n        silent: true,\n        shading: 'lambert',\n        data: [],\n        barSize: 1,\n        lineStyle: {\n            width: 4\n        },\n        // animation: false,\n        animationDurationUpdate: UPDATE_DURATION\n    }]\n}","html":"","externalScripts":"https://echarts.baidu.com/resource/echarts-gl-latest/dist/echarts-gl.min.js","updaterUID":"bd-2215764494","theme":"default","layout":"","viewCount":74234,"userName":"p***g","commentCount":19,"starCount":114,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xBkkLDElkZ.png?v=1493350278382","isCustomThumbnail":1,"builtinTags":["category-work","grid3D","series-bar3D","tooltip","visualMap"],"customTags":["echarts-gl"],"updaterUserName":"p***g"}}