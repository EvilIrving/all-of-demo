{"status":0,"data":{"cid":"xEPLidH_w-","authorUid":"bd-939842705","authorUserName":"j***h","title":"厦门老人公交出行兴趣点分析","description":"","latestVersion":8,"alwaysLatest":1,"createTime":"2019-03-04T12:55:43.000Z","lastUpdateTime":"2019-03-04T12:55:43.000Z","auth":2,"uid":"bd-939842705","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":8,"parentVersion":7,"echartsVersion":"4.2.1","versionCreateTime":"2019-07-03T02:48:37.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1551702964926-4Wi6tEpVh.csv\";\n\n//以下是离线转换GPS坐标到百度坐标\n\nvar pi = 3.14159265358979324;\nvar a = 6378245.0;\nvar ee = 0.00669342162296594323;\nvar x_pi = 3.14159265358979324 * 3000.0 / 180.0;\n\nfunction transformLat(lat, lon) {\n    var ret = -100.0 + 2.0 * lat + 3.0 * lon + 0.2 * lon * lon + 0.1 * lat * lon + 0.2 * Math.sqrt(Math.abs(lat));\n    ret += (20.0 * Math.sin(6.0 * lat * pi) + 20.0 * Math.sin(2.0 * lat * pi)) * 2.0 / 3.0;\n    ret += (20.0 * Math.sin(lon * pi) + 40.0 * Math.sin(lon / 3.0 * pi)) * 2.0 / 3.0;\n    ret += (160.0 * Math.sin(lon / 12.0 * pi) + 320 * Math.sin(lon * pi / 30.0)) * 2.0 / 3.0;\n    return ret;\n}\n\nfunction transformLon(lat, lon) {\n    var ret = 300.0 + lat + 2.0 * lon + 0.1 * lat * lat + 0.1 * lat * lon + 0.1 * Math.sqrt(Math.abs(lat));\n    ret += (20.0 * Math.sin(6.0 * lat * pi) + 20.0 * Math.sin(2.0 * lat * pi)) * 2.0 / 3.0;\n    ret += (20.0 * Math.sin(lat * pi) + 40.0 * Math.sin(lat / 3.0 * pi)) * 2.0 / 3.0;\n    ret += (150.0 * Math.sin(lat / 12.0 * pi) + 300.0 * Math.sin(lat / 30.0 * pi)) * 2.0 / 3.0;\n    return ret;\n}\n\nfunction wgs2gcj(lat, lon) {\n    var dLat = transformLat(lon - 105.0, lat - 35.0);\n    var dLon = transformLon(lon - 105.0, lat - 35.0);\n    var radLat = lat / 180.0 * pi;\n    var magic = Math.sin(radLat);\n    magic = 1 - ee * magic * magic;\n    var sqrtMagic = Math.sqrt(magic);\n    dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * pi);\n    dLon = (dLon * 180.0) / (a / sqrtMagic * Math.cos(radLat) * pi);\n    var mgLat = lat + dLat;\n    var mgLon = lon + dLon;\n    var loc = [mgLat, mgLon];\n    return loc;\n}\n\nfunction gcj2bd(lat, lon) {\n    var x = lon,\n        y = lat;\n    var z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * x_pi);\n    var theta = Math.atan2(y, x) + 0.000003 * Math.cos(x * x_pi);\n    var bd_lon = z * Math.cos(theta) + 0.0065;\n    var bd_lat = z * Math.sin(theta) + 0.006;\n    return [bd_lat, bd_lon];\n}\n\nfunction wgs2bd(lat, lon) {\n\n    var gcj = wgs2gcj(lat, lon);\n\n    var bd = gcj2bd(gcj[0], gcj[1]);\n    return bd;\n}\n\n\n//百度坐标转换结束\n\nvar convertData = function(csvdata) {\n    var res = {\n        'education': [],\n        'hospital': [],\n        'scope': [],\n        'shopping': []\n    };\n    var rows = csvdata.split('\\n');\n    for (var i in rows) {\n        if (i < 1)\n            continue;\n        var row = rows[i].split(',');\n        if (row[0]) {\n            row[0] = row[0].slice(1, row[0].length - 1);\n            row[1] = row[1].slice(1, row[1].length - 1);\n            res[row[0]].push({\n                \"name\": row[1],\n                \"value\": [parseFloat(row[4]), parseFloat(row[3]), parseInt(row[2])]\n            });\n        }\n    }\n    console.log(res);\n\n    return res;\n};\n\nvar max = 2143,\n    min = 1; // todo \nvar maxSize4Pin = 50,\n    minSize4Pin = 10;\n\nvar option = {\n    bmap: {\n        roam: true,\n    },\n    tooltip: {\n        trigger: 'item',\n        formatter:function(param){\n            console.log(param);\n            var res='地点:'+param.name+'<br>'\n            +'排名:'+(param.dataIndex+1)+'<br>'\n            +'类型:'+param.seriesName+'<br>'\n            +'客流:'+param.value[2]\n            return res;\n        },\n    },\n    title: {\n        text: '老人出行POI兴趣点分析',\n        left: 'center',\n        textStyle: {\n            color: '#fff'\n        }\n    },\n    legend: {\n        selectedMode: 'multiple',\n        orient: 'vertical',\n        y: 'center',\n        x: 'left',\n        data: ['学校', '医院', '公园', '购物'],\n        textStyle: {\n            color: 'black'\n        }\n    },\n    color:['green','gray','red','brown'],\n    /*visualMap: [{\n        left: 'right',\n        top: '10%',\n        dimension: 2,\n        min: 0,\n        max: 100,\n        itemWidth: 30,\n        itemHeight: 120,\n        calculable: true,\n        precision: 0.1,\n        inRange: {\n            symbolSize: [3, 10]\n        },\n        outOfRange: {\n            symbolSize: [3, 10],\n            color: ['rgba(255,255,255,.2)']\n        }\n    }],*/\n    series: [{\n            name: '学校',\n            type: 'scatter',\n            coordinateSystem: 'bmap',\n            data: [],\n            symbolSize: function(val) {\n                if (val[2] / 100 < 1)\n                    return 5;\n                if (val[2] / 100 > 10)\n                    return 10;\n                return val[2] / 100;\n            },\n            symbol: 'triangle',\n            label: {\n                normal: {\n                    formatter: '{b}',\n                    position: 'right',\n                    show: false\n                },\n                emphasis: {\n                    show: true\n                }\n            },\n\n        },\n        {\n            name: '医院',\n            type: 'scatter',\n            coordinateSystem: 'bmap',\n            data: [],\n            symbolSize: function(val) {\n                if (val[2] / 100 < 1)\n                    return 5;\n                if (val[2] / 100 > 10)\n                    return 10;\n                return val[2] / 100;\n            },\n            symbol: 'diamond',\n            label: {\n                normal: {\n                    formatter: '{b}',\n                    position: 'right',\n                    show: false\n                },\n                emphasis: {\n                    show: true\n                }\n            },\n\n        },\n        {\n            name: '公园',\n            type: 'scatter',\n            coordinateSystem: 'bmap',\n            data: [],\n            symbolSize: function(val) {\n                \n                if (val[2] / 100 < 20)\n                    return 5;\n                if (val[2] / 100 > 20)\n                    return 20;\n                return val[2] / 100;\n            },\n            symbol: 'roundRect',\n            label: {\n                normal: {\n                    formatter: '{b}',\n                    position: 'right',\n                    show: false\n                },\n                emphasis: {\n                    show: true\n                }\n            },\n        },\n        {\n            name: '购物',\n            type: 'scatter',\n            coordinateSystem: 'bmap',\n            data: [],\n            symbol: 'pin',\n            symbolSize: function(val) {\n                console.log(val);\n                if (val[2] / 100 < 15)\n                    return 15;\n                if (val[2] / 100 > 15)\n                    return 20;\n                return val[2] / 100;\n            },\n            label: {\n                normal: {\n                    formatter: function(val){\n                        return val.dataIndex+1+\":\"+val.name;\n                    },\n                    position: 'right',\n                    show: true\n                },\n                emphasis: {\n                    show: true\n                }\n            },\n\n        },\n\n    ]\n};\n\n$.ajax({\n    \"url\": uploadedDataURL,\n    \"dataType\": \"text\",\n    \"method\": \"GET\",\n    \"success\": function(csvdata) {\n        var res = convertData(csvdata);\n        option.series[0].data = res['education'];\n        option.series[1].data = res['hospital'];\n        option.series[2].data = res['scope'];\n        option.series[3].data = res['shopping'];\n\n        //console.log(option.series[1].data);\n        myChart.setOption(option);\n        // console.log(option);\n        //获取echart中使用的bmap实例\n        var map = myChart.getModel().getComponent('bmap').getBMap();\n        map.disableDoubleClickZoom();\n        map.centerAndZoom(\"厦门\", 13);\n\n    },\n});","html":"","externalScripts":"http://api.map.baidu.com/api?v=2.0&ak=BFcd9e84753ab8dcef34748bc43f952d,/dep/echarts/latest/extension/bmap.min.js","updaterUID":"bd-939842705","theme":"","layout":"","viewCount":63,"userName":"j***h","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xEPLidH_w-.png?v=1551707360760","isCustomThumbnail":0,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"j***h"}}