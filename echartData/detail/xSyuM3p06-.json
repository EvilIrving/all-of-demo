{"status":0,"data":{"cid":"xSyuM3p06-","authorUid":"bd-672241695","authorUserName":"炜迦炜迦","title":"柱状图折线图动态求和求平均","description":"主要应用legendselectchanged事件。点击右上角改变图例的显示状态，每一列的总和及所有列的平均值会随类别显示与隐藏而动态改变，y轴坐标系也会相应变化。","latestVersion":5,"alwaysLatest":1,"createTime":"2017-10-26T02:44:32.000Z","lastUpdateTime":"2017-10-26T02:44:32.000Z","auth":1,"uid":"bd-672241695","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"3.8.0","versionCreateTime":"2018-03-27T15:06:36.000Z","code":"var myChart = echarts.init(document.getElementById('chart-panel'));\r\nvar selected = {}; //存储选中的状态\r\nvar xdata = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];\r\nvar ydata = ['类别1', '类别2', '类别3', '类别4'];\r\nvar vdata = [\r\n    [27.5, 28.0, 26.4, 25.1, 24.6, 22.8, 24.7, 24.0, 24.0, 23.6],\r\n    [7.5, 7.5, 7.9, 7.2, 7.3, 6.7, 7.0, 6.7, 6.7, 6.3],\r\n    [45.2, 44.0, 42.3, 46.8, 39.4, 42.3, 38.0, 52.3, 46.2, 47.4],\r\n    [6.0, 6.7, 8.4, 7.7, 6.8, 6.4, 8.7, 5.8, 5.7, 9.7]\r\n];\r\nvar series = [];\r\nvar legenddata = ydata;\r\nvar sumData = [];\r\n\r\n//求每一列数据和\r\n$.each(vdata[0], function(i, v) { //0-9\r\n    var sum = 0;\r\n    for (var j = 0; j < vdata.length; j++) { //0-2\r\n        sum += vdata[j][i];\r\n    }\r\n    sumData[i] = parseFloat(toDecimal(sum));\r\n});\r\n\r\n$.each(vdata, function(i, v) {\r\n\r\n    var bs = {\r\n        name: ydata[i],\r\n        type: 'bar',\r\n        smooth: true,\r\n        areaStyle: {\r\n            normal: {}\r\n        },\r\n        data: v,\r\n        barWidth: '40%',\r\n        stack: '总量'\r\n    };\r\n    series.push(bs);\r\n\r\n});\r\n\r\n//总量&平均值\r\nvar bs2 = {\r\n    name: '总量',\r\n    type: 'line',\r\n    data: sumData,\r\n    label: {\r\n        normal: {\r\n            show: true,\r\n            position: 'top'\r\n        }\r\n    },\r\n    lineStyle:{\r\n        normal: {\r\n            color: \"none\"\r\n        }\r\n    },\r\n    markLine: {\r\n        lineStyle: {\r\n            normal: {\r\n                color: '#fc97af'\r\n            }\r\n        },\r\n        label: {\r\n            normal: {\r\n                position: 'start'\r\n            }\r\n        },\r\n        data: [{\r\n            name: '年平均',\r\n            type: 'average'\r\n        }]\r\n    }\r\n};\r\nseries.push(bs2);\r\n\r\noption = {\r\n    tooltip: {\r\n        trigger: 'axis',\r\n        axisPointer: {\r\n            type: 'shadow',\r\n            crossStyle: {\r\n                color: '#999'\r\n            }\r\n        },\r\n        formatter: function(params) {\r\n            params.pop(); //删除最后一个\r\n            if(params[0]){\r\n                var res = params[0].name + '<br/>';\r\n                for (var i = 0; i < params.length; i++) {\r\n                    res += (params[i].marker + params[i].seriesName + \" : \" + params[i].value + '<br/>');\r\n                }\r\n                return res;\r\n            }\r\n        }\r\n    },\r\n    legend: {\r\n        data: legenddata,\r\n        top: '6%',\r\n        right: '3%'\r\n    },\r\n    xAxis: [{\r\n        data: xdata,\r\n    }],\r\n    yAxis: [{\r\n        name: '',\r\n        type: 'value',\r\n        axisLabel: {\r\n            formatter: function(value) {\r\n                if (value >= 100000000) {\r\n                    return value / 100000000 + ' 亿';\r\n                } else if (value >= 1000000) {\r\n                    return value / 10000 + ' 万';\r\n                } else {\r\n                    return value + '';\r\n                }\r\n            },\r\n        }\r\n    }],\r\n    grid: {\r\n        top: '12%',\r\n        left: '3%',\r\n        right: '4%',\r\n        bottom: '4%',\r\n        containLabel: true\r\n    },\r\n    series: series\r\n};\r\n\r\n//保留一位小数\r\nfunction toDecimal(num) {\r\n    return parseFloat(num).toFixed(1);\r\n}\r\n\r\n//捕捉变化状态\r\nmyChart.on(\"legendselectchanged\", function(params) {\r\n    selected = params.selected;\r\n\r\n    //重新计算sumData\r\n    $.each(vdata[0], function(i, v) { //0-9\r\n        var sum = 0;\r\n        //遍历对象\r\n        for (var key in selected) {\r\n            if (selected[key]) { //获取被选中的元素\r\n                var index = ydata.indexOf(key); //获取被选中key在ydata里的索引\r\n                sum += vdata[index][i];\r\n            }\r\n        }\r\n        sumData[i] = parseFloat(toDecimal(sum));\r\n\r\n    });\r\n    myChart.setOption(option); //重新绘图\r\n\r\n});\r\n\r\nmyChart.setOption(option);","html":"","externalScripts":"","updaterUID":"bd-2117871882","theme":"vintage","layout":"","viewCount":2024,"userName":"炜迦炜迦","commentCount":0,"starCount":5,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSyuM3p06-.png?v=1522163196330","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","markLine","series-bar","series-line","tooltip"],"customTags":["legendselectchanged"],"updaterUserName":"粗***夫"}}