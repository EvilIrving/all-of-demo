{"status":0,"data":{"cid":"xKqnq_8C97","authorUid":"obd-o2pq5nyvQfbCAxb0gSfLWLzrxSIY363","authorUserName":"一***蝉","title":"叠加柱状图自定义合计功能","description":"一般的叠加柱状图只能分别查看各条目数据，自己实现了对这些条目的合计统计功能，自定义tip文本内容和图例改变响应事件","latestVersion":1,"alwaysLatest":0,"createTime":"2022-01-21T01:27:26.000Z","lastUpdateTime":"2022-01-21T01:27:26.000Z","auth":2,"uid":"obd-o2pq5nyvQfbCAxb0gSfLWLzrxSIY363","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.2","versionCreateTime":"2022-01-21T01:27:26.000Z","code":"option = {\n    tooltip: {\n        trigger: 'axis',\n        formatter: function (params) {\n            let tipStr = params[0].axisValueLabel + '</br>';\n            let totalNum = 0;\n            for (let i = 0; i < params.length; i++) {\n                totalNum += params[i].value;\n                if (params[i].seriesName !== '合计') {\n                    tipStr += params[i].seriesName + '：' + params[i].value + '</br>';\n                }\n            }\n            for (let i = 0; i < params.length; i++) {\n                totalNum += params[i].value;\n                if (params[i].seriesName === '合计') {\n                    tipStr += '合计：' + totalNum;\n                }\n            }\n            return tipStr;\n        },\n        axisPointer: {\n            // 坐标轴指示器，坐标轴触发有效\n            type: 'shadow', // 默认为直线，可选为：'line' | 'shadow'\n        },\n    },\n    legend: {\n        top: 10,\n        left: 10,\n        icon: 'rect',\n        itemWidth: 4, // 图例图表宽度\n        itemHeight: 12, // 图例图标高度\n        data: ['餐费', '打车费', '零食', '日用品'],\n    },\n    grid: {\n        left: '3%',\n        right: '13%',\n        bottom: '8%',\n        top: '25%',\n        containLabel: true,\n    },\n    xAxis: {\n        type: 'category',\n        name: '日期',\n        axisLabel: {\n            fontSize: 12,\n            interval: 0,\n            rotate: 40,\n            formatter: function (params, index) {\n                var date = new Date(params);\n                var yy = date.getFullYear();\n                var mm = date.getMonth() + 1;\n                return yy + '-' + (mm < 10 ? '0' + mm : mm);\n            },\n        },\n        axisLine: {\n            lineStyle: {\n                // color: '#cbeaf6', // x坐标轴线颜色\n            },\n        },\n        data: ['2022-01-01', '2022-01-02', '2022-01-03', '2022-01-04', '2022-01-05', '2022-01-06'],\n    },\n    yAxis: [\n        {\n            type: 'value',\n            name: '花费',\n            axisLabel: {\n                // color: '#cbeaf6', // 坐标轴label文字颜色\n            },\n            axisLine: {\n                lineStyle: {\n                    // color: '#cbeaf6', // y坐标轴线颜色\n                },\n            },\n            splitLine: {\n                // 网格线\n                lineStyle: {\n                    // type: 'dashed', // 设置网格线类型 dotted：虚线   solid:实线\n                    // color: '#395367',\n                },\n                show: true, // 隐藏或显示\n            },\n        },\n    ],\n    series: [\n        {\n            name: '餐费',\n            type: 'bar',\n            barWidth: 13,\n            stack: '分类',\n            itemStyle: {\n                color: '#ffc254',\n            },\n            data: [40, 35, 40, 30, 35, 50],\n        },\n        {\n            name: '打车费',\n            type: 'bar',\n            barWidth: 13,\n            stack: '分类',\n            itemStyle: {\n                color: '#b3d465',\n            },\n            data: [12, 13, 15, 12, 11, 12],\n        },\n        {\n            name: '零食',\n            type: 'bar',\n            barWidth: 13,\n            stack: '分类',\n            itemStyle: {\n                color: '#00b7ee',\n            },\n            data: [25, 23, 19, 20, 22, 30],\n        },\n        {\n            name: '日用品',\n            type: 'bar',\n            barWidth: 13,\n            stack: '分类',\n            itemStyle: {\n                color: '#ec6941',\n            },\n            data: [12, 13, 12, 50, 10, 16],\n        },\n        {\n            name: '合计',\n            type: 'bar',\n            stack: '分类',\n            label: {\n                normal: {\n                    show: true,\n                    position: 'top',\n                    textStyle: {\n                        color: '#ffffff',\n                    },\n                    formatter: '',\n                },\n            },\n            data: [0, 0, 0, 0, 0, 0],\n        },\n    ],\n};\n\nvar series = option.series;\nvar tooltip = option.tooltip;\n// 提示框自定义内容包括总合及文字\nfunction formatFun(params) {\n    // console.log('params====>', params)\n    let tipStr = params[0].axisValueLabel + '</br>'; // 初始化提示框文字默认当前轴名称并换行\n    let totalNum = 0; // 用于存储当前列总数\n    // params为当前柱状图数组数量 遍历求和并添加类目label：value\n    for (let i = 0; i < params.length; i++) {\n        if (params[i].seriesName !== '合计') {\n            const dotHtml = `<span style=\"display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${params[i].color}\"></span>`;\n            totalNum += params[i].value;\n            tipStr += dotHtml + params[i].seriesName + '：' + params[i].value + '</br>';\n        }\n    }\n    // 添加最后的合计行 数据为每列总合\n    for (let i = 0; i < params.length; i++) {\n        if (params[i].seriesName === '合计') {\n            tipStr += '合计：' + totalNum;\n        }\n    }\n    return tipStr;\n}\ntooltip.formatter = formatFun;\n// 指定函数计算总合\nfunction fun(params) {\n    var dataSum = 0;\n    for (var i = 0; i < series.length; i++) {\n        dataSum += series[i].data[params.dataIndex];\n    }\n    return dataSum;\n}\n// 加载页面时候替换最后一个series的formatter\nseries[series.length - 1].label.normal.formatter = fun;\n","html":"","externalScripts":"","updaterUID":"obd-o2pq5nyvQfbCAxb0gSfLWLzrxSIY363","theme":"","layout":"","viewCount":0,"userName":"一***蝉","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xKqnq_8C97.png?v=1642728446799","isCustomThumbnail":1,"builtinTags":["category-work","grid","legend","series-bar","tooltip"],"customTags":[],"updaterUserName":"一***蝉"}}