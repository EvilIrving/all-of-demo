{"status":0,"data":{"cid":"xax6kRx8Qi","authorUid":"obd-oAh1pmOtRq8dpE1-TB9zEDrgNUYDa75","authorUserName":"y***车","title":"温州市地图 下钻 下级市","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-06-29T07:46:34.000Z","lastUpdateTime":"2021-06-29T07:46:34.000Z","auth":2,"uid":"obd-oAh1pmOtRq8dpE1-TB9zEDrgNUYDa75","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.1.2","versionCreateTime":"2021-06-29T07:46:34.000Z","code":"var yueqing = \"/asset/get/s/data-1624952205528-Q_RdqxVYb.json\";\n\nvar yongjia = \"/asset/get/s/data-1624952202235--ulXjrFMZ.json\";\n\nvar wz = \"/asset/get/s/data-1624952197196-RG3ko6TgM.json\";\n\nvar wencheng = \"/asset/get/s/data-1624952192639-s7dFq8c6t.json\";\n\nvar taishun = \"/asset/get/s/data-1624952188050-Is7pR5uWQ.json\";\n\nvar ruian = \"/asset/get/s/data-1624952182604-OBaFiET4r.json\";\n\nvar pingyang = \"/asset/get/s/data-1624952176584-yRTFVIefu.json\";\n\nvar ouhai = \"/asset/get/s/data-1624952172887-wTGShRCen.json\";\n\nvar lucheng = \"/asset/get/s/data-1624952168860-TYngOI-Pr.json\";\n\nvar longwan = \"/asset/get/s/data-1624952164019-47GxAund8.json\";\n\nvar longgang = \"/asset/get/s/data-1624952152461-QjXW50Xvp.json\";\n\nvar dongtou = \"/asset/get/s/data-1624952144958-oHtCUn28l.json\";\n\nvar cangnan = \"/asset/get/s/data-1624952127724-rBWwaP3l4.json\";\n\n\necharts.extendsMap = function(id, opt){\n    // 实例\n    var chart = this.init(document.getElementById(id));\n\n    var curGeoJson = {};\n   \n      var cityMapWz = {\n       \"鹿城区\": lucheng,\n          \"瓯海区\": ouhai,\n          \"龙湾区\": longwan,\n          \"永嘉县\": yongjia,\n          \"乐清市\": yueqing,\n          \"瑞安市\": ruian,\n          \"平阳县\": pingyang,\n          \"苍南县\": cangnan,\n          \"洞头区\":dongtou,\n          \"文成县\": wencheng,\n          \"泰顺县\": taishun,\n    };\n    //地图坐标\n         var geoCoordMapWz = {\n          \"鹿城区\": [120.482067, 28.083209],\n          \"瓯海区\": [120.621248, 27.932983],\n          \"龙湾区\": [120.817869, 27.899288],\n          \"永嘉县\": [120.66681,  28.369418],\n          \"乐清市\": [120.993218, 28.120655],\n          \"瑞安市\": [120.553587, 27.784367],\n          \"平阳县\": [120.569649, 27.661973],\n          \"苍南县\": [120.435951, 27.383617],\n          \"洞头区\": [121.161237, 27.842644],\n          \"文成县\": [120.026781, 27.830728],\n          \"泰顺县\": [119.821936, 27.557831],\n          // 新增 经开区 瓯江口 市本级\n          \"经开区\": ['', ''],\n          \"瓯江口\": ['', ''],\n          \"市本级\": ['', ''],\n        }\n\n    var levelColorMap = {\n        '1': 'rgba(241, 109, 115, .8)',\n        '2': 'rgba(255, 235, 59, .7)',\n        '3': 'rgba(147, 235, 248, 1)'\n    };\n\n\tvar defaultOpt = {\n\t\tmapName: 'china',     // 地图展示\n\t\tgoDown: false,        // 是否下钻\n\t\tbgColor: '#404a59',   // 画布背景色\n        activeArea: [],       // 区域高亮,同echarts配置项\n        data: [],\n        // 下钻回调(点击的地图名、实例对象option、实例对象)\n        callback: function(name, option, instance){}\n\t};\n\tif(opt) opt = this.util.extend(defaultOpt, opt);\n\t\n\t// 层级索引\n\tvar name = [opt.mapName];\n\tvar idx = 0;\n\tvar pos = {\n\t\tleftPlus: 115,\n\t\tleftCur: 150,\n\t\tleft: 198,\n\t\ttop: 50\n\t};\n    \n\tvar line = [[0, 0], [8, 11], [0, 22]];\n    // style\n\tvar style = {\n\t\tfont: '18px \"Microsoft YaHei\", sans-serif',\n\t\ttextColor: '#eee',\n\t\tlineColor: 'rgba(147, 235, 248, .8)'\n\t};\n\n    var handleEvents = {\n        /**\n         * i 实例对象\n         * o option\n         * n 地图名\n        **/\n        resetOption: function(i, o, n){\n            var breadcrumb = this.createBreadcrumb(n);\n            \n            var j = name.indexOf(n);\n            var l = o.graphic.length;\n            if(j < 0){\n                o.graphic.push(breadcrumb);\n                o.graphic[0].children[0].shape.x2 = 145;\n                o.graphic[0].children[1].shape.x2 = 145;\n                if(o.graphic.length > 2){\n                    for(var x = 0; x < opt.data.length; x++){\n                        if(n === opt.data[x].name + '市'){\n                            o.series[0].data = handleEvents.initSeriesData([opt.data[x]]);\n                            break;\n                        }else o.series[0].data = [];\n                    }\n                };\n                name.push(n);\n                idx++;\n            }else{\n                o.graphic.splice(j + 2, l);\n                if(o.graphic.length <= 2){\n                    o.graphic[0].children[0].shape.x2 = 60;\n                    o.graphic[0].children[1].shape.x2 = 60;\n                    o.series[0].data = handleEvents.initSeriesData(opt.data);\n                };\n                name.splice(j + 1, l);\n                idx = j;\n                pos.leftCur -= pos.leftPlus * (l - j - 1);\n            };\n\n            o.geo.map = n;\n            o.geo.zoom = 0.4;\n            i.clear();\n            i.setOption(o);\n            this.zoomAnimation();\n            opt.callback(n, o, i);\n        },\n\n        /**\n         * name 地图名\n        **/\n        createBreadcrumb: function(name){\n            var cityToPinyin = {\n                \"南昌市\": \"nanchang\",\n                \"景德镇市\": \"jingdezhen\",\n                \"萍乡市\": \"pingxiang\",\n                \"九江市\": \"jiujiang\",\n                \"新余市\": \"xinyu\",\n                \"鹰潭市\": \"yingtan\",\n                \"赣州市\": \"ganzhou\",\n                \"吉安市\": \"jian\",\n                \"宜春市\": \"yichun\",\n                \"抚州市\": \"fuzhou\",\n                \"上饶市\": \"shangrao\"\n            };\n            var breadcrumb = {\n                type: 'group',\n                id: name,\n                left: pos.leftCur + pos.leftPlus,\n                top: pos.top + 3,\n                children: [{\n                    type: 'polyline',\n                    left: -90,\n                    top: -5,\n                    shape: {\n                        points: line\n                    },\n                    style: {\n                        stroke: '#fff',\n                        key: name\n                        // lineWidth: 2,\n                    },\n                    onclick: function(){\n                        var name = this.style.key;\n                        handleEvents.resetOption(chart, option, name);\n                    }\n                }, {\n                    type: 'text',\n                    left: -68,\n                    top: 'middle',\n                    style: {\n                        text: name,\n                        textAlign: 'center',\n                        fill: style.textColor,\n                        font: style.font\n                    },\n                    onclick: function(){\n                        var name = this.style.text;\n                        handleEvents.resetOption(chart, option, name);\n                    }\n                }, {\n                    type: 'text',\n                    left: -68,\n                    top: 10,\n                    style: {\n\n                        name: name,\n                        text: cityToPinyin[name] ? cityToPinyin[name].toUpperCase() : '',\n                        textAlign: 'center',\n                        fill: style.textColor,\n                        font: '12px \"Microsoft YaHei\", sans-serif',\n                    },\n                    onclick: function(){\n                        // console.log(this.style);\n                        var name = this.style.name;\n                        handleEvents.resetOption(chart, option, name);\n                    }\n                }]\n            }\n\n            pos.leftCur += pos.leftPlus;\n\n            return breadcrumb;\n        },\n\n        // 设置effectscatter\n        initSeriesData: function(data){\n            var temp = [];\n            for(var i = 0;i < data.length;i++){\n                var geoCoord = geoCoordMapWz[data[i].name];\n                if(geoCoord){\n                    temp.push({\n                        name: data[i].name,\n                        value: geoCoord.concat(data[i].value, data[i].level)\n                    });\n                }\n            };\n            return temp;\n        },\n\n        zoomAnimation: function(){\n            var count = null;\n            var zoom = function(per){\n                if(!count) count = per;\n                count = count + per;\n                // console.log(per,count);\n                chart.setOption({\n                    geo: {\n                        zoom: count\n                    }\n                });\n                if(count < 1) window.requestAnimationFrame(function(){\n                    zoom(0.2);\n                });\n            };\n            window.requestAnimationFrame(function(){\n                zoom(0.2);\n            });\n        }\n    };\n    \n    var option = {\n    \tbackgroundColor: opt.bgColor,\n    \tgraphic: [{\n    \t\ttype: 'group',\n    \t\tleft: pos.left,\n\t        top: pos.top - 4,\n    \t\tchildren: [{\n    \t\t\ttype: 'line',\n    \t\t\tleft: 0,\n        \t\ttop: -20,\n        \t\tshape: {\n                    x1: 0,\n                    y1: 0,\n                    x2: 60,\n                    y2: 0\n                },\n        \t\tstyle: {\n        \t\t\tstroke: style.lineColor,\n        \t\t}\n\t\t\t}, {\n    \t\t\ttype: 'line',\n    \t\t\tleft: 0,\n        \t\ttop: 20,\n\t\t        shape: {\n                    x1: 0,\n                    y1: 0,\n                    x2: 60,\n                    y2: 0\n                },\n                style: {\n                    stroke: style.lineColor,\n                }\n    \t\t}]\n    \t}, {\n        \tid: name[idx],\n        \ttype: 'group',\n        \tleft: pos.left + 2,\n        \ttop: pos.top,\n        \tchildren: [{\n        \t\ttype: 'polyline',\n        \t\tleft: 90,\n        \t\ttop: -12,\n        \t\tshape: {\n                    points: line\n                },\n        \t\tstyle: {\n                    stroke: 'transparent',\n        \t\t\tkey: name[0]\n        \t\t},\n        \t\tonclick: function(){\n        \t\t\tvar name = this.style.key;\n\t        \t\thandleEvents.resetOption(chart, option, name);\n\t        \t}\n        \t}, {\n        \t\ttype: 'text',\n        \t\tleft: 0,\n                top: 'middle',\n        \t\tstyle: {\n\t        \t\ttext: name[0] === '温州' ? '温州市' : name[0],\n\t        \t\ttextAlign: 'center',\n\t        \t\tfill: style.textColor,\n\t        \t\tfont: style.font\n\t        \t},\n\t        \tonclick: function(){\n\t        \t\thandleEvents.resetOption(chart, option, '温州');\n\t        \t}\n        \t}, {\n                type: 'text',\n                left: 0,\n                top: 10,\n                style: {\n                    text: 'WENZHOU',\n                    textAlign: 'center',\n                    fill: style.textColor,\n                    font: '12px \"Microsoft YaHei\", sans-serif',\n                },\n                onclick: function(){\n                    handleEvents.resetOption(chart, option, '温州');\n                }\n            }]\n        }],\n        geo: {\n        \tmap: opt.mapName,\n            // roam: true,\n            zoom: 1,\n        \tlabel: {\n                normal: {\n                    show: true,\n                    textStyle: {\n                        color: '#fff'\n                    }\n                },\n                emphasis: {\n                    textStyle: {\n                        color: '#fff'\n                    }\n                }\n            },\n            itemStyle: {\n                normal: {\n                    borderColor: 'rgba(147, 235, 248, 1)',\n                    borderWidth: 1,\n                    areaColor: {\n                        type: 'radial',\n                        x: 0.5,\n                        y: 0.5,\n                        r: 0.8,\n                        colorStops: [{\n                            offset: 0, \n                            color: 'rgba(147, 235, 248, 0)' // 0% 处的颜色\n                        }, {\n                            offset: 1, \n                            color: 'rgba(147, 235, 248, .2)' // 100% 处的颜色\n                        }],\n                        globalCoord: false // 缺省为 false\n                    },\n                    shadowColor: 'rgba(128, 217, 248, 1)',\n                    // shadowColor: 'rgba(255, 255, 255, 1)',\n                    shadowOffsetX: -2,\n                    shadowOffsetY: 2,\n                    shadowBlur: 10\n                },\n                emphasis: {\n                    areaColor: '#389BB7',\n                    borderWidth: 0\n                }\n            },\n            regions: opt.activeArea.map(function(item){\n                if(typeof item !== 'string'){\n                    return {\n                        name: item.name,\n                        itemStyle: {\n                            normal: {\n                                areaColor: item.areaColor || '#389BB7'\n                            }\n                        },\n                        label: {\n                            normal: {\n                                show: item.showLabel,\n                                textStyle: {\n                                    color: '#fff'\n                                }\n                            }\n                        }\n                    }\n                }else{\n                    return {\n                        name: item,\n                        itemStyle: {\n                            normal: {\n                                borderColor: '#91e6ff',\n                                areaColor: '#389BB7'\n                            }\n                        }\n                    }\n                }\n            })\n        },\n        series: [{\n            type: 'effectScatter',\n            coordinateSystem: 'geo',\n            // symbol: 'diamond',\n            showEffectOn: 'render',\n            rippleEffect: {\n                period: 15,\n                scale: 6,\n                brushType: 'fill'\n            },\n            hoverAnimation: true,\n            itemStyle: {\n                normal: {\n                    color: function(params){\n                        return levelColorMap[params.value[3]];\n                    },\n                    shadowBlur: 10,\n                    shadowColor: '#333'\n                }\n            },\n            data: handleEvents.initSeriesData(opt.data)\n        }]\n    };\n\n    chart.setOption(option);\n    // 添加事件\n    chart.on('click', function(params){\n        var _self = this;\n    \tif(opt.goDown && params.name !== name[idx]){\n            if(cityMapWz[params.name]){\n                var url = cityMapWz[params.name];\n                $.get(url, function(response){\n                    // console.log(response);\n                    curGeoJson = response;\n                    echarts.registerMap(params.name, response);\n                    handleEvents.resetOption(_self, option, params.name);\n                });\n            }\n    \t}\n    });\n\n    chart.setMap = function(mapName){\n        var _self = this;\n        if(mapName.indexOf('市') < 0) mapName = mapName + '市';\n        var citySource = cityMapWz[mapName];\n        if(citySource){\n            var url = './map/' + citySource + '.json';\n            $.get(url, function(response){\n                // console.log(response);\n                curGeoJson = response;\n                echarts.registerMap(mapName, response);\n                handleEvents.resetOption(_self, option, mapName);\n            });\n        }\n        // handleEvents.resetOption(this, option, mapName);\n    };\n\n    return chart;\n};\n\n$.getJSON(wz, function(geoJson){\n    echarts.registerMap('温州', geoJson);\n    var myChart = echarts.extendsMap('chart-panel', {\n    \tbgColor: '#154e90', // 画布背景色\n    \tmapName: '温州',    // 地图名\n    \tgoDown: true,       // 是否下钻\n    \t// 下钻回调\n    \tcallback: function(name, option, instance){\n    \t\tconsole.log(name, option, instance);\n    \t},\n        // 数据展示            \t\n    \tdata: [{\n    \t\tname: '南昌',\n    \t\tvalue: 10,\n    \t\tlevel: 1\n    \t}, {\n    \t\tname: '景德镇',\n    \t\tvalue: 12,\n    \t\tlevel: 2\n    \t}, {\n    \t\tname: '萍乡',\n    \t\tvalue: 11,\n    \t\tlevel: 3\n    \t}, {\n    \t\tname: '赣州',\n    \t\tvalue: 16,\n    \t\tlevel: 2\n    \t}, {\n    \t\tname: '吉安',\n    \t\tvalue: 12,\n    \t\tlevel: 1\n    \t}]\n    });\n})\n","html":"","externalScripts":"","updaterUID":"obd-oAh1pmOtRq8dpE1-TB9zEDrgNUYDa75","theme":"","layout":"","viewCount":0,"userName":"y***车","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xax6kRx8Qi.png?v=1624952794949","isCustomThumbnail":0,"builtinTags":["category-work","geo","graphic","series-effectScatter"],"customTags":[],"updaterUserName":"y***车"}}