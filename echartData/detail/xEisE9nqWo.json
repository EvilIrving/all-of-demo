{"status":0,"data":{"cid":"xEisE9nqWo","authorUid":"bd-4129269411","authorUserName":"1***9","title":"地图上加柱子","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2019-07-10T09:32:57.000Z","lastUpdateTime":"2019-07-10T09:32:57.000Z","auth":2,"uid":"bd-4129269411","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2019-07-10T09:32:57.000Z","code":"//数据定义区\r\nvar typeArr = [\"鲜花\",\"星星\",\"香蕉\",\"嫌弃\"];\r\nvar typeIndex = 1;\r\nvar selectedRange = null;\r\nvar option = null;\r\nvar str = \"\";\r\nvar data = [];\r\nvar geoCoordMap = {};\r\nvar name = \"虚拟地图区域饼图数据统计\"\r\nvar mapName = 'china'\r\n// 地图特征\r\nvar mapFeatures = echarts.getMap(mapName).geoJson.features;\r\nmapFeatures.forEach(function(v){\r\n    // 地区名称\r\n    var name = v.properties.name;\r\n    // 地区经纬度\r\n    geoCoordMap[name] = v.properties.cp;\r\n    data.push({\r\n    \t// 需要挨个处理各地区数据（不使用随机产生的数）：另外需要构造的数据是柱图数据\r\n    \t\"name\":name,\r\n    \t\"value\":[\r\n    \t{name:\"鲜花\",value:Math.round(Math.random() * 100 + 10)},\r\n    \t{name:\"星星\",value:Math.round(Math.random() * 100 + 10)},\r\n    \t{name:\"香蕉\",value:Math.round(Math.random() * 100 + 10)},\r\n    \t{name:\"嫌弃\",value:Math.round(Math.random() * 100 + 10)}\r\n    \t]\r\n    })\r\n});\r\n\r\n\r\n/*变换地图数据（格式）：pie*/\r\nfunction convertMapDta(type,data){\r\n\tvar mapData = [];\r\n\tdata.forEach(function(v){\r\n\t\tv.value.forEach(function(v1){\r\n\t\t\tif(String(v1.name) === String(type)){\r\n                // 数据格式：data: [120, 200, 150, 80]\r\n                mapData.push({\r\n                \t\"name\":v.name,\"value\":v1.value\r\n                })\r\n            }\r\n        })\r\n\t});\r\n\treturn mapData;\r\n}\r\n\r\n\r\n\r\n\r\n/*resetPie*/\r\nfunction resetPie(myChart,params,geoCoordMap,typeIndex){\r\n\tvar op = myChart.getOption();\r\n\tvar ops = op.series;\r\n\tvar gd=option.grid;\r\n\r\n\tmyChart.setOption(op,true);\r\n}\r\n\r\n/*addPie*/\r\nfunction addPie(chart,data) {\r\n\tvar op = chart.getOption();\r\n\tvar sd = option.series;\r\n\tvar gd=option.grid;\r\n\tfor (var i = 0; i < data.length; i++) {\r\n\t\tvar randomValue = Math.round(Math.random() * 30);\r\n\t\tvar radius = randomValue <= 10 ? 10 : randomValue;\r\n\t\tvar geoCoord = geoCoordMap[data[i].name];\r\n\t\tif (geoCoord) {\r\n\t\t\tvar vr = [];\r\n\t\t\t(data[i].value).map(function(v,j){\r\n\t\t\t\tvr.push({name:v.name,value:v.value});\r\n\t\t\t});\r\n\t\t\tvar p = chart.convertToPixel({seriesIndex: 0}, geoCoord);\r\n\t\t\r\n\t\t\tgd.push({\r\n\t\t\t    width:20,height:20,\r\n\t\t\t    left:p[0],\r\n\t\t\t    top:p[1],z:5\r\n\t\t\t    \r\n\t\t\t});\r\n\t\t\toption.yAxis.push({\r\n\t\t\t    gridIndex:i,\r\n\t\t\t      type: 'value',\r\n\t\t\t      show:false,\r\n\t\t\t      axisLabel:{show:false},\r\n\t\t\t      z:5\r\n\t\t\t});\r\n\t\t\toption.xAxis.push({\r\n\t\t\t      type: 'category',\r\n                data: [\"1\",\"2\"],\r\n                show:false,\r\n\t\t\t    gridIndex:i\r\n\t\t\t})\r\n\t\t\tsd.push(\r\n\t\t\t{\r\n\t\t\t\r\n                data: [120, 200],\r\n                type: 'bar',\r\n                yAxisIndex :i,\r\n                  xAxisIndex :i,\r\n                z:5,\r\n              //  zlevel:22,\r\n                itemStyle:{\r\n                    color:'red'\r\n                }\r\n            \r\n\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n  \r\n\treturn option;\r\n\t\r\n};\r\n\r\n\r\n\r\n/* 指定图表的配置项和数据:pie*/\r\nvar option = {\r\n    title: {\r\n        text: name,\r\n        left: 'center',\r\n        textStyle: {\r\n            color: '#03A89E'\r\n        }\r\n    },\r\n    tooltip : {\r\n        trigger: 'item',\r\n        formatter:function(params){\r\n            if(params.value){\r\n                return params.name + \"<br/>\"+ typeArr[typeIndex] +\": \"+ params.value;\r\n            }\r\n        }\r\n    },\r\n    grid:[],\r\n    yAxis:[],\r\n    xAxis:[],\r\n    series : [{\r\n        name: 'chinaMap',\r\n        type: 'map',\r\n        mapType: mapName,\r\n        roam:true,\r\n        label: {\r\n            normal: {\r\n                show: true\r\n            },\r\n            emphasis: {\r\n                show: true\r\n            }\r\n        },\r\n        itemStyle:{\r\n            normal:{\r\n                areaColor:\"#808A87\"\r\n            }\r\n        },\r\n        data:convertMapDta(typeArr[typeIndex],data),\r\n        z:2\r\n    }]\r\n};\r\n\r\n\r\n\r\nif (option && typeof option === \"object\") {\r\n\tmyChart.setOption(option, true);\r\n}\r\n/*pie*/\r\naddPie(myChart,data);\r\n/*bar*/\r\n// addBar(myChart,data);\r\n\r\nmyChart.setOption(option,true);\r\n\r\n/*饼图跟着地图移动:pie*/\r\nmyChart.on('georoam', function (params) {\r\n\tresetPie(myChart,params,geoCoordMap,typeIndex);\r\n});\r\nmyChart.on('datarangeselected', function (params) {\r\n\tresetPie(myChart,params,geoCoordMap,typeIndex);\r\n});\r\nwindow.addEventListener(\"resize\",function(){\r\n\tmyChart.resize();\r\n\tresetPie(myChart,0,geoCoordMap);\r\n})\r\n\r\n\r\n//myChart.setOption(option);\r\n\r\n\r\n\r\n\r\n\r\n\r\n","html":"","externalScripts":"https://echarts.baidu.com/resource/echarts-gl-latest/dist/echarts-gl.min.js,/dep/echarts/map/js/china.js","updaterUID":"bd-4129269411","theme":"","layout":"","viewCount":1812,"userName":"1***9","commentCount":1,"starCount":7,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xEisE9nqWo.png?v=1562751177673","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-bar","series-map","title","tooltip"],"customTags":[],"updaterUserName":"1***9"}}