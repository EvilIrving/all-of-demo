{"status":0,"data":{"cid":"xAMmcqslwX","authorUid":"bd-2552167583","authorUserName":"z***g","title":"饼图-v5","description":"","latestVersion":7,"alwaysLatest":0,"createTime":"2021-05-27T07:40:59.000Z","lastUpdateTime":"2021-05-27T07:40:59.000Z","auth":2,"uid":"bd-2552167583","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":7,"parentVersion":6,"echartsVersion":"5.1.1","versionCreateTime":"2021-06-09T09:10:53.000Z","code":"var titleText = {\n    labelLine: true,\n    text: '数据总量',\n    unit: '条',\n    color: [],\n};\nvar typeData = {\n    0: { name: '血氧', color: '#44BBB4' },\n    1: { name: '心电', color: '#5386FC' },\n    2: { name: '血压', color: '#F9B651' },\n    3: { name: '体温', color: '#F49150' },\n    4: { name: '血糖', color: '#F16467' },\n    5: { name: '体脂', color: '#AF6EF1' },\n    6: { name: '舌象', color: '#7FC8FB' },\n    7: { name: '舌象', color: '#7FC8FB' },\n    8: { name: '舌象', color: '#7FC8FB' },\n    9: { name: '舌象', color: '#7FC8FB' },\n};\nfunction sumTotal(arr) {\n    let s = 0;\n    arr.forEach((val, index, arr) => {\n        s += val.value == 0.1 ? 0 : val.value;\n    });\n    return s || 0;\n}\nvar data = [\n    { value: 12, checkType: '08', name: '舌象' },\n    { value: 6, checkType: '03', name: '血压' },\n    { value: 3, checkType: '02', name: '心电' },\n    { value: 2, checkType: '01', name: '血氧' },\n    { value: 4, checkType: '04', name: '体温' },\n];\n\n// 当前设备检测数据占比\nconst newData = [];\ndata.forEach((val, index, arr) => {\n    if (val.value > 0) {\n        newData.push({\n            value: val.value,\n            name: typeData[index].name,\n            itemStyle: {\n                color: typeData[index].color,\n            },\n            label: {\n                rich: {\n                    hr: {\n                        backgroundColor: typeData[index].color,\n                    },\n                    a: {\n                        color: '#999999',\n                    },\n                },\n            },\n        });\n    }\n});\ndata = newData;\n\nconst total = sumTotal(data);\nif (!total || total === 0) {\n    data = [\n        {\n            value: 0,\n            name: '空',\n            itemStyle: {\n                color: '#13102F',\n            },\n            label: {\n                show: false,\n            },\n        },\n    ];\n}\n\nconst reducer = (m, current) => {\n    const middleware = typeof m === 'number' ? m : m.value;\n    return middleware + current.value;\n};\nconst count = data.reduce(reducer);\n\nconst others = [];\nconst newOtherData = [];\nfor (let i = 0; i < data.length; i++) {\n    if (data[i].value / count < 0.05) {\n        others.push(data[i]);\n    } else {\n        newOtherData.push(data[i]);\n    }\n}\nif (others.length > 1) {\n    newOtherData.push({\n        name: '其他',\n        value: others.reduce(reducer),\n        itemStyle: {\n            color: '#9adfff',\n        },\n        label: {\n            rich: {\n                hr: {\n                    backgroundColor: '#9adfff',\n                },\n                a: {\n                    color: '#999999',\n                },\n            },\n        },\n    });\n}\n\noption = {\n    backgroundColor: '#02001D',\n    legend: {\n        show: false,\n        orient: 'vertical',\n        top: '0',\n        right: '0',\n        textStyle: {\n            color: '#666666',\n            fontWeight: 'normal',\n        },\n    },\n    title: {\n        text: `${titleText.text}\\n{number|${total}}\\n{loading|${titleText.unit}}`,\n        left: 'center',\n        top: 'center', // top待调整\n        textStyle: {\n            color: '#999999',\n            fontSize: 16,\n            fontWeight: '400',\n            rich: {\n                loading: {\n                    color: '#999999',\n                    height: 20,\n                    fontSize: 16,\n                },\n                number: {\n                    color: '#FFFFFF',\n                    height: 70,\n                    fontSize: 48,\n                    fontWeight: 'bold',\n                    padding: [10, 0, 0, 0],\n                },\n            },\n        },\n        itemGap: -4, // 主副标题间距\n    },\n    tooltip: {\n        trigger: 'item',\n        formatter: (params) => {\n            if (params.name === '其他') {\n                let str = '';\n                others.map((v) => {\n                    str += `${v.name}: ${v.value} ${titleText.unit} (${\n                        Math.round((v.value * 10000) / count) / 100\n                    }%)<br/>`;\n                });\n                return str;\n            } else {\n                return `${params.name}: ${params.value} ${titleText.unit} (${params.percent}%)`;\n            }\n        },\n    },\n    series: [\n        {\n            type: 'pie',\n            // radius: ['70%', '90%'],\n            radius: ['55%', '65%'],\n            center: ['50%', '50%'],\n            avoidLabelOverlap: true, //是否启用防止标签重叠策略，默认开启\n            color: titleText.color,\n            silent: !total,\n            label: {\n                show: !total ? false : titleText.labelLine,\n                position: 'outside',\n                formatter: '{a|{b}}\\n{hr|}',\n                rich: {\n                    hr: {\n                        backgroundColor: 't',\n                        borderRadius: 3,\n                        width: 3,\n                        height: 3,\n                        padding: [3, 3, 0, -12],\n                    },\n                    a: {\n                        padding: [-25, 5, -20, 3],\n                        color: '#999999',\n                    },\n                },\n            },\n            emphasis: {\n              label: {\n                show: true\n              }\n            },\n            labelLine: {\n                // show: !total ? false : titleText.labelLine,\n                normal: {\n                    show: false,\n                    length2: -2,\n                },\n            },\n            data: others.length <= 1 ? data : newOtherData\n        },\n    ],\n};\nvar dataLen = option.series[0].data.length\nsetTimeout(() => {\n    myChart.dispatchAction({\n        type: 'highlight',\n        seriesIndex: 0,\n        dataIndex: 0,\n    });\n}, 1000);\n\nmyChart.currentIndex = -1;\nsetInterval(() => {\n    // 取消之前高亮的图形\n    myChart.dispatchAction({\n        type: 'downplay',\n        seriesIndex: 0,\n        dataIndex: myChart.currentIndex,\n    });\n    myChart.currentIndex = (myChart.currentIndex + 1) % dataLen;\n    // 高亮当前图形\n    myChart.dispatchAction({\n        type: 'highlight',\n        seriesIndex: 0,\n        dataIndex: myChart.currentIndex,\n    });\n}, 2000);\n","html":"","externalScripts":"","updaterUID":"bd-2552167583","theme":"","layout":"","viewCount":0,"userName":"z***g","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xAMmcqslwX.png?v=1623229853830","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-bar","title"],"customTags":[],"updaterUserName":"z***g"}}