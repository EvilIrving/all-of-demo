{"status":0,"data":{"cid":"xK-lbp8oOa","authorUid":"obd-o2-aTjNCXh_ADELOPM4d70VB1G3Oy6I","authorUserName":"衰***命","title":"堆砌图总数和样式随图例选择变化","description":"","latestVersion":8,"alwaysLatest":1,"createTime":"2021-02-06T01:45:47.000Z","lastUpdateTime":"2021-02-06T01:45:47.000Z","auth":2,"uid":"obd-o2-aTjNCXh_ADELOPM4d70VB1G3Oy6I","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":8,"parentVersion":7,"echartsVersion":"4.8.0","versionCreateTime":"2021-02-06T06:53:10.000Z","code":"var getname = ['学前教育', '学前教育（公费师范）', '小学教育（公费师范）', '小学教育', '教育学', '公共事业管理', '公共事业管理（公共与非盈利管理）'];\r\nvar getvaluenum = [1, 20, 25, 0, 0, 0, 0, 5, 22, 32, 26, 41, 0, 0, 21, 0, 24, 25, 30, 15, 28, 20, 0, 23, 44, 24, 20, 37, 0, 0, 1, 1, 0, 1, 0];\r\nvar getxlmc = ['2020级', '2019级', '2018级', '2017级', '2016级'];\r\n\r\nvar getxlmcnum=getvaluenum.length/getname.length;\r\n\r\nvar getvalue = [];\r\nfor (let i = 0; i < getxlmcnum; i++) {\r\n  getvalue[i] = [];\r\n  for (let j = 0; j < getname.length; j++) {\r\n        getvalue[i][j] = getvaluenum[i*getname.length+j];\r\n\r\n  }\r\n}\r\n\r\nvar color1 = ['#63B4FF', '#FFD19A', '#64F0BC', '#BDBCFF', '#FFA387','#63B4FF', '#FFD19A', '#64F0BC', '#BDBCFF', '#FFA387'];\r\nvar color2 = ['#1890FF', '#FFD283', '#47D095', '#9C9BFF', '#FF6388','#1890FF', '#FFD283', '#47D095', '#9C9BFF', '#FF6388'];\r\nvar getvaluesum=[];\r\nfor(var i=0;i<getname.length;i++){\r\n    getvaluesum[i] =0\r\n    for(var j=0;j<getxlmcnum;j++){\r\n    \tgetvaluesum[i] += getvalue[j][i];\r\n    }\r\n}\r\n\r\nvar maxnum = Math.max.apply(null, getvaluesum);\r\nvar maxlen = Math.pow(10, String(Math.ceil(maxnum)).length - 2);\r\nif (maxnum >= 5) {\r\n    var max = Math.ceil(maxnum / (.95 * maxlen)) * maxlen;\r\n} else {\r\n    var max = 5;\r\n}\r\n\r\nvar series = [];\r\nfor (var i = 0; i < getxlmc.length; i++) {\r\n    series.push({\r\n        name: getxlmc[i],\r\n        type: 'bar',\r\n        data: getvalue[i],\r\n        stack: '各专业本科生年级分布',\r\n        barWidth: '20px',\r\n        itemStyle: {\r\n            normal: {\r\n                color: {\r\n                    x: 0,\r\n                    y: 0,\r\n                    x2: 0,\r\n                    y2: 1,\r\n                    colorStops: [{\r\n                        offset: 0,\r\n                        color: color1[i] // 0% 处的颜色\r\n                    }, {\r\n                        offset: 1,\r\n                        color: color2[i] // 100% 处的颜色\r\n                    }],\r\n                },\r\n                barBorderRadius: [0, 0, 0, 0],\r\n                label: {\r\n                    show: false,\r\n                    position: 'top',\r\n                    textStyle: {\r\n                        fontSize: 12,\r\n                        color: '#666666',\r\n                    },\r\n                }\r\n            }\r\n        },\r\n    })\r\n}\r\n\r\noption = {\r\n    grid: {\r\n        top: '33',\r\n        right: '15',\r\n        left: '50',\r\n        bottom: '55'\r\n    },\r\n    tooltip: {\r\n        trigger: 'axis',\r\n        axisPointer: {\r\n            type: 'none'\r\n        },\r\n        backgroundColor: 'rgba(21, 64, 92, 0.9)',\r\n        formatter: function(params) {\r\n            var str = ''; //声明一个变量用来存储数据\r\n            str += '<div>' + params[0].name + '</div>';\r\n            for (var i = 0; i < getxlmcnum; i++) {\r\n                if (params[i]) {\r\n                    if (params[i].value > 0) {\r\n                        str += '<span style=\"color:rgba(0, 255, 252, 1);font:16px bold;\">' + params[i].seriesName + '</span>本科生人数&nbsp;&nbsp;<span style=\"color:rgba(0, 255, 252, 1);\">' + params[i].value + '人</span></br>';\r\n                    }\r\n                }\r\n            }\r\n            return str;\r\n        }\r\n    },\r\n    legend: {\r\n        type: \"scroll\",\r\n        right: '10',\r\n        top: '0',\r\n        data: getxlmc,\r\n        itemGap: 25,\r\n        itemWidth: 16,\r\n        itemHeight: 16,\r\n        textStyle: {\r\n            fontSize: '13',\r\n            color: '#666666',\r\n        },\r\n\r\n    },\r\n    xAxis: [{\r\n        data: getname,\r\n        axisLabel: {\r\n            interval: 0,  \r\n            formatter: function(value) {\r\n                var ret = \"\"; //拼接加\\n返回的类目项  \r\n                var maxLength = 8; //每项显示文字个数  \r\n                var valLength = value.length; //X轴类目项的文字个数  \r\n                var rowN = Math.ceil(valLength / maxLength); //类目项需要换行的行数  \r\n                if (rowN > 1) //如果类目项的文字大于5,\r\n                {\r\n                    for (var i = 0; i < rowN; i++) {\r\n                        var temp = \"\"; //每次截取的字符串  \r\n                        var start = i * maxLength; //开始截取的位置  \r\n                        var end = start + maxLength; //结束截取的位置  \r\n                        //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  \r\n                        temp = value.substring(start, end) + \"\\n\";\r\n                        ret += temp; //凭借最终的字符串  \r\n                    }\r\n                    return ret;\r\n                } else {\r\n                    return value;\r\n                }\r\n            },\r\n            margin: 10,\r\n            color: '#666666',\r\n            textStyle: {\r\n                fontSize: 13,\r\n                fontWeight:400\r\n            },\r\n        },\r\n        axisLine: {\r\n            lineStyle: {\r\n                color: '#B0C5DB',\r\n            }\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n    }],\r\n    yAxis: [{\r\n        min: 0,\r\n        max: max, // 计算最大值\r\n        interval: max / 5, //  平均分为5份\r\n        splitNumber: 5,\r\n        name: '单位：人',\r\n        nameTextStyle: {\r\n            color: '#999999',\r\n            fontSize: 13,\r\n            padding: [0, 0, 0, 65]\r\n        },\r\n        axisLabel: {\r\n            color: '#666666',\r\n            textStyle: {\r\n                fontSize: 13\r\n            },\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        splitLine: {\r\n            lineStyle: {\r\n                color: '#CCDBEB',\r\n                type: 'dashed',\r\n                opacity: 0.5\r\n            }\r\n        }\r\n    }],\r\n    series: series\r\n};\r\n\r\nvar series = option[\"series\"];\r\nvar fun = function(params) {\r\n    var datavalue = 0;\r\n    for (var i = 0; i < series.length; i++) {\r\n        datavalue += series[i].data[params.dataIndex]\r\n    }\r\n    return datavalue;\r\n}\r\n\r\nif (series[series.length - 1]) {\r\n   series[series.length - 1][\"itemStyle\"][\"normal\"][\"label\"][\"show\"] = true;\r\n   series[series.length - 1][\"itemStyle\"][\"normal\"][\"label\"][\"formatter\"] = fun;\r\n   series[series.length - 1][\"itemStyle\"][\"normal\"][\"barBorderRadius\"] = [3, 3, 0, 0];\r\n}\r\nmyChart.on(\"legendselectchanged\", function(object) {\r\n\r\n    var b = object.selected, //图例的选中情况，key是图例的name，value是true或false\r\n        d = []; //选中的series的index列表\r\n    for (var key in b) {\r\n        if (b[key]) { //选中的图例\r\n            for (var i = 0; i < series.length; i++) {\r\n                var changename = series[i][\"name\"];\r\n                if (changename == key) {\r\n                    d.push(i); //选中的series的index列表\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    var fn = function(params) {\r\n        var datavalue = 0;\r\n        for (var i = 0; i < d.length; i++) {\r\n            for (var j = 0; j < series.length; j++) {\r\n                if (d[i] == j) {\r\n                    datavalue += series[j].data[params.dataIndex];\r\n                }\r\n            }\r\n        }\r\n\r\n        return datavalue;\r\n    }\r\n\r\n    for (var j = 0; j < series.length; j++) {\r\n        series[j][\"itemStyle\"][\"normal\"][\"label\"][\"show\"] = false;\r\n        series[j][\"itemStyle\"][\"normal\"][\"barBorderRadius\"] = [0, 0, 0, 0];\r\n    }\r\n\r\n    var l_s = series[d[d.length - 1]]; //选中的series的最后一个\r\n    if (l_s != null && l_s != \"\" && l_s != undefined) {\r\n        l_s[\"itemStyle\"][\"normal\"][\"label\"][\"show\"] = true; //显示label\r\n        l_s[\"itemStyle\"][\"normal\"][\"label\"][\"formatter\"] = fn; //绑定formatter\r\n        l_s[\"itemStyle\"][\"normal\"][\"barBorderRadius\"] = [3, 3, 0, 0];\r\n    }\r\n    myChart.setOption(option)\r\n})\r\n","html":"","externalScripts":"","updaterUID":"obd-o2-aTjNCXh_ADELOPM4d70VB1G3Oy6I","theme":"","layout":"","viewCount":156,"userName":"衰***命","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xK-lbp8oOa.png?v=1612594391102","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","tooltip"],"customTags":[],"updaterUserName":"衰***命"}}