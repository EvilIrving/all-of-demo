{"status":0,"data":{"cid":"x6OZscNlKY","authorUid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","authorUserName":"157*****625","title":"模仿excel复合饼图","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-08-11T09:50:27.000Z","lastUpdateTime":"2021-08-11T09:50:27.000Z","auth":2,"uid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.1.2","versionCreateTime":"2021-08-11T09:50:27.000Z","code":"\nlet markLineData = []\nlet source =  [\n            ['product', '2015', '2016'],\n            ['系列1-1', 43.3],\n            ['系列1-2', 83.1],\n            ['系列1-3', 86.4],\n            ['系列1-4', 72.4],\n            ['系列1-5', 72.4],\n            ['系列2-1', 20],\n            ['系列2-2', 10],\n            ['系列2-3',30],\n        ]\n\n \noption = {\n    grid: getBarHeight(),\n    legend: {},\n    tooltip: {},\n    dataset: {\n        source: source\n    },\n     xAxis: [\n        {\n            show:false,\n            type: 'category',\n            data: ['周一']\n        }\n    ],\n    yAxis: [\n        {\n            show:false,\n            max:\"dataMax\",\n            type: 'value'\n        }\n    ],\n    series: [{\n            type: 'pie',\n            radius: \"50%\",\n            center: ['25%', '50%'],\n            label: {\n                show: true,\n                position: \"inside\",\n            },\n            startAngle: 45, // 起始角度 45 \n            clockwise: false, // 逆时针 \n            markLine:{\n              lineStyle: {\n                type: 'solid',\n                color:\"#BFBFBF\"\n              },\n              symbol: 'none',\n              data:markLineData\n            }\n        }\n       \n    ]\n};\n\n// 添加“其他”\naddOtherData(source,3,option);\n\n\n// 获取表标线 对应点坐标 \nfunction getMarkLineData(percent) {\n    // 1.获取画布 width,height\n      let height = myChart.getHeight()\n      let width = myChart.getWidth() \n        \n    // 2.  根据 series[0].center 获取圆心坐标\n      let x0 = width*0.25 // 圆心x轴坐标\n    \n    //3.圆边上点坐标\n      // let x1   =   x0   +   r   *   cos(ao   *   3.14   /180   )\n      // let y1   =   y0   +   r   *   sin(ao   *   3.14   /180   )\n    \n    // “其他” 终点坐标series[0].startAngle 45\n      let x1 = x0 + (height/4) * Math.cos(45 * 3.14 / 180)\n      let y1 = (height*0.5)   -   (height/4)   *   Math.sin(45   *   3.14   /180   )\n      \n      let ao = 360 * (percent/100) // 扇形角度\n      \n      let ao1 = 0 // 用来计算的坐标角度\n      ao1=(ao<=45)?(45-ao):(360-(ao-45))\n      if(ao1<270 && ao1>45)ao1=270 // 角度当270用，要不样式不好看\n      \n      let x2=0,y2=0;\n      x2=x0 + (height/4) * Math.cos(ao1 * 3.14 / 180)\n      y2 = (height*0.5)  -   (height/4)   *   Math.sin(ao1   *   3.14   /180   )\n      \n      return [[{x:x1,y:y1},{x: \"75%\", y: \"35%\"}],[{x:x2,y:y2},{x: \"75%\", y: \"65%\"}]]\n}\n// 添加其他 \nfunction addOtherData(datasetSource,len,option){\n     let percent = 0\n      let sum=0 // 总计\n      datasetSource.forEach((data,rowIndex)=>{\n          if(rowIndex>0){ // 第一行数据不算\n                let count=0\n                for(let key of data){\n                  let value = isNaN(key)?0:Number(key)\n                  if(count===1)sum+=value\n                  count++\n                }\n          }\n      })\n      let endData = datasetSource.splice(datasetSource.length-len)\n      let other = [\"其他\"]\n      for(let i=0;i<endData.length;i++){\n        let j=0;\n          for(let key of endData[i]){\n            let value = isNaN(key)?0:key\n            if(j)other[j]?(other[j]+=value):other.push(value)\n            j++\n          }\n      }\n      datasetSource.push(other)\n      // \"其他\"占比\n      percent = sum?((other[1]/sum)*100).toFixed(2):100\n     option.series[0].markLine.data  = getMarkLineData(percent)\n     let minHeight = 0\n     if(!other[1]){ // 设置最小最小高度，防止为0时没有高度\n         height = myChart.getHeight()*0.3\n         minHeight = height/len\n         \n     }\n      getBarSeries(endData,option,minHeight)\n    }\n// 获取柱形图的高 \nfunction getBarHeight(){\n     let height = myChart.getHeight()\n     return [ {x: '75%', y: '35%', width: '100', height: height*0.3 }]\n}\n\nfunction getBarSeries(endData,option,minHeight){\n    let series=[]\n    endData.forEach(item=>{\n        let obj =  {\n            name: item[0],\n            type: 'bar',\n            stack: '系列2',\n            data: [item[1]],\n            barMinHeight:minHeight,\n            label:{\n                show:true,\n                position :\"inside\",\n                formatter:'{a}\\n{c}'\n            },\n            tooltip:{\n                show:false\n            }\n        }\n        series.push(obj)\n    })\n    option.series=option.series.concat(series)\n}\n    \n\n","html":"","externalScripts":"","updaterUID":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","theme":"","layout":"","viewCount":0,"userName":"157*****625","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x6OZscNlKY.png?v=1628675427849","isCustomThumbnail":1,"builtinTags":["category-work","dataset","grid","legend","markLine","series-bar","series-pie","tooltip"],"customTags":[],"updaterUserName":"157*****625"}}