{"status":0,"data":{"cid":"xqRgsitg19","authorUid":"bd-811754791","authorUserName":"I***妍","title":"实体属性关系图+坐标排序","description":"","latestVersion":2,"alwaysLatest":0,"createTime":"2022-01-21T09:44:39.000Z","lastUpdateTime":"2022-01-21T09:45:34.000Z","auth":1,"uid":"bd-811754791","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"5.2.2","versionCreateTime":"2022-01-21T09:45:34.000Z","code":"let dataInfo = [\n  {\n    name: '装机',\n    value: 52,\n    outNum: 52,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '回看',\n    value: 1,\n    outNum: 0,\n    loseNum: 1,\n    symbolSize: 50,\n    loseRate: '1.0000',\n  },\n  {\n    name: '订购失败',\n    value: 15,\n    outNum: 4,\n    loseNum: 11,\n    symbolSize: 50,\n    loseRate: '0.7333',\n  },\n  {\n    name: '点击页面订购按钮',\n    value: 52,\n    outNum: 42,\n    loseNum: 10,\n    symbolSize: 50,\n    loseRate: '0.1923',\n  },\n  {\n    name: '搜索',\n    value: 3,\n    outNum: 3,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '进入订购页',\n    value: 52,\n    outNum: 52,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '订购成功',\n    value: 11,\n    outNum: 3,\n    loseNum: 8,\n    symbolSize: 50,\n    loseRate: '0.7273',\n  },\n  {\n    name: '进入专区',\n    value: 52,\n    outNum: 52,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '开机',\n    value: 52,\n    outNum: 52,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '进入退订页',\n    value: 2,\n    outNum: 2,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '收藏',\n    value: 20,\n    outNum: 15,\n    loseNum: 5,\n    symbolSize: 50,\n    loseRate: '0.2500',\n  },\n  {\n    name: '发起退订',\n    value: 1,\n    outNum: 1,\n    loseNum: 0,\n    symbolSize: 50,\n    loseRate: '0.0000',\n  },\n  {\n    name: '直播',\n    value: 39,\n    outNum: 33,\n    loseNum: 6,\n    symbolSize: 50,\n    loseRate: '0.1538',\n  },\n  {\n    name: '点播',\n    value: 47,\n    outNum: 36,\n    loseNum: 11,\n    symbolSize: 50,\n    loseRate: '0.2340',\n  },\n];\nlet dataLink = [\n  {\n    source: '装机',\n    target: '开机',\n    value: 52,\n  },\n  {\n    source: '装机',\n    target: '直播',\n    value: 52,\n  },\n  {\n    source: '装机',\n    target: '点播',\n    value: 52,\n  },\n  {\n    source: '装机',\n    target: '进入专区',\n    value: 52,\n  },\n  {\n    source: '回看',\n    target: null,\n    value: 1,\n  },\n  {\n    source: '订购失败',\n    target: null,\n    value: 15,\n  },\n  {\n    source: '订购失败',\n    target: '直播',\n    value: 15,\n  },\n  {\n    source: '订购失败',\n    target: '点播',\n    value: 15,\n  },\n  {\n    source: '订购失败',\n    target: '订购成功',\n    value: 15,\n  },\n  {\n    source: '点击页面订购按钮',\n    target: null,\n    value: 52,\n  },\n  {\n    source: '点击页面订购按钮',\n    target: '收藏',\n    value: 52,\n  },\n  {\n    source: '点击页面订购按钮',\n    target: '直播',\n    value: 52,\n  },\n  {\n    source: '点击页面订购按钮',\n    target: '订购失败',\n    value: 52,\n  },\n  {\n    source: '点击页面订购按钮',\n    target: '点播',\n    value: 52,\n  },\n  {\n    source: '点击页面订购按钮',\n    target: '订购成功',\n    value: 52,\n  },\n  {\n    source: '搜索',\n    target: '点播',\n    value: 3,\n  },\n  {\n    source: '搜索',\n    target: '进入订购页',\n    value: 3,\n  },\n  {\n    source: '进入订购页',\n    target: '收藏',\n    value: 52,\n  },\n  {\n    source: '进入订购页',\n    target: '直播',\n    value: 52,\n  },\n  {\n    source: '进入订购页',\n    target: '点击页面订购按钮',\n    value: 52,\n  },\n  {\n    source: '进入订购页',\n    target: '点播',\n    value: 52,\n  },\n  {\n    source: '进入订购页',\n    target: '搜索',\n    value: 52,\n  },\n  {\n    source: '订购成功',\n    target: null,\n    value: 11,\n  },\n  {\n    source: '订购成功',\n    target: '订购失败',\n    value: 11,\n  },\n  {\n    source: '订购成功',\n    target: '点播',\n    value: 11,\n  },\n  {\n    source: '进入专区',\n    target: '开机',\n    value: 52,\n  },\n  {\n    source: '进入专区',\n    target: '收藏',\n    value: 52,\n  },\n  {\n    source: '进入专区',\n    target: '直播',\n    value: 52,\n  },\n  {\n    source: '进入专区',\n    target: '点播',\n    value: 52,\n  },\n  {\n    source: '进入专区',\n    target: '进入订购页',\n    value: 52,\n  },\n  {\n    source: '开机',\n    target: '直播',\n    value: 52,\n  },\n  {\n    source: '开机',\n    target: '点播',\n    value: 52,\n  },\n  {\n    source: '开机',\n    target: '进入订购页',\n    value: 52,\n  },\n  {\n    source: '开机',\n    target: '进入专区',\n    value: 52,\n  },\n  {\n    source: '进入退订页',\n    target: '发起退订',\n    value: 2,\n  },\n  {\n    source: '进入退订页',\n    target: '点击页面订购按钮',\n    value: 2,\n  },\n  {\n    source: '收藏',\n    target: null,\n    value: 20,\n  },\n  {\n    source: '收藏',\n    target: '回看',\n    value: 20,\n  },\n  {\n    source: '收藏',\n    target: '直播',\n    value: 20,\n  },\n  {\n    source: '收藏',\n    target: '搜索',\n    value: 20,\n  },\n  {\n    source: '收藏',\n    target: '点播',\n    value: 20,\n  },\n  {\n    source: '收藏',\n    target: '点击页面订购按钮',\n    value: 20,\n  },\n  {\n    source: '收藏',\n    target: '进入订购页',\n    value: 20,\n  },\n  {\n    source: '发起退订',\n    target: '直播',\n    value: 1,\n  },\n  {\n    source: '直播',\n    target: null,\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '开机',\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '进入退订页',\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '收藏',\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '点播',\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '点击页面订购按钮',\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '进入订购页',\n    value: 39,\n  },\n  {\n    source: '直播',\n    target: '进入专区',\n    value: 39,\n  },\n  {\n    source: '点播',\n    target: null,\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '进入退订页',\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '收藏',\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '直播',\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '点击页面订购按钮',\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '搜索',\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '进入订购页',\n    value: 47,\n  },\n  {\n    source: '点播',\n    target: '进入专区',\n    value: 47,\n  },\n];\n\nlet finalvalue = []\nconst func = (node,index) => {\n  const nodeNames = node.map(ii=>ii.name)\n  \n  // 现有的一级的target\n  const target = dataLink.filter(item=> nodeNames.includes(item.source)).map(i=>i.target)\n  \n   // 去重后的本次数据\n  const setTarget = Array.from(new Set(target))\n  \n  // 计算节点的坐标（第一个为准）\n  const arr = setTarget.filter(em=>!nodeNames.includes(em) && em).map((item,inde)=>{\n    return{\n      name:item,\n      value:[index+1, inde*10]\n    }\n  })\n // 拼接上一轮数据\n  node = node.concat(arr)\n  if (index < dataInfo.length && arr.length !== 0) func(node,index + 1)\n  else finalvalue = node\n};\n \nconst firstNode = [\n  {\n    name: '装机',\n    value: [0, 10],\n  },\n];\nfunc(firstNode,0)\n\n// 对已有数据重写value\ndataInfo.forEach(item=>{\n  finalvalue.forEach(em=>{\n    if(em.name === item.name) item.value = em.value\n  })\n})\n\noption = {\n  title: {\n    text: '实体属性关系图',\n    top: 'top',\n    left: 'center',\n  },\n  itemStyle: {\n    normal: {\n      color: '#000',\n    },\n    shadowBlur: 10,\n  },\n  animationDuration: 1500,\n  animationEasingUpdate: 'quinticInOut',\n  xAxis: {\n    show: false,\n    type: 'value',\n  },\n  yAxis: {\n    show: false,\n    type: 'value',\n  },\n  series: [\n    {\n      type: 'graph',\n      coordinateSystem: 'cartesian2d',\n      legendHoverLink: false,\n      hoverAnimation: true,\n      nodeScaleRatio: false,\n      //建头\n      edgeSymbol: ['circle', 'arrow'],\n      edgeSymbolSize: [2, 15],\n      edgeLabel: {\n        show: false,\n        normal: {\n          show: true,\n          position: 'middle',\n          textStyle: {\n            fontSize: 12,\n          },\n          formatter: '{c}',\n        },\n      },\n      focusNodeAdjacency: true,\n      roam: true,\n      categories: [\n        {\n          name: '一级关系',\n          itemStyle: {\n            //可配置颜色\n            normal: {\n              color: '#A170DD',\n            },\n          },\n        },\n        {\n          name: '二级关系',\n          itemStyle: {\n            //可配置颜色\n            normal: {\n              color: '#41B1EF',\n            },\n          },\n        },\n        {\n          name: '三级关系',\n          itemStyle: {\n            //可配置颜色\n            normal: {\n              color: '#E8B842',\n            },\n          },\n        },\n        {\n          name: '四级关系',\n          itemStyle: {\n            //可配置颜色\n            normal: {\n              color: '#667AED',\n            },\n          },\n        },\n      ],\n      //圆形上面的文字\n      label: {\n        normal: {\n          position: 'inside',\n          show: true,\n          textStyle: {\n            color: '#fff',\n            fontSize: 12,\n          },\n        },\n      },\n      force: {\n        repulsion: 2500,\n      },\n      itemStyle: {\n        normal: {\n          color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [\n            {\n              offset: 0,\n              color: '#157eff',\n            },\n            {\n              offset: 1,\n              color: '#35c2ff',\n            },\n          ]),\n        },\n        shadowBlur: 10,\n      },\n      data: dataInfo,\n      links: dataLink,\n    },\n  ],\n};\n","html":"","externalScripts":"","updaterUID":"bd-811754791","theme":"","layout":"","viewCount":0,"userName":"I***妍","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xqRgsitg19.png?v=1642758334998","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-graph","title"],"customTags":[],"updaterUserName":"I***妍"}}