{"status":0,"data":{"cid":"xQn6icdmIW","authorUid":"bd-3372784342","authorUserName":"小***7","title":"区间滑动动态更新多图表数据","description":"利用grid做多图表展示，dataZoom做数据展示细分，zoom事件做动态更新","latestVersion":2,"alwaysLatest":1,"createTime":"2019-02-16T07:35:29.000Z","lastUpdateTime":"2019-02-16T07:40:38.000Z","auth":2,"uid":"bd-3372784342","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.2.1","versionCreateTime":"2019-02-16T07:37:02.000Z","code":"const lineOpt = ({\n    timeList,\n    alist,\n    blist,\n    clist\n}) => {\n    const option = {\n        title: {\n            text: '区间滑动动态更新多图表数据'\n        },\n        legend: {\n            orient: \"horizontal\", // 'vertical'\n            x: \"center\", // 'center' | 'left' | {number},\n            y: \"60\" // 'center' | 'bottom' | {number}\n        },\n        tooltip: {\n            trigger: \"axis\",\n            transitionDuration: 0,\n            confine: true,\n            bordeRadius: 4,\n            borderWidth: 1,\n            borderColor: \"#333\",\n            backgroundColor: \"rgba(255,255,255,0.9)\",\n            textStyle: {\n                fontSize: 12,\n                color: \"#333\"\n            },\n            formatter: function(params) {\n                let time = params[0].axisValue;\n                return (\n                    `<div><time>${time}</time><br/>` +\n                    params\n                    .map(item => {\n                        return `<p>${item.marker + item.seriesName}: ${item.data[1]}</p>`;\n                    })\n                    .join(\"\")\n                );\n            }\n        },\n        axisPointer: {\n            type: \"shadow\",\n            link: {\n                xAxisIndex: \"all\"\n            }\n        },\n        toolbox: {\n            show: true,\n            x: \"right\",\n            y: \"50\",\n            feature: {\n                saveAsImage: {\n                    show: true\n                }\n            }\n        },\n        grid: [{\n                top: 100,\n                height: 100,\n                right: 50\n            },\n            {\n                top: 240,\n                height: 100,\n                right: 50\n            }\n        ],\n        xAxis: [{\n            type: \"category\",\n            gridIndex: 0,\n            axisTick: {\n                alignWithLabel: true\n            },\n            axisLabel: {\n                show: false\n            }\n        }, {\n            type: \"category\",\n            gridIndex: 1,\n            axisTick: {\n                alignWithLabel: true\n            }\n        }],\n        yAxis: [{\n                type: \"value\",\n                name: \"a\",\n                gridIndex: 0,\n                axisLabel: {\n                    formatter: \"{value}\"\n                }\n            }, {\n                type: \"value\",\n                name: \"b\",\n                axisLabel: {\n                    formatter: \"{value}\"\n                },\n                gridIndex: 1\n            },\n            {\n                type: \"value\",\n                name: \"c\",\n                axisLabel: {\n                    formatter: \"{value}\"\n                },\n                gridIndex: 0\n            }\n        ],\n        dataZoom: [{\n            type: \"slider\",\n            xAxisIndex: [0, 1],\n            filterMode: \"filter\",\n            zoomLock: false,\n            realtime: false,\n            start: 0,\n            end: 10,\n            top: 30\n        }],\n        series: [\n            genSeriesItem(timeList, alist, {\n                name: \"a数据\",\n                type: \"line\",\n                yAxisIndex: 0,\n                xAxisIndex: 0\n            }),\n            genSeriesItem(timeList, blist, {\n                name: \"b数据\",\n                type: \"line\",\n                yAxisIndex: 1,\n                xAxisIndex: 1\n            }),\n            genSeriesItem(timeList, clist, {\n                name: \"c数据\",\n                type: \"line\",\n                yAxisIndex: 2,\n                xAxisIndex: 0\n            })\n        ]\n    };\n    return option;\n};\nconst genSeriesItem = (times, datas, others) => {\n    return {\n        ...others,\n        data: times.map((time, index) => {\n            return [unixTimestamp(time), datas[index]];\n        })\n    };\n};\nconst unixTimestamp = (t) => {\n    var time = new Date();\n    time.setTime(t);\n    return `${time.getHours()}:${time.getMinutes()}:${time.getSeconds()}`;\n};\n\nvar now = new Date().getTime();\n\nfunction getData(t) {\n    var a = [],\n        b = [],\n        c = [],\n        tl = [];\n    for (var i = 0; i < 100; i++) {\n        tl.push(t + i * 1000);\n        a.push(Math.floor(Math.random() * 1000));\n        b.push(Math.floor(Math.random() * 100));\n        c.push(Math.floor(Math.random() * 1800));\n    }\n    return {\n        t: tl,\n        a: a,\n        b: b,\n        c: c\n    }\n}\n\nvar data = getData(now += 100000);\nmyChart.setOption(lineOpt({\n    timeList: data.t,\n    alist: data.a,\n    blist: data.b,\n    clist: data.c\n}), true);\nmyChart.on(\"datazoom\", params => {\n    // console.log(params)\n    // 折线图获取数据，需要做区域平移尾部触发分片数据加载\n    if (params.end === 100) {\n\n        var newData = getData(now += 100000);\n        // 加载完塞数据后，缩放区域要固定回上一个区域去\n        const dataZoom = myChart.getOption().dataZoom[0],\n            startValue = dataZoom.startValue,\n            endValue = dataZoom.endValue;\n        myChart.appendData(\n            genSeriesItem(newData.t, newData.a, {\n                seriesIndex: 0\n            })\n        );\n        myChart.appendData(\n            genSeriesItem(newData.t, newData.b, {\n                seriesIndex: 1\n            })\n        );\n        myChart.appendData(\n            genSeriesItem(newData.t, newData.c, {\n                seriesIndex: 2\n            })\n        );\n        // 直接appenddata不会更新数据，需要重新setOption\n        myChart.dispatchAction({\n            type: \"dataZoom\",\n            startValue,\n            endValue\n        });\n    }\n});","html":"","externalScripts":"","updaterUID":"bd-3372784342","theme":"default","layout":"","viewCount":210,"userName":"小***7","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xQn6icdmIW.png?v=1550302622933","isCustomThumbnail":0,"builtinTags":[],"customTags":[],"updaterUserName":"小***7"}}