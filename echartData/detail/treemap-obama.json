{"status":0,"data":{"cid":"treemap-obama","authorUid":"bd-2135947294","authorUserName":"echarts","title":"How $3.7 Trillion is Spent","description":"面积表达经费量值，切换图例\"2012Budget\"和\"Growth\"可看出使用明暗度表达增长率高低。","latestVersion":1,"alwaysLatest":1,"createTime":"2016-04-25T08:36:11.000Z","lastUpdateTime":"2016-04-25T11:56:04.000Z","auth":2,"uid":"bd-2135947294","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.1.6","versionCreateTime":"2016-04-25T08:36:11.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1461573008611-HJF5HLsl.json\";\n\nmyChart.showLoading();\n\nvar household_america_2012 = 113616229;\n$.getJSON(uploadedDataURL, function (obama_budget_2012) {\n    myChart.hideLoading();\n\n    var formatUtil;\n\n    function buildData(mode, originList) {\n        var out = [];\n\n        for (var i = 0; i < originList.length; i++) {\n            var node = originList[i];\n            var newNode = out[i] = cloneNodeInfo(node);\n            var value = newNode.value;\n\n            if (!newNode) {\n                continue;\n            }\n\n            // Calculate amount per household.\n            value[3] = value[0] / household_america_2012;\n\n            // if mode === 0 and mode === 2 do nothing\n            if (mode === 1) {\n                // Set 'Change from 2010' to value[0].\n                var tmp = value[1];\n                value[1] = value[0];\n                value[0] = tmp;\n            }\n\n            if (node.children) {\n                newNode.children = buildData(mode, node.children);\n            }\n        }\n\n        return out;\n    }\n\n    function cloneNodeInfo(node) {\n        if (!node) {\n            return;\n        }\n\n        var newNode = {};\n        newNode.name = node.name;\n        newNode.id = node.id;\n        newNode.discretion = node.discretion;\n        newNode.value = (node.value || []).slice();\n        return newNode;\n    }\n\n    function getLevelOption(mode) {\n        return [\n            {\n                color: mode === 2\n                    ? [\n                        '#c23531', '#314656', '#61a0a8', '#dd8668',\n                        '#91c7ae', '#6e7074', '#61a0a8', '#bda29a',\n                        '#44525d', '#c4ccd3'\n                    ]\n                    : null,\n                colorMappingBy: 'id',\n                itemStyle: {\n                    normal: {\n                        borderWidth: 3,\n                        gapWidth: 3\n                    }\n                }\n            },\n            {\n                colorAlpha: mode === 2\n                    ? [0.5, 1] : null,\n                itemStyle: {\n                    normal: {\n                        gapWidth: 1\n                    }\n                }\n            }\n        ];\n    }\n\n    function isValidNumber(num) {\n        return num != null && isFinite(num);\n    }\n\n    function getTooltipFormatter(mode) {\n        var amountIndex = mode === 1 ? 1 : 0;\n        var amountIndex2011 = mode === 1 ? 0 : 1;\n\n        return function (info) {\n            var value = info.value;\n\n            var amount = value[amountIndex];\n            amount = isValidNumber(amount)\n                ? formatUtil.addCommas(amount * 1000) + '$'\n                : '-';\n\n            var amount2011 = value[amountIndex2011];\n            amount2011 = isValidNumber(amount2011)\n                ? formatUtil.addCommas(amount2011 * 1000) + '$'\n                : '-';\n\n            var perHousehold = value[3];\n            perHousehold = isValidNumber(perHousehold)\n                ? formatUtil.addCommas((+perHousehold.toFixed(4)) * 1000) + '$'\n                : '-';\n\n            var change = value[2];\n            change = isValidNumber(change)\n                ? change.toFixed(2) + '%'\n                : '-';\n\n            return [\n                '<div class=\"tooltip-title\">' + formatUtil.encodeHTML(info.name) + '</div>',\n                '2012 Amount: &nbsp;&nbsp;' + amount + '<br>',\n                'Per Household: &nbsp;&nbsp;' + perHousehold + '<br>',\n                '2011 Amount: &nbsp;&nbsp;' + amount2011 + '<br>',\n                'Change From 2011: &nbsp;&nbsp;' + change\n            ].join('');\n        };\n    }\n\n    function createSeriesCommon() {\n        return {\n            type: 'treemap',\n            label: {\n                show: true,\n                formatter: \"{b}\",\n                normal: {\n                    textStyle: {\n                        ellipsis: true\n                    }\n                }\n            },\n            itemStyle: {\n                normal: {\n                    borderColor: 'black'\n                }\n            },\n            levels: getLevelOption(0)\n        };\n    }\n\n    formatUtil = echarts.format;\n    var modes = ['2012Budget', '2011Budget', 'Growth'];\n\n    myChart.setOption(option = {\n        title: {\n            left: 'center',\n            text: 'How $3.7 Trillion is Spent',\n            subtext: 'Obama’s 2012 Budget Proposal'\n        },\n\n        legend: {\n            data: modes,\n            selectedMode: 'single',\n            top: 50,\n            itemGap: 5\n        },\n\n        tooltip: {\n            formatter: getTooltipFormatter(0)\n        },\n\n        series: modes.map(function (mode, idx) {\n            var seriesOpt = createSeriesCommon();\n            seriesOpt.name = mode;\n            seriesOpt.top = 80;\n            seriesOpt.visualDimension = idx === 2 ? 2 : null;\n            seriesOpt.data = buildData(idx, obama_budget_2012);\n            seriesOpt.levels = getLevelOption(idx);\n            return seriesOpt;\n        })\n    });\n});","html":"","externalScripts":"","updaterUID":"bd-2135947294","theme":"default","layout":"","viewCount":3902,"userName":"echarts","commentCount":0,"starCount":5,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/treemap-obama.png?v=1461573371580","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-treemap","title","tooltip"],"customTags":[],"updaterUserName":"echarts"}}