{"status":0,"data":{"cid":"xrJKh_pfqe","authorUid":"bd-54322411","authorUserName":"纵横捭阖越千年","title":"股票分时刷新图","description":"股票分时刷新，坐标轴刻度颜色，tooltip formatter","latestVersion":2,"alwaysLatest":1,"createTime":"2017-02-28T09:53:52.000Z","lastUpdateTime":"2017-02-28T09:53:52.000Z","auth":2,"uid":"bd-54322411","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"3.4.0","versionCreateTime":"2017-02-28T09:55:39.000Z","code":"$(function() {\r\n    var i = 1;\r\n    //1s模拟1min\r\n    var timer = setInterval(function() {\r\n        i++;\r\n        refreshEcharts(i);\r\n        if (i > 241) clearInterval(timer);\r\n    }, 1000)\r\n\r\n})\r\n\r\n\r\n\r\nfunction refreshEcharts(data) {\r\n    var data0 = 2000,\r\n        data1 = [],\r\n        data2 = [],\r\n        minY,\r\n        maxY,\r\n        weekday = ['日', '一', '二', '三', '四', '五', ''];\r\n\r\n    //生成横坐标时间轴\r\n    var beforenoon = autoTimeline('9:30', '11:30');\r\n    var afternoon = autoTimeline('13:00', '15:00');\r\n    beforenoon.splice(beforenoon.length - 1, 1);\r\n    afternoon[0] = '11:30/13:00';\r\n    var timeline = beforenoon.concat(afternoon);\r\n\r\n    //模拟数据传入\r\n    for (var i = 0; i < 241; i++) {\r\n        var x = Math.floor(Math.random() * 200);\r\n        data1.push(2100 - x);\r\n    }\r\n    minY = ((Math.min.apply(Math, data1) - data0) / data0 * 100).toFixed(2);\r\n    maxY = ((Math.max.apply(Math, data1) - data0) / data0 * 100).toFixed(2);\r\n    for (var i = 0; i < 241; i++) {\r\n        var x = Math.floor(Math.random() * 100);\r\n        data2.push(2050 - x);\r\n    }\r\n\r\n    //图表初始化\r\n   \r\n     myChart.setOption(option = {\r\n        title: {\r\n            text: '股票分时刷新图',\r\n        },\r\n        dataZoom: [{\r\n            type: 'inside'\r\n        }],\r\n        tooltip: {\r\n            trigger: 'axis',\r\n            formatter: function(params) {\r\n                var today = new Date();\r\n                todays = today.getFullYear() + '/' + ((today.getMonth() + 1) < 10 ? '0' +\r\n                    (today.getMonth() + 1) : (today.getMonth() + 1)) + '/' + (today.getDate() < 10 ? '0' + today.getDate() : today.getDate());\r\n                //鼠标指向为空时显示为空\r\n                var res = params[0].name && params[0].name.length > 0 ?\r\n                    '<span >' +\r\n                    option.title.text + '<br />' + todays + '/' + weekday[today.getDay()] + ' ' + params[0].name + '<br />' +\r\n                    params[0].seriesName + ': <span style=\"color:' + setColor((params[0].data - data0)) + '\">' + params[0].data.toFixed(2) + '</span><br />' +\r\n                    params[1].seriesName + ': <span style=\"color:red\">' + params[1].data.toFixed(2) + '</span><br />' +\r\n                    '涨跌: <span style=\"color:' + setColor((params[0].data - data0)) + '\">' + (params[0].data - data0).toFixed(2) + '(' + ((params[0].data - data0) / data0 * 100).toFixed(2) + '%)</span>' +\r\n                    '</span>' :\r\n                    '';\r\n\r\n                function setColor(data) {\r\n                    return data > 0 ? '#FF0000' : '#00FF00';\r\n                }\r\n                return res;\r\n            }\r\n        },\r\n\r\n        toolbox: {\r\n            show: true,\r\n            feature: {\r\n                mark: {\r\n                    show: true\r\n                },\r\n                restore: {\r\n                    show: true\r\n                },\r\n                saveAsImage: {\r\n                    show: true\r\n                }\r\n            }\r\n        },\r\n        calculable: true,\r\n        xAxis: [{\r\n            type: 'category',\r\n            boundaryGap: false,\r\n            axisLabel: {\r\n                interval: 59,\r\n            },\r\n            data: timeline,\r\n\r\n        }],\r\n        yAxis: [{\r\n            type: 'value',\r\n            scale: true,\r\n            min: 'dataMin',\r\n            max: 'dataMax',\r\n\r\n            axisLabel: {\r\n                formatter: function(val) {\r\n                    return val.toFixed(2);\r\n                },\r\n                textStyle: {\r\n                    color: function(val) {\r\n                        //设置坐标轴刻度颜色(大于1000的数需要去除'，')\r\n                        return val.split(',').join('') < data0 ? 'green' : 'red';\r\n                    }\r\n                }\r\n            },\r\n        }, {\r\n            type: 'value',\r\n            scale: true,\r\n            min: minY,\r\n            max: maxY,\r\n\r\n            axisLabel: {\r\n                formatter: function(val) {\r\n                    return val + '%';\r\n                },\r\n                textStyle: {\r\n                    color: function(val) {\r\n                        return val.split(',').join('') < 0 ? 'green' : 'red';\r\n                    }\r\n                }\r\n            },\r\n\r\n        }],\r\n\r\n        // visualMap: {\r\n        //     show: false,\r\n        //     pieces: [{\r\n        //         gt: 0,\r\n        //         lte: data0,\r\n        //         color: 'green'\r\n        //     }, {\r\n        //         gt: data0,\r\n        //         color: 'red'\r\n        //     }]\r\n        // },\r\n        series: [{\r\n            name: '价格',\r\n            itemStyle: {\r\n                normal: {\r\n                    color: 'blue',\r\n                }\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 1\r\n                }\r\n            },\r\n            animation: false,\r\n            smooth: true,\r\n            type: 'line',\r\n            data: data1,\r\n            markPoint: {\r\n                data: [{\r\n                    type: 'max',\r\n                    name: '最大值'\r\n                }, {\r\n                    type: 'min',\r\n                    name: '最小值'\r\n                }]\r\n            },\r\n            markLine: {\r\n                silent: true,\r\n                label: {\r\n                    normal: {\r\n                        position: 'start'\r\n                    }\r\n                },\r\n                data: [{\r\n                    yAxis: data0.toFixed(2)\r\n                }]\r\n            }\r\n        }, {\r\n            name: '均值',\r\n            itemStyle: {\r\n                normal: {\r\n                    color: 'black',\r\n                }\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 1\r\n                }\r\n            },\r\n            animation: false,\r\n            smooth: true,\r\n            type: 'line',\r\n            data: data2,\r\n\r\n        }]\r\n    });\r\n\r\n\r\n}\r\n\r\n\r\nfunction autoTimeline(start, end) {\r\n    var timeline = [],\r\n        startHour = start.split(':')[0] * 1,\r\n        startMin = start.split(':')[1] * 1,\r\n        endHour = end.split(':')[0] * 1,\r\n        endMin = end.split(':')[1] * 1;\r\n    for (var i = startHour; i <= endHour; i++) {\r\n        var start = (i == startHour) ? startMin : '0';\r\n        var end = (i == endHour) ? endMin : '59';\r\n        for (var j = start; j <= end; j++) {\r\n            j = (j < 10) ? '0' + j : j;\r\n            timeline.push(i + \":\" + j);\r\n        }\r\n    }\r\n    return timeline;\r\n}","html":"","externalScripts":"","updaterUID":"bd-54322411","theme":"","layout":"","viewCount":1272,"userName":"纵横捭阖越千年","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrJKh_pfqe.png?v=1488275740190","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","markLine","markPoint","series-line","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"纵横捭阖越千年"}}