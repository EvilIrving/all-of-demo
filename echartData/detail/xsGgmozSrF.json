{"status":0,"data":{"cid":"xsGgmozSrF","authorUid":"obd-oEZ_HCiGXKJiieqxiZ_4MEjbmCJ-54D","authorUserName":"n***2","title":"pie map","description":"带饼图的世界地图","latestVersion":1,"alwaysLatest":1,"createTime":"2020-12-07T02:53:17.000Z","lastUpdateTime":"2020-12-07T02:53:17.000Z","auth":1,"uid":"obd-oEZ_HCiGXKJiieqxiZ_4MEjbmCJ-54D","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.8.0","versionCreateTime":"2020-12-07T02:53:17.000Z","code":"const worldGeoCoordMap = {\r\n    '美国蒙特里': [-121.874729, 36.541478],\r\n    '荷兰奥特芬': [5.057415, 52.735095],\r\n    '中国上海': [121.4648, 31.2891]\r\n};\r\nconst worldDatas = [\r\n    ['美国蒙特里', 10, 20, 30, 0, 0],\r\n    ['荷兰奥特芬', 0, 0, 0, 0, 1],\r\n    ['中国上海', 0, 50, 0, 100, 0]\r\n];\r\n\r\nlet series = [];\r\n\r\nconst option = {\r\n    tooltip: {\r\n        trigger: 'item',\r\n        backgroundColor: 'rgba(166, 200, 76, 0.82)',\r\n        borderColor: '#FFFFCC',\r\n        showDelay: 0,\r\n        hideDelay: 0,\r\n        enterable: true,\r\n        transitionDuration: 0,\r\n        extraCssText: 'z-index:100',\r\n        formatter: function(params, ticket, callback) {\r\n            //根据业务自己拓展要显示的内容\r\n            var res = \"\";\r\n            var name = params.name;\r\n            var value = params.value[params.seriesIndex + 1];\r\n            res = \"<span style='color:#fff;'>\" + name + \"</span><br/>数据：\" + value;\r\n            return res;\r\n        }\r\n    },\r\n    geo: {\r\n        map: 'world',\r\n        zoom: 1.2,\r\n        label: {\r\n            emphasis: {\r\n                show: false\r\n            }\r\n        },\r\n        roam: true, //是否允许缩放\r\n        itemStyle: {\r\n            normal: {\r\n                areaColor: '#DDD',\r\n                borderColor: '#b1b1b1'\r\n            },\r\n            emphasis: {\r\n                areaColor: '#DDD'\r\n            }\r\n        }\r\n    },\r\n    series: series\r\n};\r\n\r\nconst renderStations = () => {\r\n    let option = {\r\n        title: [],\r\n        grid: [],\r\n        legend: {\r\n            //   x: '64%',\r\n            //   y: '30%',\r\n            //   orient: 'vertical',\r\n            data: ['GPS', 'GLONASS', 'GALILEO', 'BDS', '异常']\r\n        },\r\n        series: []\r\n    };\r\n\r\n    echarts.util.each(worldDatas, function(dataItem, idx) {\r\n        let geoCoord = worldGeoCoordMap[dataItem[0]];\r\n        let coord = myChart.convertToPixel('geo', geoCoord);\r\n        idx = String(idx);\r\n        inflationData = [{\r\n                name: 'GPS',\r\n                value: dataItem[1]\r\n            },\r\n            {\r\n                name: 'GLONASS',\r\n                value: dataItem[2]\r\n            },\r\n            {\r\n                name: 'GALILEO',\r\n                value: dataItem[3]\r\n            },\r\n            {\r\n                name: 'BDS',\r\n                value: dataItem[4]\r\n            },\r\n            {\r\n                name: '异常',\r\n                value: dataItem[5]\r\n            },\r\n        ];\r\n        let total = dataItem[1] + dataItem[2] + dataItem[3] + dataItem[4] + dataItem[5];\r\n        let title = {\r\n            text: dataItem[0],\r\n            textStyle: {\r\n                fontSize: 10,\r\n                fontWeight: 'bold'\r\n            },\r\n            x: coord[0] - 15,\r\n            y: coord[1] + 15\r\n        };\r\n        option.title.push(title);\r\n        option.grid.push({\r\n            id: idx,\r\n            gridId: idx,\r\n            width: 30,\r\n            height: 40,\r\n            left: coord[0] - 15,\r\n            top: coord[1] - 15,\r\n            z: 100\r\n        });\r\n        option.series.push({\r\n            id: idx,\r\n            type: 'pie',\r\n            label: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: true\r\n                }\r\n            },\r\n            lableLine: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: true\r\n                }\r\n            },\r\n            radius: 15,\r\n            center: coord,\r\n            data: inflationData,\r\n            z: 100,\r\n            tooltip: {\r\n                trigger: 'item',\r\n                formatter: '{b} : {c}'\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    color: function(params) {\r\n                        // 每个饼的颜色\r\n                        let colorList = ['#38c2cc', '#a047f2', '#f7bb2a', '#a7f421', '#f02020'];\r\n                        return colorList[params.dataIndex];\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n    myChart.setOption(option);\r\n}\r\n\r\nsetTimeout(renderStations, 0);\r\n// 缩放和拖拽\r\nfunction throttle(fn, delay, debounce) {\r\n    let currCall;\r\n    let lastCall = 0;\r\n    let lastExec = 0;\r\n    let timer = null;\r\n    let diff;\r\n    let scope;\r\n    let args;\r\n\r\n    delay = delay || 0;\r\n\r\n    function exec() {\r\n        lastExec = new Date().getTime();\r\n        timer = null;\r\n        fn.apply(scope, args || []);\r\n    }\r\n\r\n    let cb = function() {\r\n        currCall = new Date().getTime();\r\n        scope = this;\r\n        args = arguments;\r\n        diff = currCall - (debounce ? lastCall : lastExec) - delay;\r\n\r\n        clearTimeout(timer);\r\n\r\n        if (debounce) {\r\n            timer = setTimeout(exec, delay);\r\n        } else {\r\n            if (diff >= 0) {\r\n                exec();\r\n            } else {\r\n                timer = setTimeout(exec, -diff);\r\n            }\r\n        }\r\n\r\n        lastCall = currCall;\r\n    };\r\n\r\n    return cb;\r\n}\r\n\r\nconst throttledRenderEachStation = throttle(renderStations, 0);\r\nmyChart.on('geoRoam', throttledRenderEachStation);\r\nmyChart.setOption(option);","html":"","externalScripts":"/dep/echarts/map/js/world.js","updaterUID":"obd-oEZ_HCiGXKJiieqxiZ_4MEjbmCJ-54D","theme":"","layout":"","viewCount":131,"userName":"n***2","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xsGgmozSrF.png?v=1607309597719","isCustomThumbnail":0,"builtinTags":["category-work","geo","legend","series-pie","title","tooltip"],"customTags":[],"updaterUserName":"n***2"}}