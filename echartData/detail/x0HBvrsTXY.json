{"status":0,"data":{"cid":"x0HBvrsTXY","authorUid":"bd-2468652156","authorUserName":"z***2","title":"地图下钻","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-11-08T02:47:30.000Z","lastUpdateTime":"2021-11-08T02:47:30.000Z","auth":1,"uid":"bd-2468652156","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.2","versionCreateTime":"2021-11-08T02:47:30.000Z","code":"$('<div class=\"back\">返回</div>').appendTo(\n    $('#chart-panel')\n);\n\n$('.back').css({\n    'position': 'absolute',\n    'left': '17px',\n    'top': '25px',\n    'color': 'rgb(222,222,222)',\n    'font-size': '15px',\n    'cursor': 'pointer',\n    'z-index': '100'\n})\n\n$('.back').click(function() {\n    renderChina()\n})\n\nvar neimenggu = \"/asset/get/s/data-1636337430226-jP0NQTylZ.json\";\n\nvar shanxi = \"/asset/get/s/data-1636337387463-rURPysXKY.json\";\n\nvar china = \"/asset/get/s/data-1594281065688-80dQTMwuL.json\";\n\nvar urlMap = {\n    '陕西省': {\n        name: 'shanxisheng',\n        url: shanxi\n    },\n    '内蒙古自治区': {\n        name: 'neimenggu',\n        url: neimenggu\n    }\n}\n\nvar data = [\n    { province: '陕西省', city: '榆林市', value: 200 },\n    { province: '陕西省', city: '延安市', value: 90 },\n    { province: '陕西省', city: '铜川市', value: 160 },\n    { province: '陕西省', city: '西安市', value: 280 },\n    { province: '陕西省', city: '咸阳市', value: 180 },\n    { province: '陕西省', city: '汉中市', value: 80 },\n    { province: '陕西省', city: '安康市', value: 90 },\n    { province: '内蒙古自治区', city: '阿拉善盟' , value: 160 },\n    { province: '内蒙古自治区', city: '赤峰市', value: 120}\n]\n\nfunction getProvinceData() {\n    // 统计方法count\n    const obj = {}\n    data.forEach((item) => {\n        if (obj[item.province]) {\n            obj[item.province] += item.value\n        } else {\n            obj[item.province] = item.value\n        }\n    })\n    const arr = []\n    for(const key in obj) {\n        arr.push({\n            name: key,\n            value: obj[key]\n        })\n    }\n    return arr\n}\n\nfunction renderChina() {\n    $.getJSON(china, function(geoJson) {\n        echarts.registerMap('china', geoJson)\n        var option = {\n            tooltip: {\n                trigger: 'item',\n                formatter: '{b}: {c}'\n            },\n            series: [{\n                type: 'map',\n                map: 'china',\n                data: getProvinceData()\n            }]\n        }\n        myChart.setOption(option)\n        myChart.off('click')\n        myChart.on('click', chinaClick)\n    })\n}\n\nfunction chinaClick(params) {\n    renderProvince(params.name)\n}\n\nfunction renderProvince(name) {\n    $.getJSON(urlMap[name].url, function(geoJson) {\n        echarts.registerMap(urlMap[name].name, geoJson)\n        var option = {\n            tooltip: {\n                trigger: 'item',\n                formatter: '{b}: {c}'\n            },\n            series: [{\n                type: 'map',\n                map: urlMap[name].name,\n                data: getCityData(name),\n                label: {\n                    show: true,\n                    formatter: '{b}: {c}'\n                }\n            }]\n        }\n        myChart.setOption(option)\n    })\n}\n\nfunction getCityData(name) {\n    const res = data.filter((item) => item.province === name)\n    return res.map((item) => ({ name: item.city, value: item.value }))\n}\n\nrenderChina()","html":"","externalScripts":"","updaterUID":"bd-2468652156","theme":"","layout":"","viewCount":0,"userName":"z***2","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x0HBvrsTXY.png?v=1636339650968","isCustomThumbnail":0,"builtinTags":["category-work","series-map","tooltip"],"customTags":[],"updaterUserName":"z***2"}}