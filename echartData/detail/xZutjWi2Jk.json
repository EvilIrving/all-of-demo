{"status":0,"data":{"cid":"xZutjWi2Jk","authorUid":"bd-167860219","authorUserName":"n***1","title":"osm建筑模型叠加测试","description":"在osm下载地图后，用Python提取其中的建筑物信息，构建shp后可视化效果测试。osm上部分建筑信息没有","latestVersion":6,"alwaysLatest":0,"createTime":"2021-08-06T15:12:02.000Z","lastUpdateTime":"2021-11-05T02:09:31.000Z","auth":2,"uid":"bd-167860219","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":6,"parentVersion":5,"echartsVersion":"4.9.0","versionCreateTime":"2021-11-05T02:09:31.000Z","code":"var uploadedDataURL = '/asset/get/s/data-1590291019662-Pukz5wykJ.json';\nmapboxgl.accessToken = mapboxglToken;\n\nvar ENCODE_SCALE = 1e6;\n\nvar geoJSON = {\n    features: [],\n};\nvar regions = [];\nvar readShp = new Promise(function (resolve, reject) {\n    shapefile\n        .open('/asset/get/s/data-1628263403232-XyuuH7p_0.shp', '/asset/get/s/data-1628263416060-SwJ3licwd.dbf')\n        .then((source) =>\n            source.read().then(function append(result) {\n                if (result.done) {\n                    resolve();\n                    return;\n                }\n                var feature = result.value;\n                feature.properties.name = geoJSON.features.length + '';\n                regions.push({\n                    name: geoJSON.features.length + '',\n                    value: 1,\n                    height: feature.properties.SHAPE_leng * 7,\n                });\n                geoJSON.features.push(feature);\n                return source.read().then(append);\n            })\n        );\n});\n\nmyChart.showLoading();\n\nPromise.all([$.getJSON('/asset/get/s/data-1590291019662-Pukz5wykJ.json'), readShp]).then(function ([\n    data,\n    lastFeature,\n]) {\n    myChart.hideLoading();\n\n    echarts.registerMap('buildings', geoJSON);\n    myChart.setOption({\n        mapbox3D: {\n            center: [121.4953, 31.23807],\n            zoom: 16,\n            pitch: 50,\n            bearing: 90,\n            style: 'mapbox://styles/mapbox/light-v9',\n            // altitudeScale: 1,\n            postEffect: {\n                enable: true,\n                FXAA: {\n                    enable: true,\n                },\n            },\n            light: {\n                main: {\n                    intensity: 1,\n                    shadow: true,\n                    shadowQuality: 'high',\n                },\n                ambient: {\n                    intensity: 0,\n                },\n                ambientCubemap: {\n                    texture: '/asset/get/s/data-1491838644249-ry33I7YTe.hdr',\n                    exposure: 1,\n                    diffuseIntensity: 0.5,\n                    specularIntensity: 2,\n                },\n            },\n        },\n        series: [\n            {\n                type: 'map3D',\n                map: 'buildings',\n                coordinateSystem: 'mapbox3D',\n                shading: 'realistic',\n                silent: true,\n                instancing: true,\n                data: regions,\n                realisticMaterial: {\n                    metalness: 0.9,\n                    roughness: 0.2,\n                },\n            },\n            {\n                type: 'lines3D',\n                shading: 'realistic',\n                coordinateSystem: 'mapbox3D',\n                barSize: 0.4,\n                silent: true,\n                data: [\n                    [//地铁二号线\n                        [121.296604, 31.191232],\n                        [121.300943, 31.19353],\n                        [121.303647, 31.194449],\n                        [121.305471, 31.194793],\n                        [121.309143, 31.195279],\n                        [121.313226, 31.195802],\n                        [121.31698, 31.195925],\n                        [121.31698, 31.195925],\n                        [121.318458, 31.195981],\n                        [121.318879, 31.196036],\n                        [121.320854, 31.196536],\n                        [121.321112, 31.196564],\n                        [121.321726, 31.196596],\n                        [121.321726, 31.196596],\n                        [121.322471, 31.196596],\n                        [121.326923, 31.196462],\n                        [121.327737, 31.196517],\n                        [121.328612, 31.196848],\n                        [121.328998, 31.197225],\n                        [121.329783, 31.198669],\n                        [121.330139, 31.199585],\n                        [121.330013, 31.20037],\n                        [121.327935, 31.204793],\n                        [121.326896, 31.207268],\n                        [121.326411, 31.209887],\n                        [121.326782, 31.214258],\n                        [121.327245, 31.216546],\n                        [121.327887, 31.218142],\n                        [121.328369, 31.21861],\n                        [121.32878, 31.218876],\n                        [121.329619, 31.219317],\n                        [121.33112, 31.219697],\n                        [121.332201, 31.219881],\n                        [121.333352, 31.220158],\n                        [121.334505, 31.220331],\n                        [121.33562, 31.220499],\n                        [121.336968, 31.220627],\n                        [121.338841, 31.220706],\n                        [121.339788, 31.220634],\n                        [121.342723, 31.220568],\n                        [121.347113, 31.220444],\n                        [121.348782, 31.220373],\n                        [121.351066, 31.220334],\n                        [121.35463, 31.220042],\n                        [121.35463, 31.220042],\n                        [121.35894, 31.219793],\n                        [121.363002, 31.219513],\n                        [121.363521, 31.219463],\n                        [121.365688, 31.219084],\n                        [121.368001, 31.218656],\n                        [121.369405, 31.218306],\n                        [121.369405, 31.218306],\n                        [121.370639, 31.218016],\n                        [121.370914, 31.217975],\n                        [121.37134, 31.217916],\n                        [121.372058, 31.217866],\n                        [121.373955, 31.217794],\n                        [121.375115, 31.217714],\n                        [121.378066, 31.217465],\n                        [121.379166, 31.217343],\n                        [121.380736, 31.217043],\n                        [121.381547, 31.216864],\n                        [121.382427, 31.216667],\n                        [121.382427, 31.216667],\n                        [121.384587, 31.216203],\n                        [121.388258, 31.215425],\n                        [121.391271, 31.214785],\n                        [121.393272, 31.214376],\n                        [121.395603, 31.213657],\n                        [121.398205, 31.213166],\n                        [121.399631, 31.212907],\n                        [121.399631, 31.212907],\n                        [121.40049, 31.21278],\n                        [121.400765, 31.212772],\n                        [121.401542, 31.212819],\n                        [121.404194, 31.214153],\n                        [121.405845, 31.21578],\n                        [121.406825, 31.216591],\n                        [121.410093, 31.219444],\n                        [121.411029, 31.219845],\n                        [121.413338, 31.220313],\n                        [121.413338, 31.220313],\n                        [121.415436, 31.220761],\n                        [121.419458, 31.220828],\n                        [121.423519, 31.220609],\n                        [121.424519, 31.220638],\n                        [121.426032, 31.220987],\n                        [121.427014, 31.221441],\n                        [121.427893, 31.221692],\n                        [121.427893, 31.221692],\n                        [121.428999, 31.221999],\n                        [121.42993, 31.222107],\n                        [121.430647, 31.221997],\n                        [121.430921, 31.221923],\n                        [121.431886, 31.221357],\n                        [121.432356, 31.221312],\n                        [121.432877, 31.221407],\n                        [121.435247, 31.22243],\n                        [121.435819, 31.222676],\n                        [121.436303, 31.222814],\n                        [121.437783, 31.223093],\n                        [121.438798, 31.223563],\n                        [121.44139, 31.224958],\n                        [121.441679, 31.225084],\n                        [121.441679, 31.225084],\n                        [121.444177, 31.226207],\n                        [121.444948, 31.226606],\n                        [121.448864, 31.228715],\n                        [121.454454, 31.231433],\n                        [121.454656, 31.231518],\n                        [121.455742, 31.231861],\n                        [121.455742, 31.231861],\n                        [121.457895, 31.232537],\n                        [121.459104, 31.232763],\n                        [121.463471, 31.233232],\n                        [121.465361, 31.233473],\n                        [121.466207, 31.233781],\n                        [121.468212, 31.234777],\n                        [121.468212, 31.234777],\n                        [121.469934, 31.235681],\n                        [121.470226, 31.235854],\n                        [121.47118, 31.23641],\n                        [121.472291, 31.236874],\n                        [121.476988, 31.238234],\n                        [121.479244, 31.239115],\n                        [121.479244, 31.239115],\n                        [121.48378, 31.240685],\n                        [121.485576, 31.240945],\n                        [121.491759, 31.241085],\n                        [121.493863, 31.240985],\n                        [121.496283, 31.240506],\n                        [121.49779, 31.240017],\n                        [121.49779, 31.240017],\n                        [121.499824, 31.239343],\n                        [121.507451, 31.236578],\n                        [121.508734, 31.236134],\n                        [121.511038, 31.235389],\n                        [121.511038, 31.235389],\n                        [121.516218, 31.233702],\n                        [121.516909, 31.233443],\n                        [121.520468, 31.232122],\n                        [121.52083, 31.231933],\n                        [121.521489, 31.231561],\n                        [121.522564, 31.231001],\n                        [121.522564, 31.231001],\n                        [121.528114, 31.228172],\n                        [121.533478, 31.225261],\n                        [121.533821, 31.225053],\n                        [121.53494, 31.224394],\n                        [121.537746, 31.222634],\n                        [121.53982, 31.221357],\n                        [121.53982, 31.221357],\n                        [121.542492, 31.219727],\n                        [121.544139, 31.218633],\n                        [121.544435, 31.217986],\n                        [121.545952, 31.213977],\n                        [121.54622, 31.213023],\n                        [121.546484, 31.211772],\n                        [121.546484, 31.211772],\n                        [121.546714, 31.210812],\n                        [121.547617, 31.209028],\n                        [121.55011, 31.20647],\n                        [121.55122, 31.20549],\n                        [121.551552, 31.205322],\n                        [121.553154, 31.205246],\n                        [121.553154, 31.205246],\n                        [121.554143, 31.20521],\n                        [121.559505, 31.204979],\n                        [121.561176, 31.204989],\n                        [121.567058, 31.205078],\n                        [121.56844, 31.204868],\n                        [121.574357, 31.203141],\n                        [121.575618, 31.202906],\n                        [121.57719, 31.203014],\n                        [121.582329, 31.203868],\n                        [121.583367, 31.204046],\n                        [121.583367, 31.204046],\n                        [121.584532, 31.204233],\n                        [121.595736, 31.205987],\n                        [121.597799, 31.206361],\n                        [121.597799, 31.206361],\n                        [121.599739, 31.206713],\n                        [121.603577, 31.207439],\n                        [121.60657, 31.208258],\n                        [121.611515, 31.211388],\n                        [121.613271, 31.212319],\n                        [121.614725, 31.21303],\n                        [121.614895, 31.213091],\n                        [121.616368, 31.213266],\n                        [121.616368, 31.213266],\n                        [121.618306, 31.213442],\n                        [121.636463, 31.214046],\n                        [121.649569, 31.215318],\n                        [121.651883, 31.215858],\n                        [121.651883, 31.215858],\n                        [121.654697, 31.216516],\n                        [121.658491, 31.217573],\n                        [121.660129, 31.217793],\n                        [121.662099, 31.217952],\n                        [121.663332, 31.217897],\n                        [121.664357, 31.217784],\n                        [121.665355, 31.217532],\n                        [121.666497, 31.217101],\n                        [121.668061, 31.216393],\n                        [121.668621, 31.216134],\n                        [121.66964, 31.215552],\n                        [121.66964, 31.215552],\n                        [121.670909, 31.214826],\n                        [121.671941, 31.214124],\n                        [121.672732, 31.213473],\n                        [121.673415, 31.21269],\n                        [121.67381, 31.212009],\n                        [121.674101, 31.211244],\n                        [121.675364, 31.206508],\n                        [121.676236, 31.201074],\n                        [121.676586, 31.198913],\n                        [121.676586, 31.198913],\n                        [121.676685, 31.198311],\n                        [121.676719, 31.198103],\n                        [121.67748, 31.194213],\n                        [121.677677, 31.193596],\n                        [121.677929, 31.192955],\n                        [121.678288, 31.192114],\n                        [121.679114, 31.190545],\n                        [121.679903, 31.189434],\n                        [121.680549, 31.188618],\n                        [121.681015, 31.18811],\n                        [121.681768, 31.187619],\n                        [121.682431, 31.187329],\n                        [121.683469, 31.187118],\n                        [121.685564, 31.186846],\n                        [121.686231, 31.186795],\n                        [121.686512, 31.186792],\n                        [121.686986, 31.186842],\n                        [121.688229, 31.187194],\n                        [121.691678, 31.188178],\n                        [121.693732, 31.188758],\n                        [121.693732, 31.188758],\n                        [121.695769, 31.189338],\n                        [121.700317, 31.190303],\n                        [121.706837, 31.191743],\n                        [121.713698, 31.193202],\n                        [121.715964, 31.1937],\n                        [121.719386, 31.194884],\n                        [121.719386, 31.194884],\n                        [121.7262, 31.197203],\n                        [121.737444, 31.199712],\n                        [121.746925, 31.201095],\n                        [121.751226, 31.201479],\n                        [121.751226, 31.201479],\n                        [121.759023, 31.201888],\n                        [121.761588, 31.202077],\n                        [121.76491, 31.202333],\n                        [121.766604, 31.202433],\n                        [121.768149, 31.202151],\n                        [121.769674, 31.20163],\n                        [121.771415, 31.200446],\n                        [121.772921, 31.19855],\n                        [121.777235, 31.190266],\n                        [121.780523, 31.187142],\n                        [121.783712, 31.183605],\n                        [121.78745, 31.178061],\n                        [121.790599, 31.173417],\n                        [121.792524, 31.170681],\n                        [121.792524, 31.170681],\n                        [121.794208, 31.168282],\n                        [121.79836, 31.161429],\n                        [121.799474, 31.159376],\n                        [121.800587, 31.156806],\n                        [121.801317, 31.154597],\n                        [121.802403, 31.151622],\n                        [121.802403, 31.151622],\n                    ],\n                ],\n                polyline: true,\n                lineStyle: {\n                    width: 6,\n                    color: '#00c800',\n                    opacity: 0.8,\n                },\n            },\n        ],\n    });\n    if (option && typeof option === 'object') {\n    myChart.setOption(option, true);\n\n}\n//Mapbox实例获取\nvar map = myChart.getModel()\n    .getComponent(\"mapbox3D\")\n    .getMapbox();\n//map.addControl(new mapboxgl.NavigationControl());\nconsole.log(map)\n\n//相机旋转\nfunction rotate() {\n    map.easeTo({ bearing: 0, duration: 8000, pitch: 0, zoom: 13 });\n    t = window.setTimeout(() => {\n        map.easeTo({ bearing: 180, duration: 10000, pitch: 80, zoom: 15 });\n        t2 = window.setTimeout(() => {\n            map.easeTo({ bearing: -120, duration: 10000, pitch: 60, zoom: 14 });\n            t3 = window.setTimeout(() => {\n                rotate();\n            }, 10000);\n        }, 10000);\n    }, 10000);\n}\nrotate()\n});\n\n\n","html":"","externalScripts":"https://unpkg.com/shapefile@0.6,http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js,http://echarts.baidu.com/resource/echarts-gl-latest/mapboxgl-token.js,https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js,https://cdn.jsdelivr.net/npm/maptalks@0.39.3/dist/maptalks.min.js,https://deyihu.github.io/src/lib/echarts-gl.1.1.3.js?tdsourcetag=s_pctim_aiomsg,https://code.jquery.com/jquery-2.1.1.js","updaterUID":"bd-167860219","theme":"default","layout":"","viewCount":0,"userName":"n***1","commentCount":1,"starCount":7,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xZutjWi2Jk.png?v=1628263492609","isCustomThumbnail":1,"builtinTags":["category-work","maptalks3D","series-map3D"],"customTags":[],"updaterUserName":"n***1"}}