{"status":0,"data":{"cid":"xIBHXmiptk","authorUid":"obd-ol9ApUNzruRtm2D-0e5Fb-FETwsWF0O","authorUserName":"相***光","title":"预测准确性报告","description":"AQI预测 - 预测准确性报告 - 预测准确性报告","latestVersion":1,"alwaysLatest":0,"createTime":"2021-10-28T07:53:13.000Z","lastUpdateTime":"2021-10-28T07:53:13.000Z","auth":2,"uid":"obd-ol9ApUNzruRtm2D-0e5Fb-FETwsWF0O","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.1","versionCreateTime":"2021-10-28T07:53:13.000Z","code":"const uploadedDataURL = '/asset/get/s/data-1635390802457-HRSoVX4EN.json';\r\n\r\nconst symbolPass =\r\n    'image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0MjAwNDAzNDA1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI1MDAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMjRDMjI5LjI0OCAxMDI0IDAgNzk0Ljc1MiAwIDUxMlMyMjkuMjQ4IDAgNTEyIDBzNTEyIDIyOS4yNDggNTEyIDUxMi0yMjkuMjQ4IDUxMi01MTIgNTEyeiBtLTExNC4xNzYtMzEwLjk1NDY2N2E1My4zMzMzMzMgNTMuMzMzMzMzIDAgMCAwIDc1LjQzNDY2NyAwbDMyMy4zMjgtMzIzLjMyOGE1My4zMzMzMzMgNTMuMzMzMzMzIDAgMSAwLTc1LjQzNDY2Ny03NS40MzQ2NjZsLTI4Ny45MTQ2NjcgMjgzLjMwNjY2Ni0xMjguODUzMzMzLTEyOC44NTMzMzNhNTMuMzMzMzMzIDUzLjMzMzMzMyAwIDEgMC03NS40MzQ2NjcgNzUuNDM0NjY3bDE2OC44NzQ2NjcgMTY4Ljg3NDY2NnoiIGZpbGw9IiMxYWZhMjkiIHAtaWQ9IjI1MDEiIGRhdGEtc3BtLWFuY2hvci1pZD0iYTMxM3guNzc4MTA2OS4wLmkwIiBjbGFzcz0iIj48L3BhdGg+PC9zdmc+';\r\nconst symbolFail =\r\n    'image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0MjgwMDM2OTY5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTkiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDMyQzI1MS40Mjg1NzE1NjI1IDMyIDMyIDI1MS40Mjg1NzE1NjI1IDMyIDUxMnMyMTkuNDI4NTcxNTYyNSA0ODAgNDgwIDQ4MCA0ODAtMjE5LjQyODU3MTU2MjUgNDgwLTQ4MC0yMTkuNDI4NTcxNTYyNS00ODAtNDgwLTQ4MHogbTIwNS43MTQyODUzMTI1IDYxNy4xNDI4NTY4NzVjMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1IDIwLjU3MTQyODQzNzUgNDggMCA2MS43MTQyODYyNDk5OTk5OTQtMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1LTQ4IDIwLjU3MTQyODQzNzUtNjEuNzE0Mjg1MzEyNDk5OTk2IDBsLTEzNy4xNDI4NTY4NzUtMTM3LjE0Mjg1NzgxMjVMMzc0Ljg1NzE0MzEyNSA3MTcuNzE0Mjg1MzEyNWMtMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1LTQ4IDIwLjU3MTQyODQzNzUtNjguNTcxNDI4NDM3NSAwcy0yMC41NzE0Mjg0Mzc1LTU0Ljg1NzE0MzEyNSAwLTY4LjU3MTQyODQzNzVsMTQ0LTE0NC0xMzcuMTQyODU3ODEyNS0xMzcuMTQyODU2ODc1Yy0yMC41NzE0Mjg0Mzc1LTEzLjcxNDI4NTMxMjUwMDAwMS0yMC41NzE0Mjg0Mzc1LTQxLjE0Mjg1Njg3NSAwLTYxLjcxNDI4NTMxMjQ5OTk5NiAyMC41NzE0Mjg0Mzc1LTIwLjU3MTQyODQzNzUgNDgtMjAuNTcxNDI4NDM3NSA2MS43MTQyODYyNDk5OTk5OTQgMGwxMzcuMTQyODU2ODc1IDEzNy4xNDI4NTY4NzUgMTQ0LTE0NGMyMC41NzE0Mjg0Mzc1LTIwLjU3MTQyODQzNzUgNDgtMjAuNTcxNDI4NDM3NSA2OC41NzE0Mjg0Mzc1IDAgMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1IDIwLjU3MTQyODQzNzUgNDggMCA2OC41NzE0Mjg0Mzc1TDU4MC41NzE0Mjg0Mzc1IDUxMmwxMzcuMTQyODU2ODc1IDEzNy4xNDI4NTY4NzV6IiBmaWxsPSIjZjE1MDQ3IiBwLWlkPSIyMTAwIj48L3BhdGg+PC9zdmc+';\r\n\r\nconst scaling = 1;\r\n\r\n/**\r\n * @deprecated 获取AQI误差范围\r\n * @params {number} value\r\n */\r\nconst getErrLimilt = (value) => {\r\n    if (!value) return 20;\r\n    if (value > 100 && value <= 200) return 30;\r\n    if (value > 200) return 50;\r\n    return 20;\r\n};\r\n\r\n/**\r\n * @description 将接口数据转化为符合 echarts 的数据\r\n * @param {array} history 历史数据\r\n * @param {array} forecast 预测数据\r\n * @param {boolean} diff 是否按AQI等级拆分数据\r\n * @returns echartsData 符合echarts配置数据\r\n */\r\nconst transformData = (history, forecast, scaling) => {\r\n    // days\r\n    let xAxisData = [...new Set([...Object.keys(history), ...Object.keys(forecast)])].sort();\r\n    const len = xAxisData.length;\r\n    if (len > 60) xAxisData = xAxisData.splice(len - 61, len - 1);\r\n    // 历史数据\r\n    const historyData = xAxisData.map((v) => (history[v] ? history[v].aqi : null));\r\n    // 预测数据\r\n    const forecastData = xAxisData.map((v) => (forecast[v] ? forecast[v].aqi : null));\r\n    // 预测标记数据\r\n    const markPointData = xAxisData.map((v, index) => {\r\n        const value = forecast[v] ? forecast[v].aqi : null;\r\n        const result = {\r\n            xAxis: index,\r\n            yAxis: value,\r\n            symbolSize: [5, getErrLimilt(value) * scaling],\r\n        };\r\n        return result;\r\n    });\r\n\r\n    return { xAxisData, historyData, forecastData, markPointData };\r\n};\r\n\r\n// 获取悬浮提示元素\r\nconst getTooltipRow = (params, isHideEmpty = false) => {\r\n    if (isHideEmpty && !params.value) return '';\r\n    return `\r\n  <div style=\"display: flex; justify-content: space-between; min-width: 0; padding-top: 3px;\">\r\n    <span style=\"${params.marker ? '' : 'padding-left: 18px'}\">${params.marker || ''} ${params.seriesName}</span>\r\n    <span style=\"padding-left: 10px; font-weight: bold;\">${params.value || '-'}<span style=\"font-weight: initial;\">${\r\n        params.range || ''\r\n    }</span></span>\r\n  </div>`;\r\n};\r\n\r\n$.getJSON(uploadedDataURL, (data) => {\r\n    const { history, forecast } = data;\r\n    console.log(data);\r\n    const { xAxisData, historyData, forecastData, markPointData } = transformData(\r\n        history || {},\r\n        forecast || {},\r\n        scaling\r\n    );\r\n    const myOption = {\r\n        // backgroundColor: '#FAFBFD',\r\n        title: {\r\n            text: '预测准确性报告',\r\n            left: 'center',\r\n        },\r\n        grid: {\r\n            top: 65,\r\n            left: 45,\r\n            right: 15,\r\n            bottom: 20,\r\n        },\r\n        legend: {\r\n            show: true,\r\n            top: 35,\r\n        },\r\n        tooltip: {\r\n            position: 'top',\r\n            trigger: 'axis',\r\n            formatter: (params) => {\r\n                if (params.length !== 2) return '';\r\n                const [paramsOne, paramsTwo] = params;\r\n                const result = [];\r\n                const dateStr = (paramsTwo || {}).axisValue || (paramsOne || {}).axisValue;\r\n                if (dateStr) result.push(dateStr);\r\n                if (paramsOne) result.push(getTooltipRow(paramsOne));\r\n                if (paramsTwo && paramsTwo.value) {\r\n                    const limilt = getErrLimilt(paramsTwo.value) / 2;\r\n                    paramsTwo.range = `±${limilt}`;\r\n                }\r\n                if (paramsTwo) result.push(getTooltipRow(paramsTwo));\r\n                if (paramsOne && paramsTwo) {\r\n                    const accuracyValue = (lineValue, barValue) => {\r\n                        if (!lineValue || !barValue) return '';\r\n                        const diffValue = Math.abs(lineValue - barValue);\r\n                        return `${parseInt(Math.abs(100 - (diffValue / barValue) * 100))}%`;\r\n                    };\r\n                    const accuracy = {\r\n                        seriesName: '准确率',\r\n                        value: accuracyValue(paramsOne.value, paramsTwo.value),\r\n                    };\r\n                    result.push(getTooltipRow(accuracy, true));\r\n                }\r\n                return result.join('');\r\n            },\r\n        },\r\n        xAxis: {\r\n            type: 'category',\r\n            axisLine: {\r\n                show: false,\r\n            },\r\n            axisTick: {\r\n                show: false,\r\n            },\r\n            data: xAxisData,\r\n        },\r\n        yAxis: {\r\n            type: 'value',\r\n        },\r\n        series: [\r\n            {\r\n                name: '实况监测',\r\n                type: 'line',\r\n                color: '#4886F8',\r\n                smooth: true,\r\n                itemStyle: { opacity: 0 },\r\n                data: historyData,\r\n            },\r\n            {\r\n                name: '模式预报',\r\n                type: 'line',\r\n                color: '#41C15A',\r\n                lineStyle: {\r\n                    opacity: 0,\r\n                },\r\n                itemStyle: {\r\n                    opacity: 0,\r\n                },\r\n                markPoint: {\r\n                    data: markPointData,\r\n                    symbol:\r\n                        'path://M 1 1 L 10 1 L 10 2 L 6 2 L 6 29 L 10 29 L 10 30 L 1 30 L 1 29 L 5 29 L 5 2 L 1 2 L 1 1',\r\n                },\r\n                data: forecastData,\r\n            },\r\n        ],\r\n    };\r\n    myChart.setOption(myOption);\r\n});\r\n","html":"","externalScripts":"","updaterUID":"obd-ol9ApUNzruRtm2D-0e5Fb-FETwsWF0O","theme":"","layout":"","viewCount":0,"userName":"相***光","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xIBHXmiptk.png?v=1635407593669","isCustomThumbnail":1,"builtinTags":["category-work","grid","legend","markPoint","series-line","title","tooltip"],"customTags":[],"updaterUserName":"相***光"}}