{"status":0,"data":{"cid":"xH1ZXXpYvf","authorUid":"bd-442035385","authorUserName":"小***了","title":"定制地图区域饼图数据统计","description":"","latestVersion":3,"alwaysLatest":1,"createTime":"2018-02-20T15:47:36.000Z","lastUpdateTime":"2018-02-20T15:47:36.000Z","auth":2,"uid":"bd-442035385","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"3.8.0","versionCreateTime":"2018-02-28T08:26:20.000Z","code":"// var uploadedDataURL = \"/asset/get/s/data-1519004377467-ByWkioPwf.json\";\r\n//参考秋枫雁飞的《虚拟地图区域饼图数据统计一图》\r\n//数据定义区\r\nvar typeArr = [\"男性\", \"女性\", \"城镇人口\", \"农村人口\"];\r\nvar typeIndex = 1;\r\nvar selectedRange = null;\r\nvar option = null;\r\nvar str = \"\";\r\nvar data = [];\r\nvar mapdata1 = [];\r\nvar geoCoordMap = {\r\n    '冷水江市': [111.47, 27.68],\r\n    '涟源市': [111.79, 27.74],\r\n    '娄星区': [112, 27.78],\r\n    '双峰县': [112.2, 27.46],\r\n    '新化县': [111.23, 27.88]\r\n};\r\nvar name = \"定制地图区域饼图数据统计\";\r\nvar mapName = 'loudi'\r\n// 地图特征\r\n$.get('/asset/get/s/data-1519004377467-ByWkioPwf.json', function(geoJson) {\r\n    // myChart.hideLoading();\r\n    echarts.registerMap('loudi', geoJson);\r\n    var mapFeatures = echarts.getMap(mapName).geoJson.features;\r\n    // console.log('==========mapFeatures==============')\r\n    // console.log(mapFeatures)\r\n    mapFeatures.forEach(function(v) {\r\n        // 地区名称\r\n        var name = v.properties.name;\r\n        // console.log('===========name=============')\r\n        // console.log(name)\r\n        // 地区经纬度\r\n        // geoCoordMap[name] = v.properties.cp;\r\n        var s1 = Math.round(Math.random() * 100 + 10);\r\n        var s2 = Math.round(Math.random() * 100 + 10);\r\n        // var s3 = Math.round(Math.random() * 100 + 10);\r\n        data.push({\r\n            // 需要挨个处理各地区数据（不使用随机产生的数）：另外需要构造的数据是柱图数据\r\n            \"name\": name,\r\n            \"value\": [{\r\n                    name: \"男性\",\r\n                    value: s1,\r\n                },\r\n                {\r\n                    name: \"女性\",\r\n                    value: s2,\r\n                },\r\n                // {\r\n                //     name: \"城镇人口\",\r\n                //     value: s3\r\n                // },\r\n                // {\r\n                //     name: \"农村人口\",\r\n                //     value: s1 + s2 - s3\r\n                // }\r\n            ]\r\n        })\r\n        mapdata1.push({\r\n            name: name,\r\n            value: s1 + s2\r\n        })\r\n    });\r\n    // 地理坐标图(打印出来方便查看)\r\n    console.log(\"===========geoCoordMap===============\");\r\n    for (var i in geoCoordMap) {\r\n        console.log(geoCoordMap[i]);\r\n    }\r\n    console.log(geoCoordMap);\r\n    console.log(\"==============data===============\");\r\n    console.log(data);\r\n    // var mapdata1=[{name:\"冷水江市\",value:data[0]},{},{},{},{},{}]\r\n    /*变换地图数据（格式）：pie*/\r\n    function convertMapDta(type, data) {\r\n        var mapData = [];\r\n        data.forEach(function(v) {\r\n            v.value.forEach(function(v1) {\r\n                if (String(v1.name) === String(type)) {\r\n                    // 数据格式：data: [120, 200, 150, 80]\r\n                    mapData.push({\r\n                        \"name\": v.name,\r\n                        \"value\": v1.value\r\n                    })\r\n                }\r\n            })\r\n        });\r\n        return mapData;\r\n    }\r\n\r\n    console.log(\"================mapData==================\")\r\n    // console.log(convertMapDta_bar(typeArr[typeIndex],data))\r\n    console.log(convertMapDta(typeArr[typeIndex], data))\r\n    console.log(\"=========================================\")\r\n\r\n    /*resetPie*/\r\n    function resetPie(myChart, params, geoCoordMap, typeIndex) {\r\n        var op = myChart.getOption();\r\n        var ops = op.series;\r\n        ops.forEach(function(v, i) {\r\n            if (i > 0) {\r\n                var geoCoord = geoCoordMap[v.name];\r\n                var p = myChart.convertToPixel({\r\n                    seriesIndex: 0\r\n                }, geoCoord);\r\n                v.center = p;\r\n                if (params != 0 && params.zoom) {\r\n                    v.radius = v.radius * params.zoom;\r\n                }\r\n                if (params != 0 && params.selected) {\r\n                    var rangeFirstNumber = params.selected[0];\r\n                    var rangeSecondNumber = params.selected[1];\r\n                    var pd = v.data[typeIndex].value;\r\n                    if (pd < rangeFirstNumber || pd > rangeSecondNumber) {\r\n                        v.itemStyle.normal.opacity = 0;\r\n                    } else {\r\n                        v.itemStyle.normal.opacity = 1;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        myChart.setOption(op, true);\r\n    }\r\n\r\n    /*addPie*/\r\n    function addPie(chart, data) {\r\n        var op = chart.getOption();\r\n        var sd = option.series;\r\n        for (var i = 0; i < data.length; i++) {\r\n            var randomValue = Math.round(Math.random() * 30) * 2;\r\n            var radius = randomValue <= 10 ? 10 : randomValue;\r\n            var geoCoord = geoCoordMap[data[i].name];\r\n            if (geoCoord) {\r\n                var vr = [];\r\n                (data[i].value).map(function(v, j) {\r\n                    vr.push({\r\n                        name: v.name,\r\n                        value: v.value,\r\n                        visualMap:false\r\n                    });\r\n                });\r\n                var p = chart.convertToPixel({\r\n                    seriesIndex: 0\r\n                }, geoCoord);\r\n                sd.push({\r\n                    name: data[i].name,\r\n                    type: 'pie',\r\n                    tooltip: {\r\n                        formatter: function(params) {\r\n                            return params.seriesName + \"<br/>\" + params.name + \" : \" + params.value+'万人';\r\n                        }\r\n                    },\r\n                    radius: radius,\r\n                    center: p,\r\n                    data: vr,\r\n                    // zlevel:1,\r\n                    label: {\r\n                        normal: {\r\n                            show: false,\r\n                        },\r\n                    },\r\n                    labelLine: {\r\n                        normal: {\r\n                            show: false\r\n                        }\r\n                    },\r\n                    itemStyle: {\r\n                        mormal: {\r\n                            opacity: 0.1\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return sd;\r\n    };\r\n\r\n\r\n    /* 指定图表的配置项和数据:pie*/\r\n    var option = {\r\n        // backgroundColor:'#666666',\r\n        title: {\r\n            text: name,\r\n            left: 'center',\r\n            textStyle: {\r\n                color: 'black'\r\n            }\r\n        },\r\n        tooltip: {\r\n            trigger: 'item',\r\n            formatter: function(params) {\r\n                if (params.value) {\r\n                    return params.name + \"<br/>\" + '总人口' +\r\n                        \": \" + params.value + '万人';\r\n                }\r\n            }\r\n        },\r\n        visualMap: {\r\n            type: 'continuous',\r\n            show: true,\r\n            min: 0,\r\n            max: 200,\r\n            left: 'left',\r\n            top: 'bottom',\r\n            text: ['高    (亿元)', '低    (亿元)'], // 文本，默认为数值文本\r\n            calculable: true,\r\n            // seriesIndex: [0],\r\n            inRange: {\r\n                // color: ['#3B5077', '#031525'] // 蓝黑\r\n                // color: ['#ffc0cb', '#800080'] // 红紫\r\n                // color: ['#3C3B3F', '#605C3C'] // 黑绿\r\n                // color:['#3C3B3F','#EE2C2C']//黑红\r\n                // color:['lightskyblue','yellow','orangered']\r\n                // color: ['#0f0c29', '#302b63', '#24243e'] // 黑紫黑\r\n                // color: ['#23074d', '#cc5333'] // 紫红\r\n                // color: ['#00467F', '#A5CC82'] // 蓝绿\r\n                // color: ['#1488CC', '#2B32B2'] // 浅蓝\r\n                color: ['#00467F', '#A5CC82'] // 蓝绿\r\n            }\r\n        },\r\n        series: [{\r\n            name: 'chinaMap',\r\n            type: 'map',\r\n            mapType: mapName,\r\n            roam: true,\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    color: 'black',\r\n                    fontSize: 13\r\n                },\r\n                emphasis: {\r\n                    show: true\r\n                }\r\n            },\r\n            // itemStyle: {\r\n            //     normal: {\r\n            //         borderColor: '#CD4F39',\r\n            //         areaColor: '#54FF9F',\r\n            //         borderWidth: 4,\r\n            //         opacity: 0.2\r\n            //     }\r\n            // },\r\n            data: mapdata1 //convertMapDta(typeArr[typeIndex],data),\r\n            /*zlevel:3*/\r\n        }]\r\n    };\r\n\r\n\r\n\r\n    if (option && typeof option === \"object\") {\r\n        myChart.setOption(option, true);\r\n    }\r\n    /*pie*/\r\n    addPie(myChart, data);\r\n\r\n    myChart.setOption(option, true);\r\n\r\n    /*饼图跟着地图移动:pie*/\r\n    myChart.on('georoam', function(params) {\r\n        resetPie(myChart, params, geoCoordMap, typeIndex);\r\n    });\r\n    myChart.on('datarangeselected', function(params) {\r\n        resetPie(myChart, params, geoCoordMap, typeIndex);\r\n    });\r\n    window.addEventListener(\"resize\", function() {\r\n        myChart.resize();\r\n        resetPie(myChart, 0, geoCoordMap);\r\n    })\r\n})\r\n\r\n\r\n// 使用刚指定的配置项和数据显示图表。\r\nmyChart.setOption(option);","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-442035385","theme":"","layout":"","viewCount":7443,"userName":"小***了","commentCount":2,"starCount":19,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xH1ZXXpYvf.png?v=1519806380626","isCustomThumbnail":0,"builtinTags":["category-work","series-map","series-pie","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"小***了"}}