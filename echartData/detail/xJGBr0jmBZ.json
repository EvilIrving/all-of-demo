{"status":0,"data":{"cid":"xJGBr0jmBZ","authorUid":"bd-2013481626","authorUserName":"じ***ゞ","title":"自定义多图层案例","description":"","latestVersion":2,"alwaysLatest":0,"createTime":"2021-10-15T08:59:55.000Z","lastUpdateTime":"2022-01-19T04:00:45.000Z","auth":2,"uid":"bd-2013481626","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"5.2.2","versionCreateTime":"2022-01-19T04:00:45.000Z","code":"\nlet Dates = ['2021-10-14 11:00:00','2021-10-14 12:00:00','2021-10-14 13:00:00','2021-10-14 14:00:00','2021-10-14 15:00:00','2021-10-14 16:00:00','2021-10-14 17:00:00','2021-10-14 18:00:00','2021-10-14 19:00:00','2021-10-14 20:00:00','2021-10-14 21:00:00','2021-10-14 22:00:00','2021-10-14 23:00:00','2021-10-15 00:00:00','2021-10-15 01:00:00','2021-10-15 02:00:00','2021-10-15 03:00:00','2021-10-15 04:00:00','2021-10-15 05:00:00','2021-10-15 06:00:00','2021-10-15 07:00:00','2021-10-15 08:00:00','2021-10-15 09:00:00','2021-10-15 10:00:00']\n\nlet R1h = ['0','0','0','0','0','0','0','0','0','0','0','0','0.8','0.9','0.6','0.1','0','0.4','0.3','0.1','0','0.1','1.3','0.3']\nlet T2m = ['17.2','17.7','17.6','17.3','17','17.4','17.1','16.9','16.5','16.1','15.9','15.4','15.4','15.3','15.2','15.2','15.2','15.2','14.7','13.8','14.1','14.5','14.5','']\nlet RH2m = ['74','71','70','71','73','73','69','71','72','76','78','80','79','79','79','77','77','78','82','90','90','84','84','']\n\nlet Win10m_S = ['2.9','2.9','2.2','2.7','3.3','1.1','2.6','3.5','3.2','3.1','1','2.8','2.9','2.4','2','2.1','1.4','1.1','1.6','1.3','0.4','1.3','2.5','']\nlet Win10m_D =['84','80','97','120','112','74','348','110','92','89','130','115','111','58','104','97','82','7','108','86','115','86','104','']\n\nlet MaxWin10m_S = ['9.5','7.1','6.8','7.7','7.5','6.2','7.4','7.2','7.8','7.4','7.8','7.8','7.1','6.6','6.6','6.6','7.3','5.1','5.1','5.2','3.9','5.7','7','']\nlet MaxWin10m_D = ['97','74','107','84','102','53','58','90','97','120','113','127','77','90','97','102','55','90','30','100','12','89','103','']\n\nlet xAxisData = [], Win10mArray = [], MaxWin10mArray = [];\nDates.forEach((item,index) => {\n  let pattern = /(\\d{4})-(\\d{2})-(\\d{2}) (\\d{2}):(\\d{2}):(\\d{2})/g;\n  xAxisData.push(item.replace(pattern, '$3日\\n$4时'));\n  \n  if(Win10m_S[index]){\n    let _w10 = { \n      value: [index, 1],\n      symbol: getWindShaftPic(Win10m_S[index]),\n      symbolSize: [8, 20],\n      symbolRotate: `-${Win10m_D[index]}`,\n    }\n    Win10mArray.push(_w10)\n  }\n  \n  if(MaxWin10m_S[index]){\n    let _w10 = { \n      value: [index, 1],\n      symbol: getWindShaftPic(MaxWin10m_S[index]),\n      symbolSize: [8, 20],\n      symbolRotate: `-${MaxWin10m_D[index]}`,\n    }\n    MaxWin10mArray.push(_w10)\n  }\n})\n\nlet splitNumber = 6; // 分割段数\n\noption = {\n  title: {\n    text: 'Demo Chart',\n    subtext: '2021年10月14日11时 - 2021年10月15日10时',\n    textStyle: { color: '#000000' },\n    subtextStyle: { color: '#000000' },\n    left: 'center',\n    top: '2%'\n  },\n  grid: [\n    {\n      top: '14%',\n      left: '8%',\n      right: '8%',\n      bottom: '30%'\n    },\n    {\n      top: '70%',\n      left: '8%',\n      right: '8%',\n      bottom: '20%'\n    },\n    {\n      top: '80%',\n      left: '8%',\n      right: '8%',\n      bottom: '10%'\n    }\n  ],\n  legend: { \n    top: '9%',\n    textStyle: { fontWeight:'bold' }\n  },\n  tooltip: [\n    {\n      trigger: 'axis',\n      formatter: (params, ticket, callback) => {\n        console.log(params)\n        let index = params[0].dataIndex;\n        let pattern = /(\\d{4})-(\\d{2})-(\\d{2}) (\\d{2}):(\\d{2}):(\\d{2})/g;\n        let Htm = `${Dates[index].replace(pattern, '$1年$2月$3日$4时')}<br>`;\n        params.forEach((item) => {\n          let {marker, seriesName, data, seriesId} = item;\n          if(seriesId == 'Win10m'){\n            Htm += `${marker} 风速：${Win10m_S[index]}m/s 角度：${Win10m_D[index]}°`;\n          } else if(seriesId == 'MaxWin10m' ){\n            Htm += `${marker} 风速：${MaxWin10m_S[index]}m/s 角度：${MaxWin10m_D[index]}°`;\n          } else {\n            Htm += `${marker} ${seriesName}: ${data}${unit[seriesId]}<br>`;\n          }\n        })\n        return Htm\n      }\n    }\n  ],\n  xAxis: [\n    {\n      boundaryGap: true,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: {\n        alignWithLabel: true, // 刻度线和标签对齐\n        interval: 0,\n        inside: true // 坐标轴刻度朝内\n      },\n      axisLabel: { show: false },\n      data: Dates\n    },\n    {\n      position: 'top',\n      axisLine:{ lineStyle: { color:'#000000', width:2 } },\n    },\n    {\n      gridIndex: 1,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: { show: false },\n      axisLabel: { show: false },\n      data: Dates\n    },\n    {\n      gridIndex: 2,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: {\n        alignWithLabel: true, // 刻度线和标签对齐\n        interval: 0, // 坐标轴刻度朝内\n        inside: true\n      },\n      axisLabel: { color: '#000000', fontSize: 14, fontWeight:'bold' },\n      data: xAxisData\n    }\n  ],\n  yAxis: [\n    {\n      name: '温度(℃)',\n      nameLocation:'center',\n      nameGap: 48,\n      nameTextStyle: { color:'#000000', fontSize:14, fontWeight:'bold' },\n      // min: calMin(T2m),\n      // max: calMax(T2m),\n      // minInterval: 1,\n      // splitNumber: splitNumber,\n      // interval: (calMax(T2m) - calMin(T2m)) / splitNumber,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: { show:false },\n      axisLabel: { textStyle: { color:'#000000', fontSize:13, fontWeight:'bold' }},\n      splitLine: { show:true, lineStyle: { color:'#000000' } }\n    },\n    {\n      show: false,\n      name: '1小时降水',\n      max: (value) => {\n        return value.max + 0.1;\n      }\n    },\n    {\n      name: '相对湿度(%)',\n      nameLocation:'center',\n      nameGap: 48,\n      nameTextStyle: { color:'#000000', fontSize:14, fontWeight:'bold' },\n      // min: calMin(RH2m),\n      // max: calMax(RH2m),\n      // minInterval: 1,\n      // splitNumber: splitNumber,\n      // interval: (calMax(RH2m) - calMin(RH2m)) / splitNumber,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: { show:false },\n      axisLabel: { textStyle: { color:'#000000', fontSize:13, fontWeight:'bold' }},\n      splitLine: { show:false }\n    },\n    {\n      gridIndex: 1,\n      name: '10米风',\n      nameLocation:'center',\n      nameGap: 20,\n      nameTextStyle: { color:'#000000', fontSize:14, fontWeight:'bold' },\n      max: 2,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: { show:false },\n      axisLabel: {show:false },\n      splitLine: { show:false }\n    },\n    {\n      gridIndex: 1,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } }\n    },\n    {\n      gridIndex: 2,\n      name: '10米极大风',\n      nameLocation:'center',\n      nameGap: 20,\n      nameTextStyle: { color:'#000000', fontSize:14, fontWeight:'bold' },\n      max: 2,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } },\n      axisTick: { show:false },\n      axisLabel: {show:false },\n      splitLine: { show:false }\n    },\n    {\n      gridIndex: 2,\n      axisLine:{ show: true, lineStyle: { color:'#000000', width:2 } }\n    },\n  ],\n  series: [\n    {\n      type: 'bar',\n      id: 'R1h',\n      name: '1小时降水',\n      color: '#4bc946',\n      yAxisIndex: 1,\n      barWidth: '50%',\n      label: { \n        show: true, \n        formatter: (params) => {\n          if(Number(params.data) === 0) return '';\n        },\n        fontWeight: 'bold',\n        position: 'top'\n      },\n      data: R1h\n    },\n    {\n      type: 'line',\n      id: 'T2m',\n      name: '2米温度',\n      symbol: 'rect',\n      symbolSize: 6,\n      color: '#fda975',\n      // smooth: true,\n      data: T2m\n    },\n    {\n      type: 'line',\n      id: 'RH2m',\n      name: '2米相对湿度',\n      symbolSize: 6,\n      yAxisIndex: 2,\n      color: '#27d3e2',\n      // smooth: true,\n      data: RH2m\n    },\n    {\n      type: 'line',\n      id: 'Win10m',\n      name: '10米风',\n      symbol: 'circle',\n      symbolSize: 6,\n      xAxisIndex: 2,\n      yAxisIndex: 3,\n      lineStyle: { width:1, opacity:0.5 },\n      data: Win10mArray\n    },\n    {\n      type: 'line',\n      id: 'MaxWin10m',\n      name: '10米极大风',\n      symbol: 'circle',\n      xAxisIndex: 3,\n      yAxisIndex: 5,\n      lineStyle: { width:1, opacity:0.5 },\n      data: MaxWin10mArray\n    }\n  ]\n};\n\nlet unit = {\n  R1h: 'mm',\n  T2m: '℃',\n  RH2m: '%'\n}\n\n//计算最大值\nfunction calMax(arr) {\n    let min = Math.min.apply(null, arr);\n    let max = Math.max.apply(null, arr);\n    let interval = (max - min) / splitNumber; // 平均值\n    max = Math.ceil(max + interval); // 向上取整\n    // console.log(min, max, interval);\n    return max;\n}\n\n//计算最小值\nfunction calMin(arr) {\n    let min = Math.min.apply(null, arr);\n    let max = Math.max.apply(null, arr);\n    let interval = (max - min) / splitNumber; // 平均值\n    min = min === 0 ? min : Math.floor(min - interval); // 向下取整\n    // console.log(min, max, interval);\n    return min;\n}\n\nfunction getWindShaftPic(windspeed) {\n  let Pic = 'none';\n  if(windspeed === '') return Pic\n  if (windspeed >= 0.0 && windspeed <= 0.2) {\n    Pic = `image:///asset/get/s/data-1631783476618-wOIHrfnEO.png`;\n  } else if (windspeed >= 0.3 && windspeed <= 1.5) {\n    Pic = `image:///asset/get/s/data-1631783483071-cfwLbKcYl.png`;\n  } else if (windspeed >= 1.6 && windspeed <= 3.3) {\n    Pic = `image:///asset/get/s/data-1631783495125-601rObfu3.png`;\n  } else if (windspeed >= 3.4 && windspeed <= 5.4) {\n    Pic = `image:///asset/get/s/data-1631783502405-jwbOFdS4D.png`;\n  } else if (windspeed >= 5.5 && windspeed <= 7.9) {\n    Pic = `image:///asset/get/s/data-1631783519568-qdPwqtQUg.png`;\n  } else if (windspeed >= 8.0 && windspeed <= 10.7) {\n    Pic = `image:///asset/get/s/data-1631783526956-IJh4S6NaA.png`;\n  } else if (windspeed >= 10.8 && windspeed <= 13.8) {\n    Pic = `image:///asset/get/s/data-1631783532927-sNH7zekiO.png`;\n  } else if (windspeed >= 13.9 && windspeed <= 17.1) {\n    Pic = `image:///asset/get/s/data-1631783538130-P00G2yMyc.png`;\n  } else if (windspeed >= 17.2 && windspeed <= 20.7) {\n    Pic = `image:///asset/get/s/data-1631783543740-JER6mEii7.png`;\n  } else if (windspeed >= 20.8 && windspeed <= 24.4) {\n    Pic = `image:///asset/get/s/data-1631783552096-Dwu8REasT.png`;\n  } else if (windspeed >= 24.5 && windspeed <= 28.4) {\n    Pic = `image:///asset/get/s/data-1631783557036-3FbF8qpJs.png`;\n  } else if (windspeed >= 28.5 && windspeed <= 32.6) {\n    Pic = `image:///asset/get/s/data-1631783561430-bRSvCqsew.png`;\n  } else if (windspeed >= 32.7) {\n    Pic = `image:///asset/get/s/data-1631783565641-ENAZ32bTX.png`;\n  }\n  return Pic\n}\n\n","html":"","externalScripts":"","updaterUID":"bd-2013481626","theme":"default","layout":"","viewCount":0,"userName":"じ***ゞ","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xJGBr0jmBZ.png?v=1634288395690","isCustomThumbnail":1,"builtinTags":["category-work","grid","legend","series-bar","series-line","title","tooltip"],"customTags":[],"updaterUserName":"じ***ゞ"}}