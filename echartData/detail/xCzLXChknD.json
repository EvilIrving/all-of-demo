{"status":0,"data":{"cid":"xCzLXChknD","authorUid":"obd-ojgM33Q5chuDris7f07k8h8VW5h1qDa","authorUserName":"伏***","title":"假想风玫瑰图","description":"在极坐标的情况下进行数据插值，呈现渲染效果（等级颜色与渐变颜色，代码中可选）","latestVersion":2,"alwaysLatest":1,"createTime":"2021-01-18T01:12:55.000Z","lastUpdateTime":"2021-01-18T01:12:55.000Z","auth":2,"uid":"obd-ojgM33Q5chuDris7f07k8h8VW5h1qDa","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2021-01-18T01:16:45.000Z","code":"var maxSpeed = 2.5; // 设置最大风速\r\n\r\n// 设置需要插值的参数，所给数据范围小\r\nconst conf = {\r\n\tradius_step: 0.02, // 半径插值步长，从0开始，步长越小，插值越密集，计算量越大\r\n\tangle_step: 3, // 步长越小，插值越密集，计算量越大\r\n};\r\n\r\n// 需要插值的数据(测试数据) [windSpeed, windDir, value]\r\nvar srcData = [ \r\n\t[2.0,225,0.9],\r\n\t[2.3,282,0.85],\r\n\t[1.5,176,0.5],\r\n\t[0.5,0,0.3],\r\n\t[1.5,22.5,0.01],\r\n\t[1.0,45,0.03],\r\n\t[2.0,45,0.02],\r\n\t[1.5,210,0.7],\r\n\t[1,195,0.6],\r\n\t[2,330,0.3],\r\n\t[2,120,0.2],\r\n\t[1.7,300,0.8],\r\n\t[1,270,0.5]\r\n\t];\r\n\r\n// 随机生成模拟数据\r\n/*var srcData = [];\r\nfor(var i=0;i<20;i++){\r\n\tsrcData.push([maxSpeed*Math.random(), 360*Math.random(), 0.4*Math.random()]);\r\n}\r\n*/\r\n\r\n//插值后的数据[radius,angle,value]\r\nvar data = interpolation(srcData);\r\nconsole.log(data.length);\r\n\r\n/**\r\n * 插值操作，返回插值后的结果\r\n */\r\nfunction interpolation(srcData){\r\n\tvar power = 0.6;\r\n\t\r\n\t// 计算距离权重系数\r\n\tvar D = [];\r\n\tfor(var i=0;i<srcData.length;i++){\r\n\t\tvar Di = [];\r\n\t\tfor(var j=0;j<srcData.length;j++){\r\n\t\t\tvar r1 = srcData[i][0];\r\n\t\t\tvar a1 = srcData[i][1];\r\n\t\t\tvar r2 = srcData[j][0];\r\n\t\t\tvar a2 = srcData[j][1];\r\n\t\t\t\r\n\t\t\tvar dr = Math.abs(r2-r1)*30;\r\n\t\t\tvar da = Math.min(Math.abs(a2-a1),360-Math.abs(a2-a1))*0.5;\r\n\t\t\tvar di = Math.sqrt(Math.pow(da, 2) + Math.pow(dr, 2));\r\n\t\t\tDi.push(1 / (1+Math.pow(di, power)));\r\n\t\t}\r\n\t\tD.push(Di);\r\n\t}\r\n\tD = math.inv(D);\r\n\t\r\n\tvar data = [];\r\n\t// 根据配置conf序列出所有需要进行插值的点\r\n\tfor(var r=conf.radius_step;r<=maxSpeed;r+=conf.radius_step){\r\n\t\tfor(var a=0;a<360;a+=conf.angle_step/r){\r\n\t\t\tvar v = 0;\r\n\t\t\tvar vectorD = [];\r\n\t\t\tvar matrixV = [];\r\n\t\t\tfor(var i=0;i<srcData.length;i++){\r\n\t\t\t\tvar ri = srcData[i][0];\r\n\t\t\t\tvar ai = srcData[i][1];\r\n\t\t\t\tvar vi = srcData[i][2];\r\n\t\t\t\tvar dr = Math.abs(r-ri)*30;\r\n\t\t\t\tvar da = Math.min(Math.abs(a-ai),360-Math.abs(a-ai))*0.5;\r\n\t\t\t\tvar di = Math.sqrt(Math.pow(da, 2) + Math.pow(dr, 2));\r\n\t\t\t\tvectorD.push(1 / (1+Math.pow(di, power)));\r\n\t\t\t\tmatrixV.push([vi]);\r\n\t\t\t}\r\n\t\t\tvar matrixD = [];matrixD.push(vectorD);\r\n\t\t\tvar matrixValue = math.multiply(math.multiply(matrixD, D), matrixV);\r\n\t\t\tv = matrixValue[0][0];\r\n\t\t\t\r\n\t\t\tdata.push([r,a,v]);\r\n\t\t}\r\n\t}\r\n\treturn data;\r\n}\r\n\r\n\r\noption = {\r\n    legend: {\r\n        data: ['Punch Card'],\r\n        left: 'right'\r\n    },\r\n    polar: {},\r\n    tooltip: {\r\n        formatter: function (params) {\r\n            return 'AQI='+Math.ceil(500*params.value[2]) + '<br>风向=' + Math.ceil(100*params.value[1])/100 + '<br>风速=' + Math.ceil(100*params.value[0])/100;\r\n        }\r\n    },\r\n    angleAxis: {\r\n        type: 'value',\r\n        min: 0,\r\n        max: 360,\r\n        splitLine: {\r\n            show: false,\r\n            lineStyle: {\r\n                color: '#999',\r\n                type: 'dashed'\r\n            }\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        },\r\n        axisTick: {\r\n        \tshow: false\r\n        },\r\n        axisLabel: {\r\n        \tshow: false\r\n        }\r\n    },\r\n    radiusAxis: {\r\n        type: 'value',\r\n        min: 0,\r\n        max: maxSpeed,\r\n        axisLine: {\r\n            show: true\r\n        },\r\n        splitLine: {\r\n        \tshow: false\r\n        },\r\n        zlevel: 10000,\r\n        z: 10000\r\n    },\r\n    radar: {\r\n        shape: '',\r\n        radius: '80%',\r\n        name: {\r\n            textStyle: {\r\n                color: 'black',\r\n                borderRadius: 3,\r\n                padding: [3, 5]\r\n            }\r\n        },\r\n        indicator: [\r\n            { name: '北', max: maxSpeed},\r\n            { name: '北东北', max: maxSpeed},\r\n            { name: '东北', max: maxSpeed},\r\n            { name: '东东北', max: maxSpeed},\r\n            { name: '东', max: maxSpeed},\r\n            { name: '东东南', max: maxSpeed},\r\n            { name: '东南', max: maxSpeed},\r\n            { name: '南东南', max: maxSpeed},\r\n            { name: '南', max: maxSpeed},\r\n            { name: '南西南', max: maxSpeed},\r\n            { name: '西南', max: maxSpeed},\r\n            { name: '西西南', max: maxSpeed},\r\n            { name: '西', max: maxSpeed},\r\n            { name: '西西北', max: maxSpeed},\r\n            { name: '西北', max: maxSpeed},\r\n            { name: '北西北', max: maxSpeed}\r\n        ],\r\n        zlevel: 10000,\r\n        z: 10000\r\n    },\r\n    series: [{\r\n        name: 'Punch Card',\r\n        type: 'scatter',\r\n        coordinateSystem: 'polar',\r\n        symbolSize: function (val) {\r\n            return 8;\r\n        },\r\n        data: data,\r\n        animationDelay: function (idx) {\r\n            return idx * 5;\r\n        },\r\n        itemStyle: {\r\n        \tcolor: function(obj){\r\n        \t\tvar v = obj.value[2]*500;\r\n        \t\tif(v>500){\r\n        \t\t\tv = 500;\r\n        \t\t}\r\n        \t\t// 渐变颜色\r\n        \t\treturn getAqiColor(v);\r\n        \t\t// 非渐变效果\r\n            \t//return getIAQIColor('aqi',v);\r\n            }\r\n        }\r\n    },{\r\n        name: '预算 vs 开销（Budget vs spending）',\r\n        type: 'radar',\r\n        data: []\r\n    }]\r\n};\r\n\r\nfunction getAqiColor(value){\r\n\tvar COLOR = ['#ccc','rgb(0,228,0)','rgb(255,255,0)','rgb(255,126,0)','rgb(255,0,0)','rgb(153,0,76)','rgb(126,0,35)'];\r\n\tvar V = [0,50,100,150,200,300,500];\r\n\tvar R = [204,0,255,255,255,153,126];\r\n\tvar G = [204,228,255,126,0,0,0];\r\n\tvar B = [204,0,0,0,0,76,35];\r\n\t\r\n\tif(value>=V[V.length-1]){\r\n\t\treturn COLOR[V.length-1];\r\n\t}\r\n\tif(value<=V[0]){\r\n\t\treturn COLOR[0];\r\n\t}\r\n\tfor(var i=0;i<COLOR.length;i++){\r\n\t\tif(V[i]==value){\r\n\t\t\treturn COLOR[i];\r\n\t\t}\r\n\t\tif(value>V[i] && value<V[i+1]){\r\n\t\t\tvar r = (R[i+1]-R[i])/(V[i+1] - V[i])*(value-V[i]) + R[i];\r\n\t\t\tvar g = (G[i+1]-G[i])/(V[i+1] - V[i])*(value-V[i]) + G[i];\r\n\t\t\tvar b = (B[i+1]-B[i])/(V[i+1] - V[i])*(value-V[i]) + B[i];\r\n\t\t\treturn 'rgb('+r+','+g+','+b+')';\r\n\t\t}\r\n\t}\r\n\treturn 'white';\r\n}\r\n\r\n\r\n// 非渐变时需要对值设定颜色等级\r\nconst _gConfig = {};\r\nvar COLOR = ['#ccc','rgb(0,228,0)','rgb(255,255,0)','rgb(255,126,0)','rgb(255,0,0)','rgb(153,0,76)','rgb(126,0,35)'];\r\nvar AQI = [0,50,100,150,200,300,10000];\r\n_gConfig.AQI_LEVEL = [0,50,100,150,200,300,400,500]; // len = 8\r\n\r\nfunction getIAQIColor(factor,value,model){\r\n\tvar obj = getAQILevel(value);\r\n\tif(typeof(obj.color)=='undefined'){\r\n\t\treturn COLOR[0];\r\n\t}\r\n\t// 计算出分因子值对应的分AQI\r\n\treturn obj.color;\r\n}\r\n\r\nfunction getAQILevel(aqiValue){\r\n\tvar res = {};\r\n\tvar AQI = _gConfig.AQI_LEVEL;\r\n\tfor(var i=0;i<AQI.length;i++){\r\n\t\tif(aqiValue <= AQI[i]){\r\n\t\t\tif(i>6){\r\n\t\t\t\tres.color = COLOR[6];\r\n\t\t\t}else{\r\n\t\t\t\tres.color = COLOR[i];\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t// 将离线颜色设置为优的颜色\r\n\tif(res.color == '#ccc'){\r\n\t\tres.color = '#00E400';\r\n\t}\r\n\treturn res;\r\n}\r\n","html":"","externalScripts":"https://cdnjs.cloudflare.com/ajax/libs/mathjs/8.1.1/math.js","updaterUID":"obd-ojgM33Q5chuDris7f07k8h8VW5h1qDa","theme":"","layout":"","viewCount":244,"userName":"伏***","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xCzLXChknD.png?v=1610932606012","isCustomThumbnail":0,"builtinTags":["category-work","legend","polar","radar","series-radar","series-scatter","tooltip"],"customTags":[],"updaterUserName":"伏***"}}