{"status":0,"data":{"cid":"xrkL9E8K-M","authorUid":"bd-1772129157","authorUserName":"130******66","title":"上海Starbucks咖啡饮品周销售量","description":"点击极坐标系下即可与圆环图交互\n点击柱状图排序","latestVersion":1,"alwaysLatest":1,"createTime":"2017-12-09T12:18:22.000Z","lastUpdateTime":"2017-12-09T12:18:22.000Z","auth":2,"uid":"bd-1772129157","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.8.0","versionCreateTime":"2017-12-09T12:18:22.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1512807942885-HJJzRztbM.xlsx\";\r\n\r\n\r\n//------------------------------------------------以下的变量为最终插入数据的变量------------------------------------------------------------\r\n//条形图x轴\r\nvar xAxisBarChart = [];\r\n//条形图数据\r\nvar dataBarChart = [];\r\n//美式咖啡一周销量（7个数）\r\nvar dataBrownies = [];\r\n//拿铁一周销量（7个数）\r\nvar dataMacarons = [];\r\n//焦糖玛奇朵一周销量（7个数）\r\nvar dataTiramisu = [];\r\n//时间轴数据\r\nvar timelineData = [];\r\n//数据插入图表\r\nvar optionsData = [];\r\n\r\n//------------------------------------------------以下的变量为数据转换时的变量------------------------------------------------------------\r\n//极坐标轴显示星期几\r\nvar weekDay = 0;\r\n//全数据数组\r\nvar sourceArray = [];\r\n//判断是否排序\r\nvar SortOrNot = false;\r\n//反序排序：从大到小\r\nvar compare = function(x, y) {\r\n        if (x.value < y.value) {\r\n            return 1;\r\n        } else if (x.value > y.value) {\r\n            return -1;\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n    //柱状图数据的映射集合，实现排序的转换\r\nvar dataBarChartMap = new Map();\r\n//柱状图数据的寄存器，最后一步再导入到dataBarChart中\r\nvar dataBarChartTemp = [];\r\n\r\n//图表加载\r\noption = {\r\n    baseOption: {\r\n        timeline: {\r\n            x: 0,\r\n            axisType: 'category',\r\n            orient: 'vertical',\r\n            autoPlay: true,\r\n            playInterval: 1000,\r\n            data: timelineData,\r\n            left: 10,\r\n            right: null,\r\n            top: 50,\r\n            bottom: 0,\r\n            width: 70,\r\n            height: null,\r\n            inverse: true,\r\n            symbol: 'none',\r\n            lineStyle: {\r\n                color: '#555'\r\n            },\r\n            checkpointStyle: {\r\n                color: '#bbb',\r\n                borderColor: '#777',\r\n                borderWidth: 2\r\n            },\r\n            label: {\r\n                normal: {\r\n                    textStyle: {\r\n                        color: '#999',\r\n                        fontSize: 15\r\n                    }\r\n                },\r\n                emphasis: {\r\n                    textStyle: {\r\n                        color: '#999',\r\n                        fontSize: 20\r\n                    }\r\n                }\r\n            },\r\n        },\r\n        title: {\r\n            text: '上海Starbucks咖啡饮品周销售量',\r\n            subtext: '点击极坐标系下即可与圆环图交互\\n点击柱状图排序',\r\n            textAlign: 'left'\r\n        },\r\n        tooltip: {\r\n            trigger: 'item',\r\n            padding: 10,\r\n            backgroundColor: '#222',\r\n            borderColor: '#777',\r\n            borderWidth: 1,\r\n            formatter: tooltipFormatter,\r\n\r\n        },\r\n        angleAxis: {\r\n            type: 'category',\r\n            data: [{\r\n                value: '周一',\r\n                textStyle: {\r\n                    fontSize: 25,\r\n                }\r\n            }, '周二', '周三', '周四', '周五', '周六', '周日'],\r\n            z: 10\r\n        },\r\n        grid: {\r\n            left: '6%',\r\n            right: '5%',\r\n            top: '16%',\r\n            bottom: '3%',\r\n            containLabel: true\r\n        },\r\n        polar: {\r\n            center: ['80%', '30%'],\r\n            radius: 100,\r\n        },\r\n        xAxis: [{\r\n            type: 'category',\r\n            data: xAxisBarChart,\r\n            axisLabel: {\r\n                'interval': 0\r\n            },\r\n        }],\r\n        yAxis: [{\r\n            type: 'value',\r\n            max: 600,\r\n            show: false,\r\n        }],\r\n        radiusAxis: {},\r\n        series: [{\r\n            type: 'bar',\r\n            data: dataBrownies,\r\n            coordinateSystem: 'polar',\r\n            name: '美式咖啡',\r\n            center: ['80%', '30%'],\r\n            stack: 'a',\r\n            itemStyle: {\r\n                normal: {\r\n                    borderWidth: 4,\r\n                    borderColor: '#ffffff',\r\n                },\r\n                emphasis: {\r\n                    borderWidth: 0,\r\n                    shadowBlur: 10,\r\n                    shadowOffsetX: 0,\r\n                    shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n                }\r\n            }\r\n        }, {\r\n            type: 'bar',\r\n            data: dataMacarons,\r\n            coordinateSystem: 'polar',\r\n            name: '拿铁',\r\n            center: ['80%', '30%'],\r\n            stack: 'a',\r\n            itemStyle: {\r\n                normal: {\r\n                    borderWidth: 4,\r\n                    borderColor: '#ffffff',\r\n                },\r\n                emphasis: {\r\n                    borderWidth: 0,\r\n                    shadowBlur: 10,\r\n                    shadowOffsetX: 0,\r\n                    shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n                }\r\n            }\r\n        }, {\r\n            type: 'bar',\r\n            data: dataTiramisu,\r\n            coordinateSystem: 'polar',\r\n            name: '焦糖玛奇朵',\r\n            center: ['80%', '30%'],\r\n            stack: 'a',\r\n            itemStyle: {\r\n                normal: {\r\n                    borderWidth: 3,\r\n                    borderColor: '#ffffff',\r\n                },\r\n                emphasis: {\r\n                    borderWidth: 3,\r\n                    shadowBlur: 10,\r\n                    shadowOffsetX: 0,\r\n                    shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n                }\r\n            }\r\n        }, {\r\n            name: '每周的日销量',\r\n            type: 'pie',\r\n            center: ['80%', '30%'],\r\n            radius: ['45%', '50%'],\r\n            avoidLabelOverlap: false,\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'outside',\r\n                    formatter: '{b} : {c} ({d}%)'\r\n\r\n                },\r\n                emphasis: {\r\n                    show: true,\r\n                    textStyle: {\r\n                        fontSize: '15',\r\n                        fontWeight: 'normal'\r\n                    }\r\n                },\r\n                tooltip: {\r\n                    trigger: 'item',\r\n                    padding: 10,\r\n                    backgroundColor: '#222',\r\n                    borderColor: '#777',\r\n                    borderWidth: 1,\r\n                    formatter: tooltipFormatter,\r\n\r\n                },\r\n            },\r\n            labelLine: {\r\n                normal: {\r\n                    show: false\r\n                }\r\n            },\r\n            legend: {\r\n                show: true,\r\n                orient: 'vertical',\r\n                x: 'left',\r\n                y: 'bottom',\r\n                data: ['var uploadedDataURL']\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    borderWidth: 3,\r\n                    borderColor: '#ffffff',\r\n                },\r\n                emphasis: {\r\n                    show: true,\r\n                    textStyle: {\r\n                        fontSize: '15',\r\n                        fontWeight: 'normal'\r\n                    }\r\n                }\r\n            }\r\n        }, {\r\n            name: '半年销量',\r\n            type: 'bar',\r\n            avoidLabelOverlap: false,\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'outside',\r\n                    formatter: '{c}'\r\n\r\n                },\r\n                emphasis: {\r\n                    show: true,\r\n                    textStyle: {\r\n                        fontSize: '20',\r\n                        fontWeight: 'normal'\r\n                    }\r\n                }\r\n            },\r\n            labelLine: {\r\n                normal: {\r\n                    show: false\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    borderWidth: 3,\r\n                    borderColor: '#ffffff',\r\n                },\r\n                emphasis: {\r\n                    borderWidth: 3,\r\n                    shadowBlur: 10,\r\n                    shadowOffsetX: 0,\r\n                    shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n                }\r\n            }\r\n        }]\r\n    },\r\n    options: optionsData,\r\n}\r\n\r\n\r\n//全数据计算\r\nfor (var week = 0; week < 26; week++) {\r\n    var weekDataArray = [];\r\n    for (var day = 0; day < 7; day++) {\r\n         var productSales = [{\r\n                'Brownies': parseInt(20 * Math.random()),\r\n                'Macarons': parseInt(20 * Math.random()),\r\n                'Tiramisu': parseInt(20 * Math.random())\r\n            }];\r\n            weekDataArray.push(productSales);\r\n    }\r\n    //\r\n    sourceArray.push(weekDataArray);\r\n    timelineData.push('第' + (week + 1) + '周');\r\n}\r\n\r\neveryProductCalculate();\r\n//\r\nfunction everyProductCalculate() {\r\n    //数组容器重置\r\n    dataBarChartMap = new Map();\r\n    dataBarChartTemp = [];\r\n    xAxisBarChart = [];\r\n    dataBrownies = [];\r\n    dataMacarons = [];\r\n    dataTiramisu = [];\r\n    optionsData = [];\r\n\r\n    //柱状图数据计算，就是一周合计的计算\r\n    for (var i = 0; i < sourceArray.length; i++) {\r\n        var weekSum = 0;\r\n        for (var j = 0; j < sourceArray[i].length; j++) {\r\n            var daySum = 0;\r\n            daySum = sourceArray[i][j][0].Brownies +\r\n                sourceArray[i][j][0].Macarons +\r\n                sourceArray[i][j][0].Tiramisu;\r\n            weekSum = weekSum + daySum;\r\n        }\r\n        dataBarChartTemp.push(weekSum);\r\n    }\r\n    //数据插入到map集合中，由星期和每周销量相互对应\r\n    for (var i = 1; i < sourceArray.length + 1; i++) {\r\n        dataBarChartMap.put(i, dataBarChartTemp[i - 1]);\r\n\r\n    }\r\n    //是否排序\r\n    if (SortOrNot) {\r\n        dataBarChartMap.elements.sort(compare);\r\n        dataBarChartTemp = dataBarChartMap.elements;\r\n    }\r\n    //得到dataBarChart，柱状图数据\r\n    dataBarChart = dataBarChartTemp;\r\n    for (var i = 0; i < sourceArray.length; i++) {\r\n        var xAxisBarChartTemp = [];\r\n        for (var j = 0; j < sourceArray.length; j++) {\r\n            if (i == dataBarChartMap.elements[j].key - 1) {\r\n                xAxisBarChartTemp.push('\\n>第' + dataBarChartMap.elements[j].key + '周<');\r\n            } else {\r\n                xAxisBarChartTemp.push(dataBarChartMap.elements[j].key + '周');\r\n            }\r\n        }\r\n        //得到xAxisBarChart，柱状图x轴数据\r\n        xAxisBarChart.push(xAxisBarChartTemp);\r\n    }\r\n    //\r\n    //每个产品全部销量计算（一个产品包含7个值）\r\n    for (var i = 0; i < sourceArray.length; i++) {\r\n        dataBrowniesTemp = [];\r\n        dataMacaronsTemp = [];\r\n        dataTiramisuTemp = [];\r\n        for (var j = 0; j < sourceArray[i].length; j++) {\r\n            dataBrowniesTemp.push(sourceArray[i][j][0].Brownies);\r\n            dataMacaronsTemp.push(sourceArray[i][j][0].Macarons);\r\n            dataTiramisuTemp.push(sourceArray[i][j][0].Tiramisu);\r\n        }\r\n        //得到饮品各自的数据\r\n        dataBrownies.push(dataBrowniesTemp);\r\n        dataMacarons.push(dataMacaronsTemp);\r\n        dataTiramisu.push(dataTiramisuTemp);\r\n    }\r\n    for (var i = 0; i < sourceArray.length; i++) {\r\n        optionsData.push({\r\n            'series': [{\r\n                    'data': dataBrownies[i]\r\n                }, {\r\n                    'data': dataMacarons[i]\r\n                }, {\r\n                    'data': dataTiramisu[i]\r\n                }, {\r\n                    'data': [{\r\n                        value: dataBrownies[i][weekDay],\r\n                        name: '美式咖啡'\r\n                    }, {\r\n                        value: dataMacarons[i][weekDay],\r\n                        name: '拿铁'\r\n                    }, {\r\n                        value: dataTiramisu[i][weekDay],\r\n                        name: '焦糖玛奇朵'\r\n                    }]\r\n                }, {\r\n                    'data': dataBarChart\r\n                },\r\n\r\n            ],\r\n            'xAxis': [{\r\n                'data': xAxisBarChart[i],\r\n            }]\r\n        });\r\n    }\r\n    option.options = optionsData;\r\n\r\n    myChart.setOption(option);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmyChart.on('click', function(params) {\r\n    //直接改变数据的内容\r\n    if (params.componentSubType != 'pie' &&\r\n        params.seriesName != '半年销量') {\r\n        weekDay = params.dataIndex;\r\n        for (var i = 0; i < option.baseOption.timeline.data.length; i++) {\r\n            option.options[i].series[3].data[0].value = dataBrownies[i][weekDay];\r\n            option.options[i].series[3].data[1].value = dataMacarons[i][weekDay];\r\n            option.options[i].series[3].data[2].value = dataTiramisu[i][weekDay];\r\n        }\r\n        var weekDayData = ['周一', '周二', '周三', '周四', '周五',\r\n            '周六', '周日'\r\n        ];\r\n        weekDayData[weekDay] = {\r\n            value: weekDayData[weekDay],\r\n            textStyle: {\r\n                fontSize: 25,\r\n            }\r\n        };\r\n        option.baseOption.timeline.autoPlay = false;\r\n        option.baseOption.angleAxis.data = weekDayData;\r\n        myChart.setOption(option);\r\n    }\r\n    //重新执行数据转换过程\r\n    else if (params.componentSubType == 'bar' &&\r\n        params.seriesName == '半年销量') {\r\n        if (SortOrNot == false) {\r\n            SortOrNot = true;\r\n        } else {\r\n            SortOrNot = false;\r\n        }\r\n        everyProductCalculate();\r\n        option.options = optionsData;\r\n        myChart.setOption(option);\r\n    }\r\n});\r\n//提示框体\r\nfunction tooltipFormatter(params) {\r\n    var valuesFormatter = [];\r\n    if (params.componentSubType == 'pie') {\r\n        valuesFormatter\r\n            .push('<div style=\"border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px\">' +\r\n                '本日销量' +\r\n                '<br>' +\r\n                '</div>' +\r\n                '<span style=\"color:' +\r\n                params.color +\r\n                '\">' + params.name + '</span>: ' + params.value);\r\n    } else {\r\n        valuesFormatter\r\n            .push('<div style=\"border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px\">' +\r\n                params.seriesName +\r\n                '</div>' +\r\n                '<span style=\"color:' +\r\n                params.color +\r\n                '\">' +\r\n                params.name +\r\n                '</span>: ' +\r\n                params.value + '<br>');\r\n    }\r\n\r\n    return valuesFormatter;\r\n}\r\n//map集合,这里应该写在工具脚本中\r\nfunction Map() {\r\n    this.elements = new Array();\r\n\r\n    // 获取Map元素个数\r\n    this.size = function() {\r\n            return this.elements.length;\r\n        },\r\n\r\n        // 判断Map是否为空\r\n        this.isEmpty = function() {\r\n            return (this.elements.length < 1);\r\n        },\r\n\r\n        // 删除Map所有元素\r\n        this.clear = function() {\r\n            this.elements = new Array();\r\n        },\r\n\r\n        // 向Map中增加元素（key, value)\r\n        this.put = function(_key, _value) {\r\n            if (this.containsKey(_key) == true) {\r\n                if (this.containsValue(_value)) {\r\n                    if (this.remove(_key) == true) {\r\n                        this.elements.push({\r\n                            key: _key,\r\n                            value: _value\r\n                        });\r\n                    }\r\n                } else {\r\n                    this.elements.push({\r\n                        key: _key,\r\n                        value: _value\r\n                    });\r\n                }\r\n            } else {\r\n                this.elements.push({\r\n                    key: _key,\r\n                    value: _value\r\n                });\r\n            }\r\n        },\r\n\r\n        // 删除指定key的元素，成功返回true，失败返回false\r\n        this.remove = function(_key) {\r\n            var bln = false;\r\n            try {\r\n                for (i = 0; i < this.elements.length; i++) {\r\n                    if (this.elements[i].key == _key) {\r\n                        this.elements.splice(i, 1);\r\n                        return true;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                bln = false;\r\n            }\r\n            return bln;\r\n        },\r\n\r\n        // 获取指定key的元素值value，失败返回null\r\n        this.get = function(_key) {\r\n            try {\r\n                for (i = 0; i < this.elements.length; i++) {\r\n                    if (this.elements[i].key == _key) {\r\n                        return this.elements[i].value;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                return null;\r\n            }\r\n        },\r\n\r\n        // 获取指定索引的元素（使用element.key，element.value获取key和value），失败返回null\r\n        this.element = function(_index) {\r\n            if (_index < 0 || _index >= this.elements.length) {\r\n                return null;\r\n            }\r\n            return this.elements[_index];\r\n        },\r\n\r\n        // 判断Map中是否含有指定key的元素\r\n        this.containsKey = function(_key) {\r\n            var bln = false;\r\n            try {\r\n                for (i = 0; i < this.elements.length; i++) {\r\n                    if (this.elements[i].key == _key) {\r\n                        bln = true;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                bln = false;\r\n            }\r\n            return bln;\r\n        },\r\n\r\n        // 判断Map中是否含有指定value的元素\r\n        this.containsValue = function(_value) {\r\n            var bln = false;\r\n            try {\r\n                for (i = 0; i < this.elements.length; i++) {\r\n                    if (this.elements[i].value == _value) {\r\n                        bln = true;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                bln = false;\r\n            }\r\n            return bln;\r\n        },\r\n\r\n        // 获取Map中所有key的数组（array）\r\n        this.keys = function() {\r\n            var arr = new Array();\r\n            for (i = 0; i < this.elements.length; i++) {\r\n                arr.push(this.elements[i].key);\r\n            }\r\n            return arr;\r\n        },\r\n\r\n        // 获取Map中所有value的数组（array）\r\n        this.values = function() {\r\n            var arr = new Array();\r\n            for (i = 0; i < this.elements.length; i++) {\r\n                arr.push(this.elements[i].value);\r\n            }\r\n            return arr;\r\n        };\r\n}","html":"","externalScripts":"","updaterUID":"bd-1772129157","theme":"","layout":"","viewCount":1212,"userName":"130******66","commentCount":0,"starCount":5,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrkL9E8K-M.png?v=1512821902292","isCustomThumbnail":0,"builtinTags":["category-work","grid","polar","series-bar","series-pie","timeline","title","tooltip"],"customTags":[],"updaterUserName":"130******66"}}