{"status":0,"data":{"cid":"xBSiTBwJnu","authorUid":"obd-otakjcfuBJSiMIOBRrWEE8krK0_Y88D","authorUserName":"L***L","title":"geo","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2020-07-29T09:22:32.000Z","lastUpdateTime":"2020-07-29T09:22:32.000Z","auth":1,"uid":"obd-otakjcfuBJSiMIOBRrWEE8krK0_Y88D","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-29T09:22:32.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1482909900836-H1BC_1WHg.json\";\n\n$.get(uploadedDataURL, (shJson) => {\n    echarts.registerMap('shanghai', shJson)\n    \n    const north = ['宝山区', '嘉定区','青浦区', '松江区']\n    const south = ['浦东新区', '奉贤区', '闵行区']\n    \n    var geoCoordMap = {\n        '黄浦区': [121.490317, 31.222771],\n        '徐汇区': [121.43752, 31.179973],\n        '长宁区': [121.4222, 31.218123],\n        '静安区': [121.448224, 31.229003],\n        '普陀区': [121.392499, 31.241701],\n        '闸北区': [121.465689, 31.25318],\n        '虹口区': [121.491832, 31.26097],\n        '杨浦区': [121.522797, 31.270755],\n        '闵行区': [121.375972, 31.111658],\n        '宝山区': [121.489934, 31.398896],\n        '嘉定区': [121.250333, 31.383524],\n        '浦东新区': [121.7795171, 31.13357039],\n        '金山区': [121.330736, 30.724697],\n        '松江区': [121.223543, 31.03047],\n        '青浦区': [121.113021, 31.151209],\n        '奉贤区': [121.458472, 30.912345],\n        '崇明县': [121.397516, 31.626946],\n    };\n    \n    function getGeo(areas){\n        const set = areas.map(area => Object.entries(geoCoordMap).filter(([key, value]) => key === area)[0][1])\n        return set.reduce((prev, curr, idx) => {\n            let [x, y] = prev\n            x = x || 0\n            y = y || 0\n            if(idx === areas.length - 1) return [(x+curr[0]) / (idx + 1), (y + curr[1]) / (idx + 1)]\n            return [x+curr[0], y + curr[1]]\n        }, [])\n    }\n    \n    geoCoordMap['北区'] = getGeo(north)\n    geoCoordMap['南区'] = getGeo(south)    \n    function coverLine(areas) {\n        const result = []\n        const areaEntries = Object.entries(geoCoordMap)\n        return areas.map((area,index) => {\n            const nextArea = index === areas.length -1 ? areas[0] : areas[index + 1]\n            const lineStyle =  north.includes(area) ? {\n                normal: {\n                    color: 'cyan'\n                }\n            } : {}\n            return {\n                coords: [getArea(area), getArea(nextArea)],\n                lineStyle\n            }\n            \n        })\n    }\n\n    function getArea (area) {\n        return Object.entries(geoCoordMap).filter(([key, geo]) => key === area)[0][1]\n    }\n    \n    const scatterData = Object.entries(geoCoordMap).map(([key, value])=>{\n        const itemStyle = key === '南区' ||  key === '北区' ? {\n            color: 'red'\n        } : {}\n        return ({name: key, itemStyle, value: value.concat([parseInt(Math.random() * 500)])})\n    })\n    \n    option = {\n        backgroundColor: '#173b84',\n        textStyle: {\n            color: '#fff'\n        },\n        geo: {\n            map: 'shanghai',\n            left: \"center\",\n            top: \"center\",\n            silent: false,\n            roam: true,\n            label: {\n                show: false\n            },\n            emphasis: {\n                show: false\n            },\n            itemStyle: {\n                    areaColor: \"#4487d5\",\n                    borderColor: \"#3B5077\",\n                    borderWidth: 1,\n                    color: \"green\"\n                }\n        },\n        series: [{\n            type: 'map',\n            map: 'shanghai',\n            geoIndex: 0,\n            aspectScale: 0.75, //长宽比\n            showLegendSymbol: false, // 存在legend时显示\n            roam: true,\n            animation: false,\n            emphasis: {\n                show: false\n            },\n        }, {\n            type: 'effectScatter',\n            coordinateSystem: 'geo',\n            zlevel: 3,\n             //波纹效果\n            rippleEffect: {\n                period: 2,\n                brushType: 'fill',\n                scale: 5\n            },\n            label: {\n                normal: {\n                    show: true,\n                    position: 'bottom',\n                    formatter: '{b}'\n                }\n            },\n            //终点形象\n            symbol: 'circle',\n            //圆点大小\n            symbolSize: function(val) {\n                return val[2] / 30;\n                // return 5;\n            },\n            itemStyle: {\n                normal: {\n                    show: true,\n                    color: '#FD916A'\n                }\n            },\n            data: scatterData\n        },\n        {\n            type: 'lines',\n            zlevel: 2,\n            lineStyle: {\n                normal: {\n                    type: 'dotted',\n                    width: 1,\n                    opacity: 0.4,\n                    color: 'yellow',\n                    curveness: 0.3\n                }\n            },\n            effect: {\n                show: true,\n                loop: true\n            },\n            data: [\n                ...coverLine(['宝山区', '松江区','青浦区', '嘉定区']),\n                ...coverLine(['浦东新区', '奉贤区', '闵行区'])\n            ]\n        }\n        \n        ]\n    }\n    console.log(coverLine(['宝山区', '嘉定区','青浦区', '松江区']))\n    myChart.setOption(option);\n    console.log(myChart.getOption())\n})","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"obd-otakjcfuBJSiMIOBRrWEE8krK0_Y88D","theme":"","layout":"","viewCount":1276,"userName":"L***L","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xBSiTBwJnu.png?v=1596014552278","isCustomThumbnail":0,"builtinTags":["category-work","geo","series-effectScatter","series-lines","series-map"],"customTags":[],"updaterUserName":"L***L"}}