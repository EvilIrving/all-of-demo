{"status":0,"data":{"cid":"xNIqwk9xbu","authorUid":"bd-3778831175","authorUserName":"m***i","title":"San Francisco Elevation Contour","description":"San Francisco Elevation Contour","latestVersion":3,"alwaysLatest":1,"createTime":"2018-12-17T12:44:17.000Z","lastUpdateTime":"2018-12-17T12:44:17.000Z","auth":2,"uid":"bd-3778831175","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.1.0","versionCreateTime":"2019-01-09T10:45:26.000Z","code":"//data from http://kepler.gl/#/\r\n\r\nconst URLS = [\r\n    '/asset/get/s/data-1545048052616-gQB5B2AC2.txt',\r\n    '/asset/get/s/data-1545048059447-gcWE5ECQt.txt',\r\n    '/asset/get/s/data-1545048064249-kh4z-rD5z.txt',\r\n    '/asset/get/s/data-1545048092463-6a4JT8yiT.txt',\r\n    '/asset/get/s/data-1545048087945-r5NyeL8Zq.txt',\r\n    '/asset/get/s/data-1545048081162-aEtkoqOv5.txt',\r\n    '/asset/get/s/data-1545048075561-O8t-pYfG6.txt',\r\n    '/asset/get/s/data-1545048069355-3nMgGCLRg.txt'\r\n];\r\n\r\nconst LEN = URLS.length;\r\nlet lines = [];\r\n\r\nfunction getColor(elevation) {\r\n    let color = 'red';\r\n    if (elevation < 50) color = '#0198BD';\r\n    if (elevation >= 50 && elevation < 220) color = '#49E3CE';\r\n    if (elevation >= 220 && elevation < 390) color = '#E8FEB5';\r\n    if (elevation >= 390 && elevation < 460) color = '#FEEDB1';\r\n    if (elevation >= 460 && elevation < 650) color = '#FEAD54';\r\n    if (elevation >= 650) color = '#D50255';\r\n    return color;\r\n\r\n}\r\n\r\nfunction getData(idx) {\r\n    fetch(URLS[idx]).then(res => res.text()).then(data => {\r\n        data = LZString.decompressFromBase64(data);\r\n        data = JSON.parse(data);\r\n        console.log(data.length);\r\n        if (idx === LEN - 1) {\r\n            console.log('getdata finish');\r\n            myChart.hideLoading();\r\n            initChart(lines);\r\n        } else {\r\n            data.forEach(d => {\r\n                let lnglats = (d.geometry || {}).coordinates || [];\r\n                const elevation = d.properties.elevation || 1;\r\n                const color = getColor(elevation);\r\n\r\n                for (let i = 0, len = lnglats.length; i < len; i++) {\r\n                    lnglats[i] = lnglats[i].concat(elevation);\r\n                }\r\n                lines.push({\r\n                    coords: lnglats,\r\n                    lineStyle: {\r\n                        color: color\r\n\r\n                    }\r\n                });\r\n            })\r\n            getData(++idx);\r\n        }\r\n    })\r\n}\r\nmyChart.showLoading();\r\ngetData(0);\r\n\r\n\r\nfunction initChart(data) {\r\n    var option = {\r\n        maptalks3D: {\r\n            bearing: 0,\r\n            center: [-122.45258435030888, 37.751668560326806],\r\n            pitch: 52.40000000000002,\r\n            zoom: 13,\r\n            urlTemplate: 'http://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',\r\n            altitudeScale: 2,\r\n            // postEffect: {\r\n            //     enable: true,\r\n            //     FXAA: {\r\n            //         enable: true\r\n            //     }\r\n            // },\r\n            // light: {\r\n            //     main: {\r\n            //         intensity: 1,\r\n            //         shadow: true,\r\n            //         shadowQuality: 'high'\r\n            //     },\r\n            //     ambient: {\r\n            //         intensity: 0.\r\n            //     },\r\n            //     ambientCubemap: {\r\n            //         texture: '/asset/get/s/data-1491838644249-ry33I7YTe.hdr',\r\n            //         exposure: 1,\r\n            //         diffuseIntensity: 0.5,\r\n            //         specularIntensity: 2\r\n            //     }\r\n            // }\r\n        },\r\n        series: [{\r\n            type: 'lines3D',\r\n            coordinateSystem: 'maptalks3D',\r\n            // effect: {\r\n            //     show: true,\r\n            //     constantSpeed:1,\r\n            //     trailWidth: 1,\r\n            //     trailLength: 1,\r\n            //     trailOpacity: 1,\r\n            //     spotIntensity: 10\r\n            // },\r\n\r\n            // blendMode: 'lighter',\r\n\r\n            polyline: true,\r\n\r\n            lineStyle: {\r\n                width: 0.8,\r\n                color: 'rgb(100, 100, 0)',\r\n                opacity: 1.\r\n            },\r\n\r\n            data: data\r\n        }]\r\n    }\r\n    myChart.setOption(option);\r\n    window.addEventListener('resize', function() {\r\n        myChart.resize();\r\n    });\r\n}","html":"","externalScripts":"https://cdn.jsdelivr.net/npm/maptalks@0.39.3/dist/maptalks.min.js,https://cdn.bootcss.com/echarts/4.1.0/echarts.min.js,https://deyihu.github.io/src/lib/echarts-gl.1.1.3.js?tdsourcetag=s_pctim_aiomsg,https://cdn.bootcss.com/lz-string/1.4.4/lz-string.min.js","updaterUID":"bd-3778831175","theme":"","layout":"","viewCount":437,"userName":"m***i","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xNIqwk9xbu.png?v=1545050660586","isCustomThumbnail":1,"builtinTags":["category-work","maptalks3D","series-lines3D"],"customTags":["echarts-gl"],"updaterUserName":"m***i"}}