{"status":0,"data":{"cid":"xHyYK1gsxz","authorUid":"bd-2618800628","authorUserName":"xuzhenhuiboy","title":"深圳各辖区犯罪率影响因素","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2017-11-28T14:15:29.000Z","lastUpdateTime":"2017-11-28T14:15:29.000Z","auth":2,"uid":"bd-2618800628","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.8.0","versionCreateTime":"2017-11-28T14:15:29.000Z","code":"var districts = {\n    \"宝安区\": {\n        \"lat\": 22.5896850000,\n        \"lng\": 113.8631380000\n    },\n    \"南山区\": {\n        \"lat\": 22.5296850000,\n        \"lng\": 113.9331380000\n    },\n    \"福田区\": {\n        \"lat\": 22.5381230000,\n        \"lng\": 114.0687750000\n    },\n    \"罗湖区\": {\n        \"lat\": 22.5621550000,\n        \"lng\": 114.1394890000\n    },\n    \"盐田区\": {\n        \"lat\": 22.5760380000,\n        \"lng\": 114.2389500000\n    },\n    \"龙岗区\": {\n        \"lat\": 22.7158600000,\n        \"lng\": 114.2343500000\n    }\n};\n\nvar allData = {\n    \"穆斯林影响系数\": {\n        \"district_count\": [{\n            \"district\": \"宝安区\",\n            \"count\": 0.2\n        },{\n            \"district\": \"南山区\",\n            \"count\": 0.3\n        },{\n            \"district\": \"福田区\",\n            \"count\": 0.4\n        },{\n            \"district\": \"罗湖区\",\n            \"count\": 0.4\n        },{\n            \"district\": \"盐田区\",\n            \"count\": 0.2\n        },{\n            \"district\": \"龙岗区\",\n            \"count\": 0.2\n        }]\n    },\n    \"外来人口影响系数\": {\n        \"district_count\": [{\n            \"district\": \"宝安区\",\n            \"count\": 0.3\n        },{\n            \"district\": \"南山区\",\n            \"count\": 0.3\n        },{\n            \"district\": \"福田区\",\n            \"count\": 0.4\n        },{\n            \"district\": \"罗湖区\",\n            \"count\": 0.26\n        },{\n            \"district\": \"盐田区\",\n            \"count\": 0.28\n        },{\n            \"district\": \"龙岗区\",\n            \"count\": 0.33\n        }]\n    },\n    \"失业率影响系数\": {\n        \"district_count\": [{\n            \"district\": \"宝安区\",\n            \"count\": 0.1\n        },{\n            \"district\": \"南山区\",\n            \"count\": 0.2\n        },{\n            \"district\": \"福田区\",\n            \"count\": 0.1\n        },{\n            \"district\": \"罗湖区\",\n            \"count\": 0.1\n        },{\n            \"district\": \"盐田区\",\n            \"count\": 0.2\n        },{\n            \"district\": \"龙岗区\",\n            \"count\": 0.2\n        }]\n    },\n    \"低收入影响系数\": {\n        \"district_count\": [{\n            \"district\": \"宝安区\",\n            \"count\": 0.18\n        },{\n            \"district\": \"南山区\",\n            \"count\": 0.15\n        },{\n            \"district\": \"福田区\",\n            \"count\": 0.1\n        },{\n            \"district\": \"罗湖区\",\n            \"count\": 0.1\n        },{\n            \"district\": \"盐田区\",\n            \"count\": 0.2\n        },{\n            \"district\": \"龙岗区\",\n            \"count\": 0.24\n        }]\n    }\n};\n\nvar option = {\n    // color: ['#85b6b2', '#6d4f8d','#cd5e7e', '#e38980','#f7db88'],\n    bmap: {\n        center: [114.1039166260,22.5902744004],\n        zoom: 12,\n        roam: true,\n        enableMapClick: false,\n        mapStyle: {\n            styleJson: [{\n                \"featureType\": \"all\",\n                \"elementType\": \"all\"\n\n            }, {\n                \"featureType\": \"poi\",\n                \"elementType\": \"all\",\n                \"stylers\": {\n                    \"visibility\": \"on\"\n                }\n            }]\n        }\n    },\n    legend: {\n        show: false,\n        orient: 'vertical',\n        right: 20,\n        top: 15,\n        padding: 10,\n        backgroundColor: \"rgba(255,255,255,0.8)\",\n        data: []\n    },\n    series: [{\n        type: 'pie',\n        data: []\n    }]\n};\n\nmyChart.setOption(option);\n\nmyChart.on('legendselectchanged', function (params) {\n    console.log(params.name);\n    for(var prop in districtChart){\n        districtChart[prop].dispatchAction({\n            type: 'legendToggleSelect',\n            name:params.name\n        });\n    }\n});\nsetTimeout(init, 0);\n\n\nfunction init() {\n    initMap();\n    initPieDistrict(myChart, getMap());\n    showPie([\"穆斯林影响系数\", \"外来人口影响系数\", \"失业率影响系数\", \"低收入影响系数\"]);\n    //showPie([\"直接访问\", \"联盟广告\", \"视频广告\"]);\n\n}\n\nfunction initMap() {\n    var top_left_navigation = new BMap.NavigationControl({\n        //type: BMAP_NAVIGATION_CONTROL_SMALL\n    });\n    var map = getMap();\n    //map.centerAndZoom(\"苏州\", 13);\n    map.addControl(top_left_navigation);\n    map.disableDoubleClickZoom();\n    map.removeEventListener(\"click\");\n    return map;\n}\n\n\nfunction getMap() {\n    return myChart.getModel().getComponent('bmap').getBMap();\n}\n\n\nvar districtPoint = districts;\nvar districtChart = {};\nvar districtLabels = [];\nvar parentChart = null;\n\nvar initPieDistrict = function(chart, map) {\n    parentChart = chart;\n    var count = 0;\n    for (var prop in districtPoint) {\n        var district = prop;\n        var position = districtPoint[prop];\n        var id = \"districtPoint\" + count++;\n        districtLabels.push(district);\n        districtChart[district] = initPieMarker(map, id, district, position);\n    }\n    //console.log(districtLabels);\n    //console.log(districtChart);\n}\n\n\n\nfunction initPieMarker(map, id, district, position) {\n    var htm = '<div id=\"' + id + '\" style=\"width:100px;height:100px;\"></div>';\n    var point = new BMap.Point(position.lng, position.lat);\n    var myRichMarkerObject = new BMapLib.RichMarker(htm, point, {\n        \"anchor\": new BMap.Size(-30, -30),\n        barkground: \"transparent\"\n    });\n    map.addOverlay(myRichMarkerObject);\n    document.getElementById(id).parentNode.style.backgroundColor = \"transparent\";\n    document.getElementById(id).parentNode.style.zIndex = \"1\";\n    var myChart = echarts.init(document.getElementById(id), \"macarons\");\n    var option = {\n        tooltip: {\n            trigger: 'item',\n            formatter: \"{a} <br/>{b}: {c} ({d}%)\"\n        },\n        \n        title: {\n            left: \"center\",\n            top: \"center\",\n            textStyle: {\n                fontSize: 14,\n                fontWeight: \"bold\"\n            }\n        },\n        series: [{\n            name: district,\n            type: 'pie',\n            avoidLabelOverlap: false,\n            label: {\n                normal: {\n                    show: false,\n                    position: 'center',\n                    formatter: \"{a}\"\n                }\n            },\n            radius: ['25', '40'],\n            data: []\n\n        }]\n    }\n    myChart.setOption(option);\n    return myChart;\n}\n\nfunction showPie(arr) {\n    let obj = {};\n    console.log(arr.length, \"len\")\n    districtLabels.forEach((i) => {\n        obj[i] = {};\n        arr.forEach((j) => {\n            console.log(j, \"xxx\")\n            obj[i][j] = 0;\n        });\n    });\n\n    console.log(obj, \"AA\")\n        //数据降维\n    for (let prop in allData) {\n        allData[prop].district_count.forEach((i) => {\n            if (obj[i.district][prop] === 0) {\n                obj[i.district][prop] = i.count;\n            }\n        });\n    }\n    console.log(obj);\n    setData(obj, arr);\n}\n\nvar placeHolderStyle = {\n    normal : {\n        color: 'rgba(255,255,255,0.8)',\n        label: {show:false},\n       \n        labelLine: {show:false}\n    },\n    emphasis : {\n        color: 'rgba(0,0,0,0)'\n    }\n};\n\nfunction setData(data, label) {\n\n    districtLabels.forEach((district) => {\n        var count = 0;\n        var dt = (data[district]);\n        var newPieData = [];\n        for (let prop in dt) {\n            newPieData.push({\n                name: prop,\n                value: dt[prop]\n            });\n            count += dt[prop];\n        }\n        console.log(newPieData);\n\n        if (count === 0) {\n            newPieData = [];\n        }\n        districtChart[district].setOption({\n            title: {\n                show: count > 0,\n                text: district\n            },\n            legend: {\n                show:  false,\n                data: label\n            },\n            series: [{\n                data: newPieData\n            }, {\n                tooltip:{show:false},\n                type: 'pie',\n                radius: [0, 25],\n                data: [{\n                    value: 0,\n                    itemStyle : placeHolderStyle\n                }]\n            }]\n        })\n    });\n    let labelName = label.map((i) => {\n        return {\n            name: i\n        };\n    });\n\n    //修改parentChart\n    parentChart.setOption({\n        legend: {\n            show: (label.length > 0),\n            data: label\n        },\n        series: [{\n            data: labelName\n        }]\n    });\n}","html":"","externalScripts":"","updaterUID":"bd-2618800628","theme":"","layout":"","viewCount":147,"userName":"xuzhenhuiboy","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHyYK1gsxz.png?v=1511878529132","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-pie"],"customTags":[],"updaterUserName":"xuzhenhuiboy"}}