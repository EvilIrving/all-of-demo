{"status":0,"data":{"cid":"xtw892J8V9","authorUid":"obd-ol9ApUNzruRtm2D-0e5Fb-FETwsWF0O","authorUserName":"相***光","title":"空气质量等级准确率评估","description":"AQI预测 - 预报准确性评估 - 空气质量等级准确率评估","latestVersion":1,"alwaysLatest":0,"createTime":"2021-10-28T07:32:42.000Z","lastUpdateTime":"2021-10-28T07:32:42.000Z","auth":2,"uid":"obd-ol9ApUNzruRtm2D-0e5Fb-FETwsWF0O","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.1","versionCreateTime":"2021-10-28T07:32:42.000Z","code":"const uploadedDataURL = '/asset/get/s/data-1635390802457-HRSoVX4EN.json';\r\n\r\nconst symbolPass =\r\n    'image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0MjAwNDAzNDA1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI1MDAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMjRDMjI5LjI0OCAxMDI0IDAgNzk0Ljc1MiAwIDUxMlMyMjkuMjQ4IDAgNTEyIDBzNTEyIDIyOS4yNDggNTEyIDUxMi0yMjkuMjQ4IDUxMi01MTIgNTEyeiBtLTExNC4xNzYtMzEwLjk1NDY2N2E1My4zMzMzMzMgNTMuMzMzMzMzIDAgMCAwIDc1LjQzNDY2NyAwbDMyMy4zMjgtMzIzLjMyOGE1My4zMzMzMzMgNTMuMzMzMzMzIDAgMSAwLTc1LjQzNDY2Ny03NS40MzQ2NjZsLTI4Ny45MTQ2NjcgMjgzLjMwNjY2Ni0xMjguODUzMzMzLTEyOC44NTMzMzNhNTMuMzMzMzMzIDUzLjMzMzMzMyAwIDEgMC03NS40MzQ2NjcgNzUuNDM0NjY3bDE2OC44NzQ2NjcgMTY4Ljg3NDY2NnoiIGZpbGw9IiMxYWZhMjkiIHAtaWQ9IjI1MDEiIGRhdGEtc3BtLWFuY2hvci1pZD0iYTMxM3guNzc4MTA2OS4wLmkwIiBjbGFzcz0iIj48L3BhdGg+PC9zdmc+';\r\nconst symbolUp =\r\n    'image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0NTI4NTM3NTE4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEyNDQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDIwLjQ4Yy0yNzEuNDI4MjY2NjcgMC00OTEuNTIgMjIwLjA5MTczMzMzLTQ5MS41MiA0OTEuNTJzMjIwLjA5MTczMzMzIDQ5MS41MiA0OTEuNTIgNDkxLjUyIDQ5MS41Mi0yMjAuMDkxNzMzMzMgNDkxLjUyLTQ5MS41Mi0yMjAuMDkxNzMzMzMtNDkxLjUyLTQ5MS41Mi00OTEuNTJ6IG0yMjIuODIyNCA0NDcuODI5MzMzMzNjLTguNzM4MTMzMzMgOC43MzgxMzMzMy0xOS42NjA4IDEyLjU2MTA2NjY3LTMxLjEyOTYgMTIuNTYxMDY2NjctMTAuOTIyNjY2NjcgMC0yMi4zOTE0NjY2Ny00LjM2OTA2NjY3LTMxLjEyOTYtMTIuNTYxMDY2NjdMNTU1LjY5MDY2NjY3IDM1MC44OTA2NjY2N3Y0MjguMTY4NTMzMzNjMCAyNC4wMjk4NjY2Ny0xOS42NjA4IDQzLjY5MDY2NjY3LTQzLjY5MDY2NjY3IDQzLjY5MDY2NjY3cy00My42OTA2NjY2Ny0xOS42NjA4LTQzLjY5MDY2NjY3LTQzLjY5MDY2NjY3VjM1MC44OTA2NjY2N0wzNTAuODkwNjY2NjcgNDY4LjMwOTMzMzMzYy0xNi45MzAxMzMzMyAxNi45MzAxMzMzMy00NC43ODI5MzMzMyAxNi45MzAxMzMzMy02MS43MTMwNjY2NyAwLTE2LjkzMDEzMzMzLTE2LjkzMDEzMzMzLTE2LjkzMDEzMzMzLTQ0Ljc4MjkzMzMzIDAtNjEuNzEzMDY2NjZsMTg3LjMyMzczMzMzLTE4Ni43Nzc2YzcuNjQ1ODY2NjctMTEuNDY4OCAyMC43NTMwNjY2Ny0xOC41Njg1MzMzMyAzNi4wNDQ4LTE4LjU2ODUzMzM0IDE0Ljc0NTYgMCAyNy44NTI4IDcuNjQ1ODY2NjcgMzYuMDQ0OCAxOC41Njg1MzMzNEw3MzUuOTE0NjY2NjcgNDA2LjU5NjI2NjY3YzE2LjM4NCAxNi45MzAxMzMzMyAxNi4zODQgNDQuMjM2OC0xLjA5MjI2NjY3IDYxLjcxMzA2NjY2eiIgZmlsbD0iI0U1REUxRSIgcC1pZD0iMTI0NSI+PC9wYXRoPjwvc3ZnPg==';\r\nconst symbolDown =\r\n    'image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0NTI4NDk3NzE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMDIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMDMuNTJjMjcxLjQyODI2NjY3IDAgNDkxLjUyLTIyMC4wOTE3MzMzMyA0OTEuNTItNDkxLjUycy0yMjAuMDkxNzMzMzMtNDkxLjUyLTQ5MS41Mi00OTEuNTItNDkxLjUyIDIyMC4wOTE3MzMzMy00OTEuNTIgNDkxLjUyIDIyMC4wOTE3MzMzMyA0OTEuNTIgNDkxLjUyIDQ5MS41MnogbS0yMjIuODIyNC00NDcuODI5MzMzMzNjOC43MzgxMzMzMy04LjczODEzMzMzIDE5LjY2MDgwMDAxLTEyLjU2MTA2NjY3IDMxLjEyOTYtMTIuNTYxMDY2NjcgMTAuOTIyNjY2NjcgMCAyMi4zOTE0NjY2NyA0LjM2OTA2NjY4IDMxLjEyOTYgMTIuNTYxMDY2NjdMNDY4LjMwOTMzMzMzIDY3My4xMDkzMzMzM2wwLTQyOC4xNjg1MzMzM2MwLTI0LjAyOTg2NjY3IDE5LjY2MDgtNDMuNjkwNjY2NjcgNDMuNjkwNjY2NjctNDMuNjkwNjY2NjdzNDMuNjkwNjY2NjcgMTkuNjYwOCA0My42OTA2NjY2NyA0My42OTA2NjY2N0w1NTUuNjkwNjY2NjcgNjczLjEwOTMzMzMzIDY3My4xMDkzMzMzMyA1NTUuNjkwNjY2NjdjMTYuOTMwMTMzMzMtMTYuOTMwMTMzMzMgNDQuNzgyOTMzMzMtMTYuOTMwMTMzMzMgNjEuNzEzMDY2NjcgMCAxNi45MzAxMzMzMyAxNi45MzAxMzMzMyAxNi45MzAxMzMzMyA0NC43ODI5MzMzMyAwIDYxLjcxMzA2NjY2bC0xODcuMzIzNzMzMzMgMTg2Ljc3NzZjLTcuNjQ1ODY2NjcgMTEuNDY4OC0yMC43NTMwNjY2NyAxOC41Njg1MzMzMy0zNi4wNDQ4IDE4LjU2ODUzMzM0LTE0Ljc0NTYgMC0yNy44NTI4LTcuNjQ1ODY2NjctMzYuMDQ0OC0xOC41Njg1MzMzNEwyODguMDg1MzMzMzMgNjE3LjQwMzczMzMzYy0xNi4zODQtMTYuOTMwMTMzMzMtMTYuMzg0LTQ0LjIzNjggMS4wOTIyNjY2Ny02MS43MTMwNjY2NnoiIGZpbGw9IiMzOUE1REQiIHAtaWQ9IjExMDMiPjwvcGF0aD48L3N2Zz4=';\r\n\r\n// AQI 等级\r\nconst AQI_LEVELS = [\r\n  {\r\n    icon: 'k1',\r\n    label: '优',\r\n    otherName: '一级',\r\n    value: 1,\r\n    min: 0,\r\n    max: 50,\r\n    proposal: '空气质量令人满意，基本无空气污染',\r\n    influence: '各类人群可正常活动',\r\n    color: '#00E500',\r\n    lightColor: '#D2F5A5',\r\n  },\r\n  {\r\n    icon: 'k2',\r\n    label: '良',\r\n    otherName: '二级',\r\n    value: 2,\r\n    min: 51,\r\n    max: 100,\r\n    proposal: '空气质量可接受，但某些污染物可能对极少数异常敏感人群健康有较弱影响',\r\n    influence: '极少数异常敏感人群应减少户外活动',\r\n    color: '#FFFF00',\r\n    lightColor: '#EBEBD8',\r\n  },\r\n  {\r\n    icon: 'k3',\r\n    label: '轻度',\r\n    otherName: '三级',\r\n    value: 3,\r\n    min: 101,\r\n    max: 150,\r\n    proposal: '易感人群症状有轻度加剧，健康人群出现刺激症状',\r\n    influence: '儿童、老年人及心脏病、呼吸系统疾病患者应减少长时间、高强度的户外锻炼',\r\n    color: '#FF7E00',\r\n    lightColor: '#F2E1C7',\r\n  },\r\n  {\r\n    icon: 'k4',\r\n    label: '中度',\r\n    otherName: '四级',\r\n    value: 4,\r\n    min: 151,\r\n    max: 200,\r\n    proposal: '进一步加剧易感人群症状，可能对健康人群心脏、呼吸系统有影响',\r\n    influence: '儿童、老年人及心脏病、呼吸系统疾病患者避免长时间、高强度的户外锻炼，一般人群适量减少户外运动',\r\n    color: '#FE0000',\r\n    lightColor: '#F3D3D3',\r\n  },\r\n  {\r\n    icon: 'k5',\r\n    label: '重度',\r\n    otherName: '五级',\r\n    value: 5,\r\n    min: 201,\r\n    max: 300,\r\n    proposal: '心脏病和肺病患者症状显著加剧，运动耐受力降低，健康人群普遍出现症状',\r\n    influence: '儿童、老年人及心脏病、肺病患者应停留在室内，停止户外运动，一般人群减少户外运动',\r\n    color: '#99004C',\r\n    lightColor: '#E5D2ED',\r\n  },\r\n  {\r\n    icon: 'k6',\r\n    label: '严重',\r\n    otherName: '六级',\r\n    value: 6,\r\n    min: 301,\r\n    max: '+',\r\n    proposal: '健康人群运动耐受力降低，有明显强烈症状，提前出现某些疾病',\r\n    influence: '儿童、老年人和病人应停留在室内，避免体力消耗，一般人群避免户外活动',\r\n    color: '#7E0022',\r\n    lightColor: '#F3CBD7',\r\n  },\r\n];\r\n\r\n/**\r\n * @description 获取AQI等级\r\n * @params {number} value\r\n */\r\n//  获取AQI等级\r\nconst getLevel = (value) => {\r\n    let index = 0;\r\n    if (!value || value <= 50) index = 0;\r\n    if (value > 50 && value <= 100) index = 1;\r\n    if (value > 100 && value <= 150) index = 2;\r\n    if (value > 150 && value <= 200) index = 3;\r\n    if (value > 200 && value <= 300) index = 4;\r\n    if (value > 300) index = 5;\r\n    return { index, ...AQI_LEVELS[index] };\r\n};\r\n\r\n// 获取渐变颜色范围\r\nconst colorRange = (startColor, endColor) => ({\r\n    type: 'linear',\r\n    x: -0.33,\r\n    y: 0.5,\r\n    colorStops: [\r\n        { offset: 0, color: startColor }, // 0% 处的颜色\r\n        { offset: 0.5, color: startColor },\r\n        { offset: 0.5, color: endColor },\r\n        { offset: 1, color: endColor }, // 100% 处的颜色\r\n    ],\r\n    global: false, // 缺省为 false\r\n});\r\n\r\n// 获取趋势\r\nconst getTrend = (history, forecast) => {\r\n    if (history === null || forecast === null) return '';\r\n    const historyLevel = getLevel(history);\r\n    const forecastLevel = getLevel(forecast);\r\n    if (historyLevel.label === forecastLevel.label) return '正确';\r\n    return history < forecast ? '偏高' : '偏低';\r\n};\r\n\r\n// 获取趋势标记符号\r\nconst getSymbol = (history, forecast) => {\r\n    const trend = getTrend(history, forecast);\r\n    if (trend === '正确') return symbolPass;\r\n    if (trend === '偏高') return symbolUp;\r\n    if (trend === '偏低') return symbolDown;\r\n    return '';\r\n};\r\n\r\n// 获取悬浮提示元素\r\nconst getTooltipRow = (params) => {\r\n    return `\r\n  <div style=\"display: flex; justify-content: space-between; min-width: 80px; padding-top: 3px;\">\r\n    <span style=\"${params.marker ? '' : 'padding-left: 18px'}\">${params.marker || ''}</span>\r\n    <span>${params.seriesName} ${params.value[2] || '-'}</span>\r\n    <span style=\"padding-left: 15px\">${params.value[1] ? '实况监测' : '模式预测'}</span>\r\n  </div>`;\r\n};\r\n\r\n/**\r\n * @description 将接口数据转化为符合 echarts 的数据\r\n * @param {array} history 历史数据\r\n * @param {array} forecast 预测数据\r\n * @param {boolean} diff 是否按AQI等级拆分数据\r\n * @returns echartsData 符合echarts配置数据\r\n */\r\nconst transformData = (history, forecast, isDiff = true) => {\r\n    const xAxisData = [...new Set([...Object.keys(history)])].sort();\r\n    // const xAxisData = [...new Set([...Object.keys(history), ...Object.keys(forecast)])].sort();\r\n    const yAxisData = ['模式预测', '实况监测'];\r\n\r\n    let seriesDatas = [];\r\n    const seriesData = [];\r\n    const markPointData = [];\r\n\r\n    for (let i = 0; i < xAxisData.length; i++) {\r\n        for (let j = 0; j < yAxisData.length; j++) {\r\n            const key = xAxisData[i];\r\n            const historyValue = (history[key] || {}).aqi || null;\r\n            const forecastValue = (forecast[key] || {}).aqi || null;\r\n            seriesData.push([i, j, j ? historyValue : forecastValue]);\r\n            if (j) {\r\n                const symbol = getSymbol(historyValue, forecastValue);\r\n                markPointData.push({\r\n                    show: Boolean(symbol),\r\n                    xAxis: i,\r\n                    yAxis: 1,\r\n                    symbolSize: 20,\r\n                    symbol,\r\n                });\r\n            }\r\n        }\r\n    }\r\n    // 按AQI等级区分数据\r\n    if (isDiff) {\r\n        seriesDatas = AQI_LEVELS.map(({ label, min, max, color }) => {\r\n            const data = seriesData.filter(([, , value]) => {\r\n                if (max === '+') return value >= min;\r\n                return value >= min && value <= max;\r\n            });\r\n            return { name: label, data, color };\r\n        });\r\n    }\r\n\r\n    return { xAxisData, yAxisData, seriesData, seriesDatas, markPointData };\r\n};\r\n\r\n$.getJSON(uploadedDataURL, (data) => {\r\n    const { history, forecast } = data;\r\n    console.log(data);\r\n    const { xAxisData, yAxisData, seriesDatas, markPointData } = transformData(history || {}, forecast || {});\r\n    const myOption = {\r\n        title: {\r\n            text: '空气质量等级准确率评估',\r\n            left: 'center',\r\n        },\r\n        grid: {\r\n            height: 80,\r\n            top: 70,\r\n            left: 58,\r\n            right: 10,\r\n            bottom: 50,\r\n        },\r\n        tooltip: {\r\n            position: 'top',\r\n            trigger: 'axis',\r\n            formatter: (params) => {\r\n                if (params.length !== 2) return '';\r\n                const [paramsOne, paramsTwo] = params;\r\n                const result = [];\r\n                const dateStr = (paramsTwo || {}).axisValue || (paramsOne || {}).axisValue;\r\n                if (dateStr) result.push(dateStr);\r\n                const trendStr = paramsOne.value[1]\r\n                    ? getTrend(paramsOne.value[2], paramsTwo.value[2])\r\n                    : getTrend(paramsTwo.value[2], paramsOne.value[2]);\r\n                if (trendStr) result.push(`&nbsp;&nbsp;&nbsp;&nbsp; ${trendStr}`);\r\n                if (paramsOne.value[1]) {\r\n                    if (paramsOne) result.push(getTooltipRow(paramsOne));\r\n                    if (paramsTwo) result.push(getTooltipRow(paramsTwo));\r\n                } else {\r\n                    if (paramsTwo) result.push(getTooltipRow(paramsTwo));\r\n                    if (paramsOne) result.push(getTooltipRow(paramsOne));\r\n                }\r\n                return result.join('');\r\n            },\r\n        },\r\n        xAxis: {\r\n            type: 'category',\r\n            data: xAxisData,\r\n            splitArea: {\r\n                show: true,\r\n            },\r\n            axisLine: {\r\n                show: false,\r\n            },\r\n            axisTick: {\r\n                show: false,\r\n            },\r\n        },\r\n        yAxis: [\r\n            {\r\n                type: 'category',\r\n                data: yAxisData,\r\n                axisLine: {\r\n                    show: false,\r\n                },\r\n                axisTick: {\r\n                    show: false,\r\n                },\r\n            },\r\n            {\r\n                type: 'value',\r\n            },\r\n        ],\r\n        legend: {\r\n            show: true,\r\n            icon: 'circle',\r\n            bottom: 0,\r\n        },\r\n        visualMap: [\r\n            {\r\n                show: false,\r\n                type: 'piecewise',\r\n                pieces: [\r\n                    ...AQI_LEVELS.map((v) => ({\r\n                        lt: v.max,\r\n                        gte: v.min,\r\n                        color: v.color,\r\n                    })),\r\n                    {\r\n                        value: AQI_LEVELS[0].max,\r\n                        color: colorRange(AQI_LEVELS[0].color, AQI_LEVELS[1].color),\r\n                    },\r\n                    {\r\n                        value: AQI_LEVELS[1].max,\r\n                        color: colorRange(AQI_LEVELS[1].color, AQI_LEVELS[2].color),\r\n                    },\r\n                    {\r\n                        value: AQI_LEVELS[2].max,\r\n                        color: colorRange(AQI_LEVELS[2].color, AQI_LEVELS[3].color),\r\n                    },\r\n                    {\r\n                        value: AQI_LEVELS[3].max,\r\n                        color: colorRange(AQI_LEVELS[3].color, AQI_LEVELS[4].color),\r\n                    },\r\n                ],\r\n            },\r\n        ],\r\n        series: [\r\n            ...seriesDatas.map(({ name, data, color }) => ({\r\n                name,\r\n                data,\r\n                type: 'heatmap',\r\n                label: {\r\n                    show: true,\r\n                },\r\n                itemStyle: {\r\n                    color,\r\n                    borderWidth: 5,\r\n                    borderColor: '#fff',\r\n                },\r\n            })),\r\n            {\r\n                type: 'line',\r\n                color: '#41C15A',\r\n                markPoint: {\r\n                    symbolOffset: [0, -35],\r\n                    data: markPointData,\r\n                },\r\n            },\r\n        ],\r\n    };\r\n    myChart.setOption(myOption);\r\n});\r\n","html":"","externalScripts":"","updaterUID":"obd-ol9ApUNzruRtm2D-0e5Fb-FETwsWF0O","theme":"","layout":"","viewCount":0,"userName":"相***光","commentCount":0,"starCount":7,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xtw892J8V9.png?v=1635406363140","isCustomThumbnail":1,"builtinTags":["category-work","grid","legend","markPoint","series-heatmap","series-line","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"相***光"}}