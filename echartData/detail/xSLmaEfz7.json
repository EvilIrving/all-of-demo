{"status":0,"data":{"cid":"xSLmaEfz7","authorUid":"bd-4111265691","authorUserName":"y***洋","title":"多个环形图堆叠","description":"","latestVersion":2,"alwaysLatest":1,"createTime":"2019-11-15T01:45:01.000Z","lastUpdateTime":"2019-11-15T01:45:01.000Z","auth":2,"uid":"bd-4111265691","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.4.0","versionCreateTime":"2019-11-15T01:48:20.000Z","code":"data = [{\r\n    'name': '省内',\r\n    'value': 2287285\r\n}, {\r\n    'name': '省外',\r\n    'value': 255746\r\n}, {\r\n    'name': '境外',\r\n    'value': 233\r\n}]\r\nlet color = ['#00C7FF', '#3068FF', '#1D38C9']\r\nlet seriesObj = []\r\nlet invisibleStyle = {\r\n    normal: {\r\n        label: {\r\n            show: false\r\n        },\r\n        labelLine: {\r\n            show: false\r\n        },\r\n        color: 'rgba(0, 0, 0, 0)',\r\n        borderColor: 'rgba(0, 0, 0, 0)',\r\n        borderWidth: 0\r\n    }\r\n}\r\nlet showStyle = {\r\n    normal: {\r\n        label: {\r\n            show: false\r\n        },\r\n        labelLine: {\r\n            show: false\r\n        },\r\n        color: 'rgba(0,99,187,0.3)',\r\n        borderColor: 'rgba(0, 0, 0, 0)',\r\n        borderWidth: 0\r\n    }\r\n}\r\nlet styleDatas = []\r\ndata.forEach(item => {\r\n    styleDatas.push({\r\n        value: item.value,\r\n        dataObj: item,\r\n        itemStyle: invisibleStyle\r\n    })\r\n})\r\nif (data) {\r\n    data.forEach((item, index) => {\r\n        let n = index % 3\r\n        let radius = 58 - index * 4\r\n        // 实现数组对象的深拷贝\r\n        let tempData = JSON.parse(JSON.stringify(styleDatas))\r\n        tempData[index].itemStyle = {\r\n            normal: {\r\n                color: color[n]\r\n            }\r\n        }\r\n        seriesObj.push(\r\n            {\r\n                name: '',\r\n                type: 'pie',\r\n                radius: ['35%', radius + '%'],\r\n                hoverAnimation: false,\r\n                z: 0,\r\n                zlevel: 0,\r\n                startAngle: 90,\r\n                minAngle: 10,\r\n                label: {\r\n                    normal: {\r\n                        show: false,\r\n                        position: 'center'\r\n                    },\r\n                    emphasis: {\r\n                        show: false\r\n                    }\r\n                },\r\n                data: tempData\r\n            }\r\n        )\r\n    })\r\n}\r\nlet pieData1 = [\r\n    { value: 41, show: true }, { value: 39, show: false }, { value: 41, show: true }, { value: 39, show: false }\r\n]\r\nlet pieData2 = [\r\n    { value: 2, show: true },\r\n    { value: 60, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 60, show: false },\r\n    { value: 2, show: true },\r\n    { value: 60, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 12, show: false },\r\n    { value: 2, show: true },\r\n    { value: 60, show: false }\r\n]\r\nlet pieData3 = [\r\n    { value: 2, show: true },\r\n    { value: 88, show: false },\r\n    { value: 2, show: true },\r\n    { value: 88, show: false },\r\n    { value: 2, show: true },\r\n    { value: 88, show: false },\r\n    { value: 2, show: true },\r\n    { value: 88, show: false }\r\n]\r\nlet pieData4 = [\r\n    { value: 1, show: true }\r\n]\r\nlet pieData5 = [\r\n    { value: 10, show: true },\r\n    { value: 10, show: false },\r\n    { value: 45, show: true },\r\n    { value: 15, show: false },\r\n    { value: 50, show: true },\r\n    { value: 50, show: false },\r\n    { value: 135, show: true },\r\n    { value: 45, show: false }\r\n]\r\nlet bgPieStyle = function (data, radius, startAngle) {\r\n    let dataArr = data\r\n    dataArr.forEach(item => {\r\n        if (item.show) {\r\n            item.itemStyle = showStyle\r\n        } else {\r\n            item.itemStyle = invisibleStyle\r\n        }\r\n    })\r\n    seriesObj.push({\r\n        type: 'pie',\r\n        radius: radius,\r\n        silent: true,\r\n        startAngle: startAngle,\r\n        hoverAnimation: false,\r\n        labelLine: {\r\n            normal: {\r\n                show: false\r\n            },\r\n            emphasis: {\r\n                show: false\r\n            }\r\n        },\r\n        data: dataArr\r\n    })\r\n}\r\n// 最里面的圈\r\nbgPieStyle(pieData4, ['25%', '28%'], 90)\r\n// 第三圈 有断开的两个弧线\r\nbgPieStyle(pieData1, ['64%', '66%'], -45)\r\n// 第三圈 短竖线 分割线\r\nbgPieStyle(pieData2, ['64%', '70%'], 90)\r\n// 长竖线 分割线\r\nbgPieStyle(pieData3, ['66%', '96%'], 135)\r\n// 第二圈 完整的细的那圈\r\nbgPieStyle(pieData4, ['80%', '82%'], 90)\r\n// 第二圈 有断开的较宽的那圈\r\nbgPieStyle(pieData5, ['75%', '87%'], 60)\r\n// 第一圈 断开的两端弧线\r\nbgPieStyle(pieData1, ['96%', '98%'], 45)\r\nlet maxData = function () {\r\n    let sum = 0\r\n    let max = 0\r\n    let flag = false\r\n    data.forEach(item => {\r\n        sum += item.value\r\n        max = max > item.value ? max : item.value\r\n    })\r\n    data.forEach(item => {\r\n        if (item.value / sum < 0.01) {\r\n            flag = true\r\n        }\r\n    })\r\n    return {\r\n        max: max,\r\n        flag: flag\r\n    }\r\n}\r\nlet percentData = maxData()\r\noption = {\r\n    backgroundColor: \"#09384E\",\r\n    tooltip: {\r\n        trigger: 'item',\r\n        formatter: function (params) {\r\n            if (params.data.dataObj) {\r\n                let data = params.data.dataObj\r\n                if (percentData.flag === true && data.value === percentData.max) {\r\n                    params.percent -= 0.01\r\n                    return `${data.name} : ${params.percent.toFixed(2)}%`\r\n                } else if (params.percent <= 0.01) {\r\n                    return `${data.name} : ≤0.01%`\r\n                } else {\r\n                    return `${data.name} : ${params.percent.toFixed(2)}%`\r\n                }\r\n            }\r\n        }\r\n    },\r\n    series: seriesObj\r\n}","html":"","externalScripts":"","updaterUID":"bd-4111265691","theme":"","layout":"","viewCount":375,"userName":"y***洋","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSLmaEfz7.png?v=1573782500973","isCustomThumbnail":0,"builtinTags":["category-work","series-pie","tooltip"],"customTags":[],"updaterUserName":"y***洋"}}