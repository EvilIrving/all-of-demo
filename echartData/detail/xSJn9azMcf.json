{"status":0,"data":{"cid":"xSJn9azMcf","authorUid":"bd-672241695","authorUserName":"炜迦炜迦","title":"柱状图&极坐标饼图切换","description":"柱状图与极坐标图间无缝切换","latestVersion":2,"alwaysLatest":1,"createTime":"2018-03-23T06:24:20.000Z","lastUpdateTime":"2018-03-23T06:24:20.000Z","auth":1,"uid":"bd-672241695","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.0.4","versionCreateTime":"2018-03-23T06:25:17.000Z","code":"var title = \"年龄分布\";\r\nvar xdata = ['≥0月～﹤1月','≥1月～﹤6岁','≥6岁～﹤14岁','≥14岁～﹤20岁','≥20岁～﹤30岁','≥30岁～﹤40岁','≥40岁～﹤50岁','≥50岁～﹤60岁','≥60岁～﹤70岁','≥70岁以上'];\r\nvar ydata = ['2013','2014','2015','2016'];\r\nvar legenddata = ydata;\r\nvar vdata = [[1,43,88,375,5780,5804,8129,5113,6607,8149],\r\n\t[22,563,955,2398,24126,16625,26580,16060,18148,17869],\r\n\t[33,736,1396,2879,31640,20220,34652,21985,24707,23849],\r\n\t[109,2899,4166,7134,61125,35392,48528,32253,33669,32073]];\r\nvar flag = true; //开关\r\n\r\nvar myChart = echarts.init(document.getElementById('chart-panel'));\r\n\r\n//默认\r\n(function(){\r\n\tdrawFun01();\r\n})();\r\n\r\n\r\n/**画柱图**/\r\nfunction drawFun01(option){\r\n\tvar series = [];\r\n\t\r\n\t//拼柱状图数据\r\n\t$.each(vdata, function(i, v) {\r\n\t    var bs = {\r\n\t        name: ydata[i],\r\n\t        type: 'bar',\r\n\t        data: v,\r\n\t        itemStyle:{normal:{color:''}},\r\n\t        label: {normal: {show: true, position: 'top'}},\r\n\t        barWidth:''\r\n\t    };\r\n\t    series.push(bs);\r\n\t});\r\n\t\t\r\n\t//柱状图配置参数\r\n\toption =  {\r\n\t    title:{\r\n\t    \ttext: title,\r\n\t    \tright:'center'\r\n\t    },\r\n\t    toolbox: {\r\n\t        right: 30,\r\n\t        feature: {\r\n\t            //切换图表类型\r\n\t            myFormula:{\r\n\t                show: true,\r\n\t                title: '图表切换',\r\n\t                icon: 'path://M512 8.448a501.248 501.248 0 1 0 501.248 501.248A503.04 503.04 0 0 0 512 8.448z m0 743.68a38.912 38.912 0 0 1-55.04-55.04 28.672 28.672 0 0 1 22.016-11.008 37.632 37.632 0 0 1 38.656 38.656 25.6 25.6 0 0 1-5.632 27.392z m110.08-314.112a220.416 220.416 0 0 1-60.672 66.048 162.048 162.048 0 0 0-44.032 44.032 103.68 103.68 0 0 0-11.008 44.032v27.648h-55.04v-27.392a198.144 198.144 0 0 1 11.008-60.672 123.648 123.648 0 0 1 55.04-49.664 210.432 210.432 0 0 0 49.664-49.664 93.184 93.184 0 0 0 16.64-55.04 70.656 70.656 0 0 0-22.016-55.04 92.416 92.416 0 0 0-66.048-16.64 174.848 174.848 0 0 0-110.08 44.032v-65.792a230.4 230.4 0 0 1 115.456-33.024 134.656 134.656 0 0 1 99.072 33.024 119.808 119.808 0 0 1 38.656 88.064 146.688 146.688 0 0 1-16.64 66.048z',\r\n\t                onclick: function(){\r\n\t                    changeType();\r\n\t                }\r\n\t            }\r\n\t        }\r\n\t    },\r\n\t    legend: {\r\n\t        data: legenddata,\r\n\t        type:'scroll',\r\n\t        top:'8%'\r\n\t    },\r\n\t    tooltip: {\r\n\t        trigger: 'axis',\r\n\t        axisPointer: {          \r\n\t            type: 'shadow'     \r\n\t        }\r\n\t    },\r\n\t    grid: {\r\n\t        top:'20%',\r\n\t        left: '5%',\r\n\t        right: '4%',\r\n\t        bottom: '12%',\r\n\t        containLabel: true\r\n\t    },\r\n\t    xAxis: [\r\n\t        {\r\n\t            type: 'category',\r\n\t            axisLine:{lineStyle:{color:'#000'}},\r\n\t            data: xdata,\r\n\t            axisLabel: {\r\n\t            \tinterval: 0,\r\n\t            \trotate: 50,\r\n\t            \ttextStyle:{color:'#000'}\r\n\t            }\r\n\t        }\r\n\t    ],\r\n\t    yAxis: [\r\n\t        {\r\n\t            name:'',\r\n\t            type: 'value',\r\n\t            axisLine:{\r\n\t            \tlineStyle:{color:'#000'}\r\n\t            },\r\n\t            axisLabel: {\r\n\t            \ttextStyle:{color:'#000'},\r\n\t                formatter:function(value){\r\n\t                \tif(value>=100000000){\r\n\t                \t\treturn value/100000000+' 亿';\r\n\t                \t} else if(value>=1000000){\r\n\t                \t\treturn value/10000+' 万';\r\n\t                \t} else {\r\n\t                \t\treturn value+'';\r\n\t                \t}\r\n\t                },\r\n\t            }\r\n\t        }\r\n\t    ],\r\n\t    dataZoom: [{\r\n\t        show: true,\r\n\t        height: 30,\r\n\t        bottom: 10,\r\n\t        startValue: xdata[0],\r\n\t        endValue: xdata[9],\r\n\t        handleSize: '100%',\r\n\t    }, {type: 'inside'}],\r\n\t    series: series\r\n\t};\r\n\t\r\n\t//?\r\n\tmyChart.setOption(option);\r\n\twindow.onresize = myChart.resize;\r\n}\r\n\r\n    \r\n/**画饼图**/\r\nfunction drawFun02(){\r\n\tvar nowIndex = 0;\r\n\tvar angleXdata = [];\r\n\tvar pieData = [];\r\n\tvar series = [];\r\n\t\r\n\t//拼x轴极坐标配置\r\n\t$.each(xdata, function(i,v){\r\n\t\tvar angleX = {\r\n\t\t\tvalue: v,\r\n\t\t\ttextStyle:{\r\n\t\t\t\tfontSize: 16,\r\n\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t}\r\n\t\t}\r\n\t\tangleXdata.push(angleX);\r\n\t});\r\n\r\n\t//拼柱状图配置项(极坐标)\r\n\t$.each(vdata, function(i, v) {\r\n\t\tvar bs = {\r\n\t        type: 'bar',\r\n\t        name: ydata[i],\r\n\t        data: v,\r\n\t        coordinateSystem: 'polar',\r\n\t        stack: 'a',\r\n\t        itemStyle: {\r\n\t            normal: {\r\n\t                borderWidth: 4,\r\n\t                borderColor: '#ffffff',\r\n\t            },\r\n\t            emphasis: {\r\n\t                borderWidth: 0,\r\n\t                shadowBlur: 10,\r\n\t                shadowOffsetX: 0,\r\n\t                shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    series.push(bs);\r\n\t});\r\n\r\n\t//拼饼图数据(默认[vdata[x][0]])\r\n\t$.each(vdata, function(i, v) {\r\n\t\tvar pie = {\r\n\t        name: ydata[i],\r\n\t        value: v[0]\r\n\t    };\r\n\t    pieData.push(pie);\r\n\t});\r\n\r\n\t//配置饼图配置项\r\n\tvar last_series = {\r\n        name: '该年龄段年份占比',\r\n        type: 'pie',\r\n        radius: ['85%', '90%'],\r\n        avoidLabelOverlap: false,\r\n        label: {\r\n            normal: {\r\n                show: true,\r\n                position: 'outside',\r\n                formatter: '{b} : {c} ({d}%)'\r\n            },\r\n            emphasis: {\r\n                show: true,\r\n                textStyle: {\r\n                    fontSize: '15',\r\n                    fontWeight: 'normal'\r\n                }\r\n            }\r\n        },\r\n        labelLine: {\r\n            normal: {\r\n                show: false\r\n            }\r\n        },\r\n        data: pieData,\r\n        legend: {\r\n            show: false,\r\n            orient: 'vertical',\r\n            x: 'right',\r\n            y: 'top',\r\n            data: [ydata[0], ydata[1], ydata[2], ydata[3]]\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                borderWidth: 3,\r\n                borderColor: '#ffffff',\r\n            },\r\n            emphasis: {\r\n                borderWidth: 3,\r\n                shadowBlur: 10,\r\n                shadowOffsetX: 0,\r\n                shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n            }\r\n        }\r\n    };\r\n\t\r\n\tseries.push(last_series);\r\n\t\r\n\tvar option = {\r\n\t    title: {\r\n\t        text: title,\r\n\t        //subtext: '点击极坐标系下即可与圆环图交互',\r\n\t        textAlign: 'left'\r\n\t    },\r\n\t    toolbox: {\r\n\t        right: 30,\r\n\t        feature: {\r\n\t            //切换图表类型\r\n\t            myFormula:{\r\n\t                show: true,\r\n\t                title: '图表切换',\r\n\t                icon: 'path://M512 8.448a501.248 501.248 0 1 0 501.248 501.248A503.04 503.04 0 0 0 512 8.448z m0 743.68a38.912 38.912 0 0 1-55.04-55.04 28.672 28.672 0 0 1 22.016-11.008 37.632 37.632 0 0 1 38.656 38.656 25.6 25.6 0 0 1-5.632 27.392z m110.08-314.112a220.416 220.416 0 0 1-60.672 66.048 162.048 162.048 0 0 0-44.032 44.032 103.68 103.68 0 0 0-11.008 44.032v27.648h-55.04v-27.392a198.144 198.144 0 0 1 11.008-60.672 123.648 123.648 0 0 1 55.04-49.664 210.432 210.432 0 0 0 49.664-49.664 93.184 93.184 0 0 0 16.64-55.04 70.656 70.656 0 0 0-22.016-55.04 92.416 92.416 0 0 0-66.048-16.64 174.848 174.848 0 0 0-110.08 44.032v-65.792a230.4 230.4 0 0 1 115.456-33.024 134.656 134.656 0 0 1 99.072 33.024 119.808 119.808 0 0 1 38.656 88.064 146.688 146.688 0 0 1-16.64 66.048z',\r\n\t                onclick: function(){\r\n\t                    changeType();\r\n\t                }\r\n\t            }\r\n\t        }\r\n\t    },\r\n\t    tooltip: {\r\n\t        trigger: 'item',\r\n\t        padding: 10,\r\n\t        backgroundColor: '#222',\r\n\t        borderColor: '#777',\r\n\t        borderWidth: 1,\r\n\t        formatter: tooltipFormatter,\r\n\t    },\r\n\t    angleAxis: {\r\n\t        type: 'category',\r\n\t        data: angleXdata,\r\n\t        z: 10\r\n\t    },\r\n\t    polar: {\r\n\t        center: ['50%', '50%'],\r\n\t        radius: 260,\r\n\t    },\r\n\t    radiusAxis: {},\r\n\t    series: series\r\n\t}\r\n\t\r\n    //\r\n\tfunction tooltipFormatter(params) {\r\n\t\t//console.log(params);\r\n\t    var valuesFormatter = [];\r\n\t    if (params.componentSubType == 'pie') {\r\n\t        valuesFormatter.push(\r\n\t            '<div style=\"border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px\">' +\r\n\t            option.angleAxis.data[nowIndex].value + '<br>' + '</div>' +\r\n\t            '<span style=\"color:' + params.color + '\">' + params.name + '</span>: ' + params.value\r\n\t        );\r\n\t    } else {\r\n\t        valuesFormatter.push(\r\n\t            '<div style=\"border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px\">' +\r\n\t            params.seriesName + \"年\" +\r\n\t            '</div>' +\r\n\t            '<span style=\"color:' + params.color + '\">' + params.name + '</span>: ' + params.value + '<br>');\r\n\t    }\r\n\t\r\n\t    return valuesFormatter;\r\n\t}\r\n    \r\n    myChart.on('click', function(params) {\r\n\t    if (params.componentSubType != 'pie') {\r\n\t        nowIndex = params.dataIndex; //当前年龄段(xdata)对应的数组索引\r\n\t        var lastSeries = series.length-1;\r\n\t        \r\n\t        $.each(vdata, function(i,v) {\r\n\t        \toption.series[lastSeries].data[i].value = v[nowIndex];\r\n\t        \toption.series[lastSeries].data[i].name = ydata[i];\r\n\t        });\r\n\t        \r\n//\t        var ageData = $.extend(true, [], xdata);\r\n//\t        xdata[nowIndex] = {\r\n//\t            value: xdata[nowIndex],\r\n//\t            textStyle: {\r\n//\t                fontSize: 24,\r\n//\t            }\r\n//\t        };\r\n//\t        option.angleAxis.data = ageData;\r\n\t        myChart.setOption(option);\r\n\t    }\r\n\t});\r\n\t\r\n    myChart.setOption(option);\r\n    window.onresize = myChart.resize;\r\n}\r\n\r\n\r\n//公式显示（用于toolbox内部）\r\nfunction changeType() {\r\n\tmyChart.clear();\r\n\tif(flag){\r\n\t\tdrawFun02();\r\n\t}else{\r\n\t\tdrawFun01();\r\n\t}\r\n\tflag = !flag;\r\n}","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"bd-672241695","theme":"","layout":"","viewCount":803,"userName":"炜迦炜迦","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSJn9azMcf.png?v=1521786317519","isCustomThumbnail":0,"builtinTags":["category-work","polar","series-bar","series-pie","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"炜迦炜迦"}}