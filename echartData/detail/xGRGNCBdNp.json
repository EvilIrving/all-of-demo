{"status":0,"data":{"cid":"xGRGNCBdNp","authorUid":"bd-4061446379","authorUserName":"A***9","title":"新冠肺炎全球疫情形势(仿人民日报)","description":"优化算法，自动排列标签文本","latestVersion":32,"alwaysLatest":1,"createTime":"2020-04-01T06:24:34.000Z","lastUpdateTime":"2020-04-01T06:24:34.000Z","auth":1,"uid":"bd-4061446379","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":32,"parentVersion":31,"echartsVersion":"4.8.0","versionCreateTime":"2021-04-12T08:06:09.000Z","code":"/*\r\n1、仿造人民日报海报的南丁格尔玫瑰图；\r\n2、图上文本标签使用算法自动排列及缩放；\r\n3、原作品链接：https://gallery.echartsjs.com/editor.html?c=xV6Jy9tLx-&v=7,可能误操作了被从作品列表转到问题列表,\r\n首页已经无法看到，所以重新发布\r\n\r\n*/\r\n\r\nsourceData = [{\r\n    name: '238例',\r\n    value: 38,\r\n    extData: [238, 'RGB(89,121,146)', 0, '沙特阿拉伯']\r\n}, {\r\n    name: '238例',\r\n    value: 39,\r\n    extData: [238, 'RGB(89,139,146)', 0, '智利']\r\n}, {\r\n    name: '250例',\r\n    value: 40,\r\n    extData: [250, 'RGB(91,166,161)', 0, '冰岛']\r\n}, {\r\n    name: '256例',\r\n    value: 41.3,\r\n    extData: [256, 'RGB(75,172,161)', 0, '巴林']\r\n}, {\r\n    name: '258例',\r\n    value: 42.6,\r\n    extData: [258, 'RGB(67,174,152)', 0, '爱沙尼亚']\r\n}, {\r\n    name: '260例',\r\n    value: 43.9,\r\n    extData: [260, 'RGB(90,186,164)', 0, '罗马尼亚']\r\n}, {\r\n    name: '272例',\r\n    value: 45.2,\r\n    extData: [272, 'RGB(68,159,128)', 0, '泰国']\r\n}, {\r\n    name: '286例',\r\n    value: 46.5,\r\n    extData: [286, 'RGB(74,176,122)', 0, '斯洛文尼亚']\r\n}, {\r\n    name: '287例',\r\n    value: 47.8,\r\n    extData: [287, 'RGB(57,187,91)', 0, '波兰']\r\n}, {\r\n    name: '307例',\r\n    value: 49,\r\n    extData: [307, 'RGB(38,197,79)', 0, '巴基斯坦']\r\n}, {\r\n    name: '313例',\r\n    value: 50,\r\n    extData: [313, 'RGB(54,200,99)', 0, '新加坡']\r\n}, {\r\n    name: '335例',\r\n    value: 52,\r\n    extData: [335, 'RGB(48,197,54)', 0, '卢森堡']\r\n}, {\r\n    name: '359例',\r\n    value: 53,\r\n    extData: [359, 'RGB(29,208,46)', 0, '芬兰']\r\n}, {\r\n    name: '366例',\r\n    value: 54,\r\n    extData: [366, 'RGB(29,225,51)', 0, '爱尔兰']\r\n}, {\r\n    name: '418例',\r\n    value: 55,\r\n    extData: [418, 'RGB(39,227,21)', 0, '希腊']\r\n}, {\r\n    name: '452例',\r\n    value: 56,\r\n    extData: [452, 'RGB(55,233,16)', 0, '卡塔尔']\r\n}, {\r\n    name: '522例',\r\n    value: 57,\r\n    extData: [522, 'RGB(122,241,18)', 0, '捷克']\r\n}, {\r\n    name: '529例',\r\n    value: 58,\r\n    extData: [529, 'RGB(136,219,40)', 0, '以色列']\r\n}, {\r\n    name: '529例',\r\n    value: 59,\r\n    extData: [529, 'RGB(195,222,41)', 0, '巴西']\r\n}, {\r\n    name: '642例',\r\n    value: 60,\r\n    extData: [642, 'RGB(221,210,41)', 0, '葡萄牙']\r\n}, {\r\n    name: '727例',\r\n    value: 62,\r\n    extData: [727, 'RGB(221,184,41)', 0, '加拿大']\r\n}, {\r\n    name: '900例',\r\n    value: 64,\r\n    extData: [900, 'RGB(221,150,39)', 0, '马来西亚']\r\n}, {\r\n    name: '日本',\r\n    value: 66,\r\n    extData: [924, 'RGB(239,161,37)', 0, '']\r\n}, {\r\n    name: '丹麦',\r\n    value: 68,\r\n    extData: [1132, 'RGB(239,153,16)', 0, '']\r\n}, {\r\n    name: '瑞典',\r\n    value: 70,\r\n    extData: [1301, 'RGB(240,131,38)', 0, '']\r\n}, {\r\n    name: '比利时',\r\n    value: 72,\r\n    extData: [1486, 'RGB(243,123,7)', 0, '']\r\n}, {\r\n    name: '挪威',\r\n    value: 74,\r\n    extData: [1562, 'RGB(213,105,48)', 0, '']\r\n}, {\r\n    name: '奥地利',\r\n    value: 76,\r\n    extData: [1646, 'RGB(219,94,30)', 0, '']\r\n}, {\r\n    name: '荷兰',\r\n    value: 80,\r\n    extData: [2051, 'RGB(219,81,32)', 0, '']\r\n}, {\r\n    name: '英国',\r\n    value: 89,\r\n    extData: [2626, 'RGB(234,69,13)', 0, '']\r\n}, {\r\n    name: '瑞士',\r\n    value: 94,\r\n    extData: [3115, 'RGB(216,62,8)', 0, '']\r\n}, {\r\n    name: '韩国',\r\n    value: 97,\r\n    extData: [8565, 'RGB(229,74,18)', 0, '']\r\n}, {\r\n    name: '法国',\r\n    value: 100,\r\n    extData: [9134, 'RGB(232,52,35)', 0, '']\r\n}, {\r\n    name: '美国',\r\n    value: 1999392,\r\n    extData: [9458, 'RGB(218,38,21)', 0, '']\r\n}, {\r\n    name: '德国',\r\n    value: 134,\r\n    extData: [12327, 'RGB(209,17,16)', 12, '']\r\n}, {\r\n    name: '西班牙',\r\n    value: 146,\r\n    extData: [14769, 'RGB(224,10,46)', 92, '']\r\n}, {\r\n    name: '伊朗',\r\n    value: 176,\r\n    extData: [17361, 'RGB(200,13,66)', 107, '']\r\n}, {\r\n    name: '意大利',\r\n    value: 226,\r\n    extData: [36455, 'RGB(175,7,82)', 36, '']\r\n}]\r\n\r\n\r\n\r\n\r\ngraphicData = [{\r\n    type: 'group',\r\n    left: 'center',\r\n    top: '70%',\r\n    bounding: 'raw', //重要，否则内容无法超过组\r\n    z: 100,\r\n    children: []\r\n}]\r\ngraphicScatter = {\r\n    type: 'circle',\r\n    shape: {\r\n        r: 2\r\n    },\r\n    style: {\r\n        fill: 'white'\r\n    },\r\n    z: 100\r\n}\r\ngraphicText = [{\r\n    type: 'text',\r\n    // left: 'center',\r\n    // top: 10,\r\n    z: 100,\r\n    style: {\r\n        fill: 'white',\r\n        text: '韩国',\r\n        font: 'bold 16px Microsoft YaHei',\r\n        textAlign: 'center'\r\n    }\r\n}, {\r\n    type: 'text',\r\n    // left: 'center',\r\n    // top: 40,\r\n    z: 100,\r\n    style: {\r\n        fill: 'white',\r\n        text: '5766例',\r\n        font: 'bold 14px Microsoft YaHei',\r\n        textAlign: 'center',\r\n\r\n    }\r\n}, {\r\n    type: 'text',\r\n    // left: 'center',\r\n    // top: 70,\r\n    z: 100,\r\n    style: {\r\n        fill: 'white',\r\n        text: '死亡36例',\r\n        font: 'bold 12px Microsoft YaHei',\r\n        textAlign: 'center'\r\n    }\r\n}]\r\ngraphic_total_Text = [{\r\n    type: 'text',\r\n    right: -220,\r\n    bottom: 450,\r\n    z: 100,\r\n    style: {\r\n        fill: 'black',\r\n        text: '截至北京时间3月19日18时',\r\n        font: 'bold 12px Microsoft YaHei',\r\n        textAlign: 'right'\r\n    }\r\n}, {\r\n    type: 'text',\r\n    right: -220,\r\n    bottom: 425,\r\n    z: 100,\r\n    style: {\r\n        fill: 'black',\r\n        text: '除中国外超过120个国家',\r\n        font: 'bold 18px Microsoft YaHei',\r\n        textAlign: 'right',\r\n\r\n    }\r\n}, {\r\n    type: 'rect',\r\n    right: -225,\r\n    bottom: 390,\r\n    z: 100,\r\n    shape: {\r\n        width: 140,\r\n        height: 30\r\n    },\r\n    style: {\r\n        fill: 'red'\r\n\r\n    }\r\n}, {\r\n    type: 'text',\r\n    right: -220,\r\n    bottom: 395,\r\n    z: 100,\r\n    style: {\r\n        fill: 'white',\r\n        text: '累计确诊118101例',\r\n        font: 'bold 15px Microsoft YaHei',\r\n        textAlign: 'right',\r\n\r\n    }\r\n}, {\r\n    type: 'rect',\r\n    right: -225,\r\n    bottom: 355,\r\n    z: 100,\r\n    shape: {\r\n        width: 130,\r\n        height: 30\r\n    },\r\n    style: {\r\n        fill: 'red'\r\n\r\n    }\r\n}, {\r\n    type: 'text',\r\n    right: -220,\r\n    bottom: 360,\r\n    z: 100,\r\n    style: {\r\n        fill: 'white',\r\n        text: '累计死亡5715例',\r\n        font: 'bold 15px Microsoft YaHei',\r\n        textAlign: 'right'\r\n    }\r\n}]\r\ngraphicChildren = {\r\n    type: 'group',\r\n    // left: 'center',\r\n    // top: 'center',\r\n    position: [],\r\n    bounding: 'raw',\r\n    z: 100,\r\n    children: []\r\n\r\n}\r\n\r\nfunction convertData1() {\r\n    var maxScale = 1\r\n    var minScale = 0.1\r\n    var stepRadius = 2 * Math.PI / sourceData.length\r\n    var stepScale = (maxScale - minScale) / sourceData.length\r\n    for (var i = 0; i < sourceData.length; i++) {\r\n        sourceData[i].itemStyle = {\r\n            color: sourceData[i][\"extData\"][1],\r\n            borderWidth: 0\r\n        }\r\n        sourceData[i].label = {\r\n            show: i > 6 ? false : false,\r\n            position: i <= 5 ? \"outer\" : \"inside\",\r\n            align: \"right\",\r\n            borderWidth: 1,\r\n            borderColor: \"red\",\r\n            alignTo: \"edge\",\r\n            margin: 650,\r\n            formatter: (a) => {\r\n                return a.data.extData[3]\r\n            }\r\n        }\r\n        sourceData[i].labelLine = {\r\n            show: i > 6 ? false : false,\r\n            lineStyle: {\r\n                type: \"dashed\"\r\n            }\r\n        }\r\n        var curRadius = (i + 0.5) * stepRadius\r\n        // var curArclen = 1\r\n        var curScale = i > 21 ? minScale + stepScale * (i) : 0.6 + stepScale * (i)\r\n        var startR = i > 21 ? sourceData[i][\"value\"] * 450 / sourceData.slice(-1)[0][\"value\"] * 0.95 : ((\r\n            sourceData[i][\"value\"] * 460 / sourceData.slice(-1)[0][\"value\"] + 20))\r\n        var curR = [startR, startR * (i > 33 ? 0.95 : (i > 21 ? 0.75 : 1.12)), startR * (i > 33 ? 0.95 : (i >\r\n            21 ? 0.8 : 1.17)) * (i > 33 ? 0.95 :\r\n            (i > 21 ? 0.8 : 1.17))]\r\n        var curPositions = []\r\n        var curChilds = []\r\n        var curCircles = []\r\n        for (var j = 0; j < 3; j++) {\r\n            var curX = Math.sin(curRadius) * curR[j]\r\n            var curY = -Math.cos(curRadius) * curR[j]\r\n            curPositions.push([curX, curY])\r\n            var curChild = JSON.stringify(graphicChildren)\r\n            curChild = JSON.parse(curChild)\r\n            curChild.position = [curX, curY]\r\n            curChild.rotation = i > 33 ? -((i + 0.5) / sourceData.length * 2 * Math.PI) : (i <= 21 ? -((i +\r\n                0.5) / sourceData.length * 2 * Math.PI) + Math.PI / 2 : 0)\r\n            curChild.scale = [curScale, curScale]\r\n            curgraphicText = JSON.parse(JSON.stringify(graphicText[j]))\r\n            curgraphicText.style.text = j == 0 ? sourceData[i][\"name\"] : (j == 1 ? (i > 21 ? sourceData[i][\r\n                \"extData\"\r\n            ][0] + \"例\" : \"\") : (j == 2 && i > 33 ? (sourceData[i][\r\n                \"extData\"\r\n            ][2] + \"例\") : (i <= 21 ? sourceData[i][\r\n                \"extData\"\r\n            ][3] : \"\")))\r\n            if (i <= 21) {\r\n                curgraphicText.style.fill = \"black\"\r\n                curgraphicText.style.textAlign = \"left\"\r\n            }\r\n            curChild.children = [curgraphicText]\r\n            curChilds.push(curChild)\r\n            graphicData[0].children.push(curChild)\r\n        }\r\n        console.log(i, sourceData[i][\"name\"], curRadius, curR, curPositions)\r\n    }\r\n    for (var m = 0; m < 3 * 2; m++) {\r\n        var cur_total_text = graphic_total_Text[m]\r\n        graphicData[0].children.push(cur_total_text)\r\n    }\r\n    return sourceData\r\n}\r\n\r\n\r\n\r\noption = {\r\n    title: {\r\n        text: '全球新冠',\r\n        subtext: '优化算法，自动排列标签文本',\r\n        left: '',\r\n        textStyle: {\r\n            color: \"red\",\r\n            fontSize: 40\r\n        },\r\n        backgroundColor: \"rgb(254,248,239)\",\r\n        top: \"3%\"\r\n    },\r\n    tooltip: {\r\n        show: false\r\n    },\r\n    toolbox: {\r\n        show: true,\r\n        feature: {\r\n            mark: {\r\n                show: true\r\n            },\r\n            dataView: {\r\n                show: true,\r\n                readOnly: false\r\n            },\r\n            magicType: {\r\n                show: true,\r\n                type: ['pie', 'funnel']\r\n            },\r\n            restore: {\r\n                show: true\r\n            },\r\n            saveAsImage: {\r\n                show: true\r\n            }\r\n        }\r\n    },\r\n    graphic: graphicData,\r\n    series: [{\r\n            name: '面积模式',\r\n            type: 'pie',\r\n            radius: [20, 450],\r\n            center: ['50%', '70%'],\r\n            label: {\r\n                show: true\r\n            },\r\n            roseType: 'area',\r\n            data: convertData1(),\r\n            rich: {\r\n                a: {\r\n                    color: 'white',\r\n                    lineHeight: 10\r\n                },\r\n                b: {\r\n                    backgroundColor: {\r\n                        image: 'xxx/xxx.jpg'\r\n                    },\r\n                    height: 40\r\n                },\r\n                x: {\r\n                    fontSize: 18,\r\n                    fontFamily: 'Microsoft YaHei',\r\n                    borderColor: '#449933',\r\n                    borderRadius: 4\r\n                }\r\n            }\r\n        },\r\n        {\r\n            name: 'alpha1',\r\n            type: 'pie',\r\n            radius: [20, 40],\r\n            center: ['50%', '70%'],\r\n            itemStyle: {\r\n                normal: {\r\n                    color: 'rgba(255, 255, 255, 0.2)'\r\n                }\r\n            },\r\n            data: [{\r\n                value: 10,\r\n                name: ''\r\n            }]\r\n        },\r\n        {\r\n            name: 'alpha2',\r\n            type: 'pie',\r\n            radius: [20, 60],\r\n            center: ['50%', '70%'],\r\n            itemStyle: {\r\n                color: 'rgba(255, 255, 255, 0.2)',\r\n            },\r\n            data: [{\r\n                value: 10,\r\n                name: ''\r\n            }]\r\n        }\r\n    ]\r\n};","html":"","externalScripts":"","updaterUID":"obd-o2XgCc3qsUu2yu4U1si0f53Bk5BrsBG","theme":"","layout":"","viewCount":16700,"userName":"A***9","commentCount":3,"starCount":40,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xGRGNCBdNp.png?v=1585722274454","isCustomThumbnail":1,"builtinTags":["category-work","graphic","series-pie","title","toolbox","tooltip"],"customTags":["南丁格尔玫瑰图","新冠肺炎"],"updaterUserName":"d***8"}}