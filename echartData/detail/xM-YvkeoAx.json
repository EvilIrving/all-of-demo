{"status":0,"data":{"cid":"xM-YvkeoAx","authorUid":"obd-o04OyAoxmecDijHeT33aLmCrP_kcFFr","authorUserName":"l***1","title":"可鼠标拖动旋转的饼图","description":"通过鼠标拖拽 来旋转饼图\n在某些情况下 标签可能出现不满足需求的情况\n需要调整startAngle \n现在可以在鼠标移动事件中 记录前后两点 \n通过构建向量的方式 来计算出旋转的角度和反向","latestVersion":2,"alwaysLatest":0,"createTime":"2021-04-30T01:47:37.000Z","lastUpdateTime":"2021-04-30T01:47:37.000Z","auth":2,"uid":"obd-o04OyAoxmecDijHeT33aLmCrP_kcFFr","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"5.1.1","versionCreateTime":"2021-04-30T01:55:02.000Z","code":"option = {\n    series: [\n        {\n            type: 'pie',\n            data: [\n                { value: 1048, name: '搜索引擎' },\n                { value: 735, name: '直接访问' },\n                { value: 580, name: '邮件营销' },\n                { value: 484, name: '联盟广告' },\n                { value: 300, name: '视频广告' }\n            ]\n        }\n    ]\n};\n\nlet statu = false\nlet last = []\nlet shape = {}\nlet waits = true\n\nfunction mousedown(value) {\n    // 获取饼图属性 圆心位置\n    shape = value.event.target.shape\n    statu = true\n}\n\nfunction mouseup(value) {\n    statu = false\n    last = []\n}\nfunction getDirection(xy0, xy1) {\n    // 通过叉乘计算旋转方向\n    let xy = xy0[0] * xy1[1] - xy1[0] * xy0[1]\n    if (xy > 0) {\n        return -1\n    }\n    if (xy < 0) {\n        return 1\n    }\n    return 0\n}\n\nfunction mousemove(value) {\n    if (statu && waits) {\n        waits = false\n        let event = value.event\n        if (last.length === 0) {\n            // 以圆心作为新建坐标系的原点\n            last = [event.offsetX - shape.cx, event.offsetY - shape.cy]\n        } else {\n            let xy0 = last\n            let xy1 = [event.offsetX - shape.cx, event.offsetY - shape.cy]\n            // 通过向量 计算出前后两点移动相对于圆心转动的夹角度数\n            let angle =\n                getDirection(xy0, xy1) *\n                    (180 / Math.PI) *\n                    Math.acos(\n                        Math.min(1.0, (xy1[1] * xy0[1] + xy1[0] * xy0[0]) /\n                            (Math.sqrt(xy1[0] * xy1[0] + xy1[1] * xy1[1]) *\n                                Math.sqrt(xy0[0] * xy0[0] + xy0[1] * xy0[1])))\n                    ) +\n                myChart.getOption().series[0].startAngle\n            console.log(\"mousemove -> angle\", angle)\n            myChart.setOption({\n                series: {\n                    startAngle: angle\n                }\n            })\n            last = xy1\n        }\n        waits = true\n    }\n}\n\nmyChart.on('mouseup', mouseup)\nmyChart.on('mouseout', mouseup)\nmyChart.on('mousedown', mousedown)\nmyChart.on('mousemove', mousemove)","html":"","externalScripts":"","updaterUID":"obd-o04OyAoxmecDijHeT33aLmCrP_kcFFr","theme":"","layout":"","viewCount":0,"userName":"l***1","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xM-YvkeoAx.png?v=1619747702566","isCustomThumbnail":0,"builtinTags":["category-work","series-pie"],"customTags":["旋转饼图"],"updaterUserName":"l***1"}}