{"status":0,"data":{"cid":"xD-5AS-fWH","authorUid":"obd-oFbwwcc7SlYVyKNBU9Y2XjhwaP1BV5o","authorUserName":"相***q","title":"双层圆环图","description":"","latestVersion":4,"alwaysLatest":0,"createTime":"2021-05-07T12:44:35.000Z","lastUpdateTime":"2021-05-07T12:44:35.000Z","auth":2,"uid":"obd-oFbwwcc7SlYVyKNBU9Y2XjhwaP1BV5o","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"5.1.1","versionCreateTime":"2021-05-08T10:12:42.000Z","code":"\n/*\n * echart 不支持配置块之间的间隔，所以需要额外插入数据来生成间隔。\n * 外环的间隔要比内环大一些，想要达到这样的效果，需要每个块的数据减去一个固定的数值\n*/\n\n/*\n * 确认问题：\n * 1. hover选中时，内环颜色、外环颜色、字体颜色如何设置\n * 2. 外环的背景色是否都一样\n * 3. label 固定显示在外环的中间。如果要调整 label 离块的距离，需要调整外环的大小 \n*/\nconst sourceData = [\n    {\n        name: '小学',\n        value: 129\n    },\n    {\n        name: '中学',\n        value: 224\n    },\n    {\n        name: '高中',\n        value: 384\n    },\n    {\n        name: '大专',\n        value: 420\n    },\n    {\n        name: '本科',\n        value: 558\n    },\n    {\n        name: '研究生',\n        value: 238\n    }\n]\n\nconst total = sourceData.reduce((num, item) => {\n    num += item.value\n    return num\n}, 0)\n\n// 内环间隔距离\nconst inSplitWidth = 3\n// 为了实现内环间隔距离，需要额外插入的数值。200 只是个系数，值越大，单位间隔的距离越小。\nconst inSplitValue = Math.floor(total / (200 / inSplitWidth))\n\n// 外环间隔比内环间隔大的值\nconst itemSplitWidth = 2\n// 外环间隔距离\nconst outSplitWidth = inSplitWidth + itemSplitWidth\n// 为了实现外环间隔距离，需要额外插入的数值。\nconst outSplitValue = Math.floor(total / (200 / outSplitWidth))\n\n// 内环数据的总数\nconst valueTotal = total + inSplitValue * sourceData.length\n\nfunction getTextAngle(currentAngle, angle) {\n    currentAngle = currentAngle + angle\n    console.log('currentAngle', currentAngle)\n    if (currentAngle <= 90) {\n        return -currentAngle;\n    } else if (currentAngle <= 180 && currentAngle > 90) {\n        return 180 - currentAngle;\n    } else if (currentAngle < 270 && currentAngle > 180) {\n        return 180 - currentAngle;\n    } else if (currentAngle < 360 && currentAngle >= 270) {\n        return 360 - currentAngle;\n    }\n}\n\n// 内环数据。在原数据的后面添加间隔数据（间隔块设置颜色透明）\nconst valueData = sourceData.reduce((arr, item) => {\n    const currentTotal = arr.reduce((total, item) => {\n        total += item.value\n        return total\n    }, 0)\n    \n    const currentAngle = 360 * (currentTotal / valueTotal)\n    const angle = 360 * (item.value / valueTotal) / 2\n    console.log('current  angle', currentAngle)\n    arr.push({\n        name: item.name,\n        value: item.value,\n        itemStyle: {\n            \n        },\n        label: {\n            lineHeight: 80,\n            rotate: getTextAngle(currentAngle, angle)\n        }\n    }, {\n        name: '',\n        value: inSplitValue,\n        itemStyle: {\n            color: 'transparent',\n            opacity: 0\n        },\n        label: {\n            show: false\n        },\n        labelLine: {\n            show: false\n        }\n    })\n    return arr\n}, [])\n\n\n// 原数据需要减去的值（外环每块的数据都要比原数据少一点才能达到外环嵌在内环的效果）\nconst itemReduced = outSplitValue - inSplitValue\n// 外环数据\nconst outValueData = sourceData.reduce((arr, item, index) => {\n    const currentTotal = arr.reduce((total, item) => {\n        total += item.value\n        return total\n    }, 0)\n    \n    const currentAngle = 360 * (currentTotal / valueTotal)\n    const angle = 360 * (item.value / valueTotal) / 2\n    \n    arr.push({\n        name: item.name,\n        value: item.value - itemReduced,\n        itemStyle: {\n            // color: 'rgba(160, 60, 60, 0.3)'\n        },\n        label: {\n            color: 'rgb(160, 60, 60)',\n            position: 'inside',\n            align: 'center',\n            // lineHeight: 20,\n            // verticalAlign: 'top',\n            rotate: getTextAngle(currentAngle, angle)\n        }\n    }, {\n        name: '',\n        value: outSplitValue,\n        itemStyle: {\n            color: 'transparent',\n            opacity: 0\n        },\n        label: {\n            show: false\n        },\n        labelLine: {\n            show: false\n        }\n    })\n    \n    return arr\n}, [])\n\noption = {\n    title: {\n        text: 'Awesome Chart'\n    },\n    series: [\n        {\n        type: 'pie',\n        data: valueData,\n        // startAngle: 0,\n        label: {\n            show: false,\n            position: 'outside',\n            align: 'center',\n            verticalAlign: 'middle',\n            // rotate: true,\n            formatter(params) {\n                // console.log('label params', params)\n                return params.data.name\n            }\n        },\n        labelLine: {\n            show: false\n        },\n        emphasis: {\n            scale: true,\n            scaleSize: 20\n        },\n        blur: {\n            itemStyle: {\n                opacity: 1\n            }  \n        },\n        // labelLayout(params) {\n        //     return {\n        //         x: params.rect.x,\n        //         y: params.rect.y + params.rect.height / 2\n        //     }  \n        // },\n        radius: ['60%', '80%'],\n        itemStyle: {\n            // borderWidth: 5,\n            // borderColor: '#000',\n            // borderRadius: [10, 20],\n            // opacity: 0.5,\n            // borderCap: 'square',\n            // borderJoin: 'round'\n        }\n    },\n    {\n        type: 'pie',\n        startAngle: -360 * (itemReduced / 2 / valueTotal) + 90,\n        radius: ['79%', '95%'],\n        itemStyle: {\n            // color: 'rgba(160, 60, 60, 0.5)',\n            opacity: 0.3,\n            // borderWidth: 15,\n            // borderColor: 'rgba(0, 0, 0, 0)'\n        },\n        label: {\n            show: true,\n            formatter(params) {\n                return '{a|'+ params.data.name +'}'\n            },\n            rich: {\n                a: {\n                    lineHeight: 50,\n                    color: 'red'\n                }\n            }\n        },\n        labelLine: {\n            show: false,\n            length: 10,\n        },\n        data: outValueData\n    }\n    ]\n};\n","html":"","externalScripts":"","updaterUID":"obd-oFbwwcc7SlYVyKNBU9Y2XjhwaP1BV5o","theme":"","layout":"","viewCount":0,"userName":"相***q","commentCount":0,"starCount":23,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xD-5AS-fWH.png?v=1620468762989","isCustomThumbnail":0,"builtinTags":["category-work","series-pie","title"],"customTags":[],"updaterUserName":"相***q"}}