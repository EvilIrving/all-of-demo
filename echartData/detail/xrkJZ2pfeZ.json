{"status":0,"data":{"cid":"xrkJZ2pfeZ","authorUid":"bd-2621770984","authorUserName":"神***枪","title":"俄罗斯方块","description":"小游戏 俄罗斯方块","latestVersion":6,"alwaysLatest":1,"createTime":"2017-05-12T05:45:26.000Z","lastUpdateTime":"2019-11-18T01:13:07.000Z","auth":2,"uid":"bd-2621770984","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":6,"parentVersion":5,"echartsVersion":"3.5.4","versionCreateTime":"2017-05-12T08:51:41.000Z","code":"app.title = '俄罗斯方块';\nvar refreshT,fallBlockT;\nvar fallTimout;\nvar speed = 1000, downSpeed = 30, nomrlSpeed = 1000;\nvar fallLine = 20, rlMove = 4,score = 0,death=false;\n\nvar data = [] ,data2 = [];\n\nArray.prototype.clone=function(){ var a=[]; for(var i=0,l=this.length;i<l;i++){ if(this[i] instanceof Array){ a.push(this[i].clone()); }else{ a.push(this[i]); }} return a; }\n\nvar block1={\n    basePt :  [[0,0],[0,1],[1,0],[1,1]],\n    roate: function(){\n        \n    }\n};\nvar block2={\n    basePt :  [[0,0],[1,0],[2,0],[2,1]],\n    shapList:[\n        [[0,0],[1,0],[2,0],[2,1]],\n        [[0,0],[0,1],[0,2],[1,0]],\n         [[0,0],[0,1],[1,1],[2,1]],\n          [[0,2],[1,0],[1,1],[1,2]]\n        ],\n    shapIndex : 0,\n    roate: function(){\n        this.shapIndex ++;\n        this.basePt = this.shapList[this.shapIndex%this.shapList.length].clone();\n    }\n};\nvar block3={\n    basePt :  [[0,1],[1,0],[1,1],[2,0]],\n    shapList:[\n       [[0,1],[1,0],[1,1],[2,0]],\n        [[0,0],[0,1],[1,1],[1,2]],\n         [[0,1],[1,0],[1,1],[2,0]],\n          [[0,0],[0,1],[1,1],[1,2]]\n        ],\n    shapIndex : 0,\n    roate: function(){\n        this.shapIndex ++;\n        this.basePt = this.shapList[this.shapIndex%this.shapList.length].clone();\n    }\n};\nvar block4={\n    basePt :  [[0,0],[1,0],[1,1],[2,1]],\n    shapList:[\n        [[0,0],[1,0],[1,1],[2,1]],\n        [[0,1],[0,2],[1,0],[1,1]]\n        ],\n    shapIndex : 0,\n    roate: function(){\n        this.shapIndex ++;\n        this.basePt = this.shapList[this.shapIndex%this.shapList.length].clone();\n    }\n};\nvar block5={\n    basePt :  [[0,0],[0,1],[1,0],[2,0]],\n    shapList:[\n        [[0,0],[0,1],[1,0],[2,0]],\n        [[0,0],[0,1],[0,2],[1,2]],\n         [[0,1],[1,1],[2,1],[2,0]],\n          [[0,0],[1,0],[1,1],[1,2]]\n        ],\n    shapIndex : 0,\n    roate: function(){\n        this.shapIndex ++;\n        this.basePt = this.shapList[this.shapIndex%this.shapList.length].clone();\n    }\n};\nvar block6={\n    basePt :  [[0,0],[1,0],[1,1],[2,0]],\n    shapList:[\n       [[0,0],[1,0],[1,1],[2,0]],\n        [[0,0],[0,1],[0,2],[1,1]],\n         [[1,0],[0,1],[1,1],[2,1]],\n          [[0,1],[1,0],[1,1],[1,2]]\n        ],\n    shapIndex : 0,\n    roate: function(){\n        this.shapIndex ++;\n        this.basePt = this.shapList[this.shapIndex%this.shapList.length].clone();\n    }\n};\nvar block7={\n    basePt :  [[-1,0],[0,0],[1,0],[2,0]],\n    shapList:[\n       [[-1,0],[0,0],[1,0],[2,0]],\n       [[0,0],[0,1],[0,2],[0,3]]\n        ],\n    shapIndex : 0,\n    roate: function(){\n        this.shapIndex ++;\n        this.basePt = this.shapList[this.shapIndex%this.shapList.length].clone();\n    }\n};\n\nvar blocks = [block1,block2,block3,block4,block5,block6,block7];\n\nvar randomBlock = function(){\n  var rnm=  parseInt(Math.random()*100)%7;\n  var blk = blocks[rnm];\n  var ck = Math.random()*6;\n  for (var i = 0; i < ck; i++) {\n      blk.roate();\n  }\n  return blk;\n};\nvar firstBlock = randomBlock();\n// 全部方块\nfor (var j = 0; j < 20; j++) {\n    for (var i = 0; i < 10; i++) {\n        data.push([i,j,0]);\n    }\n}\n\noption = {\n    backgroundColor:  '#aaa',\n    title: [{\n        text: '俄罗斯方块'\n    },{\n        text: \"    当前得分：0\",\n        left:550,\n        top: '30%'\n    },\n    {\n        text: \"   ←、→ 左右移动\\r\\n\\r\\n↓ 加速下落，↑ 变形\",\n        left:550,\n        top: '60%'\n    }],\n    grid:{\n        show:true,\n        borderColor :'#000',\n        z:2,\n        top:50,\n        left:200,\n        height:520,\n        width:260\n    },\n    legend: {\n       show:false\n    },\n    xAxis: {\n         interval :2,\n        splitLine: {\n            lineStyle: {\n                type: 'dashed'\n            }\n        },\n        max:10,\n        axisTick :{\n            show:false\n        },\n        axisLabel :{\n            show:false\n        } ,\n        axisLine :{\n            show:false\n        }\n    },\n    yAxis: {\n        interval :2,\n        splitLine: {\n            lineStyle: {\n                type: 'dashed'\n            }\n        },\n        max:20,\n        axisTick :{\n            show:false\n        },\n        axisLabel :{\n            show:false\n        } ,\n        axisLine :{\n            show:false\n        }\n       \n    },\n    series: [{\n        data: data,\n        type: 'scatter',\n        symbol :'rect',\n        symbolSize: function(v){\n            return v[2]*26;\n        },\n        symbolOffset :[13,-13],\n        label: {\n            emphasis: {\n                show: false\n            }\n        },\n        itemStyle: {\n            normal: {\n                shadowBlur: 10,\n                shadowColor: 'rgba(120, 36, 50, 0.5)',\n                shadowOffsetY: 5,\n                color: new echarts.graphic.RadialGradient(0.4, 0.3, 1, [{\n                    offset: 0,\n                    color: 'rgb(251, 118, 123)'\n                }, {\n                    offset: 1,\n                    color: 'rgb(204, 46, 72)'\n                }])\n            }\n        }\n    },{\n        data: data2,\n        type: 'scatter',\n        symbol :'rect',\n        symbolSize: function(v){\n            return v[2]*26;\n        },\n        symbolOffset :[13,-13],\n        label: {\n            emphasis: {\n                show: false\n            }\n        },\n        itemStyle: {\n            normal: {\n                shadowBlur: 10,\n                shadowColor: 'rgba(25, 100, 150, 0.5)',\n                shadowOffsetY: 5,\n               color: new echarts.graphic.RadialGradient(0.4, 0.3, 1, [{\n                    offset: 0,\n                    color: 'rgb(151, 218, 23)'\n                }, {\n                    offset: 1,\n                    color: 'rgb(104, 100, 5)'\n                }])\n            }\n        }\n    }]\n};\nvar touchDistortionOther = function(){\n    var old_Pts = firstBlock.basePt.clone();\n    firstBlock.roate();\n    var isTouch = touchFallOther();\n    firstBlock.basePt = old_Pts;\n    firstBlock.shapIndex--;\n    \n    return isTouch;\n}\n\nvar touchFallOther = function(){\n   var pts = firstBlock.basePt.clone();\n   \n     for (var i = 0; i < pts.length; i++) {\n       var da_i = pts[i][0]+rlMove;\n       var da_j =  pts[i][1]+fallLine;\n       if(da_i<0 || da_i >=10){\n           return true;\n       }\n       if( option.series[0].data[da_j*10+da_i] && option.series[0].data[da_j*10+da_i][2] === 1){\n           return true;\n       }\n   }\n   return false;\n}\nvar touchLeftRightOther = function(lrOffset){\n    var pts = firstBlock.basePt.clone();\n    var preLR_move = rlMove + lrOffset;\n    \n     for (var i = 0; i < pts.length; i++) {\n       var da_i = pts[i][0] + preLR_move;\n       var da_j =  pts[i][1] + fallLine;\n       if(da_i<0 || da_i >=10){\n           return true;\n       }\n       if( option.series[0].data[da_j*10+da_i] && option.series[0].data[da_j*10+da_i][2] === 1){\n           return true;\n       }\n   }\n   return false;\n}\nvar setScore = function(){\n    for (var j = 0; j < 20; j++) {\n        var rowBlok=0;\n        for (var i = 0; i < 10; i++) {\n           rowBlok+= option.series[0].data[j*10+i][2]\n        }\n        //消除一行\n        if(rowBlok == 10){\n            for (var k = j+1; k < 20; k++) {\n                for (var m = 0; m < 10; m++) {\n                    option.series[0].data[(k-1)*10+m][2] = option.series[0].data[k*10+m][2];\n                }\n            }\n            score++;\n           option.title[1].text = '    当前得分：'+score;\n           j--;\n        }\n    }\n};\nvar  checkDeath = function(){\n    for (var i = 0; i < 10; i++) {\n         if( option.series[0].data[19*10+i][2] === 1){\n             death = true;\n              option.title[1].text = '游戏结束\\r\\n\\r\\n    本次得分：'+score;\n         }\n    }\n};\nrefreshT = function () {\n   var pts = firstBlock.basePt.clone();\n   \n   if(fallLine < 0 || touchFallOther()){\n      for ( i = 0; i < pts.length; i++) {\n          var da_i = pts[i][0]+rlMove;\n          var da_j =  pts[i][1]+fallLine+1;\n          if(option.series[0].data[da_j*10+da_i]){\n            option.series[0].data[da_j*10+da_i][2] = 1;\n          }\n      }\n      myChart.setOption(option);\n      //计算得分\n      setScore();\n      checkDeath();\n       option.series[1].data=[];\n       firstBlock = randomBlock();\n       rlMove = 4;\n       fallLine = 20;\n       speed = nomrlSpeed;\n   }else{\n       for (var i = 0; i < pts.length; i++) {\n           //横轴移动4\n           pts[i][0]+=rlMove;\n           pts[i][1]+=fallLine;\n           pts[i][2]=1;\n        }\n        option.series[1].data = pts;\n   }\n   //停止下落，\n//   option.series[1].data = pts;\n//   option.series[0].data = data;\n   myChart.setOption(option);\n    \n};\n\nfallBlockT = function () {\n    if(death) return;\n  fallLine--;\n  refreshT();\n fallTimout = setTimeout( fallBlockT, speed);\n};\nfallBlockT();\ndocument.onkeydown = function (event) { \n\tif (event && event.keyCode === 37 ) {\n        if(!touchLeftRightOther(-1)){\n            rlMove--;\n            refreshT();\n        }\n\t}\n\tif (event && event.keyCode === 40 ) {\n          speed = downSpeed;\n          clearTimeout(fallTimout);\n          fallBlockT();\n\t}\n\tif (event && event.keyCode === 39 ) {\n          if(!touchLeftRightOther(1)){\n            rlMove++;\n            refreshT();\n        }\n\t}\n\t//变形\n\tif (event && event.keyCode === 38 ) {\n          if(!touchDistortionOther()){\n           firstBlock.roate();\n           refreshT();\n        }\n\t}\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","html":"","externalScripts":"","updaterUID":"bd-2621770984","theme":"default","layout":"","viewCount":35853,"userName":"神***枪","commentCount":36,"starCount":173,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrkJZ2pfeZ.png?v=1574039587534","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-scatter","title"],"customTags":[],"updaterUserName":"神***枪"}}