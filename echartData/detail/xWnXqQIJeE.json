{"status":0,"data":{"cid":"xWnXqQIJeE","authorUid":"bd-127895190","authorUserName":"C***N","title":"echarts地图实现状态信息的切换","description":"存在个问题，再切换legend时使用3X版本会隐藏掉当前状态的线，但是使用现有4X版本会全部隐藏，求大神解答","latestVersion":1,"alwaysLatest":1,"createTime":"2019-04-29T09:36:06.000Z","lastUpdateTime":"2019-04-29T09:36:06.000Z","auth":2,"uid":"bd-127895190","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2019-04-29T09:36:06.000Z","code":"// 问题？？？？？？？？\r\n// 使用3x版本点击底部的legend状态会把当前状态的线条隐藏了\r\n// 但是使用4x版本就不行  会全部隐藏\r\n// 请教下各位， 如何用4X版本还是实现隐藏当前点以及状态线功能\r\n\r\n\r\nvar geoList = [\r\n        { name:'石嘴山', longitude: 106.333447, latitude: 38.981052, value: 1, status: \"到报\" },\r\n        { name:'银川',longitude: 106.204666, latitude:38.491113, value: 1, status: \"缺报\" },\r\n        { name:'吴忠',longitude: 106.241461, latitude:38.070551, value: 1, status: \"到报\" },\r\n        { name:'中卫',longitude: 105.229609, latitude:37.501102, value: 1, status: \"缺报\" },\r\n        { name:'固原',longitude: 106.223063, latitude:36.05075, value: 1, status: \"故障\" }\r\n    ]    \r\n    var series = [];\r\n    \r\n    var convertData = function (data, status) {\r\n        var res = [];\r\n        for (var i = 0; i < data.length; i++) {\r\n            var dataItem = data[i];\r\n            var fromCoord = [106.223063,37.427776];\r\n            var toCoord = [dataItem.longitude, dataItem.latitude];\r\n            if (dataItem.status === status){\r\n                if (fromCoord && toCoord) {\r\n                    res.push({\r\n                        toName: dataItem.name,\r\n                        coords: [fromCoord, toCoord]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        return res;\r\n    };\r\n    var convertDataStatus = function (data, status) {\r\n        var res = [];\r\n        for (var i = 0; i < data.length; i++) {\r\n            var dataItem = data[i];\r\n            var toCoord = [dataItem.longitude, dataItem.latitude];\r\n            if (dataItem.status === status){\r\n                if (toCoord) {\r\n                    res.push({\r\n                        name: dataItem.name,\r\n                        value: toCoord.concat(dataItem.value)\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        return res;\r\n    };\r\n    var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';\r\n\r\n    [['银川', geoList]].forEach(function (item, i) {\r\n        series.push({\r\n            name: \"到报拖尾\",\r\n            type: 'lines',\r\n            zlevel: 1,\r\n            silent: true,\r\n            effect: {\r\n                show: true,\r\n                period: 6,\r\n                trailLength: 0.7,\r\n                color: '#0f0',\r\n                symbolSize: 3\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    color: \"#fff\",\r\n                    width: 0,\r\n                    curveness: 0.2\r\n                }\r\n            },\r\n            data: convertData(item[1], \"到报\")\r\n        }, {\r\n            name: \"到报线\",\r\n            type: 'lines',\r\n            silent: true,\r\n            zlevel: 2,\r\n            effect: {\r\n                show: true,\r\n                period: 6,\r\n                trailLength: 0,\r\n                symbol: \"arrow\",\r\n                symbolSize: 10\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    color: \"#0f0\",\r\n                    width: 2,\r\n                    opacity: 0.5,\r\n                    curveness: 0.2\r\n                }\r\n            },\r\n            data: convertData(item[1], \"到报\")\r\n        }, {\r\n            name: \"缺报线\",\r\n            type: 'lines',\r\n            zlevel: 2,\r\n            silent: true,\r\n            effect: {\r\n                show: true,\r\n                period: 6,\r\n                trailLength: 0,\r\n                symbol: \"triangle\",\r\n                symbolSize: 10\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    color: \"#ff0\",\r\n                    width: 2,\r\n                    opacity: 0.5,\r\n                    curveness: 0.2\r\n                }\r\n            },\r\n            data: convertData(item[1], \"缺报\")\r\n        }, {\r\n            name: \"中心点\",\r\n            type: \"effectScatter\",\r\n            coordinateSystem: \"geo\",\r\n            zlevel: 3,\r\n            rippleEffect: {\r\n                brushType: \"stroke\"\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: \"right\",\r\n                    formatter: \"{b}\",\r\n                    textStyle: {\r\n                        fontSize: 15,\r\n                        fontWeight: \"bolder\"\r\n                    }\r\n                }\r\n            },\r\n            symbolSize: 20,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: \"#fff\"\r\n                }\r\n            },\r\n            data: [{\r\n                name: \"数据中心\",\r\n                value: [106.223063,37.427776, \"数据中心\"]\r\n            }]\r\n        }, {\r\n            name: \"到报\",\r\n            type: 'effectScatter',\r\n            coordinateSystem: 'geo',\r\n            zlevel: 3,\r\n            rippleEffect: {\r\n                brushType: 'stroke'\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'right',\r\n                    formatter: '{b}'\r\n                }\r\n            },\r\n            symbolSize: 10,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: \"#0f0\"\r\n                }\r\n            },\r\n            data: convertDataStatus(item[1], \"到报\")\r\n        }, {\r\n            name: \"缺报\",\r\n            type: 'effectScatter',\r\n            coordinateSystem: 'geo',\r\n            zlevel: 3,\r\n            rippleEffect: {\r\n                brushType: 'stroke'\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'right',\r\n                    formatter: '{b}'\r\n                }\r\n            },\r\n            symbolSize: 10,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: \"#ff0\"\r\n                }\r\n            },\r\n            data: convertDataStatus(item[1], \"缺报\")\r\n        }, {\r\n            name: \"故障\",\r\n            type: 'effectScatter',\r\n            coordinateSystem: 'geo',\r\n            zlevel: 3,\r\n            rippleEffect: {\r\n                brushType: 'stroke'\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'right',\r\n                    formatter: '{b}'\r\n                }\r\n            },\r\n            symbolSize: 10,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: \"#f00\"\r\n                }\r\n            },\r\n            data: convertDataStatus(item[1], \"故障\")\r\n        })\r\n    })\r\n    option = {\r\n        backgroundColor: \"#20263f\",\r\n        tooltip : {\r\n            trigger: 'item',\r\n            formatter: function(params){\r\n                if (params.componentSubType === \"effectScatter\") {\r\n                    var html = \"台站名称: \" + params.name + \"<br/>\";\r\n                    html += params.marker + \"经度: \" +  params.value[0] + \"<br/>\";\r\n                    html += params.marker + \"纬度: \" +  params.value[1] + \"<br/>\";\r\n                    html += params.marker + \"所属值: \" +  params.value[2] + \"<br/>\";\r\n                    return html;\r\n                }\r\n            }\r\n        },\r\n        legend: {\r\n            orient: 'vertical',\r\n            top: 'bottom',\r\n            left: 'right',\r\n            data:['到报', '缺报', '故障'],\r\n            textStyle: {\r\n                color: '#fff'\r\n            },\r\n            // selectedMode: 'single'\r\n        },\r\n        geo: {\r\n            map: '宁夏',\r\n            zoom: 1.1,\r\n            label: {\r\n                show: false,\r\n                textStyle: {\r\n                    color: '#fff', //地图初始化区域字体颜色\r\n                    fontSize: 16,\r\n                    opacity: 1,\r\n                    backgroundColor: 'rgba(53,171,199,0)'\r\n                },\r\n                emphasis: {\r\n                    show: false,\r\n                    textStyle: {\r\n                        color: '#fff', //地图初始化区域字体颜色\r\n                        fontSize: 16,\r\n                        opacity: 1,\r\n                        backgroundColor: 'rgba(53,171,199,0)'\r\n                    }\r\n                }\r\n            },\r\n            roam: true,\r\n            itemStyle: {\r\n                normal: {\r\n                    areaColor: '#2158c9',\r\n                    borderWidth: 2,\r\n                    borderColor: '#03a2fe',\r\n                    shadowOffsetX: -10,\r\n                    shadowColor: '#2158c9',\r\n                    shadowBlur: 1\r\n                },\r\n                emphasis: {\r\n                    areaColor: '#2464ae'\r\n                }\r\n            }\r\n        },\r\n        series: series\r\n        // geo3D: {\r\n        //     map: '宁夏',\r\n        //     itemStyle: {\r\n        //         areaColor: 'rgb(30,88,181)',\r\n        //         opacity: 1,\r\n        //         borderWidth: 2,\r\n        //         borderColor: 'rgb(5,163,255)'\r\n        //     },\r\n        //     label: {\r\n        //         show: true,\r\n        //         textStyle: {\r\n        //             color: '#fff', //地图初始化区域字体颜色\r\n        //             fontSize: 16,\r\n        //             opacity: 1,\r\n        //             backgroundColor: 'rgba(53,171,199,0)'\r\n        //         },\r\n        //     },\r\n        //     emphasis: { //当鼠标放上去  地区区域是否显示名称\r\n        //         label: {\r\n        //             show: true,\r\n        //             textStyle: {\r\n        //                 color: '#fff',\r\n        //                 fontSize: 16,\r\n        //                 backgroundColor: 'rgba(0,23,11,0)'\r\n        //             }\r\n        //         }\r\n        //     },\r\n        //     viewControl: {\r\n        //         autoRotate : false,\r\n        //         distance : 150,\r\n        //         alpha  : 60,\r\n        //     },\r\n        // }\r\n    };\r\n    myChart.setOption(option);\r\n    myChart.on(\"legendselectchanged\", function(params) {\r\n        var isSelected = params.selected[params.name];\r\n        if (params.name === \"到报\" && !isSelected) {\r\n            myChart.setOption({\r\n                legend: {\r\n                    selected: {\r\n                        \"到报拖尾\": false,\r\n                        \"到报线\": false\r\n                    }\r\n                }\r\n            })\r\n        } \r\n        else {\r\n            if (params.name === \"到报\" && isSelected) {\r\n                myChart.setOption({\r\n                    legend: {\r\n                        selected: {\r\n                            \"到报拖尾\": true,\r\n                            \"到报线\": true\r\n                        }\r\n                    }\r\n                })\r\n            } \r\n            else {\r\n                if (params.name === \"缺报\" && !isSelected) {\r\n                    myChart.setOption({\r\n                        legend: {\r\n                            selected: {\r\n                                \"缺报线\": false\r\n                            }\r\n                        }\r\n                    })\r\n                } \r\n                else {\r\n                    if (params.name === \"缺报\" && isSelected) {\r\n                        myChart.setOption({\r\n                            legend: {\r\n                                selected: {\r\n                                    \"缺报线\": true\r\n                                }\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });","html":"","externalScripts":"https://gallerybox.echartsjs.com/dep/echarts/map/js/province/ningxia.js","updaterUID":"bd-127895190","theme":"","layout":"","viewCount":3405,"userName":"C***N","commentCount":1,"starCount":11,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xWnXqQIJeE.png?v=1556530566898","isCustomThumbnail":0,"builtinTags":["category-work","geo","legend","series-effectScatter","series-lines","tooltip"],"customTags":[],"updaterUserName":"C***N"}}