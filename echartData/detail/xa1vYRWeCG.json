{"status":0,"data":{"cid":"xa1vYRWeCG","authorUid":"bd-2552142171","authorUserName":"镜***白","title":"3d饼图","description":"现在还没有做label，有做了label的后面我会上传github","latestVersion":5,"alwaysLatest":1,"createTime":"2020-07-16T05:04:53.000Z","lastUpdateTime":"2021-08-10T03:55:13.000Z","auth":2,"uid":"bd-2552142171","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"4.9.0","versionCreateTime":"2021-08-10T03:55:13.000Z","code":"\n// 扩展组件地址https://github.com/StillAlexLiu/echarts-pie-3d\nconst MyShape = echarts.graphic.extendShape({\n    shape: {\n        cx: 0,\n        cy: 0,\n        r: 0,\n        startAngle: 0,\n        endAngle: Math.PI * 2,\n        clockwise: true,\n        step: 0\n    },\n    style: {\n        stroke: '#000',\n        fill: null\n    },\n    buildPath: function(ctx, shape) {\n        const x = shape.cx\n        const y = shape.cy\n        const r = Math.max(shape.r, 0)\n        const startAngle = shape.startAngle\n        const endAngle = shape.endAngle\n        const clockwise = shape.clockwise\n        const unitX = Math.cos(startAngle)\n        const unitY = Math.sin(startAngle)\n        const unitXE = Math.cos(endAngle)\n        const unitYE = Math.sin(endAngle)\n        ctx.moveTo(unitX * r + x, unitY * r + y)\n        ctx.arc(x, y, r, startAngle, endAngle, !clockwise)\n        ctx.lineTo(unitXE * r + x, unitYE * r + y + shape.step)\n        ctx.arc(x, y + shape.step, r, endAngle, startAngle, clockwise)\n        ctx.lineTo(unitX * r + x, unitY * r + y)\n    }\n})\necharts.graphic.registerShape('myCustomShape', MyShape)\n\nconst PI2 = Math.PI * 2\nconst data1 = [{\n        value: 335,\n        name: '直接访问'\n    },\n    {\n        value: 310,\n        name: '邮件营销'\n    },\n    {\n        value: 234,\n        name: '联盟广告'\n    },\n    {\n        value: 135,\n        name: '视频广告'\n    },\n    {\n        value: 1548,\n        name: '搜索引擎'\n    }\n]\nconst valueList = []\nfor (let i = 0; i < data1.length; i++) {\n    valueList.push(data1[i].value)\n}\nconst viewData = []\nlet validDataCount = 0\nconst colorList = ['#f00', '#0f0', '#00f', '#ff0', '#0ff']\nfor (let i = 0; i < data1.length; i++) {\n    const item = data1[i]\n    const percent = echarts.number.getPercentWithPrecision(valueList, i, 1)\n    validDataCount += percent\n    viewData.push({\n        name: item.name,\n        value: item.value,\n        percent: percent,\n        validDataCount: validDataCount,\n        __pieColor: colorList[i % colorList.length]\n    })\n}\n\noption = {\n    series: [{\n        data: data1,\n        type: 'custom',\n        coordinateSystem: 'none',\n        renderItem: (params, api) => {\n            // 使用echarts自己等lib计算出百分比\n            const index = params.dataIndex\n            const data = viewData[index]\n            const start = PI2 * (data.validDataCount - data.percent) / 100\n            const end = PI2 * data.validDataCount / 100\n            const center = [api.getWidth() / 2, api.getHeight() / 2]\n            const scale = [1, 0.6]\n            const origin = center\n            return {\n                type: 'group',\n                children: [{\n                        type: 'sector',\n                        scale: scale,\n                        origin: origin,\n                        silent: true,\n                        z2: 0,\n                        shape: {\n                            cx: center[0],\n                            cy: center[1] + 20,\n                            r0: 0,\n                            r: 130,\n                            startAngle: start,\n                            endAngle: end\n                        },\n                        style: api.style({\n                            fill: data.__pieColor\n                        })\n                    },\n\n                    {\n                        type: 'sector',\n                        scale: scale,\n                        origin: origin,\n                        silent: true,\n                        z2: 2,\n                        shape: {\n                            cx: center[0],\n                            cy: center[1] - 20,\n                            r0: 0,\n                            r: 130,\n                            startAngle: start,\n                            endAngle: end\n                        },\n                        style: api.style({\n                            fill: data.__pieColor\n                        })\n                    },\n                    {\n                        type: 'myCustomShape',\n                        scale: scale,\n                        origin: origin,\n                        silent: true,\n                        z2: 1,\n                        shape: {\n                            cx: center[0],\n                            cy: center[1] - 20,\n                            step: 40,\n                            r0: 0,\n                            r: 130,\n                            startAngle: start,\n                            endAngle: end\n                        },\n                        style: api.style({\n                            fill: data.__pieColor,\n                            stroke: data.__pieColor,\n                            lineWidth: 0\n                        })\n                    }\n                ]\n            }\n        }\n    }]\n\n}\n// 3d插件在https://github.com/StillAlexLiu/echarts-pie-3d","html":"","externalScripts":"","updaterUID":"bd-2552142171","theme":"","layout":"","viewCount":464,"userName":"镜***白","commentCount":2,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xa1vYRWeCG.png?v=1628567713281","isCustomThumbnail":0,"builtinTags":["category-work","series-custom"],"customTags":[],"updaterUserName":"镜***白"}}