{"status":0,"data":{"cid":"x3h6E59PKB","authorUid":"bd-142485545","authorUserName":"梦***殇","title":"饼图","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-12-17T02:27:16.000Z","lastUpdateTime":"2021-12-17T02:27:16.000Z","auth":2,"uid":"bd-142485545","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.2","versionCreateTime":"2021-12-17T02:27:16.000Z","code":"const series = [ {name: 'One', value: 81}, {name: 'Two', value: 46}, {name: 'Three', value: 59} ]\r\nconst centerX = '50%'\r\nconst angle = 0\r\n\r\nlet total = series\r\n    .map(item => item.value)\r\n    .reduce((prev, next) => {\r\n        return prev + next\r\n    }, 0)\r\n\r\nlet maxLen = 0\r\nlet oldAllRate = 0\r\nseries.map((o, index) => {\r\n    if (index === series.length - 1) {\r\n        o.rate = oldAllRate === 0 && o.value === 0 ? 0 : (100 - oldAllRate).toFixed(1)\r\n    } else {\r\n        o.rate = total > 0 ? ((o.value / total) * 100).toFixed(1) : 0\r\n        oldAllRate += Number(o.rate)\r\n    }\r\n    maxLen = o.name.length > maxLen ? o.name.length : maxLen\r\n})\r\n\r\nfunction getCirlPoint(x0, y0, r, angle) {\r\n    //获取圆上面某点的坐标(x0,y0表示坐标，r半径，angle角度)\r\n    let x1 = x0 + r * Math.cos((angle * Math.PI) / 180)\r\n    let y1 = y0 + r * Math.sin((angle * Math.PI) / 180)\r\n    return {\r\n        x: x1,\r\n        y: y1\r\n    }\r\n}\r\n\r\nfunction _pie1() {\r\n    let data = []\r\n    total = 0\r\n    series.forEach(o => {\r\n        total += o.value\r\n    })\r\n    series.forEach(o => {\r\n        data.push(o, {\r\n            value: total / 90,\r\n            itemStyle: {\r\n                normal: {\r\n                    label: {\r\n                        show: false\r\n                    },\r\n                    labelLine: {\r\n                        show: false\r\n                    },\r\n                    color: 'rgba(0, 0, 0, 0)',\r\n                    borderColor: 'rgba(0, 0, 0, 0)',\r\n                    borderWidth: 0\r\n                }\r\n            }\r\n        })\r\n    })\r\n    return data\r\n}\r\nfunction _pie2() {\r\n    let dataArr = []\r\n    for (var i = 0; i < 4; i++) {\r\n        if (i % 2 === 0) {\r\n            dataArr.push({\r\n                name: (i + 1).toString(),\r\n                value: 20,\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: '#1a4050',\r\n                        borderWidth: 0,\r\n                        borderColor: 'rgba(0,0,0,0)'\r\n                    }\r\n                }\r\n            })\r\n        } else {\r\n            dataArr.push({\r\n                name: (i + 1).toString(),\r\n                value: 20,\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: 'rgba(0,0,0,0)',\r\n                        borderWidth: 0,\r\n                        borderColor: 'rgba(0,0,0,0)'\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n    return dataArr\r\n}\r\n\r\noption = {\r\n    backgroundColor: '#0E1327',\r\n    fontSize: 16,\r\n    tooltip: {\r\n        trigger: 'item',\r\n        textStyle: {\r\n            color: '#fff'\r\n        },\r\n        backgroundColor: 'rgba(16, 32, 40, 0.88)',\r\n        borderRadius: 4,\r\n        borderColor: '#20749e',\r\n        formatter: params => {\r\n            return params.name ? params.marker + params.name + ': ' + params.value : ''\r\n        }\r\n    },\r\n    legend: {\r\n        type: 'scroll',\r\n        orient: 'vertical',\r\n        right: '0%',\r\n        width: '50%', // 影响了所有，讨论后再看怎么加\r\n        itemGap: 20,\r\n        itemWidth: 14,\r\n        itemHeight: 14,\r\n        top: 'middle',\r\n        textStyle: {\r\n            color: '#fff',\r\n            rich: {\r\n                a: {\r\n                    fontSize: 12,\r\n                    width: maxLen > 3 ? 80 : 60\r\n                },\r\n                b: {\r\n                    fontSize: 10,\r\n                    width: 65\r\n                },\r\n                c: {\r\n                    fontSize: 10,\r\n                    width: 45\r\n                }\r\n            }\r\n        },\r\n        // 使用回调函数\r\n        // formatter: function(name) {\r\n        //               var data = options.series[0].data\r\n        //               //   var total = 0\r\n        //               var tarValue\r\n        //               var tarRate\r\n        //               for (var i = 0, l = data.length; i < l; i++) {\r\n        //                   //   if (data[i].value && data[i].name) {\r\n        //                   //       total += data[i].value\r\n        //                   //   }\r\n        //                   if (data[i].name == name) {\r\n        //                       tarValue = data[i].value\r\n        //                       tarRate = data[i].rate\r\n        //                   }\r\n        //               }\r\n        //               //   var p = total > 0 ? ((tarValue / total) * 100).toFixed(1) : 0\r\n        //               const word =\r\n        //                   name.length > 6 ? name.substr(0, Math.ceil(name.length / 2)) + '\\n' + name.substr(Math.ceil(name.length / 2)) : name\r\n        //               //   return '{a|' + word + '}{b|' + tarValue + data[0].unit + '}{c|' + p + '%' + '}'\r\n        //               return '{a|' + word + '}{b|' + tarValue + data[0].unit + '}{c|' + tarRate + '%' + '}'\r\n        //               // 影响了所有，讨论后再看怎么加\r\n        //               //   return name + '   ' + tarValue + data[0].unit + '  ' + '   ' + p + '%'\r\n        //               //   return name + ' ' + p + '%'\r\n        //           },\r\n        data: series\r\n    },\r\n    series: [\r\n        {\r\n            name: '',\r\n            type: 'pie',\r\n            color: ['#9fe8ff', '#cbd4ff', '#fff7c0', '#9fffff', '#62ffdf'],\r\n            center: [centerX, '50%'],\r\n            radius: ['60%', '70%'],\r\n            avoidLabelOverlap: false,\r\n            zlevel: 5,\r\n            label: {\r\n                show: false\r\n            },\r\n            hoverAnimation: false,\r\n            emphasis: {\r\n                show: false\r\n            },\r\n            labelLine: {\r\n                show: false\r\n            },\r\n            // itemStyle: {\r\n            //     borderWidth: 5, // 间距的宽度\r\n            //     borderColor: 'rgba(0, 0, 0, 0)' //背景色\r\n            // },\r\n            data: _pie1()\r\n        },\r\n        {\r\n            radius: ['60%', '63%'],\r\n            center: [centerX, '50%'],\r\n            type: 'pie',\r\n            zlevel: 6,\r\n            label: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: false\r\n                }\r\n            },\r\n            labelLine: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: false\r\n                }\r\n            },\r\n            hoverAnimation: false,\r\n            animation: false,\r\n            tooltip: {\r\n                show: false\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    color: 'rgba(0,0,0,0.8)'\r\n                }\r\n            },\r\n            data: _pie1()\r\n        },\r\n        {\r\n            radius: ['67%', '70%'],\r\n            center: [centerX, '50%'],\r\n            type: 'pie',\r\n            zlevel: 6,\r\n            label: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: false\r\n                }\r\n            },\r\n            labelLine: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: false\r\n                }\r\n            },\r\n            hoverAnimation: false,\r\n            animation: false,\r\n            tooltip: {\r\n                show: false\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    color: 'rgba(0,0,0,0.8)'\r\n                }\r\n            },\r\n            data: _pie1()\r\n        },\r\n        {\r\n            type: 'pie',\r\n            zlevel: 2,\r\n            silent: true,\r\n            center: [centerX, '50%'],\r\n            radius: ['70%', '74%'],\r\n            startAngle: 45,\r\n            label: {\r\n                normal: {\r\n                    show: false\r\n                }\r\n            },\r\n            labelLine: {\r\n                normal: {\r\n                    show: false\r\n                }\r\n            },\r\n            data: _pie2()\r\n        },\r\n        {\r\n            name: 'ring5',\r\n            type: 'custom',\r\n            coordinateSystem: 'none',\r\n            renderItem: (params, api) => {\r\n                return {\r\n                    type: 'arc',\r\n                    shape: {\r\n                        // cx: api.getWidth() / 2,\r\n                        cx: centerX,\r\n                        cy: api.getHeight() / 2,\r\n                        r: (Math.min(api.getWidth(), api.getHeight()) / 2) * 0.45,\r\n                        startAngle: ((0 + angle) * Math.PI) / 180,\r\n                        endAngle: ((360 + angle) * Math.PI) / 180\r\n                    },\r\n                    style: {\r\n                        stroke: {\r\n                            type: 'linear',\r\n                            x: 1,\r\n                            y: 0.5,\r\n                            x2: 0,\r\n                            y2: 1,\r\n                            colorStops: [\r\n                                {\r\n                                    offset: 0,\r\n                                    color: 'transparent' // 0% 处的颜色\r\n                                },\r\n                                {\r\n                                    offset: 0.6,\r\n                                    color: '#00eaff' // 100% 处的颜色\r\n                                }\r\n                            ]\r\n                        },\r\n                        fill: 'transparent',\r\n                        lineWidth: 1\r\n                    },\r\n                    // style: api.style(),\r\n                    silent: true\r\n                }\r\n            },\r\n            data: [0]\r\n        },\r\n        {\r\n            name: 'ring5',\r\n            type: 'custom',\r\n            coordinateSystem: 'none',\r\n            renderItem: (params, api) => {\r\n                // let x0 = api.getWidth() / 2\r\n                let x0 = centerX\r\n                let y0 = api.getHeight() / 2\r\n                let r = (Math.min(api.getWidth(), api.getHeight()) / 2) * 0.45\r\n                let point = getCirlPoint(x0, y0, r, -95 + angle)\r\n                return {\r\n                    type: 'circle',\r\n                    shape: {\r\n                        cx: point.x,\r\n                        cy: point.y,\r\n                        r: 2.5\r\n                    },\r\n                    style: {\r\n                        stroke: '#00eaff', //绿\r\n                        fill: '#00eaff'\r\n                    },\r\n                    silent: true\r\n                }\r\n            },\r\n            data: [0]\r\n        }\r\n    ]\r\n}\r\n","html":"","externalScripts":"","updaterUID":"bd-142485545","theme":"","layout":"","viewCount":0,"userName":"梦***殇","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x3h6E59PKB.png?v=1639708037071","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-custom","series-pie","tooltip"],"customTags":[],"updaterUserName":"梦***殇"}}