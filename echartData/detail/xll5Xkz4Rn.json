{"status":0,"data":{"cid":"xll5Xkz4Rn","authorUid":"obd-o2Uq48DS8VVe30Eo4Mzq2csfOGk3560","authorUserName":"叫***e","title":"","description":"1.设置临界值 ：\n   当中心数大于临界值时，所有的关系都展 \n    开；小于临界值时不展开关系图\n2.点击实现展开或收缩关系图\n3.点击实现变大或缩小","latestVersion":2,"alwaysLatest":0,"createTime":"2021-12-20T09:30:32.000Z","lastUpdateTime":"2021-12-27T07:31:24.000Z","auth":2,"uid":"obd-o2Uq48DS8VVe30Eo4Mzq2csfOGk3560","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"5.2.2","versionCreateTime":"2021-12-27T07:31:24.000Z","code":" //临界值  当中心数大于临界值时，所有的关系都展开  小于临界值时不展开关系图\r\n var criticalValue = 2;\r\n \r\n //中心数\r\nconst defaultCategory = [\"李志强\",'赵冬','高鼎'];\r\n\r\n var graph = {\r\n        \"nodes\": [{\r\n            \"name\": \"李志强\",\r\n            \"category\": \"确诊\",\r\n            \"symbolSize\": 30,\r\n            value:['确诊'],\r\n            color:\"#F10F0F\"\r\n\r\n\r\n        },\r\n            {\r\n                \"name\": \"张亮\",\r\n                \"category\": \"密接\",\r\n                \"symbolSize\": 30,\r\n                value:['密接'],\r\n                color: '#FFC001'\r\n\r\n            },\r\n            {\r\n                \"name\": \"王飞\",\r\n                \"category\": \"王飞\",\r\n                \"symbolSize\": 30,\r\n                value: ['次密接'],\r\n                color: '#1D84C6'\r\n\r\n            },\r\n\r\n            {\r\n                \"name\": \"王丽\",\r\n                \"category\": \"王丽\",\r\n                \"symbolSize\": 30,\r\n                value: ['密接'],\r\n                color: '#FFC001'\r\n            },\r\n            {\r\n                \"name\": \"符华\",\r\n                \"category\": \"符华\",\r\n                \"symbolSize\": 30,\r\n                value: ['次密接'],\r\n                color: '#1D84C6'\r\n            },\r\n            {\r\n                \"name\": \"钱峰\",\r\n                \"category\": \"钱峰\",\r\n                \"symbolSize\": 30,\r\n                value: ['次密接'],\r\n                color: '#1D84C6'\r\n            },\r\n\r\n\r\n            {\r\n                \"name\": \"赵冬\",\r\n                \"category\": \"赵冬\",\r\n                \"symbolSize\": 30,\r\n                value: ['确诊'],\r\n                color:\"#F10F0F\"\r\n            },\r\n            {\r\n                \"name\": \"吴梦\",\r\n                \"category\": \"吴梦\",\r\n                \"symbolSize\": 30,\r\n                color: '#1D84C6',\r\n                value: ['次密接']\r\n            },\r\n            {\r\n                \"name\": \"杨月\",\r\n                \"category\": \"杨月\",\r\n                \"symbolSize\": 30,\r\n                color: '#1D84C6',\r\n                value: ['次密接']\r\n            },\r\n            {\r\n                \"name\": \"周清\",\r\n                \"category\": \"周清\",\r\n                \"symbolSize\": 30,\r\n                color: '#1D84C6',\r\n                value: ['次密接']\r\n            },\r\n            {\r\n                \"name\": \"张枫\",\r\n                \"category\": \"张枫\",\r\n                \"symbolSize\": 30,\r\n                color: '#FFC001',\r\n            value: ['密接']\r\n\r\n            },\r\n            {\r\n                \"name\": \"化辰\",\r\n                \"category\": \"化辰\",\r\n                \"symbolSize\": 30,\r\n                color: '#FFC001',\r\n                value: ['密接']\r\n            },\r\n            {\r\n                \"name\": \"彭帅\",\r\n                \"category\": \"彭帅\",\r\n                \"symbolSize\": 30,\r\n                color: '#FFC001',\r\n                value: ['密接']\r\n            },\r\n            {\r\n                \"name\": \"高鼎\",\r\n                \"category\": \"课程\",\r\n                \"symbolSize\": 30,\r\n\r\n                color:\"#F10F0F\"\r\n            },\r\n            {\r\n                \"name\": \"章艺\",\r\n                \"category\": \"章艺\",\r\n                \"symbolSize\": 30,\r\n                color: '#1D84C6',\r\n                value: ['次密接']\r\n            },\r\n            {\r\n                \"name\": \"连亮\",\r\n                \"category\": \"连亮\",\r\n                \"symbolSize\": 30,\r\n                color: '#1D84C6',\r\n                value: ['次密接']\r\n            },\r\n            {\r\n                \"name\": \"化月\",\r\n                \"category\": \"化月\",\r\n                \"symbolSize\": 30,\r\n                color: '#FFC001',\r\n                value: ['密接']\r\n            },\r\n            {\r\n                \"name\": \"马可\",\r\n                \"category\": \"马可\",\r\n                \"symbolSize\": 30,\r\n                color: '#FFC001',\r\n                value: ['密接']\r\n            }\r\n\r\n\r\n        ],\r\n        \"links\": [{\r\n            \"source\": \"李志强\",\r\n            \"target\": \"张亮\",\r\n             'reason':\"聚餐\"\r\n        },\r\n            {\r\n                \"source\": \"张亮\",\r\n                \"target\": \"王飞\",\r\n                'reason':\"出现在同一场所\"\r\n            },\r\n            {\r\n                \"source\": \"李志强\",\r\n                \"target\": \"王丽\",\r\n                'reason':\"出现在同一场所\"\r\n            },\r\n            {\r\n                \"source\": \"王丽\",\r\n                \"target\": \"钱峰\",\r\n                'reason':\"聚餐\"\r\n            },\r\n            {\r\n                \"source\": \"王丽\",\r\n                \"target\": \"符华\",\r\n                'reason':\"家庭聚集\"\r\n            },\r\n\r\n            {\r\n                \"source\": \"赵冬\",\r\n                \"target\": \"张枫\",\r\n                'reason':\"家庭聚集\"\r\n            },\r\n            {\r\n                \"source\": \"张枫\",\r\n                \"target\": \"吴梦\",\r\n                 'reason':\"出现在同一场所\"\r\n\r\n            },\r\n            {\r\n                \"source\": \"张枫\",\r\n                \"target\": \"杨月\",\r\n                'reason':'聚会'\r\n            },\r\n            {\r\n                \"source\": \"彭帅\",\r\n                \"target\": \"周清\",\r\n                'reason':'聚会'\r\n            },\r\n            {\r\n                \"source\": \"赵冬\",\r\n                \"target\": \"化辰\",\r\n                'reason':\"出现在同一场所\"\r\n            },\r\n            {\r\n                \"source\": \"赵冬\",\r\n                \"target\": \"彭帅\",\r\n                'reason':\"出现在同一场所\"\r\n            },\r\n\r\n            {\r\n                \"source\": \"高鼎\",\r\n                \"target\": \"化月\",\r\n                'reason':\"出现在同一场所\"\r\n            },\r\n            {\r\n                \"source\": \"高鼎\",\r\n                \"target\": \"马可\",\r\n                'reason':'聚会'\r\n            },\r\n            {\r\n                \"source\": \"马可\",\r\n                \"target\": \"章艺\",\r\n                'reason':\"出现在同一场所\"\r\n            },\r\n            {\r\n                \"source\": \"马可\",\r\n                \"target\": \"连亮\",\r\n                'reason':\"出现在同一场所\"\r\n            }\r\n        ]\r\n    };\r\n\r\n    const currentGraph = {\r\n        nodes: {},\r\n        links: {},\r\n    };\r\n    if(defaultCategory.length < criticalValue){\r\n        currentGraph.links = graph.links\r\n    }\r\n    const nodeMap = {};\r\n// 页面加载时，第一次初始化图\r\n    function init() {\r\n        // 根据定义的常量，产生currentGraph的默认数据\r\n        // 遍历全部nodes和links，产生node映射map\r\n        for (let i = 0; i < graph.nodes.length; i++) {\r\n           if(defaultCategory.length > criticalValue){\r\n               for(let m = 0;m<defaultCategory.length;m++){\r\n                   if (graph.nodes[i].name === defaultCategory[m]) {\r\n                       currentGraph.nodes[graph.nodes[i].name] = graph.nodes[i];\r\n                   }\r\n                   nodeMap[graph.nodes[i].name] = graph.nodes[i];\r\n                   nodeMap[graph.nodes[i].name]['links'] = {};\r\n                   nodeMap[graph.nodes[i].name]['nodes'] = {};\r\n                   nodeMap[graph.nodes[i].name]['hasAppend'] = false;\r\n               }\r\n           }else{\r\n               currentGraph.nodes[graph.nodes[i].name] = graph.nodes[i];\r\n               nodeMap[graph.nodes[i].name] = graph.nodes[i];\r\n               nodeMap[graph.nodes[i].name]['links'] = {};\r\n               nodeMap[graph.nodes[i].name]['nodes'] = {};\r\n               nodeMap[graph.nodes[i].name]['hasAppend'] = true;\r\n           }\r\n        }\r\n        for (let i = 0; i < graph.links.length; i++) {\r\n            let link = graph.links[i];\r\n            if (nodeMap[link.source] !== undefined && nodeMap[link.target] !== undefined) {\r\n                nodeMap[link.source].links[link.target] = link;\r\n                nodeMap[link.source].nodes[nodeMap[link.target].name] = nodeMap[link.target];\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < graph.nodes.length; i++) {\r\n            graph.nodes[i].itemStyle =  {\r\n                color: graph.nodes[i].color\r\n            };\r\n            graph.nodes[i].label = {\r\n                normal: {\r\n                    show: graph.nodes[i].symbolSize > 15\r\n                },\r\n\r\n            };\r\n        }\r\n        redrawGraph();\r\n    }\r\n// 处理点击节点展开\r\n    function append(nodeName) {\r\n        // 根据nodeName从nodeMap里拿出对应的nodes和links，并append到currentGraph.nodes currentGraph.links\r\n        let node = nodeMap[nodeName];\r\n        if (node.hasAppend === true || Object.keys(node.nodes).length === 0 || Object.keys(node.links).length === 0) {\r\n\r\n            return\r\n        }\r\n        Object.values(node.nodes).forEach(n => {\r\n            n.symbolSize =40;\r\n            currentGraph.nodes[n.name] = n;\r\n        });\r\n        Object.values(node.links).forEach(l => {\r\n            currentGraph.links[l.source + \"_\" + l.target] = l;\r\n        });\r\n        node.hasAppend = true;\r\n        redrawGraph();\r\n    }\r\n// 处理点击节点收缩\r\n    function remove(nodeName) {\r\n        //根据nodeName从nodeMap里拿出对应的nodes和links，从currentGraph.nodes currentGraph.links删除当前节点的nodes和links并且递归\r\n        let node = nodeMap[nodeName];\r\n        Object.values(node.nodes).forEach(n => {\r\n            delete currentGraph.nodes[n.name];\r\n            if (n.hasAppend === true && Object.keys(n.nodes).length > 0) {\r\n                remove(n.name);\r\n            }\r\n        });\r\n        Object.values(node.links).forEach(l => {\r\n            delete currentGraph.links[l.source + '_' + l.target];\r\n        });\r\n        // 设置flag 等于false\r\n        node.hasAppend = false;\r\n\r\n        redrawGraph();\r\n    }\r\n// 根据更新后的option重新画图\r\n    function redrawGraph() {\r\n        option.series[0].data = Object.values(currentGraph.nodes);\r\n        option.series[0].links = Object.values(currentGraph.links);\r\n        console.log(option);\r\n        myChart.setOption(option);\r\n    }\r\n    option = {\r\n        backgroundColor:\"#000\",\r\n        tooltip: {\r\n            formatter:function(params){\r\n                return params.data.reason\r\n            }\r\n        },\r\n        legend: [],\r\n        animation: false,\r\n        series: [{\r\n            type: 'graph',\r\n            layout: 'force',\r\n            data: Object.values(currentGraph.nodes),\r\n            links: Object.values(currentGraph.links),\r\n            roam: true,\r\n            focusNodeAdjacency: false,\r\n            label: {\r\n                formatter: '{b}',\r\n                textStyle:{\r\n                    color:\"#ffffff\"\r\n                },\r\n                \r\n            },\r\n              edgeSymbol: ['circle', 'arrow'],\r\n            lineStyle: {\r\n                color: 'rgba(255,255,255,0.6)',\r\n                opacity: 1,\r\n                curveness: 0.3\r\n            },\r\n            force: {\r\n                layoutAnimation: false,\r\n                repulsion: 100\r\n            },\r\n\r\n        }]\r\n    };\r\n    init();\r\n    myChart.on('click', function(params) {\r\n\r\n        if (params.dataType === \"node\") {\r\n            const node = nodeMap[params.data.name];\r\n            if (node.hasAppend === true) {\r\n                option.series[0].force.repulsion = 100;\r\n                currentGraph.nodes[(params.data.name)].symbolSize = 30\r\n                remove(node.name)\r\n            } else {\r\n                option.series[0].force.repulsion = 320;\r\n                currentGraph.nodes[(params.data.name)].symbolSize = 40\r\n                append(node.name);\r\n\r\n\r\n            }\r\n        }\r\n\r\n    });","html":"","externalScripts":"","updaterUID":"obd-o2Uq48DS8VVe30Eo4Mzq2csfOGk3560","theme":"","layout":"","viewCount":0,"userName":"叫***e","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xll5Xkz4Rn.png?v=1640590284454","isCustomThumbnail":0,"builtinTags":["category-work","series-graph","tooltip"],"customTags":[],"updaterUserName":"叫***e"}}