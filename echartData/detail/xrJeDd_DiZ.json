{"status":0,"data":{"cid":"xrJeDd_DiZ","authorUid":"bd-1026690535","authorUserName":"smile星怀蓝梦","title":"openlayers","description":"echarts结合openlayers","latestVersion":1,"alwaysLatest":1,"createTime":"2017-09-26T06:48:55.000Z","lastUpdateTime":"2017-09-26T06:48:55.000Z","auth":2,"uid":"bd-1026690535","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.7.1","versionCreateTime":"2017-09-26T06:48:55.000Z","code":"document.onreadystatechange = function () {\r\n    if (document.readyState === 'complete') {\r\n      var Maps = new HMap('map', {\r\n        controls: {\r\n          loading: true,\r\n          zoomSlider: true,\r\n          fullScreen: false\r\n        },\r\n        view: {\r\n          center: [13442207.605459828, 3600600.2028761804],\r\n          extent: [-2.0037507067161843E7, -3.0240971958386254E7, 2.0037507067161843E7, 3.0240971958386205E7],\r\n          projection: 'EPSG:102100',\r\n          tileSize: 256,\r\n          zoom: 12, // resolution\r\n        },\r\n        baseLayers: [\r\n          {\r\n            layerName: 'vector',\r\n            isDefault: true,\r\n            layerType: 'TileXYZ',\r\n            tileGrid: {\r\n              tileSize: 256,\r\n              extent: [-2.0037507067161843E7, -3.0240971958386254E7, 2.0037507067161843E7, 3.0240971958386205E7],\r\n              origin: [-2.0037508342787E7, 2.0037508342787E7],\r\n              resolutions: [\r\n                156543.03392800014,\r\n                78271.51696399994,\r\n                39135.75848200009,\r\n                19567.87924099992,\r\n                9783.93962049996,\r\n                4891.96981024998,\r\n                2445.98490512499,\r\n                1222.992452562495,\r\n                611.4962262813797,\r\n                305.74811314055756,\r\n                152.87405657041106,\r\n                76.43702828507324,\r\n                38.21851414253662,\r\n                19.10925707126831,\r\n                9.554628535634155,\r\n                4.77731426794937,\r\n                2.388657133974685\r\n              ]\r\n            },\r\n            layerUrl: 'http://cache1.arcgisonline.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}'\r\n          }\r\n        ]\r\n      });\r\n      // 处理数据\r\n      function convertData (sourceData) {\r\n        return [].concat.apply([], $.map(sourceData, function (busLine, index) {\r\n          var prevPoint = null;\r\n          var points = [];\r\n          var value = busLine.shift();\r\n          for (var i = 0; i < busLine.length; i += 2) {\r\n            var point = [busLine[i], busLine[i + 1]];\r\n            if (i > 0) {\r\n              point = [\r\n                prevPoint[0] + point[0],\r\n                prevPoint[1] + point[1]\r\n              ];\r\n            }\r\n            prevPoint = point;\r\n            points.push([point[0] / 1e5, point[1] / 1e5]);\r\n          }\r\n          return {\r\n            value: value,\r\n            coords: points\r\n          };\r\n        }));\r\n      }\r\n      // 创建图表实例\r\n      var echartslayer = undefined\r\n      if (echartslayer !== undefined) {\r\n        return false\r\n      } else {\r\n        echartslayer = new ol3Echarts(Maps.map, '.ol-overlaycontainer');\r\n      }\r\n      // 配置项\r\n      var option = {\r\n        HMap: {},\r\n        visualMap: {\r\n          type: \"piecewise\",\r\n          left: 'right',\r\n          top: 'top',\r\n          /*            pieces: [\r\n           {min: 15}, // 不指定 max，表示 max 为无限大（Infinity）。\r\n           {min: 12, max: 15},\r\n           {min: 9, max: 12},\r\n           {min: 6, max: 9},\r\n           {min: 3, max: 6},\r\n           {max: 3}     // 不指定 min，表示 min 为无限大（-Infinity）。\r\n           ],*/\r\n          min: 0,\r\n          max: 15,\r\n          splitNumber: 5,\r\n          maxOpen: true,\r\n          color: ['red', 'yellow', 'green']\r\n        },\r\n        tooltip: {\r\n          formatter: function (params, ticket, callback) {\r\n            return \"拥堵指数:\" + params.value;\r\n          },\r\n          trigger: 'item'\r\n        },\r\n        series: [\r\n          {\r\n            type: 'lines',\r\n            coordinateSystem: 'HMap',\r\n            polyline: true,\r\n            lineStyle: {\r\n              normal: {\r\n                opacity: 1,\r\n                width: 4\r\n              },\r\n              emphasis: {\r\n                width: 6\r\n              }\r\n            },\r\n            effect: {\r\n              show: true,\r\n              symbolSize: 2,\r\n              color: \"white\"\r\n            }\r\n          }\r\n        ]\r\n      };\r\n      echartslayer.chart.showLoading()\r\n      $.get('https://www.easy-mock.com/mock/593aabdf8ac26d795fc563b1/echarts/traffic', function (res) {\r\n        if (res && res['success']) {\r\n          echartslayer.chart.hideLoading()\r\n          option.series[0].data = convertData(res['data']);\r\n          echartslayer.chart.setOption(option);\r\n        }\r\n      });\r\n    }\r\n  }","html":"","externalScripts":"https://unpkg.com/hmap-js@1.5.0/dist/hmap.js,https://unpkg.com/jquery@3.2.1/dist/jquery.js,https://unpkg.com/echarts@3.7.1/dist/echarts.js,https://unpkg.com/ol3-echarts@1.1.0/dist/ol3Echarts.js","updaterUID":"bd-1026690535","theme":"","layout":"","viewCount":188,"userName":"smile星怀蓝梦","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xrJeDd_DiZ.undefined?v=","isCustomThumbnail":0,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"smile星怀蓝梦"}}