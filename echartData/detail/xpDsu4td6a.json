{"status":0,"data":{"cid":"xpDsu4td6a","authorUid":"bd-6442928284","authorUserName":"流***r","title":"quan-k","description":"","latestVersion":2,"alwaysLatest":1,"createTime":"2020-04-19T12:11:19.000Z","lastUpdateTime":"2020-04-19T12:11:19.000Z","auth":2,"uid":"bd-6442928284","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.7.0","versionCreateTime":"2020-04-28T15:28:32.000Z","code":"// -10% ~ 10% 随机数\nconst rnd = () => 0.2 * Math.random() - 0.1;\n// 随机漫步\nconst randomWalk = (count) => {\n  const ps = [1];\n  for (let i = 1; i < count; i++) {\n    ps[i] = Number((ps[i - 1] * (1 + rnd())).toFixed(2));\n  }\n  return ps;\n};\n\nconst prices = randomWalk(11);\n\n// 交易次数不限制\nconst profit = (prices, kmax) => {\n  console.log('start======================>');\n  if (!prices || !prices.length) {\n    return [0, 0];\n  }\n  const dp0 = [];\n  const dp1 = [];\n  for (let i = 0; i < prices.length; i++) {\n    const p = prices[i];\n    dp0[i] = [];\n    dp1[i] = [];\n    for (let k = kmax; k >= 1; k--) {\n      if (i === 0) {\n          dp0[i][k] = 0;\n          dp1[i][k] = -p;\n          continue;\n      }\n      if (dp1[i -1][k] + p > dp0[i-1][k]) {\n          console.log('sell======>',i, k, p);\n          dp0[i][k] = dp1[i -1][k] + p;\n      } else {\n          dp0[i][k] = dp0[i-1][k];\n      }\n      if (dp0[i-1][k-1] - p > dp1[i-1][k]) {\n          console.log('buy======>', i, k, p);\n          dp1[i][k] = dp0[i-1][k-1] - p;\n      } else {\n          dp1[i][k] = dp1[i-1][k];\n      }\n    }\n  }\n  \n  console.log('vvv', dp0[prices.length - 1][kmax]);\n\n  return [\n   [],[]\n  ];\n};\n\nconst [bIdxs, sIdxs] = profit(prices, 2);\n\n// 波峰波谷\nconst findValleyPeaks = (prices) => {\n    if (!prices.length) {\n        return [];\n    }\n\n    const tradeList = [];\n    const buy = (index) => {\n        tradeList.push({\n            buyIndex: index,\n            buyPrice: prices[index],\n            sellIndex: -1,\n            sellPrice: -Infinity,\n        });\n    };\n    const sell = (index) => {\n        const trade = tradeList[tradeList.length - 1];\n        if (trade) {\n            trade.sellIndex = index;\n            trade.sellPrice = prices[index];\n        }\n    };\n\n    let prev = prices[0];\n    // 0-> 初始趋势不明   -1 -> 熊市   1 -> 牛市\n    let trend = 0;\n    for (let i = 0; i < prices.length; i++) {\n        const p = prices[i];\n        const delta = p - prev;\n        if (trend <= 0 && delta > 0) {\n            buy(i - 1);\n            trend = 1;\n        }\n        if (trend >= 0 && delta < 0) {\n            sell(i - 1);\n            trend = -1;\n        }\n        prev = p;\n    }\n    // 最后一天卖出\n    const lastTrade = tradeList[tradeList.length - 1];\n    if (lastTrade.sellIndex === -1) {\n        lastTrade.sellIndex === prices.length - 1;\n        lastTrade.sellPrice === prices[prices.length - 1];\n    }\n    return tradeList;\n};\n\nconst mergeTrade = (trade1, trade2) => {\n    if (trade2.buyPrice > trade1.buyPrice && trade2.sellPrice > trade1.sellPrice) {\n        return {\n            buyIndex: trade1.buyIndex,\n            buyPrice: trade1.buyPrice,\n            sellIndex: trade2.sellIndex,\n            sellPrice: trade2.sellPrice,\n        };\n    } else if ((trade1.sellPrice - trade1.buyPrice) > (trade2.sellPrice - trade2.buyPrice)) {\n        return {\n            buyIndex: trade1.buyIndex,\n            buyPrice: trade1.buyPrice,\n            sellIndex: trade1.sellIndex,\n            sellPrice: trade1.sellPrice,\n        };\n    } else {\n        return {\n            buyIndex: trade2.buyIndex,\n            buyPrice: trade2.buyPrice,\n            sellIndex: trade2.sellIndex,\n            sellPrice: trade2.sellPrice,\n        };\n    }\n};\n\nconst profit2 = (prices, kmax) => {\n    const tradeList = findValleyPeaks(prices);\n    if (kmax >= tradeList.length) {\n        return tradeList;\n    }\n    \n};\n\n\n\nconst data = prices.map((v, index) => [index, v]);\nconst markPoints = [];\n\nbIdxs.forEach(v => {\n  markPoints.push({\n    name : '买点',\n    coord: [v, data[v][1]],\n    symbolOffset: [0, 10],\n    itemStyle: {\n      color:'red',\n    },\n   });\n});\n\nsIdxs.forEach(v => {\n  markPoints.push({\n    name : '卖点',\n    coord: [v, data[v][1]],\n    symbolOffset: [0, -10],\n    itemStyle: {\n      color:'yellowgreen',\n    },\n   });\n});\n\noption = {\n    backgroundColor: '#080b30',\n    title: {\n        text: 'quan-infinity',\n        textStyle: {\n          color: '#fff',  \n        },\n    },\n    tooltip: {\n        trigger: 'axis',\n    },\n    grid: {\n        left: 64,\n        right: 16,\n        bottom: 80,\n    },\n    toolbox: {\n        feature: {\n            dataZoom: {\n                yAxisIndex: 'none'\n            },\n            restore: {},\n            saveAsImage: {}\n        }\n    },\n    xAxis: {\n        axisLine: {\n            show: true,\n            lineStyle: {\n                color: 'rgba(255,255,255,0.3)'\n            }\n        },\n        axisTick: {\n            show: false,\n        },\n        splitLine: {\n            show: false,\n        },\n    },\n    yAxis: {\n        axisLine: {\n            show: false,\n        },\n        axisTick: {\n            show: false,\n        },\n        axisLabel: {\n            color: 'rgba(255,255,255,0.3)',\n        },\n        splitLine: {\n            show: true,\n            lineStyle: {\n                color: 'rgba(255,255,255,0.3)'\n            }\n        },\n    },\n    dataZoom: [\n        {\n            type: 'inside',\n            start: 0,\n            end: 1000\n        },\n        {\n            start: 0,\n            end: 1000,\n            handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\n            handleSize: '80%',\n            handleStyle: {\n                color: '#fff',\n                shadowBlur: 3,\n                shadowColor: 'rgba(0, 0, 0, 0.6)',\n                shadowOffsetX: 2,\n                shadowOffsetY: 2\n            }\n        }\n    ],\n    series: [{\n        type: 'line',\n        lineStyle: {\n            color: \"#6c50f3\",\n        },\n        markPoint : {\n            symbol: 'circle',\n            symbolSize: 10,\n            data : markPoints,\n        },\n        data,\n    }],\n};","html":"","externalScripts":"","updaterUID":"bd-6442928284","theme":"","layout":"","viewCount":71,"userName":"流***r","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xpDsu4td6a.png?v=1588087712283","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","markPoint","series-line","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"流***r"}}