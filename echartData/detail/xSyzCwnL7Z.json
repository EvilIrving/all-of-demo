{"status":0,"data":{"cid":"xSyzCwnL7Z","authorUid":"bd-167860219","authorUserName":"n***1","title":"公交GPS可视化","description":"公交GPS可视化，鼠标移动至右侧运行图","latestVersion":4,"alwaysLatest":1,"createTime":"2017-06-20T14:57:14.000Z","lastUpdateTime":"2020-05-09T14:17:12.000Z","auth":2,"uid":"bd-167860219","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"3.8.0","versionCreateTime":"2019-04-17T09:47:03.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1497966699001-HyX_djLQb.json\";\n\nmyChart.setOption(option = {\n    title: {\n        text: \"公交GPS可视化\",\n        subtext: '鼠标移动至右侧运行图可见效果',\n        left: 10,\n        top: 10,\n        textStyle: {\n            color: 'rgba(18,89,147,1)',\n            fontSize: 40\n        }\n    },\n    tooltip: {\n        trigger: 'item',\n        transitionDuration: 0,\n        position: function(point, params, dom, rect, size) {\n            var least_area = 20;\n            var offset_x = 30; /* 相对于point的偏移 */\n            var offset_y = 30;\n\n            /* last_point的least_area范围内不会产生新的t_pos */\n            if (Math.abs(point[0] - last_point[0]) < least_area &&\n                Math.abs(point[1] - last_point[1]) < least_area &&\n                counter >= 2) {\n                return t_pos;\n            }\n            if (Math.abs(point[0] - last_point[0]) >= least_area ||\n                Math.abs(point[1] - last_point[1]) >= least_area) {\n                counter = 0;\n            }\n            counter += 1;\n            /* 使real_x,real_y有数值 */\n            if (counter == 1) {\n                t_pos.left = point[0] + offset_x;\n                t_pos.top = point[1] + offset_y;\n                last_point = [point[0], point[1]];\n            }\n            /* 此处进行修正tooltip的位置 */\n            if (counter == 2) {\n                var real_x = $(dom).position().left;\n                var real_y = $(dom).position().top;\n                t_pos.left += point[0] - real_x + offset_x;\n                t_pos.top += point[1] - real_y + offset_y;\n            }\n            return t_pos;\n        }\n    },\n    animation: false,\n    bmap: {\n        center: [120.601206, 36.203083],\n        zoom: 12,\n        roam: true,\n        mapStyle: {\n            'styleJson': [{\n                \"featureType\": \"all\",\n                \"elementType\": \"all\",\n                \"stylers\": {\n                    \"lightness\": 10,\n                    \"saturation\": -100\n                }\n            }, {\n                \"featureType\": \"subway\",\n                \"elementType\": \"labels.icon\",\n                \"stylers\": {\n                    \"color\": \"#022338\",\n                    \"visibility\": \"off\"\n                }\n            }, {\n                \"featureType\": \"poi\",\n                \"elementType\": \"labels\",\n                \"stylers\": {\n                    \"color\": \"#022338\",\n                    \"visibility\": \"off\"\n                }\n            }, {\n                \"featureType\": \"highway\",\n                \"elementType\": \"labels.icon\",\n                \"stylers\": {\n                    \"color\": \"#022338\",\n                    \"visibility\": \"off\"\n                }\n            }, {\n                \"featureType\": \"all\",\n                \"elementType\": \"labels\",\n                \"stylers\": {\n                    \"visibility\": \"off\"\n                }\n            }]\n        }\n    },\n    animation: false,\n    grid: [{\n        right: 40,\n        bottom: '3%',\n        top: '0',\n\n        //height: '40%',\n        width: '28%'\n    }, {\n        show: true,\n        left: null,\n        right: 0,\n        height: '100%',\n        width: '360px',\n        bottom: '0%',\n        backgroundColor: 'rgba(255,255,255,0.9)'\n    }, {\n            show: true,\n            left: 0,\n            top: 0,\n            height: '80px',\n            width: '320px',\n            bottom: '0%',\n            backgroundColor: 'rgba(255,255,255,0.8)',\n            zlevel: -1\n        }],\n    dataZoom: [{\n        type: 'slider',\n        yAxisIndex: 0,\n        start: 0,\n        end: 80,\n        filterMode: 'empty',\n        textStyle: {\n            color: '#000'\n        },\n        borderColor: '#000',\n        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\n        handleSize: '80%',\n        handleStyle: {\n            color: '#000',\n            shadowBlur: 3,\n            shadowColor: 'rgba(0, 0, 0, 0.6)',\n            shadowOffsetX: 2,\n            shadowOffsetY: 2\n        }\n    }, {\n        type: 'inside',\n        yAxisIndex: 0,\n        start: 0,\n        end: 30,\n        filterMode: 'empty'\n    }],\n\n    tooltip: {\n        trigger: 'axis',\n        formatter: function(params, ticket, callback) {\n            return '时间' + params[0].axisValueLabel\n            return ''\n        }\n\n\n    },\n    axisPointer: {\n        type: 'shadow',\n        triggerTooltip: false\n    },\n    xAxis: [{\n        gridIndex: 0,\n\n        name: '时间',\n        axisLine: {\n            lineStyle: {\n                color: '#000'\n            }\n        },\n        axisLabel: {\n            margin: 2,\n            textStyle: {\n                color: '#000'\n            }\n        }\n    }],\n    yAxis: [{\n        gridIndex: 0,\n        name: '时间',\n        type: 'time',\n        axisLine: {\n            lineStyle: {\n                color: '#000'\n            }\n        },\n        axisLabel: {\n            margin: 2,\n            textStyle: {\n                color: '#000'\n            }\n        }\n    }],\n\n    series: []\n});\n\n$.getJSON(uploadedDataURL, function(gpsdata) {\n    console.log(gpsdata[0])\n    var series2 = [{\n        zlevel: 2,\n        type: 'line',\n\n        showSymbol: false,\n        lineStyle: {\n            normal: {\n\n                opacity: 0.8,\n                width: 3\n            }\n        },\n        xAxisIndex: 0,\n        yAxisIndex: 0,\n        data: []\n    }]\n    for (var k = 0; k < gpsdata[0].length; k += 1) {\n        try {\n\n            var dataindex = 0\n\n            series2.push({\n                type: 'scatter',\n                coordinateSystem: 'bmap',\n                symbol: planePath,\n                symbolSize: 15,\n                data: [{\n                    name: gpsdata[1][k],\n                    value: [gpsdata[0][k][dataindex][0], gpsdata[0][k][dataindex][1]]\n                }]\n            })\n        } catch (err) {\n            series2.push({\n                type: 'scatter'\n            })\n        }\n    }\n\n    series2.push({\n        type: 'lines',\n        data: [{\n            name: 'busline',\n            coords: gpsdata[0][1]\n        }],\n        zlevel: -1,\n        coordinateSystem: 'bmap',\n        polyline: true,\n        lineStyle: {\n            normal: {\n                color: 'rgba(18,89,147,0.5)',\n\n                opacity: 0.8,\n                width: 1,\n                shadowColor: 'rgba(0, 0, 0, 0.9)',\n                shadowBlur: 10\n            }\n        },\n        tooltip: {\n            show: false\n        },\n        progressiveThreshold: 500,\n        progressive: 200\n    })\n    series2.push({\n        zlevel: -1,\n        type: 'scatter',\n        data: gpsdata[3],\n        coordinateSystem: 'bmap',\n        symbolSize: 8,\n        itemStyle: {\n            normal: {\n                color: 'rgba(18,89,147,0.5)'\n            }\n        },\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.name;\n            }\n        },\n        label: {\n            normal: {\n                show: false\n            },\n            emphasis: {\n                show: false\n            }\n        },\n    })\n\n    myChart.setOption({\n\n        series: series2\n    })\n\n    for (var k = 0; k < gpsdata[0].length; k += 1) {\n        var linedata = []\n        for (var i = 0; i < gpsdata[0][k].length; i += 1) {\n            linedata.push([gpsdata[0][k][i][3], gpsdata[0][k][i][2]])\n        }\n        series2.push({\n            name: gpsdata[1][k],\n            zlevel: 2,\n            type: 'line',\n\n            showSymbol: false,\n            symbolSize: 10,\n            lineStyle: {\n                normal: {\n\n                    opacity: 0.8,\n                    width: 3\n                }\n            },\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            data: linedata\n        })\n    }\n\n    myChart.hideLoading();\n\n    var series3 = []\n            for (var k = 0; k < gpsdata[0].length; k += 1) {\n            try {\n                var stdtime = params.dataByCoordSys[0].dataByAxis[0].value\n\n                var dataindex = 100\n                series3.push({\n                    type: 'scatter',\n                    coordinateSystem: 'bmap',\n                    symbol: 'path://M1024 476.279467c0 0 0 33.4848 0 41.591467 0 72.362667 0 136.6528 0 136.6528 0 15.479467-12.100267 28.040533-27.016533 28.040533l-41.284267 0c0-56.610133-45.8752-102.5024-102.4512-102.5024s-102.4512 45.8752-102.4512 102.5024L290.304 682.564267c-0.017067-56.610133-45.8752-102.5024-102.468267-102.5024-56.558933 0-102.434133 45.8752-102.4512 102.5024L27.0336 682.564267c-14.916267 0-27.016533-12.544-27.016533-28.040533L0.017067 318.173867C0.017067 290.423467 17.988267 273.066667 44.100267 273.066667c0 0 811.3152 0 844.032 0s98.4576 43.281067 124.125867 101.870933C1025.655467 406.289067 1024 476.279467 1024 476.279467zM170.786133 324.317867 78.574933 324.317867c-15.086933 0-27.323733 12.219733-27.323733 27.306667l0 81.834667c0 15.086933 12.2368 27.2896 27.323733 27.2896l92.2112 0L170.786133 324.317867zM324.471467 324.317867l-119.534933 0 0 136.413867 119.534933 0L324.471467 324.317867zM477.610667 324.317867l-119.005867 0 0 136.413867 119.005867 0L477.610667 324.317867zM631.210667 324.317867l-119.005867 0 0 136.413867 119.005867 0L631.210667 324.317867zM784.896 324.317867l-119.534933 0 0 136.413867 119.534933 0L784.896 324.317867zM784.8448 524.919467c0-7.0144-7.645867-12.6976-17.083733-12.6976s-17.066667 5.6832-17.066667 12.6976l0 25.361067c0 7.0144 7.6288 12.6976 17.066667 12.6976s17.083733-5.6832 17.083733-12.6976L784.8448 524.919467zM966.024533 404.155733c-11.008-46.728533-71.3728-79.837867-88.1152-79.837867-41.0112 0-58.845867 0-58.845867 0l0 136.413867L971.741867 460.8C971.741867 460.8 974.848 441.719467 966.024533 404.155733zM187.835733 614.2464c37.717333 0 68.3008 30.600533 68.3008 68.352 0 37.7344-30.583467 68.334933-68.3008 68.334933-37.7344 0-68.3008-30.600533-68.3008-68.334933C119.534933 644.846933 150.101333 614.2464 187.835733 614.2464zM853.265067 614.2464c37.717333 0 68.3008 30.600533 68.3008 68.352 0 37.7344-30.583467 68.334933-68.3008 68.334933-37.7344 0-68.317867-30.600533-68.317867-68.334933C784.9472 644.846933 815.530667 614.2464 853.265067 614.2464z',\n                    symbolSize: 25,\n                    data: [{\n                        name: gpsdata[1][k],\n                        value: [gpsdata[0][k][dataindex][0], gpsdata[0][k][dataindex][1]]\n                    }],\n                            zlevel: -1,\n\n\n\n\n        itemStyle: {\n            normal: {\n        \n            }\n        },\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.name;\n            }\n        },\n        label: {\n            normal: {\n                show: false\n            },\n            emphasis: {\n                show: false\n            }\n        }\n                })\n                    \n            } catch (err) {\n                series3.push({\n                    type: 'scatter'\n                })\n            }\n        }\n\n        \n        myChart.setOption({\n            series: series2.concat(series3)\n        })\n    myChart.on('showtip', function(params) {\nvar series3 = []\n        for (var k = 0; k < gpsdata[0].length; k += 1) {\n            try {\n                var stdtime = params.dataByCoordSys[0].dataByAxis[0].value\n\n                var dataindex = gpsdata[0][k].findIndex(function(value, index, arr) {\n\n                    var timestamp = Date.parse(value[2]);\n\n                    return timestamp > stdtime;\n                })\n                series3.push({\n                    type: 'scatter',\n                    coordinateSystem: 'bmap',\n                    symbol: 'path://M1024 476.279467c0 0 0 33.4848 0 41.591467 0 72.362667 0 136.6528 0 136.6528 0 15.479467-12.100267 28.040533-27.016533 28.040533l-41.284267 0c0-56.610133-45.8752-102.5024-102.4512-102.5024s-102.4512 45.8752-102.4512 102.5024L290.304 682.564267c-0.017067-56.610133-45.8752-102.5024-102.468267-102.5024-56.558933 0-102.434133 45.8752-102.4512 102.5024L27.0336 682.564267c-14.916267 0-27.016533-12.544-27.016533-28.040533L0.017067 318.173867C0.017067 290.423467 17.988267 273.066667 44.100267 273.066667c0 0 811.3152 0 844.032 0s98.4576 43.281067 124.125867 101.870933C1025.655467 406.289067 1024 476.279467 1024 476.279467zM170.786133 324.317867 78.574933 324.317867c-15.086933 0-27.323733 12.219733-27.323733 27.306667l0 81.834667c0 15.086933 12.2368 27.2896 27.323733 27.2896l92.2112 0L170.786133 324.317867zM324.471467 324.317867l-119.534933 0 0 136.413867 119.534933 0L324.471467 324.317867zM477.610667 324.317867l-119.005867 0 0 136.413867 119.005867 0L477.610667 324.317867zM631.210667 324.317867l-119.005867 0 0 136.413867 119.005867 0L631.210667 324.317867zM784.896 324.317867l-119.534933 0 0 136.413867 119.534933 0L784.896 324.317867zM784.8448 524.919467c0-7.0144-7.645867-12.6976-17.083733-12.6976s-17.066667 5.6832-17.066667 12.6976l0 25.361067c0 7.0144 7.6288 12.6976 17.066667 12.6976s17.083733-5.6832 17.083733-12.6976L784.8448 524.919467zM966.024533 404.155733c-11.008-46.728533-71.3728-79.837867-88.1152-79.837867-41.0112 0-58.845867 0-58.845867 0l0 136.413867L971.741867 460.8C971.741867 460.8 974.848 441.719467 966.024533 404.155733zM187.835733 614.2464c37.717333 0 68.3008 30.600533 68.3008 68.352 0 37.7344-30.583467 68.334933-68.3008 68.334933-37.7344 0-68.3008-30.600533-68.3008-68.334933C119.534933 644.846933 150.101333 614.2464 187.835733 614.2464zM853.265067 614.2464c37.717333 0 68.3008 30.600533 68.3008 68.352 0 37.7344-30.583467 68.334933-68.3008 68.334933-37.7344 0-68.317867-30.600533-68.317867-68.334933C784.9472 644.846933 815.530667 614.2464 853.265067 614.2464z',\n                    symbolSize: 25,\n                    data: [{\n                        name: gpsdata[1][k],\n                        value: [gpsdata[0][k][dataindex][0], gpsdata[0][k][dataindex][1]]\n                    }],\n                            zlevel: -1,\n\n\n\n\n        itemStyle: {\n            normal: {\n        \n            }\n        },\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                return params.name;\n            }\n        },\n        label: {\n            normal: {\n                show: false\n            },\n            emphasis: {\n                show: false\n            }\n        }\n                })\n                    \n            } catch (err) {\n                series3.push({\n                    type: 'scatter'\n                })\n            }\n        }\n\n                var series4=[]\nfor (var j = 0; j < series2.length; j += 1) {\n    series4.push({})\n}\n        \n        myChart.setOption({\n            series: series4.concat(series3)\n        })\n    })\n})","html":"","externalScripts":"/dep/echarts/latest/extension/bmap.min.js,https://api.map.baidu.com/getscript?v=2.0&amp;ak=xfhhaTThl11qYVrqLZii6w8qE5ggnhrY&amp;services=&amp;t=20190123111209","updaterUID":"bd-167860219","theme":"default","layout":"","viewCount":1796,"userName":"n***1","commentCount":2,"starCount":9,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSyzCwnL7Z.png?v=1589033833037","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"n***1"}}