{"status":0,"data":{"cid":"x4gTNLXEy4","authorUid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","authorUserName":"157*****625","title":"双y轴分割线对齐","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-08-11T09:42:03.000Z","lastUpdateTime":"2021-08-11T09:42:03.000Z","auth":2,"uid":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.1.2","versionCreateTime":"2021-08-11T09:42:03.000Z","code":"let dataSource = [\n    [\"product\", \"bsntq\", \"zje\", \"B\"],\n    [\"库存材料\", 102, 230, 236],\n    [\"半成品\", 596, 250, 509],\n    [\"产成品\", 459, 550, 356],\n    [\"在制品\", 308, 785, 119],\n    [\"印度工厂\", 120, 340, 550],\n    [\"工程施工\", 230, 340, -650],\n    [\"库存存货\", 540, 120, 760],\n    [\"发出商品\", 560, -230, 550],\n    [\"美国\", -1230, 456, 142],\n    [\"售后库存\", 654, 450, -869]\n]\n\noption = {\n    \"grid\": {\n        \"left\": \"3%\",\n        \"right\": \"4%\",\n        \"bottom\": \"3%\",\n        \"containLabel\": true\n    },\n   \n    \"title\": {\n        \"left\": \"center\",\n        \"show\": true,\n        \"text\": \"双y轴分割线对齐\",\n        \"textStyle\": {\n            \"color\": \"#333\",\n            \"fontSize\": 18\n        }\n    },\n    \"xAxis\": [{\n        \"type\": \"category\"\n    }],\n    \"yAxis\": [{\n        \"type\": \"value\"\n    }, {\n        \"type\": \"value\"\n    }],\n    \"legend\": {\n        \"show\": true,\n        \"type\": \"scroll\",\n        \"bottom\": 0,\n        \"textStyle\": {\n            \"fontSize\": 12\n        }\n    },\n    \"series\": [{\n        \"name\": \"上年同期\",\n        \"type\": \"bar\",\n        \"barGap\": \"30%\"\n    }, {\n        \"name\": \"增减额\",\n        \"type\": \"bar\",\n        \"barGap\": \"30%\"\n    }, {\n        \"name\": \"累计数\",\n        \"type\": \"line\",\n        \"yAxisIndex\": 1\n    }],\n    \"dataset\": {\n        \"source\": dataSource\n    },\n    \"tooltip\": {\n        \"axisPointer\": {\n            \"type\": \"none\"\n        }\n    }\n}\n\n// 刻度最大值\nfunction yAxisMax(maxValue) {\n    if (isNaN(maxValue / 1) || maxValue / 1 < 10) {\n        return 10\n    }\n    const max = Math.ceil(maxValue) + '';\n    const itemValue = Math.ceil(max / 5) + '';\n    const mins = Math.ceil((itemValue / Math.pow(10, itemValue.length - 1)))\n    const item = mins * Math.pow(10, itemValue.length - 1) + '';\n    // item 需要是5的整数倍\n    const res = Math.ceil(item / 5) * 5 * 5;\n    return res\n}\n\n// 获取y轴 数值，上部分割数，下部分割数\nfunction getYAxisConfig(dataSource, serieIndexs = []) {\n    // y轴数值\n    let yData = []\n    dataSource.forEach((item, index) => {\n        if (index > 0) { // 第一行数据不取值\n            serieIndexs.forEach(serie => {\n                yData.push(item[serie + 1] || 0)\n            })\n        }\n    })\n    // 绝对值最大值\n    let absMax = yData.reduce((num1, num2) => {\n        return Math.abs(num1) > Math.abs(num2) ? Math.abs(num1) : Math.abs(num2)\n    })\n    // 间隔值：默认分割段数 5\n    let interval = yAxisMax(absMax) / 5\n\n    // 取最大值\n    let max = Math.max(...yData)\n    // 取最小值\n    let min = Math.min(...yData)\n\n    let topSplitNumber = max > 0 ? Math.ceil(max / interval) : 0\n    let downSplitNumber = min < 0 ? Math.ceil(Math.abs(min) / interval) : 0\n    return {\n        interval: interval,\n        yData: interval,\n        topSplitNumber: topSplitNumber,\n        downSplitNumber: downSplitNumber\n    }\n\n}\n\n// 获取各y轴对应的serie\nfunction getYAxisIndexSeries(series, dataSource) {\n    let yAxisIndexSeries = {}\n    series.forEach((item, index) => {\n        if (!item.yAxisIndex) { // 默认y轴\n            if (!yAxisIndexSeries.hasOwnProperty(\"0\")) {\n                yAxisIndexSeries['0'] = [index]\n            } else {\n                yAxisIndexSeries['0'].push(index)\n            }\n        } else if (item.yAxisIndex) {\n            let key = item.yAxisIndex + \"\"\n            if (!yAxisIndexSeries.hasOwnProperty(key)) {\n                yAxisIndexSeries[key] = [index]\n            } else {\n                yAxisIndexSeries[key].push(index)\n            }\n        }\n    })\n\n    if (Object.keys(yAxisIndexSeries).length > 1) { // 存在多条y轴\n        splitLineAlign(dataSource, yAxisIndexSeries)\n        // yAxisIndexSeries = {\n        //     0: [0, 1],\n        //     1: [2]\n        // }\n    }\n\n}\n\n// 解决分割线不对齐\nfunction splitLineAlign(dataSource, yAxisIndexSeries) {\n    let applyObj = {}\n    let topSplitNumbers = []\n    let downSplitNumbers = []\n    for (let key in yAxisIndexSeries) {\n        applyObj[key] = getYAxisConfig(dataSource, yAxisIndexSeries[key])\n        topSplitNumbers.push(applyObj[key].topSplitNumber)\n        downSplitNumbers.push(applyObj[key].downSplitNumber)\n    }\n    let topSplitNumber = Math.max(...topSplitNumbers)\n    let downSplitNumber = Math.max(...downSplitNumbers)\n\n    for (let key in applyObj) {\n        if (option.yAxis[key]) {\n            option.yAxis[key]['max'] = applyObj[key].interval * topSplitNumber\n            option.yAxis[key]['min'] = applyObj[key].interval * downSplitNumber * (-1) // x轴下部分 负数\n            option.yAxis[key]['interval'] = applyObj[key].interval\n        }\n    }\n}\n\n\n\ngetYAxisIndexSeries(option.series, dataSource)","html":"","externalScripts":"","updaterUID":"obd-oCXci_RolYUjjHLA-X4-aSYX89tcP3h","theme":"","layout":"","viewCount":0,"userName":"157*****625","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x4gTNLXEy4.png?v=1628674923574","isCustomThumbnail":0,"builtinTags":["category-work","dataset","grid","legend","series-bar","series-line","title","tooltip"],"customTags":[],"updaterUserName":"157*****625"}}