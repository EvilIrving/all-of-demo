{"status":0,"data":{"cid":"xBksRWF2m7","authorUid":"bd-3393114599","authorUserName":"木***g","title":"跨象限阶梯瀑布图","description":"传统echarts阶梯瀑布图是仅适用于数据集中于一个象限的情况，经过数据的改造，将阶梯瀑布图适用于跨象限的阶段","latestVersion":1,"alwaysLatest":1,"createTime":"2018-07-18T09:01:07.000Z","lastUpdateTime":"2018-07-18T09:01:07.000Z","auth":2,"uid":"bd-3393114599","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.1.0","versionCreateTime":"2018-07-18T09:01:07.000Z","code":"var titleStyle = {\n    fontSize: 14\n};\nvar subjectsData = {\n    \"yearMonth\": \"2018年1-7月\",\n    \"xData\": [\n        \"指标1\",\n        \"指标2\",\n        \"指标3\",\n        \"指标4\",\n        \"指标5\",\n        \"指标6\",\n        \"指标7\",\n        \"指标8\",\n        \"指标9\",\n        \"指标10\",\n        \"指标11\",\n        \"指标12\",\n        \"指标13\",\n        \"指标14\",\n        \"指标15\",\n        \"指标16\"\n    ],\n    \"yData\": [74756, -5424, -19416, 2558, 615, 7997, -15708, -29782, 2848, -7974, -5777, -7055, -4145, 13120, 6490, 4571]\n}\n\nvar myJson = [];\nvar updata = [];\nvar downdata = [];\nvar auxdata = []; //辅助1的数据，存放每个堆子的总数\nvar auxdataDown = []; //支出的辅助数据，当堆子跨y轴的正负区域的时候做的辅助\nvar auxdataUp = []; //支出的辅助数据，当堆子跨y轴的正负区域的时候做的辅助\nformatStackData(subjectsData, myJson, updata, downdata, auxdata, auxdataDown, auxdataUp)\n\noption = {\n    title: {\n        text: subjectsData.yearMonth + '财务费用',\n        left: 'center',\n        textStyle: titleStyle\n    },\n    toolbox: {\n        feature: {\n            saveAsImage: {\n                show: true\n            }\n        }\n    },\n    tooltip: { //提示框组件\n        trigger: 'axis',\n        axisPointer: { // 坐标轴指示器，坐标轴触发有效\n            type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'\n        },\n        formatter: function(params) {\n            var tar;\n            var tar2;\n            if (params[3].value != '-') {\n                tar = params[3]; //收入\n            } else {\n                tar = params[4]; //支出\n            }\n            var str;\n            for (var i = 0; i < myJson.length; i++) {\n                if (tar.name === myJson[i].xData) {\n                    str = Math.abs(tar.value) + Math.abs(myJson[i].auxdataDown) + Math.abs(myJson[i].auxdataUp);\n                }\n            }\n            return tar.name + '<br/>' + tar.seriesName + ' : ' + str;\n        }\n    },\n    legend: {\n        data: ['收入', '支出'],\n        selectedMode: false, //禁用点击图表改变显示状态\n        left: 10,\n        top: 18\n    },\n    grid: {\n        left: '1%',\n        right: '4%',\n        bottom: '3%',\n        containLabel: true\n    },\n    xAxis: {\n        type: 'category',\n        splitLine: {\n            show: false\n        },\n        axisLabel: {\n            rotate: 40\n        },\n        data: subjectsData.xData\n    },\n    yAxis: {\n        type: 'value',\n        splitLine: {\n            show: false\n        }\n    },\n    series: [{\n            name: '辅助', //辅助1是总量数据，将主要柱状图按堆叠位置开始展示\n            type: 'bar',\n            stack: '总量',\n            itemStyle: {\n                normal: {\n                    color: 'rgba(0,0,0,0)'\n                },\n                emphasis: {\n                    show: false\n                }\n            },\n            data: auxdata\n        },\n        {\n            name: '支出辅助', //支出辅助是当支出跨越y轴的正负轴的时候做的辅助\n            type: 'bar',\n            stack: '总量',\n            itemStyle: {\n                normal: {\n                    color: '#FF0033'\n                },\n                emphasis: {\n                    show: false\n                }\n            },\n            data: auxdataDown\n        },\n        {\n            name: '收入辅助', //收入辅助是当收入跨越y轴的正负轴的时候做的辅助\n            type: 'bar',\n            stack: '总量',\n            itemStyle: {\n                normal: {\n                    color: '#33CC33'\n                },\n                emphasis: {\n                    show: false\n                }\n            },\n            data: auxdataUp\n        },\n        {\n            name: '收入',\n            type: 'bar',\n            stack: '总量',\n            itemStyle: {\n                normal: {\n                    color: '#33CC33'\n                }\n            },\n            label: {\n                normal: {\n                    show: true,\n                    position: 'top',\n                    formatter: function(params) {\n                        return formatNormal(params, myJson);\n                    }\n                }\n            },\n            data: updata\n        },\n        {\n            name: '支出',\n            type: 'bar',\n            stack: '总量',\n            itemStyle: {\n                normal: {\n                    color: '#FF0033'\n                }\n            },\n            label: {\n                normal: {\n                    show: true,\n                    position: 'bottom',\n                    formatter: function(params) {\n                        return formatNormal(params, myJson);\n                    }\n                }\n            },\n            data: downdata\n        }\n    ]\n};\n//构造各个指标的数据\nfunction formatStackData(subjectsData, myJson, updata, downdata, auxdata, auxdataDown, auxdataUp) {\n    var myData = subjectsData.yData;\n    var xData = subjectsData.xData;\n    var sum = 0;\n    for (var i = 0; i < myData.length; i++) {\n        var sign = sum + myData[i];\n        if (sign > 0) {\n            if (myData[i] > 0) {\n                if (sum < 0) {\n                    //这种情况的时候柱子要从负数跨到正数，收入的时候会出现的情况，所以是收入辅助存放sum，其余辅助存放0\n                    updata.push(sign);\n                    auxdataUp.push(sum);\n                    auxdataDown.push(0);\n                    auxdata.push(0);\n                } else {\n                    updata.push(myData[i]);\n                    auxdataUp.push(0);\n                    auxdataDown.push(0);\n                    auxdata.push(sum);\n                }\n                downdata.push('-');\n            } else {\n                auxdata.push(sign);\n                updata.push('-');\n                downdata.push(Math.abs(myData[i]));\n                auxdataDown.push(0);\n                auxdataUp.push(0);\n            }\n        } else {\n            if (myData[i] > 0) {\n                auxdata.push(sign);\n                updata.push(-myData[i]);\n                downdata.push('-');\n                auxdataDown.push(0);\n                auxdataUp.push(0);\n            } else {\n                updata.push('-');\n                if (sum > 0) {\n                    //这种情况的时候柱子要从正数跨到负数，支出数据的情况，所以这时候是支出辅助存放sum，其余辅助存放0\n                    downdata.push(sign);\n                    auxdataDown.push(sum);\n                    auxdataUp.push(0);\n                    auxdata.push(0);\n                } else {\n                    downdata.push(myData[i]);\n                    auxdataDown.push(0);\n                    auxdataUp.push(0);\n                    auxdata.push(sum);\n                }\n            }\n        }\n        sum = sum + myData[i];\n\n        //将各个分离的指标整理成json放入myJosn中\n        var a = {\n            xData: xData[i],\n            auxdata: auxdata[i],\n            auxdataUp: auxdataUp[i],\n            auxdataDown: auxdataDown[i],\n            updata: updata[i],\n            downdata: downdata[i]\n        };\n        myJson.push(a);\n    }\n}\n//控制数字显示的值\nfunction formatNormal(params, myJson) {\n    var str;\n    for (var i = 0; i < myJson.length; i++) {\n        if (params.name === myJson[i].xData) {\n            str = Math.abs(params.value) + Math.abs(myJson[i].auxdataDown) + Math.abs(myJson[i].auxdataUp);\n        }\n    }\n    return str;\n}","html":"","externalScripts":"","updaterUID":"bd-3393114599","theme":"","layout":"","viewCount":458,"userName":"木***g","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xBksRWF2m7.png?v=1531904467611","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"木***g"}}