{"status":0,"data":{"cid":"xHJaWqD-1Q","authorUid":"bd-2167432574","authorUserName":"堂***布","title":"复合饼图的一种实现","description":"复合饼图的一种实现途径，将其他部分的详细情况展示在环状图中","latestVersion":2,"alwaysLatest":1,"createTime":"2018-05-22T09:59:33.000Z","lastUpdateTime":"2018-05-22T09:59:33.000Z","auth":1,"uid":"bd-2167432574","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.2.1","versionCreateTime":"2019-07-06T15:24:29.000Z","code":"var data = [\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题1\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题2\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题3\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题2\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题3\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题4\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管1\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管2\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管2\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管2\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管3\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题2\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管4\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管5\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管6\",\"FaultName\":\"问题8\"},\r\n{\"RoadSection\":\"管6\",\"FaultName\":\"问题8\"},\r\n{\"RoadSection\":\"管7\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管7\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管7\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管7\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管7\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管7\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题1\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题4\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题4\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管8\",\"FaultName\":\"问题4\"},\r\n{\"RoadSection\":\"管9\",\"FaultName\":\"问题2\"},\r\n{\"RoadSection\":\"管9\",\"FaultName\":\"问题9\"},\r\n{\"RoadSection\":\"管9\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管9\",\"FaultName\":\"问题2\"},\r\n{\"RoadSection\":\"管9\",\"FaultName\":\"问题2\"},\r\n{\"RoadSection\":\"管9\",\"FaultName\":\"问题10\"},\r\n{\"RoadSection\":\"管10\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管10\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管10\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管10\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管11\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管11\",\"FaultName\":\"问题10\"},\r\n{\"RoadSection\":\"管11\",\"FaultName\":\"问题7\"},\r\n{\"RoadSection\":\"管11\",\"FaultName\":\"问题10\"},\r\n{\"RoadSection\":\"管11\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管11\",\"FaultName\":\"问题5\"},\r\n{\"RoadSection\":\"管12\",\"FaultName\":\"问题1\"},\r\n{\"RoadSection\":\"管12\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管12\",\"FaultName\":\"问题6\"},\r\n{\"RoadSection\":\"管12\",\"FaultName\":\"问题6\"}];\r\n\r\n\r\n//将数值小的归为其他类\r\nfunction getSectionData(data) {\r\n    var dataNew = {\r\n        items: [],\r\n        others: []\r\n    };\r\n    var sumOther = 0;\r\n    var sumAll = 0;\r\n    for (var i = 0; i < data.length; i++) {\r\n        if (i < data.length - 4) {\r\n            dataNew.others.push(data[i]);\r\n            sumOther += data[i].value;\r\n        } else {\r\n            dataNew.items.push(data[i]);\r\n        }\r\n        sumAll += data[i].value;\r\n    }\r\n    dataNew.items.push({\r\n        value: sumOther,\r\n        name: \"其他\"\r\n    });\r\n    dataNew.others.push({\r\n        value: sumAll - sumOther,\r\n        name: \"placeholder\",\r\n        itemStyle: {\r\n            normal: {\r\n                label: {\r\n                    show: false\r\n                },\r\n                labelLine: {\r\n                    show: false\r\n                },\r\n                color: \"transparent\",\r\n                borderColor: \"transparent\",\r\n                borderWidth: 0\r\n            },\r\n            emphasis: {\r\n                color: \"transparent\",\r\n                borderColor: \"transparent\",\r\n                borderWidth: 0,\r\n                label: {\r\n                    show: false\r\n                }\r\n            }\r\n        },\r\n        tooltip: {\r\n            formatter: function() {\r\n                return \"\";\r\n            },\r\n            backgroundColor: 'transparent',\r\n            borderColor: 'transparent',\r\n            height: 0,\r\n            width: 0\r\n        }\r\n    });\r\n    return dataNew;\r\n}\r\n\r\n\r\nfunction getTypeDataForChart(srcData) {\r\n    var datas = [];\r\n    srcData.forEach(function(item) {\r\n        if (datas.length === 0) {\r\n            datas.push({\r\n                value: 1,\r\n                name: item.FaultName\r\n            });\r\n            //仅第一个item执行\r\n        } else {\r\n            var hasItem = datas.some(function(count) {\r\n                return item.FaultName == count.name;\r\n            });\r\n            if (hasItem) {\r\n                datas.forEach( function(count) {\r\n                    if (count.name == item.FaultName)\r\n                        count.value++;\r\n                });\r\n            } else {\r\n                datas.push({\r\n                    value: 1,\r\n                    name: item.FaultName\r\n                });\r\n            }\r\n        }\r\n    });\r\n    return datas.sort(function(a, b) {\r\n        return a.value - b.value;\r\n    });\r\n}\r\n\r\nvar newData = getSectionData(getTypeDataForChart(data)); //获取其他和几个大的数据分离的数据\r\n\r\n\r\nvar option = {\r\n    title: [{\r\n            text: \"各问题类型占比\",\r\n            textStyle: {\r\n                color: \"#333\",\r\n                fontSize: \"14\"\r\n            }\r\n        }\r\n    ],\r\n   \r\n    tooltip: {\r\n        formatter: '{b} ({c} 处)'\r\n    },\r\n    series: [{\r\n            name: '各缺陷类型占比',\r\n            type: 'pie',\r\n            radius: '60%',\r\n            center: ['60%', '60%'],\r\n            hoverAnimation: false,\r\n            data: newData.items,\r\n            labelLine: {\r\n                normal: {\r\n                    show: true,\r\n                    length: 5,\r\n                    length2: 5\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    label: {\r\n                        show: true,\r\n                        position: 'inside',\r\n                        formatter: '{b} \\n ({d}%)'\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        {\r\n            name: '其他',\r\n            type: 'pie',\r\n            clockWise: false,\r\n            radius: ['70%', '80%'],\r\n            center: ['60%', '60%'],\r\n            data: newData.others,\r\n            labelLine: {\r\n                normal: {\r\n                    show: true,\r\n                    length: 10,\r\n                    length2: 10\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    label: {\r\n                        show: true,\r\n                        formatter: '{b}({d}%)'\r\n                    }\r\n                }\r\n            }\r\n        }\r\n      \r\n    ]\r\n\r\n};","html":"","externalScripts":"","updaterUID":"bd-3474549409","theme":"","layout":"","viewCount":1657,"userName":"堂***布","commentCount":0,"starCount":6,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHJaWqD-1Q.png?v=1562426669142","isCustomThumbnail":0,"builtinTags":["category-work","series-pie","title","tooltip"],"customTags":[],"updaterUserName":"j***0"}}