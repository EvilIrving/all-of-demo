{"status":0,"data":{"cid":"xS1WmHRJRf","authorUid":"bd-1380664696","authorUserName":"丫***咚","title":"散点图占比效果显示","description":"散点图每个点上显示占比效果","latestVersion":1,"alwaysLatest":1,"createTime":"2018-05-09T01:55:36.000Z","lastUpdateTime":"2018-05-09T01:55:36.000Z","auth":2,"uid":"bd-1380664696","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.1.0","versionCreateTime":"2018-05-09T01:55:36.000Z","code":"//散点图\r\nfunction scatterPlot(id, datas, links) {\r\n    var echartsInstance = echarts.getInstanceByDom(document.getElementById(id));\r\n    if (echartsInstance != undefined) {\r\n        echarts.dispose(echartsInstance)\r\n    }\r\n    var chartDOM = document.getElementById(id);\r\n    var chartInstance = echarts.init(chartDOM);\r\n    var option = {\r\n        backgroundColor: 'rgba(14, 22, 71, 0.3)',\r\n        tooltip: {\r\n            show: true\r\n        },\r\n        series: [{\r\n            type: 'graph',\r\n            layout: 'none',\r\n            roam: false,\r\n            center: ['50%', '50%'],\r\n            draggable: false,\r\n            focusNodeAdjacency: true,\r\n            tooltip: {\r\n                formatter: function(data) {\r\n                    return data.data.name;\r\n                }\r\n            },\r\n            data: datas,\r\n            links: links,\r\n            lineStyle: {\r\n                normal: {\r\n                    color: '#342832',\r\n                    curveness: 0,\r\n                    type: \"solid\"\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    color: function(data) {\r\n                        return data.data.mark == \"department\" ? \"#090d3d\" : \"#37130c\"\r\n                    },\r\n                    borderColor: \"#ffe4bc\",\r\n                    borderWidth: 1,\r\n                    borderType: \"solid\",\r\n                    opacity: 1\r\n                }\r\n            },\r\n            label: {\r\n                normal: {\r\n                    color: \"#fff\",\r\n                    show: true,\r\n                    position: 'top',\r\n                    formatter: function(params) {\r\n                        if (params.data.show) {\r\n                            return params.data.name;\r\n                        } else {\r\n                            return \"\";\r\n                        }\r\n                    },\r\n                    z: 4\r\n                }\r\n            }\r\n        }]\r\n    };\r\n    chartInstance.setOption(option);\r\n}\r\n\r\n//散点图上的扇形图\r\nfunction scatterPlotPink(id) {\r\n    var chartDOM = document.getElementById(id);\r\n    var echartsInstance = echarts.getInstanceByDom(chartDOM);\r\n    if (echartsInstance != undefined) {\r\n        var chartOption = echartsInstance.getOption();\r\n        echarts.util.map(chartOption.series[0].data, function(item, index) {\r\n            if (index < 9 && index > 0) {\r\n                chartOption.series.push({\r\n                    id: item.organizeID + 'pie',\r\n                    type: 'pie',\r\n                    center: echartsInstance.convertToPixel({\r\n                        seriesIndex: 0\r\n                    }, [item.x, item.y]),\r\n                    tooltip: {\r\n                        show: false\r\n                    },\r\n                    legend: {\r\n                        show: false\r\n                    },\r\n                    z: 3,\r\n                    radius: [10, 20],\r\n                    hoverAnimation: false,\r\n                    data: [{\r\n                            value: item.value,\r\n                            itemStyle: {\r\n                                normal: {\r\n                                    color: item.mark == \"department\" ? \"#ca8622\" : \"#e86435\"\r\n                                }\r\n                            },\r\n                            label: {\r\n                                show: true,\r\n                                formatter: '{c}' + \"%\",\r\n                                color: \"#fff\",\r\n                                fontWight: \"normal\",\r\n                                position: 'center'\r\n                            }\r\n                        },\r\n                        {\r\n                            value: 100 - item.value,\r\n                            itemStyle: {\r\n                                normal: {\r\n                                    color: \"transparent\"\r\n                                }\r\n                            },\r\n                            label: {\r\n                                show: false\r\n                            }\r\n                        }\r\n                    ]\r\n                })\r\n            }\r\n        })\r\n        echartsInstance.setOption(chartOption)\r\n    }\r\n}\r\n\r\n// 根据对象的某个属性对其进行由大到小排序\r\nfunction arrMaxToMinSort(propertyName) {\r\n    return function(object1, object2) {\r\n        var value1 = object1[propertyName];\r\n        var value2 = object2[propertyName];\r\n        if (value2 > value1) {\r\n            return 1;\r\n        } else if (value2 < value1) {\r\n            return -1;\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n}\r\n\r\n//基础数据\r\nvar excChartInfos = [{\r\n        \"organizeID\": \"黑龙江省\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"黑龙江省\",\r\n        \"orgShortName\": \"黑龙\",\r\n        \"totalQua\": 50\r\n    },\r\n    {\r\n        \"organizeID\": \"甘肃省\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"甘肃省\",\r\n        \"orgShortName\": \"甘肃\",\r\n        \"totalQua\": 50\r\n    },\r\n    {\r\n        \"organizeID\": \"生产建设兵团\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"生产建设兵团\",\r\n        \"orgShortName\": \"兵团\",\r\n        \"totalQua\": 10\r\n    },\r\n    {\r\n        \"organizeID\": \"重庆市\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"重庆市\",\r\n        \"orgShortName\": \"重庆\",\r\n        \"totalQua\": 500\r\n    },\r\n    {\r\n        \"organizeID\": \"新疆维吾尔自治区\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"新疆维吾尔自治区\",\r\n        \"orgShortName\": \"新疆\",\r\n        \"totalQua\": 10\r\n    },\r\n    {\r\n        \"organizeID\": \"环保部\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"环保部\",\r\n        \"orgShortName\": \"环保\",\r\n        \"totalQua\": 10\r\n    },\r\n    {\r\n        \"organizeID\": \"国安部\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"国安部\",\r\n        \"orgShortName\": \"国安\",\r\n        \"totalQua\": 70\r\n    },\r\n    {\r\n        \"organizeID\": \"陕西省\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"陕西省\",\r\n        \"orgShortName\": \"陕西\",\r\n        \"totalQua\": 500\r\n    }, {\r\n        \"organizeID\": \"河南省\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"河南省\",\r\n        \"orgShortName\": \"河南\",\r\n        \"totalQua\": 5000\r\n    },\r\n    {\r\n        \"organizeID\": \"浙江省\",\r\n        \"mark\": \"province\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"浙江省\",\r\n        \"orgShortName\": \"浙江\",\r\n        \"totalQua\": 3000\r\n    },\r\n    {\r\n        \"organizeID\": \"扶贫办\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"扶贫办\",\r\n        \"orgShortName\": \"扶贫\",\r\n        \"totalQua\": 20\r\n    },\r\n    {\r\n        \"organizeID\": \"体育总局\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"体育总局\",\r\n        \"orgShortName\": \"体育\",\r\n        \"totalQua\": 20\r\n    },\r\n    {\r\n        \"organizeID\": \"监察部\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"监察部\",\r\n        \"orgShortName\": \"监察\",\r\n        \"totalQua\": 20\r\n    },\r\n    {\r\n        \"organizeID\": \"教育部\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"教育部\",\r\n        \"orgShortName\": \"教育\",\r\n        \"totalQua\": 20\r\n    },\r\n    {\r\n        \"organizeID\": \"民政部\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"民政部\",\r\n        \"orgShortName\": \"民政\",\r\n        \"totalQua\": 180\r\n    },\r\n    {\r\n        \"organizeID\": \"宗教局\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"宗教局\",\r\n        \"orgShortName\": \"宗教\",\r\n        \"totalQua\": 20\r\n    },\r\n    {\r\n        \"organizeID\": \"测绘局\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"测绘局\",\r\n        \"orgShortName\": \"地信\",\r\n        \"totalQua\": 20\r\n    },\r\n    {\r\n        \"organizeID\": \"法制办\",\r\n        \"mark\": \"department\",\r\n        \"overallTotalQua\": 10000,\r\n        \"orgFullName\": \"法制办\",\r\n        \"orgShortName\": \"法制\",\r\n        \"totalQua\": 20\r\n    }\r\n]\r\n\r\n//绘图区域的id\r\nvar id = \"chart-panel\";\r\n\r\n//中心区域的名称\r\nvar organizeFullName = \"国务院\";\r\n\r\n//线的数据\r\nvar links = [];\r\n\r\n//计算绘图区域宽高 \r\nvar H = parseInt($(\"#\" + id).height());\r\nvar W = parseInt($(\"#\" + id).width());\r\n//先置入要显示的8个点的坐标\r\nvar pointer = [{\r\n        x: W / 2 - 120,\r\n        y: H / 2\r\n    },\r\n    {\r\n        x: W / 2 - 100,\r\n        y: H / 2 - 80\r\n    },\r\n    {\r\n        x: W / 2,\r\n        y: H / 2 - 100\r\n    },\r\n    {\r\n        x: W / 2 + 60,\r\n        y: H / 2 - 80\r\n    },\r\n    {\r\n        x: W / 2 + 100,\r\n        y: H / 2\r\n    },\r\n    {\r\n        x: W / 2 + 60,\r\n        y: H / 2 + 80\r\n    },\r\n    {\r\n        x: W / 2,\r\n        y: H / 2 + 100\r\n    },\r\n    {\r\n        x: W / 2 - 100,\r\n        y: H / 2 + 80\r\n    }\r\n]\r\n\r\n//按照量排序\r\nexcChartInfos.sort(arrMaxToMinSort(\"totalQua\"));\r\n\r\n//组装所要显示图形的数据\r\nexcChartInfos.forEach(function(value, index) {\r\n    //当前量占总量的百分比\r\n    if (value.overallTotalQua === 0) {\r\n        value[\"totalPer\"] = 0;\r\n    } else {\r\n        value[\"totalPer\"] = Math.round(value.totalQua / value.overallTotalQua * 100);\r\n    }\r\n\r\n    if (index < 8) {\r\n        value[\"symbolSize\"] = 40;\r\n        value[\"show\"] = !0;\r\n        value[\"x\"] = pointer[index].x;\r\n        value[\"y\"] = pointer[index].y;\r\n    } else {\r\n        value[\"symbolSize\"] = 5;\r\n        value[\"show\"] = !1;\r\n        do {\r\n            value[\"x\"] = Math.random() * W;\r\n            value[\"y\"] = Math.random() * H;\r\n        }\r\n        while (W / 2 - 140 < value[\"x\"] && value[\"x\"] < W / 2 + 140 && H / 2 - 120 < value[\"y\"] && value[\"y\"] < H / 2 + 120);\r\n    }\r\n\r\n    value[\"name\"] = value.orgFullName;\r\n    value[\"draggable\"] = !1;\r\n    value[\"value\"] = value.totalPer;\r\n\r\n    //设置线的数据\r\n    links.push({\r\n        source: organizeFullName,\r\n        target: value.orgFullName,\r\n        value: Math.round(Math.random() * 10) + \"%\"\r\n    })\r\n})\r\n\r\n//将当前机构信息添加到首位\r\nexcChartInfos.unshift({\r\n    name: organizeFullName,\r\n    value: 20,\r\n    subtext: organizeFullName,\r\n    symbol: \"image://http://www.liuvweb.com/visualView/img/graph_center.png\",\r\n    symbolSize: 70,\r\n    roam: false,\r\n    label: {\r\n        normal: {\r\n            show: true,\r\n            position: 'inside',\r\n            formatter: function(params) {\r\n                return params.data.name\r\n            },\r\n            fontSize: 15\r\n        }\r\n    },\r\n    itemStyle: {\r\n        normal: {\r\n            color: \"#090d3d\",\r\n            borderType: \"solid\",\r\n            opacity: 1,\r\n            borderWidth: \"1px\",\r\n            borderColor: \"#fff\",\r\n            shadowColor: 'rgba(255, 255, 255, 0.8)',\r\n            shadowBlur: 30\r\n        }\r\n\r\n    },\r\n    x: W / 2,\r\n    y: H / 2,\r\n    fixed: true\r\n})\r\n\r\n//绘制关系图\r\nscatterPlot(id, excChartInfos, links)\r\n\r\n//绘制关系图上的扇形区域\r\nscatterPlotPink(id)","html":"","externalScripts":"","updaterUID":"bd-1380664696","theme":"","layout":"","viewCount":199,"userName":"丫***咚","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xS1WmHRJRf.png?v=1525830937027","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":["graph","pie","scatter"],"updaterUserName":"丫***咚"}}