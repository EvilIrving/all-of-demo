{"status":0,"data":{"cid":"xH1TsZEjhb","authorUid":"bd-3843002826","authorUserName":"2***9","title":"结合d3的力导图布局图","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2017-10-11T05:52:37.000Z","lastUpdateTime":"2017-10-11T05:52:37.000Z","auth":2,"uid":"bd-3843002826","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.7.2","versionCreateTime":"2017-10-11T05:52:37.000Z","code":"//////////////////////////////////////////////////////\r\nfunction support_webgl() {\r\n    try {\r\n        var canvas = document.createElement('canvas');\r\n        return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n// alert(support_webgl());\r\n/////////////////////////////////////////////////\r\n// var n = 1000,\r\n//     nodes = d3.range(n).map(function(i) {\r\n//         return {\r\n//             name: 'p' + i,\r\n//             index: i,\r\n//             x:i,y:i\r\n//         };\r\n//     }),\r\n//     links = d3.range(n).map(function(i) {\r\n//         return {\r\n//             source: i,\r\n//             target: (i + 3) % n\r\n//         };\r\n//     });\r\n// var simulation = d3.forceSimulation(nodes)\r\n//     .force(\"charge\", d3.forceManyBody().strength(-80))\r\n//     .force(\"link\", d3.forceLink(links).distance(20).strength(1).iterations(10))\r\n//     .force(\"x\", d3.forceX())\r\n//     .force(\"y\", d3.forceY());\r\n///////////////////////////////////////////////\r\nvar n = 20;\r\n\r\nvar nodes = d3.range(n * n).map(function(i) {\r\n  return {\r\n    index: i\r\n  };\r\n});\r\n\r\nvar links = [];\r\n\r\nfor (var y = 0; y < n; ++y) {\r\n  for (var x = 0; x < n; ++x) {\r\n    if (y > 0) links.push({source: (y - 1) * n + x, target: y * n + x});\r\n    if (x > 0) links.push({source: y * n + (x - 1), target: y * n + x});\r\n  }\r\n}\r\n// simulation.alphaDecay(0.01);\r\nvar simulation = d3.forceSimulation(nodes).stop()\r\n    .force(\"charge\", d3.forceManyBody().strength(-30))\r\n    .force(\"link\", d3.forceLink(links).strength(1).distance(20).iterations(10));\r\nvar percent = 0;\r\n\r\nfunction getData() {\r\n    return [{\r\n        value: percent,\r\n        itemStyle: {\r\n            normal: {\r\n                color: '#f2c967',\r\n                shadowBlur: 10,\r\n                shadowColor: '#f2c967'\r\n            }\r\n        }\r\n    }, {\r\n        value: 1 - percent,\r\n        itemStyle: {\r\n            normal: {\r\n                color: 'transparent'\r\n            }\r\n        }\r\n    }];\r\n}\r\nvar ri = 0,\r\n    rn = Math.ceil(Math.log(simulation.alphaMin()) / Math.log(1 - simulation.alphaDecay()));\r\nfallBlockT = function() {\r\n    if(ri==rn){\r\n        return ;\r\n    }\r\n    ri++;\r\n    simulation.tick();\r\n    percent = (ri+0.0)/rn;\r\n    ticked();\r\n    setTimeout(fallBlockT);\r\n};\r\nvar pp = 10;\r\nvar ii = 0;\r\n\r\nfunction ticked() {\r\n    var opt2 = {\r\n        series: [{\r\n            data: nodes\r\n        }, {}, {\r\n            data: getData()\r\n        }]\r\n    };\r\n    myChart.setOption(opt2);\r\n    if (ii < pp) {\r\n        if(ii==8){\r\n            // alert(nodes[0].x);\r\n        }\r\n        ii++;\r\n    }\r\n}\r\n//////////////////////////////////////////////////////////\r\n// var dt=new Date();\r\n// for (var i = 0, n = Math.ceil(Math.log(simulation.alphaMin()) / Math.log(1 - simulation.alphaDecay())); i < n; ++i) {\r\n//     simulation.tick();\r\n// }\r\n// alert(\"time:\"+((new Date()).getTime()-dt.getTime()));\r\n// for (var i = 0; i < nodes.length; i++) {\r\n//     var nd = nodes[i];\r\n//     alert(\"x:\" + nd.x + \"\\ny:\" + nd.y);\r\n// }\r\nvar links2 = [];\r\nfor (var i = 0; i < links.length; i++) {\r\n    links2.push({\r\n        source: links[i].source.index,\r\n        target: links[i].target.index\r\n    });\r\n}\r\nvar option = {\r\n    tooltip: {\r\n        show: false\r\n    },\r\n    animation: false,\r\n    series: [{\r\n        type: 'graph',\r\n        symbolSize: 10,\r\n        layout:'none',\r\n        roam: true, //禁止用鼠标滚轮缩小放大效果\r\n        edgeSymbol: ['circle', 'arrow'],\r\n        edgeSymbolSize: [4, 10],\r\n        // 连接线上的文字\r\n        edgeLabel: {\r\n            normal: {\r\n                show: false,\r\n                textStyle: {\r\n                    fontSize: 20\r\n                }\r\n            }\r\n        },\r\n        lineStyle: {\r\n            normal: {\r\n                opacity: 1,\r\n                width: 2,\r\n                curveness: 0.1\r\n            }\r\n        },\r\n        // 圆圈内的文字\r\n        label: {\r\n            normal: {\r\n                show: false\r\n            }\r\n        },\r\n        data: nodes,\r\n        // links: [],\r\n        links: links2\r\n    }, {\r\n        type: 'pie',\r\n        radius: ['28%', '33%'],\r\n        silent: true,\r\n        label: {\r\n            normal: {\r\n                show: false,\r\n            }\r\n        },\r\n        data: [{\r\n            itemStyle: {\r\n                normal: {\r\n                    color: '#3da1ee',\r\n                    shadowBlur: 2,\r\n                    shadowColor: '#3da1ee'\r\n                }\r\n            }\r\n        }]\r\n    }, {\r\n        name: 'main',\r\n        type: 'pie',\r\n        radius: ['35%', '42%'],\r\n        label: {\r\n            normal: {\r\n                show: false\r\n            }\r\n        },\r\n        data: getData()\r\n    }]\r\n};\r\nmyChart.setOption(option);\r\nfallBlockT();","html":"","externalScripts":"https://d3js.org/d3.v4.min.js,http://echarts.baidu.com/resource/echarts-gl-latest/dist/echarts-gl.min.js","updaterUID":"bd-3843002826","theme":"","layout":"","viewCount":1183,"userName":"2***9","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xH1TsZEjhb.png?v=1507701157503","isCustomThumbnail":0,"builtinTags":["category-work","series-graph","series-pie","tooltip"],"customTags":[],"updaterUserName":"2***9"}}