{"status":0,"data":{"cid":"xS1zti_0xX","authorUid":"bd-1191423521","authorUserName":"lenovolhl","title":"Awesome Chart","description":"graph图表拖拽","latestVersion":7,"alwaysLatest":1,"createTime":"2018-06-13T11:09:46.000Z","lastUpdateTime":"2018-06-13T11:09:46.000Z","auth":1,"uid":"bd-1191423521","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":7,"parentVersion":6,"echartsVersion":"4.4.0","versionCreateTime":"2020-03-22T17:58:47.000Z","code":"option = {\n    tooltip: {\n        show: false,\n    },\n    series: [{\n        type: 'graph',\n        layout: 'none',\n        focusNodeAdjacency: false,\n        nodeScaleRatio: 0.1,\n        roam: true,\n        zoom: 1,\n        zoomLimit: {\n            max: 1.5,\n            min: 0.5\n        },\n        draggable: false,\n        animation: false,\n        circular: {\n            rotateLabel: true\n        },\n        edgeSymbol: ['', 'arrow'], //\n        label: {\n            show: true,\n            fontSize: 8,\n            color: '#000',\n            fontWeight: 'normal',\n            position: 'right',\n            formatter: function(param) {\n    \n                return param.name;\n            },\n        },\n        edgeLabel: {\n            normal: {\n                show: true,\n                textStyle: {\n                    fontSize: 10\n                },\n                formatter: \"{c}\"\n            }\n        },\n\n        data: [{\n            name: '鹰眼',\n            value: [10, 35, 50],\n            x: 240,\n            y: 192,\n\n        }, {\n            name: 'Mysql',\n            x: 179,\n            y: 254,\n            value: [6, 7, 8],\n        }, {\n            name: 'Redis',\n            value: [9, 31, 11],\n            x: 100,\n            y: 100,\n\n        }, {\n            name: 'ES',\n            value: [23, 65, 50],\n            x: 263.3165375759196,\n            y: 108.7891462763019,\n\n        }, ],\n        edges: [{\n            source: 0,\n            target: 1,\n            value: '数据库调用'\n        }, {\n            source: 0,\n            target: 2,\n            value: '数据库调用'\n        }, {\n            source: 0,\n            target: 3,\n            value: '远程调用'\n        }, {\n            source: 1,\n            target: 2,\n            value: '数据库调用'\n        }, {\n            source: 2,\n            target: 3,\n            value: '远程调用'\n        }],\n\n    },\n    \n    \t{// 外围刻度\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '10%'],radius: '10%', \n\t\tsplitNumber:10,min:0,max:10,\n\t\tstartAngle:225,endAngle:-45,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {width: 2,shadowBlur: 0,color: [[1, '#03b7c9']]}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: true,\n\t\t\tlineStyle: { color:'#03b7c9', width: 1},\n\t\t\tlength: -5,\n\t\t\tsplitNumber: 2\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlength: -10,\n\t\t\tlineStyle: {color: '#03b7c9'}\n\t\t},\n\t\taxisLabel: {\n\t\t\tdistance: -12,\n\t\t\ttextStyle: {color: '#03b7c9',fontSize: '10',fontWeight: 'bold'}\n\t\t},\n\t\tpointer: {show: 0},\n\t\tdetail: {show: 0}\n\t},\n\t{// 内侧指针、数值显示\n\t\tname: '出巡区间',\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '10%'],radius: '10%',\n\t\tstartAngle: 225,endAngle: -45,\n\t\tmin: 0,max: 10,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\twidth: 16,\n\t\t\t\tcolor: [[1, 'rgba(255,255,255,.1)']]\n\t\t\t}\n\t\t},\n\t\taxisTick: {show: 0},\n\t\tsplitLine: {show: 0},\n\t\taxisLabel: {show: 0},\n\t\tpointer: {show: true,length: '90%'},\n\t\tdetail: {\n\t\t\tshow: true,\n\t\t\toffsetCenter: [0, '100%'],\n\t\t\ttextStyle: {fontSize: 12,color: '#fff'},\n\t\t\tformatter: ['{value}'+'个','{name|'+'出巡区间'+'}'].join('\\n'),\n\t\t\trich: {\n\t\t\t\tname: {fontSize: 10,lineHeight: 15,color: '#fff'}\n\t\t\t}\n\t\t},\n\t\titemStyle: {\n\t\t\tnormal: {color: '#03b7c9',}\n\t\t},\n\t\tdata: [{\n\t\t\tvalue: 0\n\t\t}]\n\t},\n\t\n//限速区间\n\t{// 外围刻度\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '26%'],radius: '10%', \n\t\tsplitNumber:10,min:0,max:10,\n\t\tstartAngle:225,endAngle:-45,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {width: 2,shadowBlur: 0,color: [[1, '#03b7c9']]}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: true,\n\t\t\tlineStyle: { color:'#03b7c9', width: 1},\n\t\t\tlength: -5,\n\t\t\tsplitNumber: 2\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlength: -10,\n\t\t\tlineStyle: {color: '#03b7c9'}\n\t\t},\n\t\taxisLabel: {\n\t\t\tdistance: -12,\n\t\t\ttextStyle: {color: '#03b7c9',fontSize: '10',fontWeight: 'bold'}\n\t\t},\n\t\tpointer: {show: 0},\n\t\tdetail: {show: 0}\n\t},\n\t{// 内侧指针、数值显示\n\t\tname: '限速区间',\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '26%'],radius: '10%',\n\t\tstartAngle: 225,endAngle: -45,\n\t\tmin: 0,max: 10,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\twidth: 16,\n\t\t\t\tcolor: [[1, 'rgba(255,255,255,.1)']]\n\t\t\t}\n\t\t},\n\t\taxisTick: {show: 0},\n\t\tsplitLine: {show: 0},\n\t\taxisLabel: {show: 0},\n\t\tpointer: {show: true,length: '90%'},\n\t\tdetail: {\n\t\t\tshow: true,\n\t\t\toffsetCenter: [0, '100%'],\n\t\t\ttextStyle: {fontSize: 12,color: '#fff'},\n\t\t\tformatter: ['{value}'+'个','{name|'+'限速区间'+'}'].join('\\n'),\n\t\t\trich: {\n\t\t\t\tname: {fontSize: 10,lineHeight: 15,color: '#fff'}\n\t\t\t}\n\t\t},\n\t\titemStyle: {\n\t\t\tnormal: {color: '#03b7c9',}\n\t\t},\n\t\tdata: [{\n\t\t\tvalue: 0\n\t\t}]\n\t},\n\t\n//客车扣停区间\n\t{// 外围刻度\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '42%'],radius: '10%', \n\t\tsplitNumber:10,min:0,max:10,\n\t\tstartAngle:225,endAngle:-45,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {width: 2,shadowBlur: 0,color: [[1, '#03b7c9']]}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: true,\n\t\t\tlineStyle: { color:'#03b7c9', width: 1},\n\t\t\tlength: -5,\n\t\t\tsplitNumber: 2\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlength: -10,\n\t\t\tlineStyle: {color: '#03b7c9'}\n\t\t},\n\t\taxisLabel: {\n\t\t\tdistance: -12,\n\t\t\ttextStyle: {color: '#03b7c9',fontSize: '10',fontWeight: 'bold'}\n\t\t},\n\t\tpointer: {show: 0},\n\t\tdetail: {show: 0}\n\t},\n\t{// 内侧指针、数值显示\n\t\tname: '扣停区间',\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '42%'],radius: '10%',\n\t\tstartAngle: 225,endAngle: -45,\n\t\tmin: 0,max: 10,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\twidth: 16,\n\t\t\t\tcolor: [[1, 'rgba(255,255,255,.1)']]\n\t\t\t}\n\t\t},\n\t\taxisTick: {show: 0},\n\t\tsplitLine: {show: 0},\n\t\taxisLabel: {show: 0},\n\t\tpointer: {show: true,length: '90%'},\n\t\tdetail: {\n\t\t\tshow: true,\n\t\t\toffsetCenter: [0, '100%'],\n\t\t\ttextStyle: {fontSize: 12,color: '#fff'},\n\t\t\tformatter: ['{value}'+'个','{name|'+'扣停区间'+'}'].join('\\n'),\n\t\t\trich: {\n\t\t\t\tname: {fontSize: 10,lineHeight: 15,color: '#fff'}\n\t\t\t}\n\t\t},\n\t\titemStyle: {\n\t\t\tnormal: {color: '#03b7c9',}\n\t\t},\n\t\tdata: [{\n\t\t\tvalue: 0\n\t\t}]\n\t},\n\t\n//封锁区间\n\t{// 外围刻度\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '58%'],radius: '10%', \n\t\tsplitNumber:10,min:0,max:10,\n\t\tstartAngle:225,endAngle:-45,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {width: 2,shadowBlur: 0,color: [[1, '#03b7c9']]}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: true,\n\t\t\tlineStyle: { color:'#03b7c9', width: 1},\n\t\t\tlength: -5,\n\t\t\tsplitNumber: 2\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlength: -10,\n\t\t\tlineStyle: {color: '#03b7c9'}\n\t\t},\n\t\taxisLabel: {\n\t\t\tdistance: -12,\n\t\t\ttextStyle: {color: '#03b7c9',fontSize: '10',fontWeight: 'bold'}\n\t\t},\n\t\tpointer: {show: 0},\n\t\tdetail: {show: 0}\n\t},\n\t{// 内侧指针、数值显示\n\t\tname: '封锁区间',\n\t\ttype: 'gauge',\n\t\tcenter: ['95%', '58%'],radius: '10%',\n\t\tstartAngle: 225,endAngle: -45,\n\t\tmin: 0,max: 10,\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\twidth: 16,\n\t\t\t\tcolor: [[1, 'rgba(255,255,255,.1)']]\n\t\t\t}\n\t\t},\n\t\taxisTick: {show: 0},\n\t\tsplitLine: {show: 0},\n\t\taxisLabel: {show: 0},\n\t\tpointer: {show: true,length: '90%'},\n\t\tdetail: {\n\t\t\tshow: true,\n\t\t\toffsetCenter: [0, '100%'],\n\t\t\ttextStyle: {fontSize: 12,color: '#fff'},\n\t\t\tformatter: ['{value}'+'个','{name|'+'封锁区间'+'}'].join('\\n'),\n\t\t\trich: {\n\t\t\t\tname: {fontSize: 10,lineHeight: 15,color: '#fff'}\n\t\t\t}\n\t\t},\n\t\titemStyle: {\n\t\t\tnormal: {color: '#03b7c9',}\n\t\t},\n\t\tdata: [{\n\t\t\tvalue: 0\n\t\t}]\n\t}\n    ]\n};\nif (!app.inNode) {\n    setTimeout(function() {\n        //readStorage();\n        initDraggableGraphic();\n        window.addEventListener('resize', updatePosition);\n        myChart.on('graphRoam', updatePosition);\n        myChart.on('dataZoom', updatePosition);\n        myChart.on('click', onLineClick);\n        myChart.dispatchAction({\n            type: 'dataZoom',\n            start: 20,\n            end: 30\n        });\n    }, 0);\n}\n\nfunction readStorage() {\n    let _topoStorage = localStorage.getItem('TOPO_POSITION');\n    if (_topoStorage) {\n        let _data = JSON.parse(_topoStorage);\n        _data.forEach(item => {\n            let _line = option.series[0].data.find(a => a.name == item.name);\n            if (_line) {\n                _line.x = item.x;\n                _line.y = item.y;\n            }\n        })\n    }\n}\n\nfunction initDraggableGraphic() {\n    myChart.setOption({\n        graphic: echarts.util.map(option.series[0].data, function(item, dataIndex) {\n            //使用图形元素组件在节点上划出一个隐形的图形覆盖住节点\n            var tmpPos = myChart.convertToPixel({\n                'seriesIndex': 0\n            }, [item.x, item.y]);\n            return {\n                type: 'circle',\n                id: dataIndex,\n                position: tmpPos,\n                shape: {\n                    cx: 0,\n                    cy: 0,\n                    r: 30\n                },\n                style: {\n                    text: '',\n                    fill: 'rgba(0,0,0,0)',\n                    font: '8px'\n                },\n                invisible: false,\n                draggable: true,\n                z: -100,\n                ondrag: echarts.util.curry(function(dataIndex) {\n                    onPointDragging(dataIndex, this)\n                }, dataIndex),\n                onclick: echarts.util.curry(function() {\n                    alert('该操作为下钻或弹出详细信息:' + option.series[0].data[dataIndex].name)\n                })\n            };\n        })\n    });\n}\n\nfunction updatePosition(p) {\n   \n    let zoom = myChart.getOption().series[0].zoom;\n     console.log(zoom)\n    if (zoom > 1.5) {\n        zoom = 1.50\n    } else if (zoom < 0.5) {\n        zoom = 0.5\n    }\n    option.series[0].zoom = zoom;\n    myChart.setOption(option)\n    myChart.setOption({\n        graphic: echarts.util.map(option.series[0].data, function(item, dataIndex) {\n            var tmpPos = myChart.convertToPixel({\n                'seriesIndex': 0\n            }, [item.x, item.y]);\n            return {\n                position: tmpPos\n            };\n        })\n    });\n}\n//拖拽中\nfunction onPointDragging(dataIndex, graphic) {\n    var tmpPos = myChart.convertFromPixel({\n        'seriesIndex': 0\n    }, graphic.position);\n    option.series[0].data[dataIndex].x = tmpPos[0];\n    option.series[0].data[dataIndex].y = tmpPos[1];\n    myChart.setOption(option);\n    updatePosition();\n    onSavePosition();\n}\n\nfunction onLineClick(param) {\n    if (param && param.data) {\n        let source = option.series[0].data[param.data.source];\n        let target = option.series[0].data[param.data.target];\n        alert(source.name + '>>>' + target.name);\n    }\n}\n\nfunction onSavePosition() {\n    clearTimeout(this.timerid);\n    this.timerid = setTimeout(function() {\n        localStorage.setItem('TOPO_POSITION', JSON.stringify(option.series[0].data));\n    }, 300)\n}\n\n\nkkk=1;\nintervalId = setInterval(function () {\n    kkk+=1;\n    option.series[0].data[0].name=kkk;\n     myChart.setOption(option);\n    console.log(kkk);\n},2000)","html":"","externalScripts":"","updaterUID":"bd-772114028","theme":"","layout":"","viewCount":373,"userName":"lenovolhl","commentCount":2,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xS1zti_0xX.png?v=1584899927132","isCustomThumbnail":0,"builtinTags":["category-work","graphic","series-gauge","series-graph","tooltip"],"customTags":[],"updaterUserName":"f***j"}}