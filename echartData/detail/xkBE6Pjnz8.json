{"status":0,"data":{"cid":"xkBE6Pjnz8","authorUid":"obd-o2TqhU5V49yi28tSjDqysoIw4zUTi6H","authorUserName":"m***h","title":"降序堆叠","description":"","latestVersion":1,"alwaysLatest":0,"createTime":"2021-05-11T02:11:01.000Z","lastUpdateTime":"2021-05-11T02:11:01.000Z","auth":2,"uid":"obd-o2TqhU5V49yi28tSjDqysoIw4zUTi6H","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.1.1","versionCreateTime":"2021-05-11T02:11:01.000Z","code":"// var getname = <#=GRID65.A2$#>;\r\r// var getvaluenum = <#=GRID65.C2$#>;\r\r// var getxlmc =<#=GRID65.C1$#>;\r\r\r\rvar getname = ['a','b','c','d','e'];\r\rvar getvaluenum = [10,20,30,48,10,40,50,60,10,20,70,80,90,10,65,100,110,120,45,88];\r\rvar getxlmc =['语文','数学','英语','物理','化学'];\r\rvar getxlmcnum=getvaluenum.length/getname.length;\r\r\r\rvar getvalue = [];\r\rfor (let i = 0; i < getxlmcnum; i++) {\r\r  getvalue[i] = [];\r\r  for (let j = 0; j < getname.length; j++) {\r\r        getvalue[i][j] = Number(getvaluenum[i*getname.length+j]);\r\r\r\r  }\r\r}\r\r\rvar color1 = ['#63B4FF', '#FFD19A', '#64F0BC', '#BDBCFF', '#FFA387','#63B4FF', '#FFD19A', '#64F0BC', '#BDBCFF', '#FFA387'];\r\rvar color2 = ['#1890FF', '#FFD283', '#47D095', '#9C9BFF', '#FF6388','#1890FF', '#FFD283', '#47D095', '#9C9BFF', '#FF6388'];\r\rvar getvaluesum=[];\r\rfor(var i=0;i<getname.length;i++){\r\r    getvaluesum[i] =0\r\r    for(var j=0;j<getxlmcnum;j++){\r\r    \tgetvaluesum[i] += getvalue[j][i];\r\r    }\r\r}\r\r\r\rvar tempSumArr = [...getvaluesum].sort((a,b)=>(b-a));\rconsole.log('getvaluesum',getvaluesum)\rconsole.log('tempSumArr',tempSumArr)\rvar indexList = []\rtempSumArr.map(item=>{\r    let startIndex = getvaluesum.indexOf(item)\r    while(indexList.indexOf(startIndex) > -1)\r    {\r        startIndex = getvaluesum.indexOf(item,startIndex + 1);\r    }\r    indexList.push(startIndex)\r})\r\rvar newSortXName = []\rvar newSortYValue = []\rconsole.log('indexList',indexList)\rindexList.map(item=>{\r    newSortXName.push(getname[item])\r})\rgetvalue.map((item,index)=>{\r    newSortYValue[index] = []\r    indexList.map(indexItem=>{\r        newSortYValue[index].push(item[indexItem])\r    })\r})\r\r\r\r\rvar maxnum = Math.max.apply(null, getvaluesum);\r\rvar maxlen = Math.pow(10, String(Math.ceil(maxnum)).length - 2);\r\rif (maxnum >= 5) {\r\r    var max = Math.ceil(maxnum / (.95 * maxlen)) * maxlen;\r\r} else {\r\r    var max = 5;\r\r}\r\r\r\rvar series = [];\r\rfor (var i = 0; i < getxlmc.length; i++) {\r\r    series.push({\r\r        name: getxlmc[i],\r\r        type: 'bar',\r\r        data: newSortYValue[i],\r\r        stack: '各专业本科生年级分布',\r\r        barWidth: '20px',\r\r        itemStyle: {\r\r            normal: {\r\r                color: {\r\r                    x: 0,\r\r                    y: 0,\r\r                    x2: 0,\r\r                    y2: 1,\r\r                    colorStops: [{\r\r                        offset: 0,\r\r                        color: color1[i] // 0% 处的颜色\r\r                    }, {\r\r                        offset: 1,\r\r                        color: color2[i] // 100% 处的颜色\r\r                    }],\r\r                },\r\r                barBorderRadius: [0, 0, 0, 0],\r\r                label: {\r\r                    show: false,\r\r                    position: 'top',\r\r                    textStyle: {\r\r                        fontSize: 12,\r\r                        color: '#666666',\r\r                    },\r\r                }\r\r            }\r\r        },\r\r    })\r\r}\r\r\r\roptiondqt = {\r\r    grid: {\r\r        top: '33',\r\r        right: '15',\r\r        left: '50',\r\r        bottom: '55'\r\r    },\r\r    tooltip: {\r\r        trigger: 'axis',\r\r        axisPointer: {\r\r            type: 'none'\r\r        },\r\r        backgroundColor: 'rgba(21, 64, 92, 0.9)',\r\r        formatter: function(params) {\r\r            var str = ''; //声明一个变量用来存储数据\r\r            str += '<div>' + params[0].name + '</div>';\r\r            for (var i = 0; i < getxlmcnum; i++) {\r\r                if (params[i]) {\r\r                    if (params[i].value > 0) {\r\r                        str += '<span style=\"color:rgba(0, 255, 252, 1);font:16px bold;\">' + params[i].seriesName + '</span>本科生人数&nbsp;&nbsp;<span style=\"color:rgba(0, 255, 252, 1);\">' + params[i].value + '人</span></br>';\r\r                    }\r\r                }\r\r            }\r\r            return str;\r\r        }\r\r    },\r\r    legend: {\r\r        type: \"scroll\",\r\r        right: '10',\r\r        top: '0',\r\r        data: getxlmc,\r\r        itemGap: 25,\r\r        itemWidth: 16,\r\r        itemHeight: 16,\r\r        textStyle: {\r\r            fontSize: '13',\r\r            color: '#666666',\r\r        },\r\r\r\r    },\r\r    xAxis: [{\r\r        data: newSortXName,\r\r        axisLabel: {\r\r            interval: 0,  \r\r            formatter: function(value) {\r\r                var ret = \"\"; //拼接加\\n返回的类目项  \r\r                var maxLength = 6; //每项显示文字个数  \r\r                var valLength = value.length; //X轴类目项的文字个数  \r\r                var rowN = Math.ceil(valLength / maxLength); //类目项需要换行的行数  \r\r                if (rowN > 1) //如果类目项的文字大于5,\r\r                {\r\r                    for (var i = 0; i < rowN; i++) {\r\r                        var temp = \"\"; //每次截取的字符串  \r\r                        var start = i * maxLength; //开始截取的位置  \r\r                        var end = start + maxLength; //结束截取的位置  \r\r                        //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  \r\r                        temp = value.substring(start, end) + \"\\n\";\r\r                        ret += temp; //凭借最终的字符串  \r\r                    }\r\r                    return ret;\r\r                } else {\r\r                    return value;\r\r                }\r\r            },\r\r            margin: 10,\r\r            color: '#666666',\r\r            textStyle: {\r\r                fontSize: 13,\r\r                fontWeight:400\r\r            },\r\r        },\r\r        axisLine: {\r\r            lineStyle: {\r\r                color: '#B0C5DB',\r\r            }\r\r        },\r\r        axisTick: {\r\r            show: false\r\r        },\r\r    }],\r\r    yAxis: [{\r\r        min: 0,\r\r        max: max, // 计算最大值\r\r        interval: max / 5, //  平均分为5份\r\r        splitNumber: 5,\r\r        name: '人',\r\r        nameTextStyle: {\r\r            color: '#999999',\r\r            fontSize: 13,\r\r            padding: [0, 0, 0, -40]\r\r        },\r\r        axisLabel: {\r\r            color: '#666666',\r\r            textStyle: {\r\r                fontSize: 13\r\r            },\r\r        },\r\r        axisLine: {\r\r            show: false\r\r        },\r\r        axisTick: {\r\r            show: false\r\r        },\r\r        splitLine: {\r\r            lineStyle: {\r\r                color: '#CCDBEB',\r\r                type: 'dashed',\r\r                opacity: 0.5\r\r            }\r\r        }\r\r    }],\r\r    series: series\r\r};\r\r\r\rvar series = optiondqt[\"series\"];\r\rvar fun = function(params) {\r\r    var datavalue = 0;\r\r    for (var i = 0; i < series.length; i++) {\r\r        datavalue += series[i].data[params.dataIndex]\r\r    }\r\r    return datavalue;\r\r}\r\r\r\rif (series[series.length - 1]) {\r\r   series[series.length - 1][\"itemStyle\"][\"normal\"][\"label\"][\"show\"] = true;\r\r   series[series.length - 1][\"itemStyle\"][\"normal\"][\"label\"][\"formatter\"] = fun;\r\r   series[series.length - 1][\"itemStyle\"][\"normal\"][\"barBorderRadius\"] = [3, 3, 0, 0];\r\r}\r\rmyChart.on(\"legendselectchanged\", function(object) {\r\r\r\r    var b = object.selected, //图例的选中情况，key是图例的name，value是true或false\r\r        d = []; //选中的series的index列表\r\r    for (var key in b) {\r\r        if (b[key]) { //选中的图例\r\r            for (var i = 0; i < series.length; i++) {\r\r                var changename = series[i][\"name\"];\r\r                if (changename == key) {\r\r                    d.push(i); //选中的series的index列表\r\r                }\r\r            }\r\r        }\r\r    }\r\r\r\r    var fn = function(params) {\r\r        var datavalue = 0;\r\r        for (var i = 0; i < d.length; i++) {\r\r            for (var j = 0; j < series.length; j++) {\r\r                if (d[i] == j) {\r\r                    datavalue += series[j].data[params.dataIndex];\r\r                }\r\r            }\r\r        }\r\r\r\r        return datavalue;\r\r    }\r\r\r\r    for (var j = 0; j < series.length; j++) {\r\r        series[j][\"itemStyle\"][\"normal\"][\"label\"][\"show\"] = false;\r\r        series[j][\"itemStyle\"][\"normal\"][\"barBorderRadius\"] = [0, 0, 0, 0];\r\r    }\r\r\r\r    var l_s = series[d[d.length - 1]]; //选中的series的最后一个\r\r    if (l_s != null && l_s != \"\" && l_s != undefined) {\r\r        l_s[\"itemStyle\"][\"normal\"][\"label\"][\"show\"] = true; //显示label\r\r        l_s[\"itemStyle\"][\"normal\"][\"label\"][\"formatter\"] = fn; //绑定formatter\r\r        l_s[\"itemStyle\"][\"normal\"][\"barBorderRadius\"] = [3, 3, 0, 0];\r\r    }\r\r    myChart.setOption(optiondqt)\r\r})\r\r\r\rreturn optiondqt; ","html":"","externalScripts":"","updaterUID":"obd-o2TqhU5V49yi28tSjDqysoIw4zUTi6H","theme":"","layout":"","viewCount":0,"userName":"m***h","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xkBE6Pjnz8.png?v=1620699061809","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","tooltip"],"customTags":[],"updaterUserName":"m***h"}}