{"status":0,"data":{"cid":"xBJXYSFtXm","authorUid":"bd-3724974333","authorUserName":"m***3","title":"上海地区送货","description":"data from Map","latestVersion":9,"alwaysLatest":1,"createTime":"2018-07-16T02:39:55.000Z","lastUpdateTime":"2018-07-16T02:39:55.000Z","auth":2,"uid":"bd-3724974333","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":9,"parentVersion":8,"echartsVersion":"4.1.0","versionCreateTime":"2018-07-16T06:28:06.000Z","code":"//var tianjin = \"/asset/get/s/data-1525844720391-Skugj-g0f.json\";\n//var uploadedDataURL = \"/asset/get/s/data-1520413844487-rknqhXp_f.json\";\nvar uploadedDataURL = \"/asset/get/s/data-1482909900836-H1BC_1WHg.json\";\n\n$.get(uploadedDataURL, function(shJson) {\n    echarts.registerMap('shanghai', shJson);\n    myChart.setOption({\n        series: [{\n            type: 'map',\n            map: 'shanghai'\n        }]\n    });\n\n    var geoCoordMap = {\n        '黄浦区': [121.490317, 31.222771],\n        '徐汇区': [121.43752, 31.179973],\n        '长宁区': [121.4222, 31.218123],\n        '静安区': [121.448224, 31.229003],\n        '普陀区': [121.392499, 31.241701],\n        '闸北区': [121.465689, 31.25318],\n        '虹口区': [121.491832, 31.26097],\n        '杨浦区': [121.522797, 31.270755],\n        '闵行区': [121.375972, 31.111658],\n        '宝山区': [121.489934, 31.398896],\n        '嘉定区': [121.250333, 31.383524],\n        '浦东新区': [121.7795171, 31.13357039],\n        '金山区': [121.330736, 30.724697],\n        '松江区': [121.223543, 31.03047],\n        '青浦区': [121.113021, 31.151209],\n        '奉贤区': [121.458472, 30.912345],\n        '崇明县': [121.397516, 31.626946],\n    };\n\n    var minSendNum = 0,\n        maxSendNum = 1000\n    var data = [{\n        name: '黄浦区',\n        value: 219\n    }, {\n        name: '徐汇区',\n        value: 339\n    }, {\n        name: '长宁区',\n        value: 412\n    }, {\n        name: '静安区',\n        value: 429\n    }, {\n        name: '普陀区',\n        value: 389\n    }, {\n        name: '闸北区',\n        value: 352\n    }, {\n        name: '虹口区',\n        value: 329\n    }, {\n        name: '杨浦区',\n        value: 532\n    }, {\n        name: '闵行区',\n        value: 299\n    }, {\n        name: '宝山区',\n        value: 139\n    }, {\n        name: '嘉定区',\n        value: 440\n    }, {\n        name: '浦东新区',\n        value: 89\n    }, {\n        name: '金山区',\n        value: 652\n    }, {\n        name: '松江区',\n        value: 415\n    }, {\n        name: '青浦区',\n        value: 329\n    }, {\n        name: '奉贤区',\n        value: 752\n    }, {\n        name: '崇明县',\n        value: 399\n    }, ]\n\n    function convertSend(area, id) {\n        var arr = []\n        data.map(item => {\n            if (item['name'] !== area) {\n                arr.push([{\n                    name: area\n                }, {\n                    id: id,\n                    name: item['name'],\n                    value: item['value']\n                }])\n            }\n        })\n        return arr\n    }\n\n    var goData = convertSend('浦东新区', 1)\n    var goData2 = [\n        [{\n            name: '浦东新区'\n        }, {\n            id: 1,\n            name: '徐汇区',\n            value: 75\n        }],\n        [{\n            name: '浦东新区'\n        }, {\n            id: 1,\n            name: '嘉定区',\n            value: 35\n        }],\n\n        //  [{name:'蓟县'}, {name:'宁河',value:95}],\n    ];\n\n    var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';\n    var arcAngle = function(data) {\n        var j, k;\n        for (var i = 0; i < data.length; i++) {\n            var dataItem = data[i];\n            if (dataItem[1].id == 1) {\n                j = 0.2;\n                return j;\n            } else if (dataItem[1].id == 2) {\n                k = -0.2;\n                return k;\n            }\n        }\n    }\n\n    var convertData = function(data) {\n        var res = [];\n        for (var i = 0; i < data.length; i++) {\n            var dataItem = data[i];\n            var fromCoord = geoCoordMap[dataItem[0].name];\n            var toCoord = geoCoordMap[dataItem[1].name];\n            if (dataItem[1].id == 1) {\n                if (fromCoord && toCoord) {\n                    res.push([{\n                        coord: fromCoord,\n                    }, {\n                        coord: toCoord,\n                        value: dataItem[1].value //线条颜色\n\n                    }]);\n                }\n            } else if (dataItem[1].id == 2) {\n                if (fromCoord && toCoord) {\n                    res.push([{\n                        coord: fromCoord,\n                    }, {\n                        coord: toCoord\n                    }]);\n                }\n            }\n        }\n        return res;\n    };\n\n    var series = [];\n    [\n        ['1', goData]\n    ].forEach(function(item, i) {\n        series.push({\n            name: item[0],\n            type: 'lines',\n            zlevel: 2,\n            //线特效配置\n            effect: {\n                show: true,\n                period: 6,\n                trailLength: 0.1,\n                symbol: planePath, //标记类型\n                symbolSize: 10\n            },\n            lineStyle: {\n                normal: {\n                    width: 1,\n                    opacity: 0.4,\n                    curveness: arcAngle(item[1]), //弧线角度\n                    color: '#fff'\n                }\n            },\n            data: convertData(item[1])\n        }, {\n            type: 'effectScatter',\n            coordinateSystem: 'geo',\n            zlevel: 2,\n            //波纹效果\n            rippleEffect: {\n                period: 2,\n                brushType: 'stroke',\n                scale: 3\n            },\n            label: {\n                normal: {\n                    show: true,\n                    position: 'bottom',\n                    formatter: '{b}'\n                }\n            },\n            //终点形象\n            symbol: 'circle',\n            //圆点大小\n            symbolSize: function(val) {\n                // return val[2] / 8;\n                return val[2] / 30;\n            },\n            itemStyle: {\n                normal: {\n                    show: true\n                }\n            },\n            data: item[1].map(function(dataItem) {\n                return {\n                    name: dataItem[1].name,\n                    value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])\n                };\n            })\n\n        });\n\n    });\n    \n    \n    \n    /**************************************************/\n    series.push({\n                type: 'map',\n                map: 'shanghai',\n                geoIndex: 0,\n                aspectScale: 0.75, //长宽比\n                showLegendSymbol: false, // 存在legend时显示\n                roam: true,\n                animation: false,\n                data: data\n            })\n/**************************************************/\n            \n            \n\n    option = {\n        backgroundColor: '#173b84',\n        textStyle: {\n            color: '#fff'\n        },\n        title: {\n            text: '上海送货',\n            subtext: '数据可更换，去掉头尾注释可直接应用到本地',\n            left: 'center'\n        },/*\n        tooltip: {\n            trigger: 'item',\n            formatter: \"{b}\"\n        },*/\n        tooltip: {\n            trigger: 'item',\n            backgroundColor: 'rgba(12, 204, 104, 0.92)',\n            borderColor: '#FFFFCC',\n            showDelay: 0,\n            hideDelay: 0,\n            enterable: true,\n            transitionDuration: 0,\n            extraCssText: 'z-index:100',\n            formatter: function(params, ticket, callback) {\n                //根据业务自己拓展要显示的内容\n                var res = \"\";\n                var name = params.name;\n                var value = params.value;\n                res = \"<span style='color:#fff;'>\" + name + \"</span><br/>数据：\" + value;\n                return res;\n            }\n        },\n        //线颜色及飞行轨道颜色\n        visualMap: [{\n            show: false,\n            min: minSendNum,\n            max: maxSendNum,\n            color: ['#ff3333', 'orange', 'yellow', 'lime', 'aqua'],\n        }, {\n            show: false,\n            min: minSendNum,\n            max: maxSendNum,\n            left: 'left',\n            top: 'bottom',\n            text: ['高', '低'], // 文本，默认为数值文本\n            calculable: true,\n            seriesIndex: [2],\n            dimension: 0,\n            inRange: {\n                color: ['#9074c3', '#4487d5', '#7e9e8e', '#51a2c2'] // 随机区域颜色\n\n            },\n            textStyle: {\n                color: '#fff'\n            }\n        }],\n        //地图相关设置\n        geo: {\n            map: 'shanghai',\n            //视角缩放比例\n            zoom: 1,\n            //鼠标缩放和平移\n            roam: true,\n            //显示文本样式\n            label: {\n                show: false\n            },\n            itemStyle: {\n                areaColor: '#4487d5',\n                borderColor: '#3B5077',\n                borderWidth: 1\n            },\n            emphasis: {\n                label: {\n                    show: false\n                },\n                itemStyle: {\n                    areaColor: '#2B91B7',\n                    borderWidth: 0\n                }\n            }\n        },\n        series: series\n    };\n    myChart.setOption(option);\n})\n// })","html":"","externalScripts":"","updaterUID":"bd-3724974333","theme":"","layout":"","viewCount":13151,"userName":"m***3","commentCount":2,"starCount":29,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xBJXYSFtXm.png?v=1531722486237","isCustomThumbnail":0,"builtinTags":["category-work","geo","series-effectScatter","series-lines","series-map","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"m***3"}}