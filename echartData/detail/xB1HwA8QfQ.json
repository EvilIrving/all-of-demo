{"status":0,"data":{"cid":"xB1HwA8QfQ","authorUid":"bd-3778831175","authorUserName":"m***i","title":"Image to Bar3D on Map","description":"Image to Bar3D on Map","latestVersion":3,"alwaysLatest":1,"createTime":"2018-06-29T07:23:08.000Z","lastUpdateTime":"2018-06-29T07:23:08.000Z","auth":2,"uid":"bd-3778831175","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.2.0","versionCreateTime":"2019-01-09T09:36:34.000Z","code":"        const minLng = 120.9337719797137;\r\n        const minLat = 30.85610622801201;\r\n        const maxLat = 31.452846278953274;\r\n        const maxLng = 121.69631352726838;\r\n        const scale = 400;\r\n\r\n        let averageLng = (maxLng - minLng) / 50;\r\n        let averageLat = (maxLat - minLat) / 50;\r\n\r\n\r\n        var img = new Image();\r\n        img.src = '/asset/get/s/data-1530256582420-BkApn87MX.png'\r\n        var canvas = document.createElement('canvas');\r\n        var ctx = canvas.getContext('2d');\r\n\r\n        img.onload = function() {\r\n            var width = canvas.width = img.width / 2;\r\n            var height = canvas.height = img.height / 2;\r\n            averageLng = (maxLng - minLng) / width;\r\n            averageLat = (maxLat - minLat) / height;\r\n            ctx.drawImage(img, 0, 0, width, height);\r\n            var imgData = ctx.getImageData(0, 0, width, height);\r\n\r\n            var data = [];\r\n            for (var i = 0; i < imgData.data.length / 4; i++) {\r\n                var r = imgData.data[i * 4];\r\n                var g = imgData.data[i * 4 + 1];\r\n                var b = imgData.data[i * 4 + 2];\r\n\r\n                var lum = 255 - (0.2125 * r + 0.7154 * g + 0.0721 * b);\r\n                lum = (lum - 125) / 20 + 50;\r\n                data.push([i % width, height - Math.floor(i / width), lum]);\r\n            }\r\n            var bardata = [];\r\n            for (let i = 0; i < data.length; i++) {\r\n                let d = data[i];\r\n                let x = d[0],\r\n                    y = d[1],\r\n                    z = d[2];\r\n                let lng = minLng + averageLng * x;\r\n                let lat = minLat + averageLat * y;\r\n                let height = z * scale;\r\n                bardata.push([lng, lat, height])\r\n            }\r\n\r\n            console.log(data)\r\n            initChart(imgData, bardata);\r\n        }\r\n\r\n\r\n        function initChart(imgData, data) {\r\n            let option = {\r\n                tooltip: {},\r\n                maptalks3D: {\r\n                    center: [121.4693, 31.123070],\r\n                    zoom: 10,\r\n                    pitch: 50,\r\n                    // bearing: -10,\r\n                    postEffect: {\r\n                        enable: true,\r\n                        FXAA: {\r\n                            enable: true\r\n                        }\r\n                    },\r\n                    light: {\r\n                        main: {\r\n                            shadow: true,\r\n                            intensity: 2\r\n                        },\r\n                        ambientCubemap: {\r\n                            texture: '/asset/get/s/data-1530248984324-SyeXJSmM7.hdr',\r\n                            exposure: 2,\r\n                            diffuseIntensity: 0.2,\r\n                            specularIntensity: 1\r\n                        }\r\n                    }\r\n                },\r\n                series: [{\r\n                    type: 'bar3D',\r\n                    shading: 'realistic',\r\n                    coordinateSystem: 'maptalks3D',\r\n                    barSize: 1,\r\n                    wireframe: {\r\n                        show: false\r\n                    },\r\n                    itemStyle: {\r\n                        color: function(params) {\r\n                            var i = params.dataIndex;\r\n                            var r = imgData.data[i * 4];\r\n                            var g = imgData.data[i * 4 + 1];\r\n                            var b = imgData.data[i * 4 + 2];\r\n                            return 'rgb(' + [r, g, b].join(',') + ')';\r\n                        }\r\n                    },\r\n                    data: data\r\n                }]\r\n            }\r\n            myChart.setOption(option)\r\n        }","html":"","externalScripts":"https://deyihu.github.io/src/lib/echarts-gl.1.1.3.js?tdsourcetag=s_pctim_aiomsg,https://cdn.jsdelivr.net/npm/maptalks@0.40.1/dist/maptalks.min.js","updaterUID":"bd-3778831175","theme":"","layout":"","viewCount":542,"userName":"m***i","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xB1HwA8QfQ.png?v=1530256989574","isCustomThumbnail":1,"builtinTags":["category-work","maptalks3D","series-bar3D","tooltip"],"customTags":[],"updaterUserName":"m***i"}}