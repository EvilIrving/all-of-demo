{"status":0,"data":{"cid":"xMp8P3kiyL","authorUid":"obd-olGfOrxetmWVSHvURGPmfWchxFQhp0D","authorUserName":"2***工","title":"按年月日折线图-滑动触发数据范围改变","description":"当dataZoom监听事件，更改数据","latestVersion":1,"alwaysLatest":0,"createTime":"2021-10-14T12:44:30.000Z","lastUpdateTime":"2021-10-14T12:44:30.000Z","auth":2,"uid":"obd-olGfOrxetmWVSHvURGPmfWchxFQhp0D","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2021-10-14T12:44:30.000Z","code":"var uploadedDataURL = '/asset/get/s/data-1634031839342-y15WlZvxx.csv';\n\nvar xdata = [];\nvar ydata = [];\nvar data = [];\nvar dataD = { xdata: {}, ydata: {} };\nvar dataM = { xdata: {}, ydata: {} };\nvar count = 0; //0==所有，1==月，2==日，\nvar expand = false;\n\ncsv();\nfunction csv() {\n  console.log('开始解析...');\n  Papa.parse(uploadedDataURL, {\n    download: true,\n    header: true,\n    complete: function (results) {\n      // console.log('Finished:', results);\n      data = results.data;\n      let tempD = 0;\n      let tempM = 0;\n      data.forEach((item, index) => {\n        let t = item['time'];\n        let d = t.split(' ')[0];\n        let m = d.split('/')[0] + '/' + d.split('/')[1];\n        let v = item['line1'];\n        xdata.push(t);\n        ydata.push(v);\n        if (tempD != d) {\n          tempD = d;\n          dataD['xdata'][d] = [];\n          dataD['ydata'][d] = [];\n        }\n        if (tempM != m) {\n          tempM = m;\n          dataM['xdata'][m] = [];\n          dataM['ydata'][m] = [];\n        }\n        //按照日统计\n        if (d == tempD) {\n          dataD['xdata'][d].push(t);\n          dataD['ydata'][d].push(v);\n        }\n        //按照月统计\n        if (m == tempM) {\n          dataM['xdata'][m].push(t);\n          dataM['ydata'][m].push(v);\n        }\n      });\n      console.log(dataM);\n      //异步数据加载。\n      myChart.hideLoading();\n      myChart.setOption(option);\n    },\n  });\n}\n//基于准备好的dom，初始化echarts实例\noption = {\n  title: {\n    show: true,\n    text: '按年月日折线图-滑动触发数据范围改变',\n    textStyle: {\n      align: 'center',\n      color: '#000',\n      fontSize: 20,\n    },\n    top: '5%',\n    left: 'center',\n  },\n  grid: {\n    top: '15%',\n    left: '5%',\n    right: '5%',\n    bottom: '5%',\n    containLabel: true,\n  },\n  tooltip: {\n    show: true,\n    trigger: 'axis',\n    // backgroundColor: 'transparent',\n    axisPointer: {\n      type: 'line',\n      lineStyle: {\n        type: 'dashed',\n      },\n    },\n  },\n  dataZoom: [\n    {\n      type: 'inside',\n      start: 0,\n      end: 100,\n    },\n  ],\n  toolbox: {\n    right: '5%',\n    feature: {\n      saveAsImage: {},\n      restore: {\n        formatter: function (params) {\n          console.log(params);\n        },\n      }, //还原\n      magicType: {\n        type: ['line', 'bar'],\n      }, //切换为折线图，切换为柱状图\n      dataView: {\n        readOnly: true,\n      }, //数据视图\n    },\n  },\n  xAxis: {\n    type: 'category',\n    name: '(时间)',\n    data: xdata,\n  },\n  yAxis: {\n    type: 'value',\n    name: '(量)',\n  },\n  series: {\n    data: ydata,\n    type: 'line',\n    smooth: true,\n    symbol: 'pin', //曲线点样式 'emptyCircle', circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\n    symbolSize: 12, //曲线点大小\n    label: {\n      //展示点的数值\n      show: true,\n      position: 'top',\n      textStyle: {\n        color: '#000',\n        fontSize: 14,\n      },\n    },\n  },\n};\nmyChart.on('datazoom', function (params) {\n  // \tconsole.log(params);//里面存有代表滑动条的起始的数字\n  let xAxisData = myChart.getModel().option.xAxis[0]; //获取axis\n  // 设定移动宽度 所有：100  日：50  时：10\n  let width = params.batch[0].end - params.batch[0].start;\n  let startIndex = xAxisData.rangeStart; //滑动条左端对应在xAxis.data的索引\n  let t = xAxisData.data.splice(startIndex, 1)[0];\n  let d = t.split(' ')[0];\n  let m = t.split('/')[0] + '/' + t.split('/')[1];\n  console.log(width);\n  if (width < 10) {\n    count = 2;\n  } else if (width < 50) {\n    count = 1;\n  } else {\n    count = 0;\n  }\n  let xAxis = count == 0 ? xdata : count == 1 ? dataM['xdata'][m] : dataD['xdata'][d];\n  let yAxis = count == 0 ? ydata : count == 1 ? dataM['ydata'][m] : dataD['ydata'][d];\n  let legend = count == 0 ? [''] : count == 1 ? [m] : [d];\n  let name = count == 0 ? '' : count == 1 ? m : d;\n  myChart.setOption({\n    legend: {\n      data: legend,\n      top: '10%',\n    },\n    xAxis: {\n      data: xAxis,\n    },\n    series: {\n      name: name,\n      data: yAxis,\n    },\n  });\n});\n","html":"","externalScripts":"https://cdn.jsdelivr.net/npm/papaparse/papaparse.min.js,https://code.jquery.com/jquery-3.1.1.min.js","updaterUID":"obd-olGfOrxetmWVSHvURGPmfWchxFQhp0D","theme":"","layout":"","viewCount":0,"userName":"2***工","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xMp8P3kiyL.png?v=1634215470177","isCustomThumbnail":0,"builtinTags":["category-work","dataZoom","grid","legend","series-line","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"2***工"}}