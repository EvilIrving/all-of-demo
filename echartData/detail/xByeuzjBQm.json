{"status":0,"data":{"cid":"xByeuzjBQm","authorUid":"bd-599414847","authorUserName":"A***M","title":"流向地图模板","description":"在echarts中套用bmap，细致到具体经纬度的流向图\n待共同解决 文字过长情况，数据过多文字覆盖情况","latestVersion":97,"alwaysLatest":1,"createTime":"2018-07-13T03:54:15.000Z","lastUpdateTime":"2018-07-13T03:54:15.000Z","auth":1,"uid":"bd-599414847","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":97,"parentVersion":96,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-07T06:41:32.000Z","code":"/**\r\n * 底部背景地图可通过bmap.mapStyle去调整\r\n * 飞机流向可调整\r\n * 线条颜色可调整 也可调控每一个线条颜色值\r\n * \r\n */\r\n\r\n// --------------可动态获取的外置参数------------------------——\r\nvar title = ''\r\nvar ZOOM = 12 //地图默认放大\r\nvar isEffect = true //是否要飞机动效\r\nvar lineWidth = 2 //线条宽度\r\nvar pointSymbolSize = 18 //中心店黑色小球大小\r\n//中心点\r\nvar point = [{\r\n    //\"name\": \"苏州市\",\r\n    \"value\": [\"116\", \"40\", 50007]\r\n}]\r\n//红色线条\r\nvar targetInPoint = [{\r\n    //\"name\": \"吴中区\",\r\n    \"value\": [\"119.01676596157351\", \"32.08866397987989\",\"96\"]\r\n}, {\r\n    //\"name\": \"姑苏区\",\r\n    \"value\": [\"120.625897\", \"31.342892\", \"96\"]\r\n}, {\r\n    //\"name\": \"太仓市\",\r\n    \"value\": [\"121.135272\", \"31.465661\", \"96\"]\r\n}, {\r\n    //\"name\": \"常熟市\",\r\n    \"value\": [\"120.765601\", \"31.664541\", \"96\"]\r\n}, {\r\n    //\"name\": \"张家港市\",\r\n    \"value\": [\"120.562656\", \"31.880165\", 10007]\r\n}]\r\n\r\n//蓝色线条\r\nvar targetOutPoint = [{\r\n    //\"name\": \"相城区\\n\\n\",\r\n    \"value\": [\"120.63\", \"31.37\", \"44\"]\r\n}, {\r\n    //\"name\": \"吴江区\",\r\n    \"value\": [\"120.63\", \"31.16\", \"37\"]\r\n}, {\r\n    //\"name\": \"工业园区\",\r\n    \"value\": [\"120.731969\", \"31.315254\", \"37\"]\r\n}, {\r\n    //\"name\": \"虎丘区\",\r\n    \"value\": [\"120.573928\", \"31.304053\", \"37\"]\r\n}, {\r\n    //\"name\": \"昆山市\",\r\n    \"value\": [\"120.994418\", \"31.389738\", \"37\"]\r\n}]\r\n\r\n//飞机路径\r\n//var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';\r\n\r\nvar planePath = 'https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2765496845,2902786914&fm=27&gp=0.jpg';\r\n// --------------可动态获取的外置参数/end------------------------——\r\n\r\n\r\nvar inPoint = []\r\nvar outPoint = []\r\ntargetInPoint.forEach((item, index) => {\r\n    targetInPoint[index]['tag'] = 'in'\r\n    inPoint.push({\r\n        name: point[0].name,\r\n        toname: item.name,\r\n        coords: [point[0].value.slice(0, 2), item.value.slice(0, 2)],\r\n    })\r\n})\r\ntargetOutPoint.forEach((item, index) => {\r\n    targetOutPoint[index]['tag'] = 'out'\r\n    outPoint.push({\r\n        name: point[0].name,\r\n        toname: item.name,\r\n        coords: [point[0].value.slice(0, 2), item.value.slice(0, 2)],\r\n    })\r\n})\r\nvar targetPoint = [...targetInPoint, ...targetOutPoint]\r\n\r\n\r\nfunction getSeries() {\r\n    var arr = [{\r\n            type: 'lines',\r\n            mapType: 'china',\r\n            coordinateSystem: 'bmap',\r\n            zlevel: 10,\r\n            //data: outPoint,\r\n            data: inPoint,\r\n            //线上面的动态特效\r\n            effect: {\r\n                show: isEffect,\r\n                period: 6,\r\n                trailLength: 0,\r\n                //symbol: planePath,\r\n                symbolSize: 15\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: lineWidth,\r\n                    color: '#ff3399',\r\n                    curveness: 0.2,\r\n                }\r\n            }\r\n        }, {\r\n            type: 'lines',\r\n            mapType: 'china',\r\n            coordinateSystem: 'bmap',\r\n            zlevel: 10,\r\n            //data: inPoint,\r\n            data: outPoint,\r\n            effect: {\r\n                show: isEffect,\r\n                period: 6,\r\n                trailLength: 0,\r\n                //symbol: planePath,\r\n                symbolSize: 15\r\n            },\r\n            lineStyle: {\r\n                normal: {\r\n                    width: lineWidth,\r\n                    color: '#ff0000',\r\n                    curveness: 0.3,\r\n                }\r\n            }\r\n        }, {\r\n            type: 'effectScatter',\r\n            mapType: 'china',\r\n            coordinateSystem: 'bmap',\r\n            zlevel: 10,\r\n            //symbolSize: 6,\r\n            symbolSize: function(value) {\r\n                var v = value && value[2] //可自动以更改\r\n                var size = parseInt(v) / 4\r\n                if (size >= 20) return 20\r\n                if (size <= 2) return 2\r\n                return size\r\n                // return 20\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    fontWeight: 300,\r\n                    position: 'right',\r\n                    formatter: ' {b}',\r\n                    textStyle: {\r\n                        fontFamily: '宋体', //字体样式可改\r\n                    },\r\n                    // color:function(value){\r\n                    //   console.log(value)\r\n                    // }\r\n                    // color:'yellow'\r\n                }\r\n            },\r\n            rippleEffect: {\r\n                period: 8,\r\n                scale: 2,\r\n                brushType: 'stroke',\r\n            },\r\n            showEffectOn: 'render',\r\n            itemStyle: {\r\n                normal: {\r\n                    textStyle: {\r\n                        fontWeight: 700,\r\n                        fontStyle: 'italic',\r\n                        fontSize: '17',\r\n                        fontFamily: 'cursive',\r\n                    },\r\n                    color: function(value) {\r\n                        switch (value.data.tag) {\r\n                            case 'in': //可调整颜色\r\n                                return '#00ff00'\r\n                                break;\r\n                            case 'out': //可调整颜色\r\n                                return '#6666cc'\r\n                                break;\r\n                            default:\r\n\r\n                        }\r\n                    },\r\n                }\r\n            },\r\n            //data: point,\r\n            data: targetPoint,\r\n            // data: convertData(houseData),\r\n        },\r\n        {\r\n            type: 'effectScatter',\r\n            mapType: 'china',\r\n            coordinateSystem: 'bmap',\r\n            zlevel: 10,\r\n            symbolSize: pointSymbolSize,\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'right',\r\n                    formatter: '{b}',\r\n                    textStyle: {\r\n                        fontWeight: 600,\r\n                        fontSize: '16',\r\n                        fontFamily: '宋体',\r\n                    },\r\n                }\r\n            },\r\n            showEffectOn: 'render',\r\n            rippleEffect: {\r\n                period: 8,\r\n                scale: 2,\r\n                brushType: 'stroke',\r\n            },\r\n\r\n            itemStyle: {\r\n                normal: {\r\n                    color: '#414957',\r\n                },\r\n                //shadowBlur: 10,\r\n            },\r\n            // data: convertData(schoolData),\r\n            data: point,\r\n            //data: targetPoint,\r\n        },\r\n    ]\r\n    return arr\r\n}\r\noption = {\r\n    title: {\r\n        text: title\r\n    },\r\n    bmap: {\r\n        center: point[0].value.slice(0, 2),\r\n        zoom: 12,\r\n        roam: true,\r\n        //地图样式的调整\r\n        mapStyle: {\r\n            styleJson: [{\r\n                    \"featureType\": \"all\",\r\n                    \"elementType\": \"all\",\r\n                    \"stylers\": {\r\n                        \"lightness\": 0,\r\n                        \"saturation\": 40\r\n                    }\r\n                },\r\n                {\r\n                    \"featureType\": \"highway\",\r\n                    \"elementType\": \"labels\",\r\n                    \"stylers\": {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                }, {\r\n                    \"featureType\": \"local\",\r\n                    \"elementType\": \"all\",\r\n                    \"stylers\": {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                }, {\r\n                    \"featureType\": \"poi\",\r\n                    \"elementType\": \"all\",\r\n                    \"stylers\": {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                }, {\r\n                    \"featureType\": \"arterial\",\r\n                    \"elementType\": \"labels\",\r\n                    \"stylers\": {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                }, {\r\n                    \"featureType\": \"label\",\r\n                    \"elementType\": \"all\",\r\n                    \"stylers\": {\r\n                        \"visibility\": \"on\"\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    // legend: {\r\n    //     orient: 'horizontal',\r\n    //     top: 10,\r\n    //     icon: 'circle',\r\n    //     itemWidth: 6,\r\n    //     itemHeight: 6,\r\n    //     itemGap: 6,\r\n    //     borderRadius: 6,\r\n    //     data: ['网外', '网内']\r\n    // },\r\n    series: getSeries()\r\n}\r\nsetTimeout(init, 0)\r\n\r\n\r\nfunction init() {\r\n    initMap();\r\n}\r\n\r\nfunction getMap() {\r\n    return myChart.getModel().getComponent('bmap').getBMap();\r\n}\r\n\r\nfunction initMap() {\r\n    //     BMAP_NAVIGATION_CONTROL_LARGE 表示显示完整的平移缩放控件。 \r\n    // BMAP_NAVIGATION_CONTROL_SMALL 表示显示小型的平移缩放控件。 \r\n    // BMAP_NAVIGATION_CONTROL_PAN 表示只显示控件的平移部分功能。 \r\n    // BMAP_NAVIGATION_CONTROL_ZOOM 表示只显示控件的缩放部分功能。\r\n    var top_right_navigation = new BMap.NavigationControl({\r\n        type: BMAP_NAVIGATION_CONTROL_LARGE,\r\n        anchor: BMAP_ANCHOR_TOP_RIGHT\r\n    });\r\n    var map = getMap();\r\n    map.addControl(top_right_navigation);\r\n    map.disableDoubleClickZoom();\r\n    \r\n        var mapStyle = {\r\n            features: [\"road\", \"building\", \"water\", \"land\"], //隐藏地图上的\"poi\",\r\n            style: \"dark\"\r\n        };\r\n        //map.setMapStyle({ styleJson:mapStyle});\r\n        map.setMapStyle(mapStyle);\r\n    return map;\r\n}","html":"","externalScripts":"http://api.map.baidu.com/api?v=2.0&ak=c9VzBGjpGifxq4HPKdyXHWxErdqpcI74,https://gallery.echartsjs.com/dep/echarts/latest/extension/bmap.min.js","updaterUID":"bd-4077273497","theme":"","layout":"","viewCount":3902,"userName":"A***M","commentCount":3,"starCount":8,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xByeuzjBQm.png?v=1531454056808","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":["bmap","echarts","lines"],"updaterUserName":"z***5"}}