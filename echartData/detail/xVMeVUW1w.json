{"status":0,"data":{"cid":"xVMeVUW1w","authorUid":"bd-2941039628","authorUserName":"o***兔","title":"原型用途","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2020-03-09T12:41:23.000Z","lastUpdateTime":"2020-03-09T12:41:23.000Z","auth":2,"uid":"bd-2941039628","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.4.0","versionCreateTime":"2020-03-09T12:41:23.000Z","code":"/*\n    【备注】\n        转载于x丝男爵，感谢提供资源\n        并在此基础修改保存\n    内容说明：\n    由于不知道是不是echart版本问题导致在这官网demo中不能拖拽，\n    但本地亲测可以，这里的代码也可以作为参考，欢迎改进\n    另博客地址：\n    https://blog.csdn.net/u012138137/article/details/89456199\n**/\nvar nodes = [{\n        x: '6',\n        y: '7',\n        name: '当前设备',\n        img: 'data-1547632686885-o5Rfi3tyk.png',\n    },\n    {\n        x: '3',\n        y: '9',\n        name: '设备A',\n        img: 'data-1547632686885-o5Rfi3tyk.png',\n    },\n    {\n        x: '3',\n        y: '5',\n        name: '设备B',\n        img: 'data-1547632686885-o5Rfi3tyk.png',\n    },\n    {\n        x: '9',\n        y: '9',\n        name: '设备C',\n        img: 'data-1547632686885-o5Rfi3tyk.png',\n    },\n    {\n        x: '9',\n        y: '5',\n        name: '设备D',\n        img: 'data-1547632686885-o5Rfi3tyk.png',\n    }\n]\nvar links = [{\n        source: '当前设备',\n        target: '设备B',\n        name: ''\n    },\n    {\n        source: '当前设备',\n        target: '设备A',\n        name: ''\n    },\n    {\n        source: '当前设备',\n        target: '设备C',\n        name: ''\n    },\n    {\n        source: '当前设备',\n        target: '设备D',\n        name: ''\n    }\n]\nvar charts = {\n    nodes: [],\n    links: [],\n    linesData: []\n}\nvar dataMap = new Map()\nfor (var j = 0; j < nodes.length; j++) {\n    var x = parseInt(nodes[j].x)\n    var y = parseInt(nodes[j].y)\n    var node = {\n        name: nodes[j].name,\n        value: [x, y],\n        symbolSize: 50,\n        alarm: nodes[j].alarm,\n        symbol: 'image:///asset/get/s/' + nodes[j].img,\n        itemStyle: {\n            normal: {\n                color: '#12b5d0',\n            }\n        }\n    }\n    dataMap.set(nodes[j].name, [x, y])\n    charts.nodes.push(node)\n}\nfor (var i = 0; i < links.length; i++) {\n    var link = {\n        source: links[i].source,\n        target: links[i].target,\n        label: {\n            normal: {\n                show: true,\n                formatter: links[i].name\n            }\n        },\n        lineStyle: {\n            normal: {\n                color: '#12b5d0'\n            }\n        }\n    }\n\n    charts.links.push(link)\n    // 组装动态移动的效果数据\n    var lines = [{\n        coord: dataMap.get(links[i].source)\n    }, {\n        coord: dataMap.get(links[i].target)\n    }]\n    charts.linesData.push(lines)\n}\noption = {\n\n    tooltip: {\n        trigger: 'item',\n        formatter: '{b}',\n    },\n    backgroundColor: \"#ffffff\",\n    xAxis: {\n        min: 0,\n        max: 12,\n        show: false,\n        type: 'value'\n    },\n    yAxis: {\n        min: 0,\n        max: 12,\n        show: false,\n        type: 'value'\n    },\n    series: [{\n        type: 'graph',\n        layout: 'none',\n        id: 'a',\n        coordinateSystem: 'cartesian2d',\n        edgeSymbol: ['', 'arrow'],\n        // symbolSize: 50,\n        label: {\n            normal: {\n                show: true,\n                position: 'bottom',\n                color: '#12b5d0'\n            }\n        },\n        lineStyle: {\n            normal: {\n                width: 2,\n                shadowColor: 'none'\n            }\n        },\n        xAxis: {\n            min: 0,\n            max: 12,\n            show: false,\n            type: 'value'\n        },\n        yAxis: {\n            min: 0,\n            max: 12,\n            show: false,\n            type: 'value'\n        },\n        // edgeSymbolSize: 8,\n        draggable: true,\n        data: charts.nodes,\n        links: charts.links,\n        z: 4,\n        itemStyle: {\n            normal: {\n                label: {\n                    show: true,\n                    formatter: function(item) {\n                        return item.data.name\n                    }\n                }\n            }\n        }\n    }, {\n        name: 'A',\n        type: 'lines',\n        coordinateSystem: 'cartesian2d',\n        z: 4,\n        effect: {\n            show: true,\n            trailLength: 0,\n            symbol: 'arrow',\n            color: '#12b5d0',\n            symbolSize: 8\n        },\n        lineStyle: {\n            normal: {\n                curveness: 0\n            }\n        },\n        data: charts.linesData,\n\n    }]\n};\nmyChart.setOption(option);\n\n\n\nmyChart.on('click', function(param) {\n    var nodeses = [{\n            x: '1',\n            y: '12',\n            name: 'DNS',\n            img: 'data-1547632686885-o5Rfi3tyk.png',\n        },\n        {\n            x: '1',\n            y: '3',\n            name: '爬虫数据',\n            img: 'data-1547632686885-o5Rfi3tyk.png',\n        }\n    ]\n    var linkses = [{\n            source: 'DNS',\n            target: '爬虫数据',\n            name: '访问'\n        }\n\n    ]\n    console.info(1)\n    var chartses = {\n        nodeses: [],\n        linkses: [],\n        linesDataes: []\n    }\n    var dataMapes = new Map()\n    for (var j = 0; j < nodeses.length; j++) {\n        var x = parseInt(nodeses[j].x)\n        var y = parseInt(nodeses[j].y)\n        var node = {\n            name: nodeses[j].name,\n            value: [x, y],\n            symbolSize: 50,\n            alarm: nodeses[j].alarm,\n            symbol: 'image:///asset/get/s/' + nodeses[j].img,\n            itemStyle: {\n                normal: {\n                    color: '#12b5d0',\n                }\n            }\n        }\n        dataMapes.set(nodeses[j].name, [x, y])\n        chartses.nodeses.push(node)\n    }\n    for (var i = 0; i < linkses.length; i++) {\n        var link = {\n            source: linkses[i].source,\n            target: linkses[i].target,\n            label: {\n                normal: {\n                    show: true,\n                    formatter: linkses[i].name\n                }\n            },\n            lineStyle: {\n                normal: {\n                    color: '#12b5d0'\n                }\n            }\n        }\n\n        chartses.linkses.push(link)\n        // 组装动态移动的效果数据\n        var linesess = [{\n            coord: dataMapes.get(linkses[i].source)\n        }, {\n            coord: dataMapes.get(linkses[i].target)\n        }]\n        chartses.linesDataes.push(linesess)\n    }\n    myChart.setOption({\n        notMerge: true,\n        series: [{\n            data: chartses.nodeses,\n            links: chartses.linkses,\n        }, {\n            data: chartses.linesDataes,\n        }],\n\n    })\n});\n\nmyChart.setOption({\n    graphic: echarts.util.map(charts.nodes, function(item, dataIndex) {\n        return {\n            type: 'circle',\n            position: myChart.convertToPixel('grid', item.value),\n            shape: {\n                cx: 5,\n                cy: 5,\n                r: 20\n            },\n            invisible: true,\n            draggable: true,\n            ondrag: echarts.util.curry(onPointDragging, dataIndex),\n            onmousemove: echarts.util.curry(showTooltip, dataIndex),\n            onmouseout: echarts.util.curry(hideTooltip, dataIndex),\n            z: 100\n        };\n    })\n});\n\nfunction onPointDragging(dataIndex, dx, dy) {\n    console.log(\"tempV-----\");\n    var tempV = myChart.convertFromPixel('grid', this.position);\n    console.log(\"tempV\", tempV);\n    charts.nodes[dataIndex].value = [tempV[0], tempV[1]];\n    // Update data\n    myChart.setOption({\n        series: [{\n            id: 'a',\n            data: charts.nodes\n        }]\n    });\n}\n\nfunction showTooltip(dataIndex) {\n    myChart.dispatchAction({\n        type: 'showTip',\n        seriesIndex: 0,\n        dataIndex: dataIndex\n    });\n}\n\nfunction hideTooltip(dataIndex) {\n    myChart.dispatchAction({\n        type: 'hideTip'\n    });\n}\n\nwindow.addEventListener('resize', function() {\n    myChart.resize();\n    myChart.setOption({\n        series: [{\n            id: 'a',\n            data: charts.nodes\n        }]\n    });\n});","html":"","externalScripts":"","updaterUID":"bd-2941039628","theme":"","layout":"","viewCount":1165,"userName":"o***兔","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xVMeVUW1w.png?v=1583757683365","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-graph","series-lines","tooltip"],"customTags":[],"updaterUserName":"o***兔"}}