{"status":0,"data":{"cid":"x7_2Y2UEJX","authorUid":"bd-3309622100","authorUserName":"xx_kavie","title":"力导向图—可折叠","description":"根据https://gallery.echartsjs.com/editor.html?c=xH1kUesyiG&v=1&tdsourcetag=s_pctim_aiomsg进行的修改","latestVersion":7,"alwaysLatest":1,"createTime":"2019-05-12T02:51:58.000Z","lastUpdateTime":"2019-05-12T02:51:58.000Z","auth":1,"uid":"bd-3309622100","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":7,"parentVersion":6,"echartsVersion":"4.2.1","versionCreateTime":"2019-05-17T01:52:51.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1557709659697-ZFG1DlAzV.json\";\r\nmyChart.showLoading();\r\n$.getJSON(uploadedDataURL, function(item) {\r\n    myChart.hideLoading();\r\n    var globalSeriesData = []; //用来存放被收起的某节点的子节点\r\n    var seriesData = item.nodes;\r\n    var seriesLinks = item.links;\r\n    var seriesCategories = item.categories;\r\n    \r\n    for (var node = 0; node < seriesData.length; node++) {\r\n        if (seriesData[node].name == \"淮阴工学院\") {\r\n            seriesData[node].fixed = \"true\";\r\n        }\r\n    }\r\n    for (var i = 0; i < seriesLinks.length; i++) {\r\n        if (!((seriesLinks[i].target).indexOf(\"淮阴工学院\") > -1 || (seriesLinks[i].source).indexOf(\"淮阴工学院\") > -1)) {\r\n            index = i;\r\n            seriesLinks.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    var option = {\r\n        title: {\r\n            text: 'title',\r\n            bottom: \"bottom\",\r\n            left: \"center\",\r\n            textStyle: {\r\n                color: '#ccc'\r\n            }\r\n        },\r\n        tooltip: {\r\n            formatter: '{b}'\r\n        },\r\n        toolbox: {\r\n            show: true,\r\n            feature: {\r\n                restore: {\r\n                    show: true\r\n                },\r\n                saveAsImage: {\r\n                    show: true\r\n                }\r\n            },\r\n            right: 15\r\n        },\r\n        //backgroundColor: '#000000',\r\n        animationDuration: 1000,\r\n        animationEasingUpdate: 'quinticInOut',\r\n        series: [{\r\n            //name: '', //用于tooltip的显示\r\n            type: 'graph',\r\n            layout: 'force',\r\n            animation: false,\r\n            symbolSize: 13,\r\n            force: {\r\n                initLayout: 'circular',\r\n                repulsion: 250,\r\n                gravity: 0.1,\r\n                edgeLength: 0.01,\r\n                layoutAnimation: true,\r\n            },\r\n            data: seriesData,\r\n            links: seriesLinks,\r\n            categories: seriesCategories,\r\n            roam: true,\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'top', //inside\r\n                    formatter: '{b}',\r\n                    fontSize: 15,\r\n                    fontStyle: '100',\r\n                }\r\n            },\r\n            height: 3,\r\n            lineStyle: {\r\n                normal: {\r\n                    width: 2,\r\n                    color: {\r\n                        type: 'linear',\r\n                        x: 0,\r\n                        y: 0,\r\n                        x2: 0,\r\n                        y2: 1,\r\n                        colorStops: [{\r\n                            offset: 0,\r\n                            color: 'white' // 0% 处的颜色red\r\n                        }, {\r\n                            offset: 1,\r\n                            color: 'black' // 100% 处的颜色blue\r\n                        }]\r\n                    },\r\n                    curveness: 0,\r\n                    type: \"solid\"\r\n                }\r\n            }\r\n        }]\r\n    };\r\n\r\n\r\n    myChart.setOption(option);\r\n\r\n\r\n    //点击隐藏节点实现,定义数组globalSeriesData用来存储被隐藏的节点的子节点\r\n    myChart.on('click', function(params) {\r\n\r\n        if (params.dataType === \"node\") {\r\n            var deletedFlag = false; // 标记点击的此节点是否存在子节点,若不存在则说明可能在上次的操作中已经删除,这时就需要尝试把之前删除的节点重新添加进去\r\n            for (var i = seriesData.length - 1; i >= 0; i--) {\r\n                if (seriesData[i].category == params.data.category) {\r\n                    console.log(seriesData[i])\r\n                    if (params.data.name != seriesData[i].name) { //排除删除根元素的可能\r\n                        deletedFlag = true;\r\n                        //for (var ii = seriesData.length - 1; ii >= 0; ii--) { //删除第一级节点的子节点\r\n                        //        if(seriesData[ii].category==seriesData[i].category){\r\n\r\n                        //        }\r\n                        //    }\r\n                        globalSeriesData.push(seriesData[i]);\r\n                        seriesData.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n            if (!deletedFlag) {\r\n                var nodeChildren = [];\r\n                console.log(globalSeriesData)\r\n                for (var n = globalSeriesData.length - 1; n >= 0; n--) {\r\n                    if (params.data.category == globalSeriesData[n].category) {\r\n                        seriesData.push(globalSeriesData[n]);\r\n                        nodeChildren.push(globalSeriesData[n]);\r\n                    }\r\n                }\r\n                if (nodeChildren.length > 0) {\r\n                    for (var s = 0; s < nodeChildren.length - 1; s++) {\r\n                        for (var n = globalSeriesData.length - 1; n >= 0; n--) {\r\n                            if (nodeChildren[s].category == globalSeriesData[n].category) {\r\n                                globalSeriesData.splice(n, 1);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            myChart.setOption(option);\r\n        }\r\n    });\r\n});","html":"","externalScripts":"","updaterUID":"bd-2486418486","theme":"","layout":"","viewCount":747,"userName":"xx_kavie","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/x7_2Y2UEJX.png?v=1558057971242","isCustomThumbnail":0,"builtinTags":["category-work","series-graph","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"timezi365"}}