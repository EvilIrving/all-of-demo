{"status":0,"data":{"cid":"xnyknPF1R","authorUid":"bd-3182588218","authorUserName":"飞***燕","title":"3D地球+扫描特效","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2019-11-01T03:47:22.000Z","lastUpdateTime":"2019-11-01T03:47:22.000Z","auth":2,"uid":"bd-3182588218","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.4.0","versionCreateTime":"2019-11-01T03:47:22.000Z","code":"var baseImg = \"/asset/get/s/data-1571295640429-3Co5rpLX.png\"; // 背景纹理贴图\n\n\nvar scanImg = \"/asset/get/s/data-1571295559348-whnsd6fi.jpg\"; // 扫描光影效果\n\nvar config = { // 扫描线条配置\n    lineWidth: 0.5, // 扫描线条宽度\n    color: '#00FFC2', // 线条颜色\n    levels: 1,\n    intensity: 3, // 强度\n    threshold: 0.01\n}\n\nvar canvas = document.createElement('canvas');\ncanvas.width = 4096;\ncanvas.height = 2048;\ncontext = canvas.getContext(\"2d\");\n\ncontext.lineWidth = config.lineWidth;\ncontext.strokeStyle = config.color;\ncontext.fillStyle = config.color;\ncontext.shadowColor = config.color;\n\nimage(scanImg).then(function(image) {\n    var m = image.height,\n        n = image.width,\n        values = new Array(n * m),\n        contours = d3.contours().size([n, m]).smooth(true),\n        projection = d3.geoIdentity().scale(canvas.width / n),\n        path = d3.geoPath(projection, context);\n\n    //   StackBlur.R(image, 5);\n\n    for (var j = 0, k = 0; j < m; ++j) {\n        for (var i = 0; i < n; ++i, ++k) {\n            values[k] = image.data[(k << 2)] / 255;\n        }\n    }\n\n    var opt = {\n        image: canvas\n    }\n\n    var results = [];\n\n    function update(threshold, levels) {\n        context.clearRect(0, 0, canvas.width, canvas.height);\n        var thresholds = [];\n        for (var i = 0; i < levels; i++) {\n            thresholds.push((threshold + 1 / levels * i) % 1);\n        }\n        results = contours.thresholds(thresholds)(values);\n        redraw();\n    }\n\n    function redraw() {\n        results.forEach(function(d, idx) {\n            context.beginPath();\n            path(d);\n            context.globalAlpha = 1;\n            context.stroke();\n            if (idx > config.levels / 5 * 3) {\n                context.globalAlpha = 0.01;\n                context.fill();\n            }\n        });\n        opt.onupdate();\n    }\n    d3.timer(function(t) {\n        var threshold = (t % 10000) / 10000;\n        update(threshold, 1);\n    });\n\n    initCharts(opt);\n\n    update(config.threshold, config.levels);\n\n});\n\nfunction image(url) {\n    return new Promise(function(resolve) {\n        var image = new Image();\n        image.src = url;\n        image.onload = function() {\n            var canvas = document.createElement(\"canvas\");\n            canvas.width = image.width / 8;\n            canvas.height = image.height / 8;\n            var context = canvas.getContext(\"2d\");\n            context.drawImage(image, 0, 0, canvas.width, canvas.height);\n            resolve(context.getImageData(0, 0, canvas.width, canvas.height));\n        };\n    });\n}\n\nfunction initCharts(opt) {\n    var contourChart = echarts.init(document.createElement('canvas'), null, {\n        width: 4096,\n        height: 2048\n    });\n\n    var img = new echarts.graphic.Image({\n        style: {\n            image: opt.image,\n            x: -1,\n            y: -1,\n            width: opt.image.width + 2,\n            height: opt.image.height + 2\n        }\n    });\n    contourChart.getZr().add(img);\n\n    opt.onupdate = function() {\n        img.dirty();\n    };\n\n    myChart.setOption({\n        backgroundColor: '#000',\n        globe: {\n            baseTexture: baseImg,\n            displacementScale: 0.05,\n            displacementQuality: 'high',\n            shading: 'realistic',\n            realisticMaterial: {\n                roughness: 0.2,\n                metalness: 0\n            },\n\n            postEffect: {\n                enable: true,\n                depthOfField: {\n                    // enable: true\n                }\n            },\n            light: {\n                ambient: {\n                    intensity: 1\n                },\n                main: { // 主光源\n                    intensity: 0,\n                    shadow: false\n                },\n                /*ambientCubemap: {\n                    texture: ROOT_PATH + 'data-gl/asset/lake.hdr',\n                    exposure: 1,\n                    diffuseIntensity: 0.5,\n                    specularIntensity: 2\n                }*/\n            },\n            viewControl: {\n                center: [0, 0, 0],\n                alpha: 30,\n                beta: 160,\n                autoRotate: true,\n                autoRotateAfterStill: 10,\n                distance: 240,\n                autoRotateSpeed: 4\n            },\n            layers: [{\n                type: 'blend',\n                blendTo: 'emission',\n                texture: contourChart,\n                intensity: config.intensity\n            }]\n        },\n        series: [{ // 点\n            type: 'scatter3D',\n            blendMode: 'lighter',\n            coordinateSystem: 'globe',\n            showEffectOn: 'render',\n            zlevel: 2,\n            effectType: 'ripple',\n            symbolSize: 15,\n            rippleEffect: {\n                period: 4,\n                scale: 4,\n                brushType: 'fill'\n            },\n\n            hoverAnimation: true,\n            itemStyle: {\n                normal: {\n                    color: 'rgba(235, 232, 6, 0.8)'\n                }\n            },\n            data: [\n                [51.511744, 25.292405],\n                [28.047305, -26.204103],\n                [30.5234, 50.450099],\n                [15.981919, 45.815008],\n                [19.940063, 50.100353],\n                [6.143158, 46.204389],\n                [8.541694, 47.376888],\n                [-8.629105, 41.157944],\n                [-9.139337, 38.722253],\n                [4.352033, 50.849644],\n                [24.940524, 60.170675],\n                [19.040235, 47.497913],\n                [16.373819, 48.208176],\n                [30.30604, 59.933177],\n                [37.61501, 55.75696],\n                [-79.383184, 43.653226]\n            ]\n        }]\n    });\n}","html":"","externalScripts":"/dep/echarts/latest/extension/bmap.min.js,https://a1115040996.github.io/MyHTML/echarts/js/echarts-gl.js,https://a1115040996.github.io/MyHTML/echarts/js/d3-geo.js,https://a1115040996.github.io/MyHTML/echarts/js/d3-timer.js,https://a1115040996.github.io/MyHTML/echarts/js/d3-contour.js","updaterUID":"bd-3182588218","theme":"","layout":"","viewCount":30240,"userName":"飞***燕","commentCount":33,"starCount":200,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xnyknPF1R.png?v=1572580042644","isCustomThumbnail":1,"builtinTags":["category-work","globe","series-scatter3D"],"customTags":[],"updaterUserName":"飞***燕"}}