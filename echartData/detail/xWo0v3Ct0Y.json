{"status":0,"data":{"cid":"xWo0v3Ct0Y","authorUid":"bd-365218436","authorUserName":"G***G","title":"叠加柱状图","description":"","latestVersion":4,"alwaysLatest":1,"createTime":"2020-06-03T08:50:41.000Z","lastUpdateTime":"2020-06-03T08:50:41.000Z","auth":2,"uid":"bd-365218436","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":4,"parentVersion":3,"echartsVersion":"4.8.0","versionCreateTime":"2020-06-04T03:02:09.000Z","code":"    let barColor = [\"#745ffd\", \"#338cf9\", \"#e0b932\", \"#e03532\"]\r\n\r\n  let oldData = [\r\n        {\r\n          clrDate: \"2020\",\r\n          amount: 371,\r\n          currencyType: \"计划\",\r\n          currencyCode: \"计划\"\r\n        },\r\n        {\r\n          clrDate: \"2020\",\r\n          amount: 324,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"预测\"\r\n        },\r\n        {\r\n          clrDate: \"2020\",\r\n          amount: 0,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"黄色\"\r\n        },\r\n        {\r\n          clrDate: \"2020\",\r\n          amount: 0,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"红色\"\r\n        },\r\n\r\n        {\r\n          clrDate: \"2021\",\r\n          amount: 385,\r\n          currencyType: \"计划\",\r\n          currencyCode: \"计划\"\r\n        },\r\n        {\r\n          clrDate: \"2021\",\r\n          amount: 346,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"预测\"\r\n        },\r\n        {\r\n          clrDate: \"2021\",\r\n          amount: 20,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"黄色\"\r\n        },\r\n        {\r\n          clrDate: \"2021\",\r\n          amount: 0,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"红色\"\r\n        },\r\n        {\r\n          clrDate: \"2022\",\r\n          amount: 392,\r\n          currencyType: \"计划\",\r\n          currencyCode: \"计划\"\r\n        },\r\n        {\r\n          clrDate: \"2022\",\r\n          amount: 332,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"预测\"\r\n        },\r\n        {\r\n          clrDate: \"2022\",\r\n          amount: 0,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"黄色\"\r\n        },\r\n        {\r\n          clrDate: \"2022\",\r\n          amount: 0,\r\n          currencyType: \"合并\",\r\n          currencyCode: \"红色\"\r\n        }\r\n      ];\r\n\r\n      let dateArr = [],\r\n        currentTypeArr = [],\r\n        currencyCodeArr = [],\r\n        seriesArr;\r\n\r\n      oldData.forEach(item => {\r\n        if (dateArr.indexOf(item.clrDate) < 0) {\r\n          dateArr.push(item.clrDate);\r\n        }\r\n        if (currentTypeArr.indexOf(item.currencyType) < 0) {\r\n          currentTypeArr.push(item.currencyType);\r\n        }\r\n        if (currencyCodeArr.indexOf(item.currencyCode) < 0) {\r\n          currencyCodeArr.push(item.currencyCode);\r\n        }\r\n      });\r\n\r\n      seriesArr = currencyCodeArr.map(currencyCode => {\r\n        return {\r\n          name: currencyCode,\r\n          stack: \"\",\r\n          type: \"bar\",\r\n          data: [],\r\n          itemStyle: {\r\n            color: \"#fff\"\r\n          }\r\n        };\r\n      });\r\n\r\n      for (var i = 0; i < seriesArr.length; i++) {\r\n        // stack 名字一样的会叠加\r\n        if (seriesArr[i].name == \"计划\") {\r\n          seriesArr[i].stack = \"计划\";\r\n        } else {\r\n          seriesArr[i].stack = \"合并\";\r\n        }\r\n\r\n        seriesArr[i].itemStyle[\"color\"] = barColor[i];\r\n        for (var j = 0; j < oldData.length; j++) {\r\n          for (var k = 0; k < dateArr.length; k++) {\r\n            if (\r\n              seriesArr[i].name == oldData[j].currencyCode &&\r\n              seriesArr[i].stack == oldData[j].currencyType &&\r\n              dateArr[k] == oldData[j].clrDate\r\n            ) {\r\n              seriesArr[i].data[k] = oldData[j].amount;\r\n            }\r\n          }\r\n        }\r\n      }\r\n     option = {\r\n        tooltip: {\r\n          trigger: \"axis\",\r\n          axisPointer: {\r\n            type: \"shadow\" // 默认为直线，可选为：'line' | 'shadow'\r\n          },\r\n          textStyle: {\r\n            rich: {}\r\n          },\r\n          formatter: function(params, ticket, callback) {\r\n            var htmlStr = \"\";\r\n            for (var i = 0; i < params.length; i++) {\r\n              if (\r\n                params[i].seriesName != \"黄色\" &&\r\n                params[i].seriesName != \"红色\"\r\n              ) {\r\n                var param = params[i];\r\n                var xName = param.name; //x轴的名称\r\n                var seriesName = param.seriesName; //图例名称\r\n\r\n                var value = param.value; //y轴值\r\n                if (seriesName == \"预测\") {\r\n                  value = value + 20;\r\n                }\r\n                var color = param.color; //图例颜色\r\n\r\n                // 预测显示\r\n                if (i === 0) {\r\n                  htmlStr += xName + \"<br/>\"; //x轴的名称\r\n                  htmlStr += \"<div>\";\r\n                  htmlStr += `<span style=\"display:inline-block;margin-right:5px;height:10px;width:10px;border-radius:3px;background:${color};\"></span>`;\r\n                  htmlStr += seriesName + \"：\" + value;\r\n                  htmlStr += \"</div>\";\r\n                } else {\r\n                  htmlStr += \"<div>\";\r\n                  htmlStr += `<span style=\"display:inline-block;margin-right:5px;height:10px;width:10px;border-radius:3px;background:${color};\"></span>`;\r\n                  htmlStr += seriesName + \"：\" + value;\r\n                  htmlStr += \"</div>\";\r\n                }\r\n              }\r\n            }\r\n            return htmlStr;\r\n          }\r\n        },\r\n        legend: {\r\n          type: \"scroll\",\r\n          data: [currencyCodeArr[0], currencyCodeArr[1]],\r\n          bottom: 0,\r\n          itemWidth: 14,\r\n          textStyle: {\r\n            color: \"#626262\",\r\n            fontSize: 14\r\n          }\r\n        },\r\n        grid: {\r\n          top: \"10%\",\r\n          bottom: \"20%\",\r\n          left: \"3%\",\r\n          right: \"4%\",\r\n          containLabel: true\r\n        },\r\n        xAxis: [\r\n          {\r\n            type: \"category\",\r\n            data: dateArr,\r\n            axisLabel: {\r\n              color: \"#626262\"\r\n            },\r\n            axisTick: {\r\n              show: false\r\n            },\r\n            axisLine: {\r\n              show: false\r\n            }\r\n          }\r\n        ],\r\n        yAxis: [\r\n          {\r\n            type: \"value\",\r\n            axisTick: {\r\n              show: false\r\n            },\r\n            axisLabel: {\r\n              color: \"#626262\"\r\n            },\r\n            axisLine: {\r\n              show: false\r\n            },\r\n            splitLine: {\r\n              show: true,\r\n              lineStyle: {\r\n                color: \"#333\",\r\n                type: \"dashed\"\r\n              }\r\n            }\r\n          }\r\n        ],\r\n        series: seriesArr\r\n      };","html":"","externalScripts":"","updaterUID":"bd-365218436","theme":"","layout":"","viewCount":61,"userName":"G***G","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xWo0v3Ct0Y.png?v=1591239729254","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","tooltip"],"customTags":[],"updaterUserName":"G***G"}}