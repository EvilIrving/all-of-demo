{"status":0,"data":{"cid":"xtITHPm6Co","authorUid":"obd-oNj2zvJFkuHMgFWUoXv43O1sHezoVCz","authorUserName":"t***e","title":"可拖拽的流程图/树形图","description":"以树形显示数据，并且可以拖拽","latestVersion":1,"alwaysLatest":0,"createTime":"2021-11-24T09:50:21.000Z","lastUpdateTime":"2021-11-24T09:50:21.000Z","auth":2,"uid":"obd-oNj2zvJFkuHMgFWUoXv43O1sHezoVCz","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.0.0","versionCreateTime":"2021-11-24T09:50:21.000Z","code":"//！！！echarts需要是5.0.0.版本以上\r\nconst symbol1 = \"image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABGFJREFUeF7tmkuojVEUgL8dGWBk4lUeRcoduVfKq0h5RilEGBiICQNKmGCChAETMlGIUIripjzK5ZY8RkSUR3lNlAED0da6Z/869/ef+++1/30e7jm77uSevdbe69tr773+vZahyZtpcvtpAWh5QJMTaG2BJneA1iFYty1gYTgw2nngBwNf6uGNNQFgYQKwAljmjBbDB6QM/g18cH9XgcsGXlcbStUAWBjpjF4MLAw0pBO47mB8CtTRp1h0AM7wTcBGYFSkSX8ETgEnDUQFEQ2AhcHAjsiGp/klIA4Z+BEDbhQAFqYAJ4BpMSbloeMhsNnAU4++1d0CFlYD54tOJFB+jYELgbI9YoU8wMJeYE+RCUSQ3WdK8whqwQAsTAceBI0aX2iGge4QtUEALIwD3oQMWEWZ8QbeavWrAVgYBFwD5msHq3L/m8BSAz8144QAaIR9X8lG9XmgAuCCnEcRAxzNYvn0lThhqiZY0gJo5NVPAKm8wBvAf7D6CQCVF2gAbAOO+Phhqs8q4BtwFGjzlH8GyHhyoEmcMcdTLum23ZTGy20aAPeAWbkae3eYa+Cu/MvCJOAc0JGj4zGw1sBLJyfG31GO22Vgto+MFwALkwFZFW1bYECup57m4oezwMwKiu4D68rvc1sCJgevtrUZeJ4n5Asg9PATaKvKJ+LOkjPAvNTkbgHr0ye4hYvAyjxDMn73Ogx9AUjIK6FvSMuCMAwQCPJYIk0ePcT4r+UDFDBe1HQbmJE3YV8A74Axecr6+D0LwhAHQcTE+O8RjRdV7w2MzZuzL4BfGW94ebrTv2dBGCidDIj+v63gyid6fhvo0d9XywXgXm8/5yny/P0fCGm5SMYnakfkvTb7AGgH5GqK1SpCiGy8zLfDwJOiHtD0ACSB0bxbQNzHlg6pdCJDuyUyXd/CwIY+BB2A6Neg0ytBjpzUDX8NRg2EyoxPIrwbLgRu2EBoJ3BA6/Pu+6FXKJxhfKL2toPQK/NT4GbYZeBg3pxzr0E3YUluvspTlvH7BgOnFUGOeJp8Cf593LSlT2Ht16AMOdEnueoFwEEQN9UmOWX1LyUAPFdT7m2B8MKNG/I12Glgkc+CaQBsAY75KE31mQsMlVQWsMRTXm6Mw5Q8IeRBZKuB4z5jaQBIuruRH0QTe6vzJObcMfRdwGcxYvXxegdIBvP2AAeg0b1AtfpikwrAf+AFqtUPBSCFEHIt1aoWwHdrSM2APMKqCifUHuC8QAoi+vzM9J11xH7tIQUTQQAchHoWRqS5BRdKBANooPNAve/L6RUC4CDUs1AiuDAi6BqstF9dwuNkDWsGJNmyKaQgIm1DYQ8oi/OlcGJ3jcrk9msLISotXjQAZSAkWGq+Qsk0YZcCWwMsD0iqJuq6gCtShqcpetBcrdE9IGtwl1yVNLnUFUmhdF6xtOzxiz7JTY2xWX1rAqAClOYply+6StWUr5sHVNMoje4WAA2t/ti35QH9cVU1NrU8QEOrP/b9AypRG1BNp5A8AAAAAElFTkSuQmCC\";\r\nconst symbol2= 'image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA+hJREFUeF7tWj1MFEEU/gatLDQY1GggGlutvEXjX+UPFloZMaImorKXaKOFUhmOUhptNLkFzBmMKCYWaIgUJsZg0LBrYvwp5ZATjHAabC7R6Jhd3eNYT2Zm7y0c2b3minnve+99897Mm9lhCPmPhTx+RAREGRByBqISCHkCRItgVAJzVgIv4ltRwevAeDVQUQ3Y/6j5a38UYBngVwacZcDQC814ORe+BZsBpt4A8D0A2w3ADljllwZYHxieIpa8q6KoIhsMAVZcB4cO8JiKM/+XZRYYDMSSBg3eNAotAeSBe8OlJ4KOgCH9MhguUs9QUTyGG4gZpyhs0RBg6V3gOEbhkDwGfwatfYe8fHHJ0gmw9DQ41pbqiE/9SWjGCp+6jlppBJj6BICqUhwoWZdhBDFjnV8c/wSYTQMA2+7XMKkewy3EjON+MP0RYOmd4Djpx2BgOhxtqDWaVfHVCXC2Op5UNTQn8ozFVXsFdQLMuEnX4FDTwixoSU0FVY2Acp59N2rFLFAjoKxnP8+AUhbIE2DFD4PzOyrpNY+yR6EZt2XsyxNgxq8B/IwMKLXMkeWbUbloCfqmXiP9PSsBz1PQ2hslBBUaIVMfBuC74ZBxpphMYs0BtKze7wylsoNoTKdkoDLQDPeuYVZ5uQww9U0ALBnLlDKFwdu4reMPkRh7IGfiJ9uGLclBkbAcAUN6AgwtIjDKcW/w975aqH+vcB3A0YpaIyHySY4As6kDYNLHT7tmX+VG8S43LrJfdLzk4B1U3gmt/bTIAUkC4o8AXicCs8ev1NTj3MpdjmjDcAe6vwzJqOVlaIK34Vg/tOQ+kXFJAvQ3ADaIwOzxC6v2oq36YF70RDqFm1lhKTrydME7cG+hGRtFPssSMAVgqQjMHe9Zr+NQ5fR1YNNIFzomB2ZVJw7etvUNmrFM5HMgBNhGvSSc/dCN6xNPAqz5f6BJCZAugUI3vCScH+3B1c+PZ3gawMy7+JQlIL8IeufBS0Lzx/to+9QfRM17TJMugmrboIiES2O9WMwq8h2eLa+8z4uKm3QbJGiEvJlQ6D998HYbQNoI0bTCxUgIJHibXdJW2AYkOgwVkhBY8ADxYcghgO44rFftRI7/QFf2ubCS/QkEcRwO/YXInywo4wtRN1fULkblOkEXO/SXomWfBWqzb4ejlgG2RjlngeKVuD8CHBLC/GnMXQ9C/XE0T0KYP4/nd4YwP5CYJiHET2RcEkL9SGpGo0T5PtB7EijnZ3KFvpK/F6QPPN84+zttSWqF9qlsMX5C+VhaMlHmU0z9LDCf3gZgOyIgAFIXFGSUAQtqugJwNsqAAEhdUJChz4Df9pWPUAdijpgAAAAASUVORK5CYII='\r\n\r\nvar data = [\r\n        { name: '1', value: { serviceId:'crux-gateway', type: 0,category:0,url:'/crux-appmodule/api/appmodule' },x:0,y:100, draggable: true,fixed:true,symbol: symbol2 }, \r\n        { name: '2', value: { serviceId:'crux-gateway1', type: 1,category:1,url:'/crux-appmodule/api/appmodule'},x:100,y:100, category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n        { name: '3', value: { serviceId:'crux-gateway2', type: 1,category:1,url:'/crux-appmodule/api/appmodule/2' }, x:200,y:100,category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n        { name: '4', value: { serviceId:'crux-gateway', type: 0,category:0,url:'/crux-appmodule/api/appmodule' },x:300,y:0, draggable: true,fixed:true,symbol: symbol2 }, \r\n        { name: '5', value: { serviceId:'crux-gateway1', type: 1,category:1,url:'/crux-appmodule/api/appmodule'},x:300,y:100, category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n        { name: '6', value: { serviceId:'crux-gateway2', type: 1,category:1,url:'/crux-appmodule/api/appmodule/2' },x:300,y:200, category: 1, draggable: true,fixed:true,symbol: symbol1 }, \r\n     ]\r\nconst positions = {};\r\nvar zoomStart = false;\r\nvar zoomInfo = {\r\n  zoom:1,\r\n  dx:0,\r\n  dy:0\r\n}\r\n // tooltip\r\nconst tooltip = {\r\n    trigger: 'item',\r\n    textStyle: { fontSize: '100%'},\r\n    formatter: params => {\r\n            return `\r\n                <div>\r\n                    <div>serviceId：${params.value.serviceId}</div>\r\n                    <div>url：${params.value.url}</div>\r\n                </div>\r\n            `\r\n    }\r\n}\r\n\r\nconst legend = {\r\n    show: true,\r\n    // bottom: '5%',\r\n    // right: '2%',\r\n    // textStyle: { color: '#fff' },\r\n    itemWidth: 20,\r\n    itemHeight: 20,\r\n    // orient: 'vertical',\r\n    data: [\r\n        { name: '成功', icon: symbol2 },\r\n        { name: '失败', icon: symbol1 },\r\n    ]\r\n}\r\nconst series = {\r\n    type: 'graph',\r\n    roam:true,\r\n     nodeScaleRatio:0,\r\n    scaleLimit:{\r\n      min:0.5,\r\n      max:3\r\n    },\r\n    symbolSize: 40,\r\n    categories: [ { name: \"成功\" }, { name: \"失败\" }],\r\n    label: { \r\n        show: true,\r\n        position:[-20,40],\r\n        align: 'center',\r\n        textStyle: { fontSize: 12, color: '#fff' },\r\n        // \"backgroundColor\": \"#F4F4F4\",\r\n        \"borderRadius\": [\r\n          0,\r\n          0,\r\n          5,\r\n          5\r\n        ], \r\n        curveness:true,\r\n        formatter: params => {\r\n            return `{label${params.value.type}|serviceId：}{value|${params.value.serviceId}}\\n{label${params.value.type}|url：}{value|${params.value.url}}`\r\n        },\r\n        rich: {\r\n              \"label0\": {\r\n                \"backgroundColor\": \"#00cc66\",\r\n                \"color\": \"#fff\",\r\n                \"width\": 60,\r\n                \"height\": 30,\r\n                \"padding\": [\r\n                  0,\r\n                  5,\r\n                  0,\r\n                  10\r\n                ],\r\n                \"align\":'left'\r\n              },\r\n              \"label1\": {\r\n                \"backgroundColor\": \"#ff0000\",\r\n                \"color\": \"#fff\",\r\n                \"width\": 60,\r\n                \"height\": 30,\r\n                \"padding\": [\r\n                  0,\r\n                  5,\r\n                  0,\r\n                  10\r\n                ],\r\n                \"align\":'left'\r\n              },\r\n              \"value\": {\r\n                \"color\": \"#888\",\r\n                \"align\": \"center\",\r\n                \"lineHeight\": 17,\r\n                \"height\": 30,\r\n                \"borderColor\": \"#eee\",\r\n                \"borderWidth\": 1,\r\n                \"padding\": [\r\n                  0,\r\n                  5,\r\n                  0,\r\n                  5\r\n                ]\r\n              }\r\n        }\r\n    },\r\n    labelLayout: function(param){\r\n        positions[param.dataIndex] = param.rect;\r\n        return {\r\n            moveOverlap:true,\r\n            hideOverlap:true\r\n        }\r\n    },\r\n    edgeSymbol: ['none', 'arrow'],\r\n    edgeSymbolSize: [4, 8],\r\n    data: data,\r\n    links: [\r\n        { source: 0, target: 1, value: '',ignoreForceLayout:true }, \r\n        { source: 1, target: 2, value: '', }, \r\n        { source: 2, target: 3, value: '', }, \r\n        { source: 2, target: 4, value: '', }, \r\n        { source: 2, target: 5, value: '', }, \r\n    ],\r\n    lineStyle: {\r\n        opacity: 0.9,\r\n        width: 2,\r\n        color: '#333'\r\n    }\r\n}\r\n\r\noption = { tooltip, series, legend }\r\nfunction getGraphicInfo(posMap){\r\n    return Object.keys(posMap).map(function (dataIndex) {\r\n      var item = posMap[dataIndex]\r\n      var system = myChart.getModel().getSeriesByIndex(0).coordinateSystem\r\n      var seriesZoom = system.getZoom();\r\n      var position = myChart.convertToPixel('series',[data[dataIndex].x,data[dataIndex].y])\r\n      return {\r\n        type: 'rect',\r\n        position:[-20,40],\r\n        shape: {\r\n          height:item.height,\r\n          width:item.width\r\n        },\r\n        x:position[0] - 40/2,\r\n        y:position[1] - 40/2,\r\n        scaleX:zoomInfo.zoom,\r\n        scaleY:zoomInfo.zoom,\r\n        // color:'#fff',\r\n        invisible: true,\r\n        draggable: true,\r\n        ondrag: function (dx, dy) {\r\n          onPointDragging(dataIndex, [this.x+20, this.y+20]);\r\n        },\r\n        onmousemove: function () {\r\n          showTooltip(dataIndex);\r\n        },\r\n        onmouseout: function () {\r\n          hideTooltip(dataIndex);\r\n        },\r\n        z: 100\r\n      };\r\n    })\r\n}\r\nsetTimeout(function() {\r\n  myChart.setOption({\r\n    graphic:getGraphicInfo(positions)\r\n  });\r\n}, 10);\r\nwindow.addEventListener('resize', updatePosition);\r\nmyChart.on('graphRoam', (e)=>{\r\n  var isZooming = e.hasOwnProperty('zoom')\r\n  if(isZooming){\r\n    zoomInfo.zoom = e.zoom\r\n    zoomInfo.originX= e.originX\r\n    zoomInfo.originY = e.originY\r\n  }else{\r\n    zoomInfo.dy = e.dy\r\n    zoomInfo.dx = e.dx\r\n  }\r\n  zoomStart = true\r\n});\r\nmyChart.on('finished', ()=>{\r\n  if(zoomStart){\r\n    zoomStart = false\r\n    updatePosition(true)\r\n  }\r\n});\r\nfunction updatePosition(isZoom) {\r\n    setTimeout(function() {\r\n      myChart.setOption({\r\n        graphic:getGraphicInfo(positions)\r\n      });\r\n  }, 10);\r\n}\r\nfunction showTooltip(dataIndex) {\r\n  myChart.dispatchAction({\r\n    type: 'showTip',\r\n    seriesIndex: 0,\r\n    dataIndex: dataIndex\r\n  });\r\n}\r\nfunction hideTooltip(dataIndex) {\r\n  myChart.dispatchAction({\r\n    type: 'hideTip'\r\n  });\r\n}\r\nfunction onPointDragging(dataIndex, pos) {\r\n  var position = myChart.convertFromPixel({seriesIndex:0}, pos);\r\n  option.series.data[dataIndex].x = position[0]\r\n  option.series.data[dataIndex].y = position[1]\r\n  myChart.setOption(option)\r\n  updatePosition()\r\n}","html":"","externalScripts":"","updaterUID":"obd-oNj2zvJFkuHMgFWUoXv43O1sHezoVCz","theme":"","layout":"","viewCount":0,"userName":"t***e","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xtITHPm6Co.png?v=1637747422017","isCustomThumbnail":0,"builtinTags":["category-work","graphic","legend","series-graph","tooltip"],"customTags":[],"updaterUserName":"t***e"}}