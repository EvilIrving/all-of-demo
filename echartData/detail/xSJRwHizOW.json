{"status":0,"data":{"cid":"xSJRwHizOW","authorUid":"bd-4013131402","authorUserName":"o***4","title":"散点图像素画","description":"","latestVersion":5,"alwaysLatest":1,"createTime":"2017-08-17T05:11:01.000Z","lastUpdateTime":"2017-08-17T05:11:01.000Z","auth":2,"uid":"bd-4013131402","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":5,"parentVersion":4,"echartsVersion":"3.6.2","versionCreateTime":"2017-08-21T09:18:44.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1503306613861-ByR_mXudZ.png\";\n\nxDotCnt = 32;\nyDotCnt = 32;\n\noption = {\n    grid: {\n        width: 400,\n        height: 400,\n        left: 200\n    },\n    xAxis: {\n        min: 0,\n        max: xDotCnt - 1,\n        type: 'value',\n        show: false\n    },\n    yAxis: {\n        min: 0,\n        max: yDotCnt - 1,\n        type: 'value',\n        inverse: true,\n        show: false\n    },\n    series: [],\n    title: {\n        text: '散点图像素画'\n    },\n    animationDuration: function(id) {\n        return (id * 2 + Math.random() * 100 + 3) * 5;\n    },\n    animationDelay: function(id) {\n        return (Math.random() * 1000) * 5;\n    }\n};\n\ngetPixels(uploadedDataURL, setOption);\n\n\nvar btn = document.createElement('button');\nbtn.style.position = 'absolute';\nbtn.style.top = '50px';\nbtn.style.marginLeft = '10px';\nbtn.innerHTML = '上传图片';\nbtn.setAttribute('onclick', 'upload()');\ndocument.body.appendChild(btn);\n\nvar file = document.createElement('input');\nfile.style.display = 'none';\nfile.setAttribute('type', 'file');\nfile.setAttribute('onchange', 'imageSelected(this.files)');\n\nwindow.upload = function () {\n    file.click();\n};\n\nwindow.imageSelected = function (files) {\n    if (files && files.length > 0) {\n        var reader = new FileReader();\n        reader.onload = function(e) { \n            getPixels(e.target.result, setOption);\n        };\n        reader.readAsDataURL(files[0]); \n    }\n};\n\n\nfunction setOption(pixels) {\n    var series = {\n        type: 'scatter',\n        symbol: 'circle',\n        symbolSize: [12, 12],\n        data: []\n    };\n    \n    for (var i = 0, x = 0, y = 0, len = pixels.length; i < len; ++i) {\n        if (pixels[i] && pixels[i] !== '-') {\n            series.data.push({\n                value: [y, x],\n                itemStyle: {\n                    normal: {\n                        color: pixels[i]\n                    }\n                }\n            });\n        }\n        \n        ++x;\n        if (x === xDotCnt) {\n            // Next line\n            ++y;\n            x = 0;\n        }\n    }\n    \n    option.series = series;\n    \n    myChart.setOption(option, true);\n}\n\n\nfunction getPixels(url, cb) {\n    var canvasRatio = 1;\n    var canvas = document.createElement('canvas');\n    canvas.width = xDotCnt * canvasRatio;\n    canvas.height = yDotCnt * canvasRatio;\n    var ctx = canvas.getContext('2d');\n    \n    var img = new Image();\n    img.onload = function () {\n        var x = 0;\n        var y = 0;\n        var width = canvas.width;\n        var height = canvas.height;\n        \n        if (img.width > img.height) {\n            y = (img.width - img.height) / 2 \n                / img.width * canvas.width;\n            height = img.height / img.width * canvas.width;\n        }\n        else if (img.width < img.height) {\n            x = (img.height - img.width) / 2\n                / img.height * canvas.height;\n            width = img.width / img.height * canvas.height;\n        }\n        ctx.drawImage(img, x, y, width, height);\n        \n        var pixels = [];\n        for (var x = 0; x < xDotCnt; ++x) {\n            for (var y = 0; y < yDotCnt; ++y) {\n                var data = ctx.getImageData(\n                    x * canvasRatio, y * canvasRatio, 1, 1\n                ).data;\n                pixels.push(getHex(data[0], data[1], data[2], data[3]));\n            }\n        }\n        \n        if (typeof cb === 'function') {\n            cb(pixels);\n        }\n    };\n    img.src = url;\n}\n\n\nfunction getHex(r, g, b, a) {\n    if (a === 0) {\n        return '-';\n    }\n    else {\n        var color = [r, g, b];\n        var hex = '#';\n        for (var c = 0; c < color.length; ++c) {\n            var d = color[c].toString(16);\n            if (d.length < 2) {\n                d = '0' + d;\n            }\n            hex += d;\n        }\n        return hex;\n    }\n}\n","html":"","externalScripts":"","updaterUID":"bd-4013131402","theme":"","layout":"","viewCount":305,"userName":"o***4","commentCount":1,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSJRwHizOW.png?v=1503307124470","isCustomThumbnail":0,"builtinTags":["category-work","grid","series-scatter","title"],"customTags":[],"updaterUserName":"o***4"}}