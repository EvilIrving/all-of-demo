{"status":0,"data":{"cid":"xxKaLrsujb","authorUid":"bd-3490920103","authorUserName":"a***4","title":"柱状覆盖图","description":"楼层多个工单完成情况","latestVersion":9,"alwaysLatest":1,"createTime":"2020-10-27T02:34:09.000Z","lastUpdateTime":"2020-10-27T02:34:09.000Z","auth":2,"uid":"bd-3490920103","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":9,"parentVersion":8,"echartsVersion":"4.8.0","versionCreateTime":"2020-11-11T14:25:46.000Z","code":"const arr = [{\r\n        \"product_code\": \"HW1624\",\r\n        \"line_name\": \"1F02\",\r\n        \"wancheng\": 1050,\r\n        \"jihua\": 2800,\r\n        \"bili\": 0.38,\r\n    },\r\n    {\r\n        \"product_code\": \"HW1626\",\r\n        \"line_name\": \"1F02\",\r\n        \"wancheng\": 2473,\r\n        \"jihua\": 25000,\r\n        \"bili\": 0.1,\r\n    },\r\n    {\r\n        \"product_code\": \"HW5626\",\r\n        \"line_name\": \"1F02\",\r\n        \"wancheng\": 2473,\r\n        \"jihua\": 25000,\r\n        \"bili\": 0.1,\r\n    },\r\n    {\r\n        \"product_code\": \"HW1524\",\r\n        \"line_name\": \"1F023\",\r\n        \"wancheng\": 2473,\r\n        \"jihua\": 25000,\r\n        \"bili\": 0.1,\r\n    },\r\n    {\r\n        \"product_code\": \"HW3524\",\r\n        \"line_name\": \"1F023\",\r\n        \"wancheng\": 2473,\r\n        \"jihua\": 25000,\r\n        \"bili\": 0.1,\r\n    },\r\n   \r\n]\r\n\r\nconst ds = dailyoutQueue(arr); //首先队列组合相同的数据\r\nconst maxLength = Math.max.apply(null, ds.map(item => item.ids.length)); \r\nlet titlearr=[];\r\nvar datass=[];\r\nfor(var i=0;i<maxLength;i++){\r\n    titlearr.push('计划',\"产出\");\r\n    \r\n}\r\n\r\nlet bs=[];\r\nfor (var j =0; j<titlearr.length; j++) {\r\n         let c=[];\r\n         ds.forEach((item, ins) => {\r\n             let name=\"\";\r\n             let val=\"\";\r\n             let lx=\"\";\r\n             item.ids.forEach((ite,index)=>{\r\n                   if(titlearr[j]=='计划' && ite.line_name==item.line_name){\r\n                       name=ite.product_code;\r\n                       val=300;\r\n                       lx=item.line_name\r\n                   }else if(titlearr[j]=='产出'&& ite.line_name==item.line_name){\r\n                       name=ite.product_code\r\n                       val=100;\r\n                        lx=item.line_name\r\n                   }else{\r\n                        name=ite.product_code;\r\n                        val=0\r\n                   }\r\n                 \r\n             })\r\n             c.push({\r\n                 name:name,\r\n                 lx:lx,\r\n                 title:titlearr[j],\r\n                 value:val\r\n             })\r\n         });\r\n         \r\n       bs.push(c)  \r\n    \r\n}\r\n\r\nalert(JSON.stringify(bs));\r\nvar datass=[\r\n    [{\"name\":\"HW1624\",\"lx\":\"1F02\",\"title\":\"计划\",\"value\":300},{\"name\":\"HW3524\",\"lx\":\"1F023\",\"title\":\"计划\",\"value\":300}],\r\n    [{\"name\":\"HW1624\",\"lx\":\"1F02\",\"title\":\"产出\",\"value\":100},{\"name\":\"HW3524\",\"lx\":\"1F023\",\"title\":\"产出\",\"value\":100}],\r\n    [{\"name\":\"HW1626\",\"lx\":\"1F02\",\"title\":\"计划\",\"value\":300},{\"name\":\"HW3524\",\"lx\":\"1F023\",\"title\":\"计划\",\"value\":0}],\r\n    [{\"name\":\"HW1626\",\"lx\":\"1F02\",\"title\":\"产出\",\"value\":100},{\"name\":\"HW3524\",\"lx\":\"1F023\",\"title\":\"产出\",\"value\":0}],\r\n    [{\"name\":\"HW5626\",\"lx\":\"1F02\",\"title\":\"计划\",\"value\":300},{\"name\":\"HW3524\",\"lx\":\"1F023\",\"title\":\"计划\",\"value\":0}],\r\n    [{\"name\":\"HW5626\",\"lx\":\"1F02\",\"title\":\"产出\",\"value\":100},{\"name\":\"HW3524\",\"lx\":\"1F023\",\"title\":\"产出\",\"value\":0}]\r\n]\r\n// var datass=[\r\n//         [{name:'t1',title:\"计划\",value:100},{name:'t2',title:\"计划\",value:100},{name:'t3',title:\"计划\",value:100}],\r\n//         [{name:'t1',title:\"产出\",value:10}, {name:'t2',title:\"产出\",value:30},{name:'t3',title:\"产出\",value:50}],\r\n//         [{name:'t4',title:\"计划\",value:70}, {name:'t5',title:\"计划\",value:90},{name:'t6',title:\"计划\",value:80}],\r\n//         [{name:'t4',title:\"产出\",value:60}, {name:'t5',title:\"产出\",value:60},{name:'t6',title:\"产出\",value:60}],\r\n//         [{name:'t7',title:\"计划\",value:70}, {name:'t8',title:\"计划\",value:90},{name:'t9',title:\"计划\",value:80}],\r\n//         [{name:'t7',title:\"产出\",value:60}, {name:'t8',title:\"产出\",value:60},{name:'t9',title:\"产出\",value:60}],\r\n//     ];\r\n\r\n    var  objs=[];\r\n    for(var i=0;i<titlearr.length;i++){\r\n   \r\n            objs.push({\r\n            name: titlearr[i],\r\n            type: 'bar',\r\n            xAxisIndex: titlearr[i]=='计划' ? 1:0,\r\n            itemStyle: {\r\n                normal: {\r\n                    color: titlearr[i]=='计划'?'#b25d25':\"#000\",\r\n\r\n                },\r\n                formatter(paream) {\r\n                    return '实际产出' + paream.value\r\n                }\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'top',\r\n                    textStyle: {\r\n                        color: '#000'\r\n                    },\r\n                    formatter(v) {\r\n                        return titlearr[i] + v.value\r\n\r\n                    }\r\n                }\r\n            },\r\n            barGap: '100%',\r\n            data:datass[i]\r\n        })\r\n    }\r\n      \r\n\r\nconsole.log(objs)\r\n\r\nvar option = {\r\n    color: [\"red\", \"#4CCEFE\"],\r\n    title: {\r\n        text: \"统计总量\",\r\n        textStyle: {\r\n            fontSize: 16,\r\n            padding: \"10px\"\r\n        }\r\n    },\r\n    legend: {\r\n        data: [\"计划\", \"产出\"],\r\n    },\r\n    tooltip: {},\r\n    yAxis: {\r\n        type: 'value',\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        axisLine: {\r\n            show: false,\r\n            lineStyle: {\r\n                color: '#000',\r\n            }\r\n        },\r\n        splitLine: {\r\n            show: true,\r\n            lineStyle: {\r\n                color: '#aaa',\r\n            }\r\n        },\r\n    },\r\n    xAxis: [{\r\n            type: 'category',\r\n            axisTick: {\r\n                show: false\r\n            },\r\n            axisLine: {\r\n                show: true,\r\n                lineStyle: {\r\n                    color: '#000',\r\n                }\r\n            },\r\n            data: ['1F02', '1F023']\r\n        }, {\r\n            type: 'category',\r\n            axisLine: {\r\n                show: false\r\n            },\r\n            axisTick: {\r\n                show: false\r\n            },\r\n            axisLabel: {\r\n                show: false\r\n            },\r\n            splitArea: {\r\n                show: false\r\n            },\r\n            splitLine: {\r\n                show: false\r\n            },\r\n            data: ['会', '不会', '看情况']\r\n        }\r\n\r\n    ],\r\n\r\n    series:objs\r\n    // [\r\n    //     {\r\n    //         name: '计划',\r\n    //         type: 'bar',\r\n    //         xAxisIndex: 1,\r\n    //         itemStyle: {\r\n    //             normal: {\r\n    //                 color: '#b25d25',\r\n\r\n    //             },\r\n    //             formatter(paream) {\r\n    //                 return '实际产出' + paream.value\r\n    //             }\r\n    //         },\r\n    //         label: {\r\n    //             normal: {\r\n    //                 show: true,\r\n    //                 position: 'top',\r\n    //                 textStyle: {\r\n    //                     color: '#000'\r\n    //                 },\r\n    //                 formatter(v) {\r\n    //                     return '计划' + v.value\r\n\r\n    //                 }\r\n    //             }\r\n    //         },\r\n    //         barGap: '100%',\r\n    //         data: [{name:'t1',value:90}, {name:'t2',value:90},{name:'t3',value:90}]\r\n    //     },\r\n    //     {\r\n    //         name: '计划',\r\n    //         type: 'bar',\r\n    //         xAxisIndex: 1,\r\n    //         itemStyle: {\r\n    //             normal: {\r\n    //                 color: '#b25d25',\r\n    //             }\r\n    //         },\r\n    //         label: {\r\n    //             normal: {\r\n    //                 show: true,\r\n    //                 position: 'top',\r\n    //                 textStyle: {\r\n    //                     color: '#fff'\r\n    //                 },\r\n    //                 formatter(v) {\r\n    //                     if (v.value == 60) {\r\n    //                         return ''\r\n    //                     } else {\r\n    //                         return '计划' + v.value\r\n    //                     }\r\n\r\n    //                 },\r\n\r\n    //             }\r\n    //         },\r\n    //         barWidth: '20%',\r\n    //         barGap: '100%',\r\n    //         data: [{name:'t4',value:60}, {name:'t5',value:60},{name:'t6',value:60}]\r\n    //     },\r\n    //     {\r\n    //         name: '实际产出',\r\n    //         type: 'bar',\r\n    //         xAxisIndex: 0,\r\n    //         barWidth: '20%',\r\n    //         itemStyle: {\r\n    //             normal: {\r\n    //                 color: \"#003472\",\r\n    //             }\r\n    //         },\r\n    //         label: {\r\n    //             normal: {\r\n    //                 show: true,\r\n    //                 position: 'top',\r\n    //                 textStyle: {\r\n    //                     color: '#fff'\r\n    //                 },\r\n    //                 formatter(v) {\r\n    //                     return '产出' + v.value\r\n\r\n    //                 }\r\n    //             }\r\n    //         },\r\n    //         barGap: '100%',\r\n    //          data: [{name:'t1',value:10}, {name:'t2',value:30},{name:'t3',value:50}]\r\n    //     },\r\n    //     {\r\n    //         name: '实际产出',\r\n    //         type: 'bar',\r\n    //         xAxisIndex: 0,\r\n    //         barWidth: '20%',\r\n    //         itemStyle: {\r\n    //             normal: {\r\n    //                 // color:\"#003472\",\r\n    //                 color: function(v) {\r\n    //                     debugger\r\n    //                     if (v.data == 60) {\r\n    //                         return \"green\"\r\n    //                     } else {\r\n    //                         return \"#003472\"\r\n    //                     }\r\n\r\n    //                 }\r\n\r\n    //             }\r\n    //         },\r\n    //         label: {\r\n    //             normal: {\r\n    //                 show: true,\r\n    //                 position: 'top',\r\n    //                 textStyle: {\r\n    //                     color: '#fff'\r\n    //                 },\r\n    //                 formatter(v) {\r\n    //                     if (v.value == 60) {\r\n    //                         return '{a|完成}'\r\n    //                     } else {\r\n    //                         return '产出' + v.value\r\n    //                     }\r\n\r\n\r\n    //                 },\r\n    //                 rich: {\r\n    //                     a: {\r\n    //                         color: '#000',\r\n\r\n    //                     },\r\n    //                 },\r\n    //             }\r\n    //         },\r\n    //         barGap: '100%',\r\n    //       data: [{name:'t4',value:10}, {name:'t5',value:30},{name:'t6',value:50}]\r\n    //     }\r\n\r\n    // ]\r\n};\r\n\r\n\r\nfunction dailyoutQueue(objs) {\r\n        var map = {},\r\n            destArray = [];\r\n        for (var v = 0; v < objs.length; v++) {\r\n            var line_name = objs[v].line_name;\r\n            var product_code = objs[v].product_code;\r\n            if (!map[line_name]) {\r\n                destArray.push({\r\n                    line_name: line_name,\r\n                    product_code: product_code,\r\n                    ids: [objs[v]],\r\n                });\r\n                map[line_name] = [objs[v]];\r\n            } else {\r\n                for (var j = 0; j < destArray.length; j++) {\r\n                    var dj = destArray[j];\r\n                    if (dj.line_name == line_name) {\r\n                        dj.ids.push(objs[v]);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return destArray;\r\n    }","html":"","externalScripts":"","updaterUID":"bd-3490920103","theme":"","layout":"","viewCount":62,"userName":"a***4","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xxKaLrsujb.png?v=1605104747046","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-bar","title","tooltip"],"customTags":[],"updaterUserName":"a***4"}}