{"status":0,"data":{"cid":"xkV9Xikk-J","authorUid":"bd-101897118","authorUserName":"q***e","title":"点位连线地图","description":"","latestVersion":8,"alwaysLatest":1,"createTime":"2019-05-22T06:17:19.000Z","lastUpdateTime":"2019-05-22T06:17:19.000Z","auth":2,"uid":"bd-101897118","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":8,"parentVersion":7,"echartsVersion":"4.2.1","versionCreateTime":"2019-06-19T08:42:59.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1558504999148-FYury9CCf.json\";\r\nvar target = '乌鲁木齐市'; //目标点城市名称\r\nvar data = [ //城市数据\r\n    {\r\n        \"name\": \"乌鲁木齐市\",\r\n        \"value\": \"20.18\"\r\n    },\r\n    {\r\n        \"name\": \"巴音郭楞蒙古自治州\",\r\n        \"value\": \"10.18\"\r\n    },\r\n    {\r\n        \"name\": \"克拉玛依市\",\r\n        \"value\": \"30.18\"\r\n    },\r\n    {\r\n        \"name\": \"克孜勒苏柯尔克孜自治州\",\r\n        \"value\": \"40.18\"\r\n    },\r\n    {\r\n        \"name\": \"哈密市\",\r\n        \"value\": \"50.18\"\r\n    },\r\n    {\r\n        \"name\": \"和田地区\",\r\n        \"value\": \"0.18\"\r\n    },\r\n    {\r\n        \"name\": \"博尔塔拉蒙古自治州\",\r\n        \"value\": \"80.18\"\r\n    }\r\n]\r\nvar chart = echarts.init(document.getElementById('chart-panel'));\r\n//根据数值获取颜色\r\nvar getColor = function(value) {\r\n    if (value <= 20) {\r\n        return '#00ffff';\r\n    } else if (value <= 40) {\r\n        return '#00ff00';\r\n    } else if (value <= 60) {\r\n        return '#ffff00'\r\n    } else if (value <= 80) {\r\n        return '#ffa500';\r\n    } else if (value <= 100) {\r\n        return '#ff3333';\r\n    } else {\r\n        return '#ddd';\r\n    }\r\n}\r\nvar geoJson; //地图json\r\n$.ajax({\r\n    url: uploadedDataURL,\r\n    dataType: 'json',\r\n    success: function(json) {\r\n        geoJson = json;\r\n        echarts.registerMap('XJ', json);\r\n\r\n        //点击点位时切换目标点位\r\n        chart.on('click', function(obj) {\r\n            if (obj.seriesName == 'city') {\r\n                target = obj.data.name;\r\n                setData();\r\n            }\r\n        });\r\n        setData();\r\n    }\r\n});\r\n\r\nfunction setData() {\r\n    var pointData = []; //点位数据\r\n    var lineData = []; //连线数据\r\n    var center = []; //目标点坐标\r\n    var features = geoJson.features;\r\n    var targetCoord; //目标点坐标\r\n    //获取目标点坐标\r\n    $.each(features, function(i, v) {\r\n        if (target == v.properties.name) {\r\n            targetCoord = v.properties.center;\r\n            return false;\r\n        }\r\n    });\r\n    //匹配点位坐标 和 连线的坐标\r\n    $.each(data, function(i, v) {\r\n        $.each(features, function(j, val) {\r\n            if (val.properties.name === v.name) {\r\n                if (v.name !== target) {\r\n                    //debugger;\r\n                    lineData.push({\r\n                        coords: [\r\n                            val.properties.center,\r\n                            targetCoord\r\n                        ],\r\n                        lineStyle: {\r\n                            color: getColor(v.value)\r\n                        }\r\n                    });\r\n                }\r\n                pointData.push({\r\n                    name: v.name,\r\n                    value: val.properties.center.concat(v.name, v.value)\r\n                });\r\n                return false;\r\n            }\r\n        });\r\n    });\r\n\r\n    var option = {\r\n        backgroundColor: '#162838',\r\n        tooltip: {\r\n            trigger: 'item'\r\n        },\r\n        geo: { //地图\r\n            show: true,\r\n            map: 'XJ',\r\n            label: {\r\n                normal: {\r\n                    show: false\r\n                },\r\n                emphasis: {\r\n                    show: false,\r\n                }\r\n            },\r\n            roam: true,\r\n            itemStyle: {\r\n                normal: {\r\n                    areaColor: '#001425',\r\n                    borderColor: '#999',\r\n                    borderWidth: 2,\r\n                },\r\n                emphasis: {\r\n                    areaColor: '#001425',\r\n                }\r\n            }\r\n        },\r\n        series: [{ //城市点位\r\n                name: 'city',\r\n                type: 'scatter',\r\n                coordinateSystem: 'geo',\r\n                symbol: 'circle',\r\n                symbolSize: function(v) {\r\n                    if (v[2] == target) { //目标点放大\r\n                        return 25;\r\n                    } else {\r\n                        return 15;\r\n                    }\r\n                },\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: function(obj) { //标志颜色\r\n                            return getColor(obj.data.value[3]);\r\n                        }\r\n                    }\r\n                },\r\n                zlevel: 9,\r\n                data: pointData,\r\n                tooltip: {\r\n                    formatter: function(obj) {\r\n                        var label = obj.data.name == target ? '本地排放：' : '区域输送：';\r\n                        var str = obj.data.name + '<br/>' + label + obj.data.value[3];\r\n                        return str;\r\n                    }\r\n                }\r\n            },\r\n            { //城市点位的涟漪效果\r\n                type: 'effectScatter',\r\n                coordinateSystem: 'geo',\r\n                data: pointData,\r\n                symbolSize: 5,\r\n                showEffectOn: 'render',\r\n                rippleEffect: {\r\n                    brushType: 'stroke',\r\n                    scale: 10\r\n                },\r\n                hoverAnimation: false,\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: function(obj) { //标志颜色\r\n                            return getColor(obj.value[3]);\r\n                        },\r\n                        shadowBlur: 20,\r\n                    }\r\n                },\r\n                zlevel: 5,\r\n                label: {\r\n                    normal: {\r\n                        show: true,\r\n                        position: 'bottom',\r\n                        offset: [0, 10],\r\n                        formatter: function(value) {\r\n                            return value.name\r\n                        },\r\n                        textStyle: {\r\n                            color: '#fff',\r\n                            fontSize: 12,\r\n                        }\r\n                    }\r\n                },\r\n            }, { //连线的尾部效果\r\n                type: 'lines',\r\n                zlevel: 1,\r\n                effect: {\r\n                    symbol: 'arrow',\r\n                    show: true,\r\n                    period: 6,\r\n                    trailLength: 0.5,\r\n                    color: '#fff',\r\n                    symbolSize: 8\r\n                },\r\n                lineStyle: {\r\n                    normal: {\r\n                        color: '#c2f555',\r\n                        width: 0,\r\n                        curveness: 0.2\r\n                    }\r\n                },\r\n                data: lineData\r\n            }, { //连线的线条和箭头\r\n                type: 'lines',\r\n                zlevel: 2,\r\n                symbol: 'none',\r\n                symbolSize: 10,\r\n                effect: {\r\n                    show: true,\r\n                    period: 6,\r\n                    trailLength: 0,\r\n                    symbol: 'arrow',\r\n                    symbolSize: 15\r\n                },\r\n                lineStyle: {\r\n                    normal: {\r\n                        color: '#c2f555',\r\n                        width: 3,\r\n                        opacity: 0.6,\r\n                        curveness: 0.2\r\n                    }\r\n                },\r\n                data: lineData\r\n            }\r\n        ]\r\n    };\r\n    chart.setOption(option);\r\n}","html":"","externalScripts":"","updaterUID":"bd-101897118","theme":"","layout":"","viewCount":2285,"userName":"q***e","commentCount":0,"starCount":7,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xkV9Xikk-J.png?v=1560933779751","isCustomThumbnail":0,"builtinTags":["category-work","geo","series-effectScatter","series-lines","series-scatter","tooltip"],"customTags":[],"updaterUserName":"q***e"}}