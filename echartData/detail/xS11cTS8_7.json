{"status":0,"data":{"cid":"xS11cTS8_7","authorUid":"bd-88341742","authorUserName":"醉***o","title":"带圆角的饼图","description":"只在正方形盒子下有效，只限于中心位置","latestVersion":2,"alwaysLatest":1,"createTime":"2018-09-12T08:25:43.000Z","lastUpdateTime":"2018-09-12T08:25:43.000Z","auth":2,"uid":"bd-88341742","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.2.0","versionCreateTime":"2018-12-13T09:00:59.000Z","code":"// 1.该图形只适合在正方形盒子的带圆角图形。\r\n// 1.该图形只适合在正方形盒子的带圆角图形。\r\n// 1.该图形只适合在正方形盒子的带圆角图形。\r\n// 当前版本为 4.2.0 出现问题有可能是版本问题\r\n\r\n// 2.一般我们通过请求得到的数据\r\nvar nameMe = ['工程建设', '产权交易', '土地交易', '其他交易', '政府采购'];\r\nvar valueMe = [310, 180, 90, 227, 123];\r\n// 自设定颜色数据\r\nvar colorMe = ['rgba(194, 53, 49, 1)', 'rgba(49, 72, 85, 1)', 'rgba(97, 160, 168, 1)', 'rgba(212, 130, 101, 1)', 'rgba(145, 199, 174, 1)'];\r\nvar colorL = ['rgba(214, 73, 69, 1)', 'rgba(69, 92, 105, 1)', 'rgba(117, 180, 188, 1)', 'rgba(232, 150, 121, 1)', 'rgba(165, 219, 194, 1)'];\r\n// 2.1.可变动的数据\r\nvar info = {\r\n\tradiusStart: 0.4,\r\n\tradiusEnd: 0.7,\r\n\tsun: 0,\r\n\tcenterX: 50,\r\n\tcenterY: 50,\r\n\tstratAngle: 0,\r\n\tcircleLocation: []\r\n}\r\n\r\n// 3.通过处理后形成的数据格式\r\n// 3.1.js 遍历数组，返回新数组（可对数组进行过滤、计算等操作），item 元素 index 元素索引 arr 遍历的数组\r\nvar assembly = nameMe.map(function(item, index, arr) {\r\n\treturn {\r\n\t\tname: item,\r\n\t\tvalue: valueMe[index],\r\n\t\titemStyle: {\r\n\t\t\tcolor: colorMe[index]\r\n\t\t},\r\n        emphasis: {\r\n            itemStyle: {\r\n                color: colorL[index],\r\n            }\r\n        }\r\n\t}\r\n})\r\n\r\n// 3.2.计算数据总和和需要在什么位置画圆\r\n// sun：为了计算饼图上的从第一段到当前段的所有占比\r\n// circleLocation 计算每个圆在每段的位置\r\nfor (var i = 0; i < valueMe.length; i++) {\r\n\tinfo.sun += valueMe[i]\r\n\tinfo.circleLocation.push(info.sun)\r\n}\r\n\r\n// 4.初始配置项\r\nvar option = {\r\n\tseries: [{\r\n\t    type: 'pie',\r\n\t    clockWise: false,\r\n\t    startAngle: 0,\r\n\t    radius: [info.radiusStart*100+'%', info.radiusEnd*100+'%'],\r\n\t    hoverAnimation: false,\r\n\t    data: assembly,\r\n\t}]\r\n}\r\n\r\n// 5.计算公式\r\n// 5.1.x1y1绘制圆的中心坐标\r\n// 5.2.xy为当前饼图所在的盒子的坐标比例（按100%来算）\r\n// 5.3.r为绘制圆的半径\r\n// 5.4.c为绘制圆的角度\r\n// x1 = x + r * Math.cos(-c * Math.PI/180)\r\n// y1 = y + r * Math.sin(-c * Math.PI/180)\r\nvar c, x1, y1, r = ((info.radiusEnd - info.radiusStart)/2 + info.radiusStart)/2*100;\r\nfor (var i = 0; i < info.circleLocation.length; i++) {\r\n\r\n\tc = 360 * (info.circleLocation[i]/info.sun) + info.stratAngle;\r\n\tx1 = info.centerX + r * Math.cos(-c * Math.PI/180);\r\n\ty1 = info.centerY + r * Math.sin(-c * Math.PI/180);\r\n\t\r\n\toption.series.push({\r\n\t\ttype: 'pie',\r\n\t\tdata: [1],\r\n\t\tname: nameMe[i],\r\n\t\tradius: ['0', (info.radiusEnd - info.radiusStart)/2*100+'%'],\r\n\t\tcenter: [x1+'%', y1+'%'],\r\n\t\thoverAnimation: false,\r\n\t\titemStyle: {\r\n\t\t\tcolor: colorMe[i],\r\n\t\t},\r\n\t\temphasis: {\r\n\t\t\titemStyle: {\r\n\t\t\t\tcolor: colorMe[i],\r\n\t\t\t}\r\n\t\t},\r\n\t\tlabelLine: {\r\n\t\t\tshow: false\r\n\t\t},\r\n\t    animationType: 'scale'\r\n\t})\r\n}\r\nvar myColor;\r\nmyChart.on('mouseover', function(params){\r\n\tfor (var i = 1; i < option.series.length; i++) {\r\n\t\tif(params.name == option.series[i].name) {\r\n\r\n\t\t\tmyColor = colorMe[i-1]\r\n\t\t\toption.series[i].itemStyle.color = colorL[i-1]\r\n\t\t\toption.series[0].data[i-1].itemStyle.color = colorL[i-1]\r\n\r\n\t\t\toption.series.push({\r\n\t\t\t\ttype: 'pie',\r\n\t\t\t\tdata: [1],\r\n\t\t\t\tname: nameMe[i],\r\n\t\t\t\tradius: ['0', (info.radiusEnd - info.radiusStart)/2*100+'%'],\r\n\t\t\t\tcenter: [option.series[i-1==0?5:i-1].center[0], option.series[i-1==0?5:i-1].center[1]],\r\n\t\t\t\thoverAnimation: false,\r\n\t\t\t\titemStyle: {\r\n\t\t\t\t\tcolor: colorL[i-1],\r\n\t\t\t\t},\r\n\t\t\t\temphasis: {\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tcolor: colorL[i-1],\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tlabelLine: {\r\n\t\t\t\t\tshow: false\r\n\t\t\t\t},\r\n\t\t\t    animationType: 'scale'\r\n\t\t\t})\r\n\r\n\t\t\tmyChart.setOption(option);\r\n\t\t}\r\n\t}\r\n\t\r\n})\r\n\r\nmyChart.on('mouseout', function(params){\r\n\tfor (var i = 1; i < option.series.length; i++) {\r\n\t\tif(params.name == option.series[i].name) {\r\n\r\n\t\t\toption.series[i].itemStyle.color = myColor\r\n\t\t\toption.series[0].data[i-1].itemStyle.color = myColor\r\n\t\t\t\r\n\t\t\toption.series.pop()\r\n\r\n\t\t\tmyChart.setOption(option, true);\r\n\t\t}\r\n\t}\r\n})\r\n\r\nmyChart.setOption(option)","html":"","externalScripts":"","updaterUID":"bd-88341742","theme":"","layout":"","viewCount":890,"userName":"醉***o","commentCount":0,"starCount":2,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xS11cTS8_7.png?v=1536740743405","isCustomThumbnail":1,"builtinTags":["category-work","series-pie"],"customTags":[],"updaterUserName":"醉***o"}}