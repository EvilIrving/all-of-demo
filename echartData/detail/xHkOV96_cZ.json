{"status":0,"data":{"cid":"xHkOV96_cZ","authorUid":"bd-4026751539","authorUserName":"草禺金兑","title":"2048","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2017-09-15T03:34:07.000Z","lastUpdateTime":"2017-09-15T03:34:07.000Z","auth":2,"uid":"bd-4026751539","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.7.1","versionCreateTime":"2017-09-15T03:34:07.000Z","code":"var randomData = function() {\r\n    var index = [];\r\n    for (i = 0; i < data.length; i++) {\r\n        if (data[i][2] === 0) {\r\n            index.push(i);\r\n        }\r\n    }\r\n    var idx = Math.floor(Math.random() * index.length);\r\n    i = index[idx];\r\n    var val = (Math.round(Math.random()) + 1);\r\n    data[i][2] = val;\r\n};\r\nvar isOver = function() {\r\n    for (i = 0; i < X; i++) {\r\n        if (data[i * Y][2] === 0) {\r\n            return 0;\r\n        }\r\n    }\r\n    for (i = 0; i < X; i++) {\r\n        for (j = 1; j < Y; j++) {\r\n            if (data[i * Y + j][2] === 0) {\r\n                return 0;\r\n            }\r\n            if (data[i * Y + j][2] == data[i * Y + j - 1][2]) {\r\n                return 0;\r\n            }\r\n        }\r\n    }\r\n    for (j = 0; j < Y; j++) {\r\n        for (i = 1; i < X; i++) {\r\n            if (data[i * Y + j][2] == data[(i - 1) * Y + j][2]) {\r\n                return 0;\r\n            }\r\n        }\r\n    }\r\n    is_over = true;\r\n};\r\nvar vecMerge = function(i, j) {\r\n    if (data[i * Y + j][2]) {\r\n        if (val_vec.length) {\r\n            if (data[i * Y + j][2] == val_vec[val_vec.length - 1]) {\r\n                score += Math.pow(2, val_vec[val_vec.length - 1]);\r\n                val_vec[val_vec.length - 1] += 1;\r\n                val_vec.push(0);\r\n                return 0;\r\n            }\r\n        }\r\n        val_vec.push(data[i * Y + j][2]);\r\n    }\r\n};\r\nvar leftFcn = function() {\r\n    for (j = 0; j < Y; j++) {\r\n        val_vec = [];\r\n        for (i = 0; i < X; i++) {\r\n            vecMerge(i, j);\r\n        }\r\n        var idx = 0;\r\n        for (k = 0; k < val_vec.length; k++) {\r\n            if (val_vec[k]) {\r\n                val_arr[idx * Y + j] = val_vec[k];\r\n                idx += 1;\r\n            }\r\n        }\r\n    }\r\n};\r\nvar rightFcn = function() {\r\n    for (j = 0; j < Y; j++) {\r\n        val_vec = [];\r\n        for (i = X - 1; i >= 0; i--) {\r\n            vecMerge(i, j);\r\n        }\r\n        var idx = X - 1;\r\n        for (k = 0; k < val_vec.length; k++) {\r\n            if (val_vec[k]) {\r\n                val_arr[idx * Y + j] = val_vec[k];\r\n                idx -= 1;\r\n            }\r\n        }\r\n    }\r\n};\r\nvar upFcn = function() {\r\n    for (i = 0; i < X; i++) {\r\n        val_vec = [];\r\n        for (j = Y - 1; j >= 0; j--) {\r\n            vecMerge(i, j);\r\n        }\r\n        var idx = Y - 1;\r\n        for (k = 0; k < val_vec.length; k++) {\r\n            if (val_vec[k]) {\r\n                val_arr[i * Y + idx] = val_vec[k];\r\n                idx -= 1;\r\n            }\r\n        }\r\n    }\r\n};\r\nvar downFcn = function() {\r\n    for (i = 0; i < X; i++) {\r\n        val_vec = [];\r\n        for (j = 0; j < Y; j++) {\r\n            vecMerge(i, j);\r\n        }\r\n        var idx = 0;\r\n        for (k = 0; k < val_vec.length; k++) {\r\n            if (val_vec[k]) {\r\n                val_arr[i * Y + idx] = val_vec[k];\r\n                idx += 1;\r\n            }\r\n        }\r\n    }\r\n};\r\ndocument.onkeydown = function(event) {\r\n    if (is_over) {\r\n        return 0;\r\n    }\r\n    if (event && (event.keyCode < 37 || event.keyCode > 40)) {\r\n        return 0;\r\n    }\r\n    for (i = 0; i < X; i++) {\r\n        for (j = 0; j < Y; j++) {\r\n            val_arr[i * Y + j] = 0;\r\n        }\r\n    }\r\n    // left\r\n    if (event && event.keyCode === 37) {\r\n        leftFcn();\r\n    }\r\n    // right\r\n    if (event && event.keyCode === 39) {\r\n        rightFcn();\r\n    }\r\n    // up\r\n    if (event && event.keyCode === 38) {\r\n        upFcn();\r\n    }\r\n    // down\r\n    if (event && event.keyCode === 40) {\r\n        downFcn();\r\n    }\r\n    var changed = false;\r\n    for (i = 0; i < X; i++) {\r\n        for (j = 0; j < Y; j++) {\r\n            if (data[i * Y + j][2] != val_arr[i * Y + j]) {\r\n                changed = true;\r\n                data[i * Y + j][2] = val_arr[i * Y + j];\r\n            }\r\n        }\r\n    }\r\n    if (changed) {\r\n        randomData();\r\n        isOver();\r\n        if (is_over) {\r\n            score = 'OVER';\r\n        }\r\n    }\r\n    option.series.data = data;\r\n    option.title.text = score + '';\r\n    myChart.setOption(option, true);\r\n}\r\n\r\n// 定义变量\r\nvar X = 4;\r\nvar Y = X;\r\nvar score = 0;\r\nvar data = [];\r\nfor (var i = 0; i < X; i++) {\r\n    for (var j = 0; j < Y; j++) {\r\n        data.push([i, j, 0])\r\n    }\r\n}\r\nvar val_arr = [];\r\nvar val_vec;\r\nvar is_over = false;\r\n\r\n// 初始化\r\nrandomData();\r\nrandomData();\r\n\r\n// 基于准备好的dom，初始化echarts实例\r\nvar axisType = {\r\n    type: 'category',\r\n    data: ['0', '1', '2', '3'],\r\n    axisLine: {\r\n        show: false\r\n    },\r\n    axisTick: {\r\n        show: false\r\n    },\r\n    axisLabel: {\r\n        show: false\r\n    }\r\n};\r\nvar option = {\r\n    title: {\r\n        text: score + '',\r\n        left: 'center',\r\n        top: 15\r\n    },\r\n    tooltip: {\r\n        formatter: function(params) {\r\n            return '[' + params.value[0] + ', ' + params.value[1] + ']: ' + params.value[2]\r\n        }\r\n    },\r\n    // animation: false,\r\n    grid: {\r\n        left: 60,\r\n        right: 60\r\n    },\r\n    xAxis: axisType,\r\n    yAxis: axisType,\r\n    visualMap: {\r\n        min: 0,\r\n        max: 14,\r\n        show: false\r\n    },\r\n    series: {\r\n        name: '2048',\r\n        type: 'heatmap',\r\n        data: data,\r\n        label: {\r\n            normal: {\r\n                show: true,\r\n                fontSize: 18,\r\n                formatter: function(params) {\r\n                    if (params.value[2]) {\r\n                        return Math.pow(2, params.value[2])\r\n                    } else {\r\n                        return ''\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                borderWidth: 1,\r\n                borderColor: \"#FFF\"\r\n            }\r\n        }\r\n    }\r\n};","html":"","externalScripts":"","updaterUID":"bd-4026751539","theme":"","layout":"","viewCount":546,"userName":"草禺金兑","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHkOV96_cZ.png?v=1505446447749","isCustomThumbnail":1,"builtinTags":["category-work","grid","series-heatmap","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"草禺金兑"}}