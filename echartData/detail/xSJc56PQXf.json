{"status":0,"data":{"cid":"xSJc56PQXf","authorUid":"bd-989904033","authorUserName":"baixiaozhe","title":"调用mapbox api 实现地图飞行定位 flyto","description":"从echarts中获取到mapbox对象后，就可以使用mapbox功能强大的api了","latestVersion":3,"alwaysLatest":1,"createTime":"2017-12-29T07:24:01.000Z","lastUpdateTime":"2017-12-29T07:24:01.000Z","auth":2,"uid":"bd-989904033","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"3.8.0","versionCreateTime":"2017-12-29T07:26:01.000Z","code":"var uploadedDataURL1 = \"/asset/get/s/data-1514531213518-SJL5tvmmG.hdr\";\n\nvar uploadedDataURL2 = \"/asset/get/s/data-1514531203136-rysKFPQ7M.json\";\nmapboxgl.accessToken = mapboxglToken;\n$.getJSON(uploadedDataURL2, function(data) {\n\n    data = data.filter(function(dataItem) {\n        return dataItem[2] > 0;\n    }).map(function(dataItem) {\n        return [dataItem[0], dataItem[1], dataItem[2]];\n    });\n\n    myChart.setOption({\n        title: {\n            text: '空格键启动飞行',\n            left: 'center'\n        },\n        visualMap: {\n            show: false,\n            max: 1000,\n            calculable: true,\n            realtime: false,\n            inRange: {\n                color: ['#23074d', '#cc5333']\n            },\n            outOfRange: {\n                colorAlpha: 0\n            }\n        },\n        mapbox: {\n            center: [104.114129, 37.550339],\n            zoom: 3,\n            pitch: 50,\n            bearing: -10,\n            style: 'mapbox://styles/mapbox/light-v9',\n            boxHeight: 20,\n            // altitudeScale: 3e2,\n            postEffect: {\n                enable: false,\n                SSAO: {\n                    enable: true,\n                    radius: 2\n                }\n            },\n            light: {\n                main: {\n                    intensity: 2,\n                    shadow: true,\n                    shadowQuality: 'high'\n                },\n                ambient: {\n                    intensity: 1.0\n                },\n                ambientCubemap: {\n                    texture: uploadedDataURL1,\n                    exposure: 2,\n                    diffuseIntensity: 0.5\n                }\n            }\n        },\n        series: [{\n            type: 'bar3D',\n            coordinateSystem: 'mapbox',\n            shading: 'lambert',\n            minHeight: 0.1,\n            barSize: 0.3,\n            data: data,\n            silent: true\n        }]\n    });\n\n    var isPerspective = true;\n\n\n    //飞行目的地 可以点击地图获取，坐标会输出到控制台\n    var locations = [{\n        \"camera\": {\n            center: [112.53778846748253, 41.60655252782351],\n            zoom: 8,\n            pitch: 30\n        }\n    }, {\n        \"camera\": {\n            center: [107.79175922308059, 30.00052304525201],\n            zoom: 8,\n            pitch: 40\n        }\n    }, {\n        \"camera\": {\n            center: [118.94102201550334, 28.165606490352943],\n            zoom: 8,\n            pitch: 50\n        }\n    }, {\n        \"camera\": {\n            center: [123.95740624281103, 37.27393230192344],\n            zoom: 8,\n            pitch: 60\n        }\n    }];\n\n    //获取mapbox地图对象\n    var map = myChart.getModel().getComponent('mapbox').getMapbox();\n\n    //监听点击地图事件 获取地图坐标 加入飞行目的地数组\n    map.on('click', function(e) {\n        console.log('center: [' + e.lngLat.lng + ', ' + e.lngLat.lat + ']');\n    });\n\n    function playback(index) {\n        //其他飞行参数参考：https://www.mapbox.com/mapbox-gl-js/api#map#flyto\n        map.flyTo(locations[index].camera);\n        map.once('moveend', function() {\n            // Duration the slide is on screen after interaction\n            window.setTimeout(function() {\n                index = index + 1;\n                if (index + 1 <= locations.length) {\n                    playback(index);\n                }\n                // Increment index\n                // index = (index + 1 === locations.length) ? 0 : index + 1;\n\n            }, 3000); // After callback, show the location for 3 seconds.\n        });\n    }\n    //空格键启动飞行\n    window.addEventListener('keydown', function(e) {\n        playback(0);\n    });\n\n});","html":"","externalScripts":"https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js,http://echarts.baidu.com/resource/echarts-gl-latest/dist/echarts-gl.min.js,http://echarts.baidu.com/resource/echarts-gl-latest/mapboxgl-token.js","updaterUID":"bd-989904033","theme":"","layout":"","viewCount":759,"userName":"baixiaozhe","commentCount":0,"starCount":6,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSJc56PQXf.png?v=1514532242734","isCustomThumbnail":1,"builtinTags":["category-work","mapbox","series-bar3D","title","visualMap"],"customTags":[],"updaterUserName":"baixiaozhe"}}