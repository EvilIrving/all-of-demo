{"status":0,"data":{"cid":"xHku9zf4Kx","authorUid":"bd-51895140","authorUserName":"zisehuayu1","title":"仪表图-内外盘","description":"双仪表盘嵌套","latestVersion":16,"alwaysLatest":1,"createTime":"2017-02-17T06:05:04.000Z","lastUpdateTime":"2017-02-17T06:05:04.000Z","auth":1,"uid":"bd-51895140","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":16,"parentVersion":15,"echartsVersion":"3.8.0","versionCreateTime":"2018-11-20T03:06:38.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1495173075713-rJ20wZ3gW.json\";\r\n\r\nvar data = [{\r\n    \"q\": [{\r\n        \"x\": \"T\",\r\n        \"id\": \"1\",\r\n        \"z\": \"13.87\",\r\n        \"t\": \"201601\",\r\n        \"time\": \" \",\r\n        \"color\": [\r\n            [0.166, '#91c7ae'],\r\n            [0.5, '#63869e'],\r\n            [0.635, '#EFC631'],\r\n            [1, '#c23531']\r\n        ],\r\n        \"scale\": [0, 2]\r\n\r\n    }]\r\n}, {\r\n    \"q\": [{\r\n        \"x\": \"T2\",\r\n        \"id\": \"1\",\r\n        \"z\": \"72.93\",\r\n        \"t\": \"201601\",\r\n        \"time\": \" \",\r\n        \"color\": [\r\n            [0.166, '#91c7ae'],\r\n            [0.5, '#63869e'],\r\n            [0.635, '#EFC631'],\r\n            [1, '#c23531']\r\n        ],\r\n        \"scale\": [0, 2]\r\n    }]\r\n}];\r\n\r\n\r\nobj = createGaugeOption(data, \"q\", [\"x\"], \"z\", [\"r\", \"time\"], \"color\", \"scale\");\r\nsetInterval(function() {\r\n    option.series[0].data[0].value = (Math.random() * 2).toFixed(2) - 0;\r\n    myChart.setOption(option, true);\r\n    option.series[1].data[0].value = (Math.random() * 2).toFixed(2) - 0;\r\n    myChart.setOption(option, true);\r\n}, 1000);\r\n\r\n\r\n\r\noption = {\r\n    title: {\r\n        text: '仪表图-内外盘'\r\n    },\r\n    legend: obj.legend,\r\n    series: obj.series\r\n};\r\n\r\nfunction createGaugeOption(datas, colName, legColName, dataColName, categoryColName, colorData, scaleData) {\r\n    console.log(JSON.stringify(datas))\r\n    var obj = {};\r\n    var series = new Array();\r\n    var legs = new Array();\r\n    var rows = new Array();\r\n    var cols = new Array();\r\n    for (var n = 0; n < datas.length; n++) {\r\n        var data = datas[n];\r\n        var d = eval(\"data.\" + colName);\r\n        for (var i = 0; i < d.length; i++) {\r\n            var rowname = ArrToStr(d[i], categoryColName[0]);\r\n            var colname = ArrToStr(d[i], categoryColName[1]);\r\n            if ($.inArray(rowname, rows) < 0) {\r\n                rows.push(rowname);\r\n            }\r\n            if ($.inArray(colname, cols) < 0) {\r\n                cols.push(colname);\r\n            }\r\n        }\r\n    }\r\n    rows = rows.sort(fncSort);\r\n    cols = cols.sort(fncSort);\r\n    for (var n = 0; n < datas.length; n++) {\r\n        var data = datas[n];\r\n        var d = eval(\"data.\" + colName);\r\n        if (d.length > 0) {\r\n            var lstr = \"\";\r\n            lstr = ArrToStr(d[0], legColName);\r\n            legs.push({\r\n                name: lstr,\r\n                textStyle: {\r\n                    //color: d[0].color\r\n                }\r\n            });\r\n        }\r\n\r\n        var colors = d[0].color;\r\n        var size = 0;\r\n        for (var i = 0; i < d.length; i++) {\r\n            var rowname = ArrToStr(d[i], categoryColName[0]);\r\n            var colname = ArrToStr(d[i], categoryColName[1]);\r\n            var x = ($.inArray(colname, cols) + 1 / (n + 1)) / (cols.length + 1);\r\n            var y = ($.inArray(rowname, rows) + 1 / (n + 1)) / (rows.length + 1);\r\n\r\n\r\n            // 内外盘间隔 盘面大小\r\n            size = 1 / rows.length - 0.05 - 0.45 * n;\r\n            var offset = [];\r\n\r\n            offset = [i, titleOffset(0.15 * (i + 1), y, size) + '%'];\r\n            var o = {\r\n                name: lstr,\r\n                type: 'gauge',\r\n                z: 100 - n,\r\n                min: d[0].scale[0],\r\n                max: d[0].scale[1],\r\n                splitNumber: 10,\r\n                //上边距\r\n                //center: [x * 100 + '%', y * 110 + '%'],\r\n                startAngle: 180,\r\n                endAngle: 0,\r\n                radius: size * 100 + '%',\r\n                axisLine: {\r\n                    show: true,\r\n                    lineStyle: {\r\n                        color: colors,\r\n                        width: 30\r\n                    }\r\n                },\r\n                axisTick: { // 坐标轴小标记\r\n                    length: 38, // 属性length控制线长\r\n                    lineStyle: { // 属性lineStyle控制线条样式\r\n                        color: 'auto'\r\n                    }\r\n                },\r\n                splitLine: { // 分隔线\r\n                    length: 35, // 属性length控制线长\r\n                    lineStyle: { // 属性lineStyle（详见lineStyle）控制线条样式\r\n                        color: 'auto'\r\n                    }\r\n                },\r\n                pointer: {\r\n                    width: 4\r\n                },\r\n                title: {\r\n                    show: true,\r\n                    offsetCenter: offset,\r\n                    textStyle: { // 其余属性默认使用全局文本样式，详见TEXTSTYLE\r\n                        fontWeight: 'bolder',\r\n                        fontSize: 20,\r\n                        fontStyle: 'italic'\r\n                    }\r\n                },\r\n                detail: {\r\n                    formatter: '{value}',\r\n                    offsetCenter: [0, '' + (-20 * (3 - n)) + '%']\r\n                },\r\n                data: [{\r\n                    value: eval(\"d[i].\" + dataColName),\r\n                    name: colname\r\n\r\n                }]\r\n            }\r\n            series.push(o);\r\n        }\r\n    }\r\n\r\n    obj.series = series;\r\n    obj.legend = {\r\n        selectedMode: false,\r\n        data: colors\r\n    };\r\n    return obj;\r\n}\r\n\r\nfunction ReservedDecimal(data, digit) {\r\n    var num = data + \"\";\r\n    if (num.indexOf(\".\") < 0) {\r\n        return num;\r\n    }\r\n    return num.substring(0, num.indexOf(\".\") + digit + 1);\r\n}\r\n\r\nfunction ArrToStr(data, arr) {\r\n    return eval(\"data.\" + arr);\r\n}\r\n\r\nfunction fncSort(a, b) {\r\n    var x = parseInt(a);\r\n    var y = parseInt(b);\r\n    if (x != y) {\r\n        return x - y;\r\n    } else {\r\n        return a - b;\r\n    }\r\n}\r\n\r\nfunction isArray(obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Array]';\r\n}\r\n\r\nfunction titleOffset(final, center, size) {\r\n    return ((final - center * 2) / size) * 80\r\n}","html":"","externalScripts":"","updaterUID":"bd-2047132608","theme":"","layout":"","viewCount":6049,"userName":"zisehuayu1","commentCount":0,"starCount":8,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xHku9zf4Kx.png?v=1542683199002","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-gauge","title"],"customTags":[],"updaterUserName":"zita_su"}}