{"status":0,"data":{"cid":"xfzFJb-MT7","authorUid":"bd-759773267","authorUserName":"马***哥","title":"可切换漏斗转化图","description":"按钮切换上下个漏斗图，切换百分比显示","latestVersion":1,"alwaysLatest":1,"createTime":"2019-02-20T08:27:00.000Z","lastUpdateTime":"2019-02-20T08:27:00.000Z","auth":2,"uid":"bd-759773267","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2019-02-20T08:27:00.000Z","code":"const funnel_index = ['1194859', '1204548', '1045451', '1026045', '1145731', '1245947', '1150457', '1204338', '1810937', '1232034', '1334452', '1194564', '1024524', '124453', '1232045', '1654519', '1156453', '1654599', '1145593', '1124514', '1127459', '1245934', '1114506', '1162622', '1222641', '1186252', '1220422', '1653865', '1232451', '1007833', '1213724', '1233661', '1784151', '1154326', '1162452', '1228596', '1529449', '1051155', '1579122', '1104331', '1228398', '1656602', '1721621', '1579135', '1220932', '1664920', '1176515', '1231938', '1228667', '1811276', '1142461', '1179633', '1040932', '1785550', '1098207', '1163572', '1115868', '1113913', '1232443', '1590754', '1224398', '1209645', '1056776', '1471530', '1210733', '1209973', '1773029', '1027426', '1232810', '1495368', '1111546', '1579132', '1775082', '1782197', '1210536', '1118665', '1040991', '1633650', '1617178', '1212419', '1214679', '1181422', '1108907', '1748339', '1219492', '1033377', '1226410', '1227185', '1197099', '1749200', '1725035', '1132742', '1039506', '1228660', '1228750', '1228776', '1179923', '1231933', '1232036', '1233268'];\nconst funnel_data_col = ['sum__detail_view', 'sum__add', 'sum__checkout', 'sum__orders'];\nconst funnel_data = [\n    [81, 19, 15, 0],\n    [76, 13, 4, 0],\n    [76, 23, 30, 0],\n    [67, 0, 0, 0],\n    [62, 16, 8, 0],\n    [60, 2, 40, 0],\n    [54, 13, 7, 1],\n    [53, 14, 16, 0],\n    [42, 0, 0, 0],\n    [40, 15, 33, 1],\n    [38, 0, 0, 0],\n    [37, 14, 3, 0],\n    [37, 13, 43, 0],\n    [35, 14, 44, 1],\n    [35, 15, 22, 0],\n    [34, 0, 0, 0],\n    [32, 4, 7, 0],\n    [31, 0, 0, 0],\n    [30, 9, 21, 0],\n    [30, 2, 2, 0],\n    [28, 13, 29, 0],\n    [27, 0, 0, 0],\n    [25, 1, 1, 0],\n    [25, 18, 0, 0],\n    [24, 6, 8, 0],\n    [23, 9, 18, 0],\n    [23, 12, 13, 1],\n    [23, 0, 0, 0],\n    [22, 11, 17, 0],\n    [21, 0, 0, 0],\n    [21, 1, 3, 0],\n    [21, 4, 8, 0],\n    [21, 0, 0, 0],\n    [20, 6, 5, 0],\n    [20, 3, 5, 0],\n    [20, 0, 12, 0],\n    [20, 0, 0, 0],\n    [19, 6, 6, 0],\n    [18, 0, 0, 0],\n    [18, 0, 0, 0],\n    [18, 0, 0, 0],\n    [18, 0, 0, 0],\n    [18, 0, 0, 0],\n    [18, 0, 0, 0],\n    [17, 7, 3, 0],\n    [16, 0, 0, 0],\n    [16, 7, 11, 2],\n    [16, 2, 3, 0],\n    [16, 0, 7, 0],\n    [15, 0, 0, 0],\n    [15, 0, 0, 0],\n    [15, 6, 8, 0],\n    [15, 9, 9, 0],\n    [15, 0, 0, 0],\n    [14, 4, 2, 0],\n    [14, 2, 0, 0],\n    [13, 1, 2, 0],\n    [13, 8, 7, 0],\n    [13, 2, 1, 0],\n    [13, 0, 0, 0],\n    [13, 0, 0, 0],\n    [12, 10, 16, 0],\n    [12, 0, 0, 0],\n    [12, 0, 0, 0],\n    [12, 2, 8, 0],\n    [12, 3, 4, 0],\n    [12, 0, 0, 0],\n    [12, 3, 0, 0],\n    [11, 11, 17, 0],\n    [11, 0, 0, 0],\n    [11, 9, 9, 0],\n    [11, 0, 0, 0],\n    [11, 0, 0, 0],\n    [11, 0, 0, 0],\n    [11, 6, 9, 0],\n    [10, 0, 0, 0],\n    [10, 2, 1, 0],\n    [10, 0, 0, 0],\n    [9, 0, 0, 0],\n    [9, 1, 4, 0],\n    [9, 10, 12, 0],\n    [9, 5, 6, 0],\n    [8, 1, 0, 0],\n    [8, 0, 0, 0],\n    [8, 4, 3, 0],\n    [8, 5, 7, 0],\n    [8, 0, 0, 0],\n    [8, 5, 3, 0],\n    [8, 4, 4, 0],\n    [8, 0, 0, 0],\n    [8, 0, 0, 0],\n    [8, 6, 14, 0],\n    [8, 6, 0, 0],\n    [8, 0, 6, 0],\n    [8, 0, 5, 0],\n    [8, 0, 8, 0],\n    [8, 1, 2, 0],\n    [8, 1, 1, 0],\n    [8, 4, 4, 0],\n    [8, 2, 5, 0]\n];\nconst funnel_percent_col = ['sum__add/sum__detail_view', 'sum__checkout/sum__detail_view', 'sum__orders/sum__detail_view'];\nconst funnel_percent = [\n    [23.45, 18.51, 0.0],\n    [17.1, 5.26, 0.0],\n    [30.26, 39.47, 0.0],\n    [0.0, 0.0, 0.0],\n    [25.8, 12.9, 0.0],\n    [3.33, 66.66, 0.0],\n    [24.07, 12.96, 1.85],\n    [26.41, 30.18, 0.0],\n    [0.0, 0.0, 0.0],\n    [37.5, 82.5, 2.5],\n    [0.0, 0.0, 0.0],\n    [37.83, 8.1, 0.0],\n    [35.13, 116.21, 0.0],\n    [40.0, 125.71, 2.85],\n    [42.85, 62.85, 0.0],\n    [0.0, 0.0, 0.0],\n    [12.5, 21.87, 0.0],\n    [0.0, 0.0, 0.0],\n    [30.0, 70.0, 0.0],\n    [6.66, 6.66, 0.0],\n    [46.42, 103.57, 0.0],\n    [0.0, 0.0, 0.0],\n    [4.0, 4.0, 0.0],\n    [72.0, 0.0, 0.0],\n    [25.0, 33.33, 0.0],\n    [39.13, 78.26, 0.0],\n    [52.17, 56.52, 4.34],\n    [0.0, 0.0, 0.0],\n    [50.0, 77.27, 0.0],\n    [0.0, 0.0, 0.0],\n    [4.76, 14.28, 0.0],\n    [19.04, 38.09, 0.0],\n    [0.0, 0.0, 0.0],\n    [30.0, 25.0, 0.0],\n    [15.0, 25.0, 0.0],\n    [0.0, 60.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [31.57, 31.57, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [41.17, 17.64, 0.0],\n    [0.0, 0.0, 0.0],\n    [43.75, 68.75, 12.5],\n    [12.5, 18.75, 0.0],\n    [0.0, 43.75, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [40.0, 53.33, 0.0],\n    [60.0, 60.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [28.57, 14.28, 0.0],\n    [14.28, 0.0, 0.0],\n    [7.69, 15.38, 0.0],\n    [61.53, 53.84, 0.0],\n    [15.38, 7.69, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [83.33, 133.33, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [16.66, 66.66, 0.0],\n    [25.0, 33.33, 0.0],\n    [0.0, 0.0, 0.0],\n    [25.0, 0.0, 0.0],\n    [100.0, 154.54, 0.0],\n    [0.0, 0.0, 0.0],\n    [81.81, 81.81, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [54.54, 81.81, 0.0],\n    [0.0, 0.0, 0.0],\n    [20.0, 10.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [11.11, 44.44, 0.0],\n    [111.11, 133.33, 0.0],\n    [55.55, 66.66, 0.0],\n    [12.5, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [50.0, 37.5, 0.0],\n    [62.5, 87.5, 0.0],\n    [0.0, 0.0, 0.0],\n    [62.5, 37.5, 0.0],\n    [50.0, 50.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [0.0, 0.0, 0.0],\n    [75.0, 175.0, 0.0],\n    [75.0, 0.0, 0.0],\n    [0.0, 75.0, 0.0],\n    [0.0, 62.5, 0.0],\n    [0.0, 100.0, 0.0],\n    [12.5, 25.0, 0.0],\n    [12.5, 12.5, 0.0],\n    [50.0, 50.0, 0.0],\n    [25.0, 62.5, 0.0]\n];\n\nlet show_percent = false;\n\nlet nfid = 0; // now funnel id\n\nfunction formatShowData(nameList, dataList) {\n    const r_data = [];\n    for (let i = 0; i < nameList.length; i++) {\n        r_data.push({\n            name: nameList[i],\n            value: dataList[i]\n        });\n    }\n    return r_data;\n}\n\noption = {\n    title: {\n        show: true,\n        text: 'goods_id' + ': ' + funnel_index[nfid] + '\\n No.' + (nfid + 1) + ' in ' + ' query',\n        bottom: 'bottom',\n        left: 'right'\n    },\n    toolbox: {\n        show: true,\n        itemSize: 20,\n        feature: {\n            myTool1: {\n                show: true,\n                title: 'percent view',\n                icon: 'path://M804.571429 731.428571c0-40.009143-33.133714-73.142857-73.142858-73.142857s-73.142857 33.133714-73.142857 73.142857 33.133714 73.142857 73.142857 73.142858 73.142857-33.133714 73.142858-73.142858zM365.714286 292.571429c0-40.009143-33.133714-73.142857-73.142857-73.142858s-73.142857 33.133714-73.142858 73.142858 33.133714 73.142857 73.142858 73.142857 73.142857-33.133714 73.142857-73.142857z m585.142857 438.857142c0 121.161143-98.304 219.428571-219.428572 219.428572s-219.428571-98.304-219.428571-219.428572 98.304-219.428571 219.428571-219.428571 219.428571 98.304 219.428572 219.428571zM896 109.714286c0 8.009143-2.852571 15.433143-7.424 21.723428l-603.428571 804.571429C278.308571 945.152 267.446857 950.857143 256 950.857143H164.571429c-20.004571 0-36.571429-16.566857-36.571429-36.571429 0-8.009143 2.852571-15.433143 7.424-21.723428l603.428571-804.571429C745.691429 78.848 756.553143 73.142857 768 73.142857h91.428571c20.004571 0 36.571429 16.566857 36.571429 36.571429zM512 292.571429c0 121.161143-98.304 219.428571-219.428571 219.428571s-219.428571-98.304-219.428572-219.428571 98.304-219.428571 219.428572-219.428572 219.428571 98.304 219.428571 219.428572z',\n                iconStyle: {\n                    color: '#cdcdcd'\n                },\n                onclick: function() {\n                    show_percent = !show_percent;\n                    myChart.setOption({\n                        toolbox: {\n                            feature: {\n                                myTool1: {\n                                    iconStyle: {\n                                        color: (show_percent) ? '#7CFC00' : '#cdcdcd'\n                                    }\n                                }\n                            }\n                        },\n                        legend: {\n                            data: (show_percent) ? funnel_percent_col : funnel_data_col,\n                        },\n                        series: {\n                            label: {\n                                normal: {\n                                    formatter: (show_percent) ? function(params) {\n                                        const percent_name = params.name;\n                                        const percent_index = funnel_percent_col.indexOf(percent_name);\n                                        const spilt_name = percent_name.split('/');\n                                        const data1_name = spilt_name[0];\n                                        const data2_name = spilt_name[1];\n                                        const data1_index = funnel_data_col.indexOf(data1_name);\n                                        const data2_index = funnel_data_col.indexOf(data2_name);\n                                        let str = data2_name + ': ' + funnel_data[nfid][data2_index] + '\\n';\n                                        str += funnel_percent[nfid][percent_index] + '%\\n';\n                                        str += data1_name + ': ' + funnel_data[nfid][data1_index];\n                                        return str;\n                                    } : function(params) {\n                                        const data_name = params.name;\n                                        const data_index = funnel_data_col.indexOf(data_name);\n                                        return data_name + '\\n' + funnel_data[nfid][data_index];\n                                    },\n                                }\n                            },\n                            data: (show_percent) ? formatShowData(funnel_percent_col, funnel_percent[nfid]) : formatShowData(funnel_data_col, funnel_data[nfid]),\n                        }\n                    });\n                }\n            },\n            myTool2: {\n                show: true,\n                title: 'goods_id' + ' prev',\n                icon: 'path://M573.056 272l308.8 404.608A76.8 76.8 0 0 1 820.736 800H203.232a76.8 76.8 0 0 1-61.056-123.392L450.976 272a76.8 76.8 0 0 1 122.08 0z',\n                iconStyle: {\n                    color: '#cdcdcd'\n                },\n                onclick: function() {\n                    nfid = ((nfid - 1) < 0) ? funnel_index.length - 1 : nfid - 1;\n                    myChart.setOption({\n                        title: {\n                            text: 'goods_id' + ': ' + funnel_index[nfid] + '\\n No.' + (nfid + 1),\n                        },\n                        series: {\n                            label: {\n                                normal: {\n                                    formatter: (show_percent) ? function(params) {\n                                        const percent_name = params.name;\n                                        const percent_index = funnel_percent_col.indexOf(percent_name);\n                                        const spilt_name = percent_name.split('/');\n                                        const data1_name = spilt_name[0];\n                                        const data2_name = spilt_name[1];\n                                        const data1_index = funnel_data_col.indexOf(data1_name);\n                                        const data2_index = funnel_data_col.indexOf(data2_name);\n                                        let str = data2_name + ': ' + funnel_data[nfid][data2_index] + '\\n';\n                                        str += funnel_percent[nfid][percent_index] + '%\\n';\n                                        str += data1_name + ': ' + funnel_data[nfid][data1_index];\n                                        return str;\n                                    } : function(params) {\n                                        const data_name = params.name;\n                                        const data_index = funnel_data_col.indexOf(data_name);\n                                        return data_name + '\\n' + funnel_data[nfid][data_index];\n                                    },\n                                }\n                            },\n                            data: (show_percent) ? formatShowData(funnel_percent_col, funnel_percent[nfid]) : formatShowData(funnel_data_col, funnel_data[nfid]),\n                        }\n                    });\n                }\n            },\n            myTool3: {\n                show: true,\n                title: 'goods_id' + ' next',\n                icon: 'path://M573.056 752l308.8-404.608A76.8 76.8 0 0 0 820.736 224H203.232a76.8 76.8 0 0 0-61.056 123.392l308.8 404.608a76.8 76.8 0 0 0 122.08 0z',\n                iconStyle: {\n                    color: '#cdcdcd'\n                },\n                onclick: function() {\n                    nfid = ((nfid + 1) === funnel_index.length) ? 0 : nfid + 1;\n                    myChart.setOption({\n                        title: {\n                            text: 'goods_id' + ': ' + funnel_index[nfid] + '\\n No.' + (nfid + 1),\n                        },\n                        series: {\n                            label: {\n                                normal: {\n                                    formatter: (show_percent) ? function(params) {\n                                        const percent_name = params.name;\n                                        const percent_index = funnel_percent_col.indexOf(percent_name);\n                                        const spilt_name = percent_name.split('/');\n                                        const data1_name = spilt_name[0];\n                                        const data2_name = spilt_name[1];\n                                        const data1_index = funnel_data_col.indexOf(data1_name);\n                                        const data2_index = funnel_data_col.indexOf(data2_name);\n                                        let str = data2_name + ': ' + funnel_data[nfid][data2_index] + '\\n';\n                                        str += funnel_percent[nfid][percent_index] + '%\\n';\n                                        str += data1_name + ': ' + funnel_data[nfid][data1_index];\n                                        return str;\n                                    } : function(params) {\n                                        const data_name = params.name;\n                                        const data_index = funnel_data_col.indexOf(data_name);\n                                        return data_name + '\\n' + funnel_data[nfid][data_index];\n                                    },\n                                }\n                            },\n                            data: (show_percent) ? formatShowData(funnel_percent_col, funnel_percent[nfid]) : formatShowData(funnel_data_col, funnel_data[nfid]),\n                        }\n                    });\n                }\n            }\n        },\n        top: '3%',\n        right: '3%'\n    },\n    tooltip: {\n        trigger: 'item',\n        formatter: function(params) {\n            const name = params.name;\n            let str = name + '<br/>';\n            const tooltip_index = (show_percent) ? funnel_percent_col.indexOf(name) : funnel_data_col.indexOf(name);\n            const data = (show_percent) ? 'CR: ' + funnel_percent[nfid][tooltip_index] + '%' : funnel_data[nfid][tooltip_index];\n            str += data + '<br/>';\n            return str;\n        },\n        confine: true\n    },\n    legend: {\n        data: (show_percent) ? funnel_percent_col : funnel_data_col,\n        selectedMode: false\n    },\n    calculable: true,\n    series: {\n        name: funnel_index[nfid],\n        type: 'funnel',\n        left: '10%',\n        top: '10%',\n        width: '80%',\n        minSize: (show_percent) ? Math.min(...funnel_percent[nfid]) + '%' : Math.min(...funnel_data[nfid]),\n        sort: 'none',\n        gap: 2,\n        label: {\n            normal: {\n                show: true,\n                position: 'inside',\n                formatter: (show_percent) ? function(params) {\n                    const percent_name = params.name;\n                    const percent_index = funnel_percent_col.indexOf(percent_name);\n                    const spilt_name = percent_name.split('/');\n                    const data1_name = spilt_name[0];\n                    const data2_name = spilt_name[1];\n                    const data1_index = funnel_data_col.indexOf(data1_name);\n                    const data2_index = funnel_data_col.indexOf(data2_name);\n                    let str = data2_name + ': ' + funnel_data[nfid][data2_index] + '\\n';\n                    str += funnel_percent[nfid][percent_index] + '%\\n';\n                    str += data1_name + ': ' + funnel_data[nfid][data1_index];\n                    return str;\n                } : function(params) {\n                    const data_name = params.name;\n                    const data_index = funnel_data_col.indexOf(data_name);\n                    return data_name + '\\n' + funnel_data[nfid][data_index];\n                },\n            },\n            emphasis: {\n                textStyle: {\n                    fontSize: 20,\n                },\n            },\n        },\n        labelLine: {\n            normal: {\n                length: 30,\n                lineStyle: {\n                    width: 3,\n                    type: 'solid',\n                },\n            },\n        },\n        itemStyle: {\n            normal: {\n                borderColor: '#fff',\n                borderWidth: 1,\n            },\n        },\n        data: (show_percent) ? formatShowData(funnel_percent_col, funnel_percent[nfid]) : formatShowData(funnel_data_col, funnel_data[nfid]),\n    }\n};","html":"","externalScripts":"","updaterUID":"bd-759773267","theme":"","layout":"","viewCount":296,"userName":"马***哥","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xfzFJb-MT7.png?v=1550651220146","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-funnel","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"马***哥"}}