{"status":0,"data":{"cid":"xygz-sjYiZ","authorUid":"obd-otxkel8eKQAQ4XeCgmorRkfq2S8Lg8J","authorUserName":"136*****728","title":"年级月考统计","description":"","latestVersion":2,"alwaysLatest":1,"createTime":"2020-07-30T14:35:34.000Z","lastUpdateTime":"2020-07-30T14:35:34.000Z","auth":1,"uid":"obd-otxkel8eKQAQ4XeCgmorRkfq2S8Lg8J","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-30T14:47:50.000Z","code":" var cellSize = [80, 80];\r\nvar pieRadius = 30;\r\nvar scatterData, lineData;\r\nvar category = ['进步学生数','高分段人数'];\r\n\r\nvar hours = ['2019-01', '2019-02', '2019-03', '2019-04', '2019-05', '2019-06', '2019-07',\r\n        '2019-08', '2019-09', '2019-10','2019-11','2019-12',\r\n        '2020-01', '2020-02', '2020-03', '2020-04', '2020-05', '2020-06',\r\n        '2020-07', '2020-08','2020-09'];\r\nvar days = ['','','班级A', '班级B', '班级C',\r\n        '班级D', '班级E', '班级F', '班级G'];\r\n\r\nvar data = [[0,0,[2,3]],[0,1,[0,1]],[0,2,[0,0]],[0,3,[0,0]],[0,4,[0,0]],[0,5,[0,0]],[0,6,[0,0]],[0,7,[0,0]],[0,8,[0,0]],[0,9,[0,0]],[0,10,[0,0]],[0,11,[0,2]],[0,12,[1,3]],[0,13,[1,0]],[0,14,[0,1]],[0,15,[1,1]],[0,16,[2,2]],[0,17,[2,4]],[0,18,[2,2]],[0,19,[1,3]],[1,0,[3,4]],[1,1,[0,0]],[1,2,[0,0]],[1,3,[0,0]],[1,4,[0,0]],[1,5,[0,0]],[1,6,[0,0]],[1,7,[0,0]],[1,8,[0,0]],[1,9,[0,0]],[1,10,[3,2]],[1,11,[0,2]],[1,12,[1,1]],[1,13,[2,4]],[1,14,[4,5]],[1,15,[5,6]],[1,16,[3,3]],[1,17,[2,5]],[1,18,[3,5]],[1,19,[2,10]],[2,0,[1,0]],[2,1,[0,1]],[2,2,[0,0]],[2,3,[0,0]],[2,4,[0,0]],[2,5,[0,0]],[2,6,[0,0]],[2,7,[0,0]],[2,8,[0,0]],[2,9,[0,0]],[2,10,[1,2]],[2,11,[1,1]],[2,12,[0,1]],[2,13,[4,5]],[2,14,[4,4]],[2,15,[3,7]],[2,16,[3,3]],[2,17,[2,3]],[2,18,[2,3]],[2,19,[1,4]],[3,0,[4,3]],[3,1,[2,1]],[3,2,[0,0]],[3,3,[0,0]],[3,4,[0,0]],[3,5,[0,0]],[3,6,[0,0]],[3,7,[0,0]],[3,8,[0,1]],[3,9,[0,0]],[3,10,[2,3]],[3,11,[2,2]],[3,12,[3,4]],[3,13,[6,8]],[3,14,[6,7]],[3,15,[3,9]],[3,16,[4,5]],[3,17,[2,3]],[3,18,[2,3]],[3,19,[3,7]],[4,0,[0,1]],[4,1,[1,2]],\r\n[4,2,[0,0]],[4,3,[0,0]],[4,4,[0,0]],[4,5,[1,0]],[4,6,[0,0]],[4,7,[0,0]],[4,8,[0,0]],[4,9,[1,1]],[4,10,[2,2]],[4,11,[1,3]],[4,12,[2,0]],[4,13,[3,1]],[4,14,[2,2]],[4,15,[9,5]],[4,16,[6,5]],[4,17,[1,0]],[4,18,[5,4]],[4,19,[4,1]],[5,0,[1,1]],[5,1,[1,0]],[5,2,[0,0]],[5,3,[2,1]],[5,4,[0,0]],[5,5,[0,0]],[5,6,[0,0]],[5,7,[0,0]],[5,8,[1,2]],[5,9,[0,0]],[5,10,[1,3]],[5,11,[0,1]],[5,12,[2,3]],[5,13,[5,5]],[5,14,[2,3]],[5,15,[2,4]],[5,16,[4,7]],[5,17,[3,3]],[5,18,[0,0]],[5,19,[2,3]],[6,0,[0,1]],\r\n[6,1,[0,0]],[6,2,[0,0]],[6,3,[0,0]],[6,4,[0,0]],[6,5,[0,0]],[6,6,[0,0]],[6,7,[0,0]],[6,8,[0,0]],[6,9,[0,0]],[6,10,[1,0]],[6,11,[0,0]],[6,12,[1,1]],[6,13,[0,1]],[6,14,[2,1]],[6,15,[2,2]],[6,16,[0,0]],[6,17,[0,0]],[6,18,[0,0]],[6,19,[0,0]],];\r\n\r\ndata.forEach(function (item,index) {\r\n    item[0] += 2;\r\n})\r\n\r\nvar voidData = new Array(21).fill(0);\r\nvar emer = new Array(21).fill(0);\r\nvar reg = new Array(21).fill(0);\r\nfor(var i = 0;i < 20;i++){\r\n    for(var j = 0; j < 7;j++){\r\n         emer[i] += data[7*i+j][2][0];\r\n         reg[i] += data[7*i+j][2][1];\r\n    }\r\n}\r\n\r\nvar total = emer.map(function(vi ,i){\r\n    return vi + reg[i];\r\n})\r\n\r\nvar max_num = Math.ceil(Math.max(...total) /10)*10;\r\n\r\ndata = data.map(function (item,index) {\r\n    return [item[1], item[0], item[2]];\r\n});\r\n\r\n\r\n\r\n// 第一个序列\r\nvar series_1 = [{\r\n        id:'pie',\r\n        type: 'scatter',\r\n        name:'pie1',\r\n        animationDelay: function (idx) {\r\n            return idx * 5;\r\n        },\r\n        data:[],\r\n    },\r\n    {\r\n        name: '高分段总人数',\r\n        xAxisIndex: 1,\r\n        yAxisIndex: 1,\r\n        type: 'line',\r\n        stack: 'one',\r\n        areaStyle: { color:'grey',},\r\n        data: reg,\r\n        tooltip:{\r\n           position: 'top',\r\n           formatter: function (params) {\r\n              return '高分段: ' + params.value;\r\n        }\r\n        },\r\n    },{\r\n        name: '超高分段总人数',\r\n        xAxisIndex: 1,\r\n        yAxisIndex: 1,\r\n            type: 'line',\r\n            stack: 'one',\r\n            areaStyle: {\r\n                 color:'lightblue'\r\n            },\r\n            data: emer,\r\n            tooltip:{\r\n           position: 'top',\r\n           formatter: function (params) {\r\n              return '超高分段: ' + params.value;\r\n        }\r\n        },\r\n    }]\r\n\r\nvar series_2 =[{\r\n        id:'pie',\r\n        name:'pie2',\r\n        type: 'scatter',\r\n        data:generateScatterData(),\r\n        symbolSize: function (val) {\r\n            return val[2] * 2;\r\n        },\r\n        animationDelay: function (idx) {\r\n            return idx * 5;\r\n        },\r\n        tooltip:{\r\n           position: 'top',\r\n           formatter: function (params) {\r\n              return ' 进步学生数: ' + params.value[2] ;\r\n        }\r\n        },\r\n    },{\r\n        data: voidData,\r\n        type: 'line',\r\n        stack: '第二个量',\r\n        xAxisIndex: 1,\r\n        yAxisIndex: 1,\r\n          tooltip:{\r\n        position: 'top',\r\n        },\r\n    },{\r\n        // id :'scrap',\r\n        name: '总进步学生数',\r\n        data: generateLineData(),\r\n        xAxisIndex: 1,\r\n        yAxisIndex: 1,\r\n        tooltip:{\r\n          position: 'top',\r\n          formatter: function (params) {\r\n            return ' 总进步: ' + params.value ;\r\n        }\r\n        },\r\n        type: 'line',\r\n        stack: '第二个量',\r\n        areaStyle: {\r\n             color:'green'\r\n        },\r\n    }\r\n     ];\r\n\r\nfunction generateScatterData(){\r\n    scatterData = [];\r\n    for(var i = 0; i < 7; i++){\r\n        for(var j = 0; j < 20; j++){\r\n            scatterData.push([\r\n                j, i+2, Math.ceil(Math.random()*20)\r\n                ])\r\n        }\r\n    }\r\n    return scatterData;\r\n}\r\n\r\nfunction generateLineData(){\r\n    lineData = [];\r\n    for(var j = 0; j < 20; j++){\r\n        lineData.push(\r\n             Math.ceil(Math.random()*50)\r\n        )\r\n    }\r\n    return lineData;\r\n}\r\n\r\nfunction fetchMax(arrayData){\r\n    return Math.ceil(Math.max(...arrayData) /10)*10;\r\n}\r\n\r\noption = {\r\n    baseOption: {\r\n        title: {\r\n            text: '年级月考统计'\r\n        },\r\n        legend: {\r\n            data: ['超高分段总人数','高分段总人数','总进步学生数'],\r\n            left: 'center'\r\n        },\r\n        tooltip: {\r\n        },\r\n        grid: [{\r\n            id:\"grid\",\r\n            left: 0,\r\n            top:20,\r\n            bottom: 45,\r\n            right: 0,\r\n            containLabel: true\r\n        },{\r\n            id:\"grid2\",\r\n            left: 17,\r\n            top:600,\r\n            bottom: 65,\r\n            right: 0,\r\n            containLabel: true\r\n        }],\r\n        xAxis: [{\r\n            type: 'category',\r\n            data: hours,\r\n            boundaryGap: false,\r\n            splitLine: {\r\n                show: true,\r\n                lineStyle: {\r\n                    color: '#999',\r\n                    type: 'dashed'\r\n                }\r\n            },\r\n            axisLine: {\r\n                show: false\r\n            }\r\n        },{\r\n            type: 'category',\r\n            data: [],\r\n            boundaryGap: false,\r\n            gridIndex:1,\r\n            splitLine: {\r\n                show: false,\r\n            },\r\n            axisLine: {\r\n                show: false\r\n            }\r\n        }],\r\n        \r\n         timeline: {\r\n                data: category,\r\n                axisType: 'category',\r\n                autoPlay: true,\r\n                playInterval: 3000,\r\n                left: '35%',\r\n                right: '35%',\r\n                bottom: 0,\r\n                width: '30%',\r\n                label: {\r\n                    emphasis: {\r\n                        textStyle: {\r\n                            color: '#fff'\r\n                        }\r\n                    }\r\n                },\r\n                symbolSize: 10,\r\n                lineStyle: {\r\n                    color: '#555'\r\n                },\r\n                checkpointStyle: {\r\n                    borderColor: '#87CEEB',\r\n                    borderWidth: 2\r\n                },\r\n                controlStyle: {\r\n                    showNextBtn: true,\r\n                    showPrevBtn: true,\r\n                    normal: {\r\n                        color: '#666',\r\n                        borderColor: '#666'\r\n                    },\r\n                    emphasis: {\r\n                        color: '#aaa',\r\n                        borderColor: '#aaa'\r\n                    }\r\n                },\r\n\r\n            },\r\n    },\r\n    options: [{\r\n        yAxis: [{\r\n            type: 'category',\r\n            data: days,\r\n            axisLine: {\r\n                show: false\r\n            },\r\n            axisTick: { show: false }\r\n        },\r\n            { \r\n            name:'总和',\r\n            nameLocation: \"middle\",\r\n            type: 'value',\r\n            position: 'left',\r\n            max:max_num,\r\n            interval:max_num,\r\n            splitLine: { show: false },\r\n            axisLine: { show: false },\r\n            gridIndex:1,\r\n            axisLabel: {\r\n                formatter: function(value, index) {\r\n                    return parseInt(value);\r\n                },\r\n                textStyle: { fontSize: 14 }\r\n            },\r\n            axisTick: { show: false }\r\n        }],\r\n        legend:{\r\n            data:['超高分段总人数','高分段总人数'],\r\n            selected:[{'总进步学生数':false}],\r\n        },\r\n        series: series_1,\r\n    tooltip:{}\r\n    },{\r\n        \r\n   legend:{\r\n        data:['总进步学生数'],\r\n        selected:[{'超高分段总人数':false},{'高分段总人数':false}],\r\n    },\r\n    series: series_2,\r\n        yAxis: [{\r\n            type: 'category',\r\n            data: days,\r\n            axisLine: {\r\n                show: false\r\n            }\r\n        },\r\n            { \r\n            name:'总和',\r\n            nameLocation: \"middle\",\r\n            type: 'value',\r\n            position: 'left',\r\n            max:fetchMax(lineData),\r\n            interval:fetchMax(lineData),\r\n            splitLine: { show: false},\r\n            axisLine: { show: false },\r\n            gridIndex:1,\r\n            axisLabel: {\r\n                formatter: function(value, index) {\r\n                    return parseInt(value);\r\n                },\r\n                textStyle: { fontSize: 14 }\r\n            },\r\n            axisTick: { show: false }\r\n        }],\r\n    }]\r\n};\r\n\r\n\r\nsetTimeout(function () {\r\n    for(var i = 0;i< data.length;i++){\r\n    var center = myChart.convertToPixel({seriesId: 'pie'}, data[i]);\r\n       series_1.push( {\r\n            id: i+ 'pie',\r\n            name:'workload',\r\n            type: 'pie',\r\n            center: center,\r\n            tooltip:{\r\n                position: 'top',\r\n                formatter: ' 超高分段: ' + data[i][2][0] + \"<br>\"+\r\n                       '高分段: ' + data[i][2][1]\r\n            },\r\n            label: {\r\n                normal: {\r\n                    formatter: '{c}',\r\n                    position: 'inside',\r\n                    show: data[i][2][0]+data[i][2][1] > 5\r\n                },\r\n            },\r\n            radius: (data[i][2][0]+data[i][2][1])*2,\r\n            data: [\r\n                {name: '超高分段', value: data[i][2][0]},\r\n                {name: '高分段', value: data[i][2][1]}\r\n            ]\r\n        });\r\n\r\n\r\n        series_2.push( {\r\n            id: i+ 'pie',\r\n            name:'workload',\r\n            type: 'pie',\r\n            center: center,\r\n            label: {\r\n                normal: {\r\n                    formatter: '{c}',\r\n                    position: 'inside',\r\n                    show: false\r\n                },\r\n            },\r\n            radius: 0,\r\n            data: [\r\n                {name: '超高分段', value: 0},\r\n                {name: '高分段', value: 0}\r\n            ]\r\n        });\r\n }\r\n}, 10);\r\n\r\n\r\nsetTimeout(function () {\r\n    myChart.setOption(option);\r\n},100)","html":"","externalScripts":"","updaterUID":"obd-otxkel8eKQAQ4XeCgmorRkfq2S8Lg8J","theme":"default","layout":"","viewCount":473,"userName":"136*****728","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xygz-sjYiZ.png?v=1596119734731","isCustomThumbnail":1,"builtinTags":["category-work","grid","legend","series-line","series-pie","series-scatter","timeline","title","tooltip"],"customTags":[],"updaterUserName":"136*****728"}}