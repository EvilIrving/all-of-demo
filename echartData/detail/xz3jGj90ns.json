{"status":0,"data":{"cid":"xz3jGj90ns","authorUid":"bd-4240785066","authorUserName":"小***丶","title":"全国地图实现点击下钻","description":"通过高德api获取行政区边界点击下钻到县","latestVersion":107,"alwaysLatest":1,"createTime":"2020-06-17T09:48:46.000Z","lastUpdateTime":"2022-01-05T08:27:30.000Z","auth":1,"uid":"bd-4240785066","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":107,"parentVersion":106,"echartsVersion":"5.2.2","versionCreateTime":"2022-01-05T08:27:30.000Z","code":"$('<div class=\"back\">返回</div>').appendTo(\n    $('#chart-panel')\n);\n\n$('.back').css({\n    'position': 'absolute',\n    'left': '17px',\n    'top': '25px',\n    'color': 'rgb(222,222,222)',\n    'font-size': '15px',\n    'cursor': 'pointer',\n    'z-index': '100'\n})\n\n$('.back').click(function() {\n    if (parentInfo.length === 1) {\n        return;\n    }\n    parentInfo.pop()\n    getGeoJson(parentInfo[parentInfo.length - 1].code)\n})\n\n\nvar parentJson = null\nvar parentInfo = [{\n    cityName: '全国',\n    level: 'china',\n    code: 000000\n}]\ngetGeoJson(100000)\n\n/**\n *  利用高德api获取行政区边界geoJson   \n *   adcode 行政区code 编号\n **/\n\n//此版本不再维护，准备在写另一个新版本 \n\nfunction getGeoJson(adcode) {\n    AMapUI.loadUI(['geo/DistrictExplorer'], DistrictExplorer => {\n        var districtExplorer = new DistrictExplorer()\n        districtExplorer.loadAreaNode(adcode, function(error, areaNode) {\n            if (error) {\n                console.error(error);\n                return;\n            }\n            let Json = areaNode.getSubFeatures()\n            if (Json.length > 0) {\n                parentJson = Json\n            } else if (Json.length === 0) {\n                Json = parentJson.filter(item => {\n                    if (item.properties.adcode == adcode) {\n                        return item\n                    }\n                })\n                if (Json.length === 0) return\n            }\n            //去获取数据\n            getMapData(Json)\n        });\n    })\n}\n\n//获取数据，这里我们用随机数模拟数据\n\nfunction getMapData(Json) {\n    // let mapData = [{\n    //         name: '广东省',\n    //         value: 1000,\n    //         level: 'province',\n    //         cityCode: 440000\n    // },\n    // {\n    //         name: '湖南省',\n    //         value: 2000,\n    //         level: 'province',\n    //         cityCode: 430000\n    // }]\n    let mapData = Json.map(item => {\n        return ({\n            name: item.properties.name,\n            value: Math.random() * 10,\n            level: item.properties.level,\n            cityCode: item.properties.adcode\n        })\n    })\n    let pointData = Json.map(item => {\n        return ({\n            name: item.properties.name,\n            value: ['118.83531246', '32.0267395887', Math.random() * 1000],\n            cityCode: item.properties.adcode\n        })\n    })\n    let mapJson = {}\n    //geoJson必须这种格式\n    mapJson.features = Json\n\n    //去渲染echarts\n    initEcharts(mapData, pointData, mapJson)\n}\n\nfunction initEcharts(mapData, pointData, mapJson) {\n    //注册\n    echarts.registerMap('Map', mapJson);\n\n    //这里加true是为了让地图重新绘制，不然如果你有筛选的时候地图会飞出去\n    myChart.setOption({\n        backgroundColor: 'rgb(20,28,52)',\n        // tooltip: {\n        //     trigger: \"item\",\n        //     formatter: p => {\n        //         let val = p.value;\n        //         if (window.isNaN(val)) {\n        //             val = 0;\n        //         }\n        //         let txtCon =\n        //             \"<div style='text-align:center'>\" + p.name + \":<br />台量：\" + val.toFixed(2) + '</div>';\n        //         return txtCon;\n        //     }\n        // },\n        tooltip: {\n            trigger: \"item\",\n            formatter: p => {\n                let val = p.value;\n                if (window.isNaN(val)) {\n                    val = 0;\n                }\n                let txtCon =\n                    p.name + \"<br>\" + \"<hr>\" + \"数值 : \" + val.toFixed(2);\n                return txtCon;\n            }\n        },\n        title: {\n            show: true,\n            x: \"center\",\n            y: \"top\",\n            // text: parentInfo[parentInfo.length - 1].cityName + \"地图实现点击下钻66\",\n            textStyle: {\n                color: \"#fff\",\n                fontSize: 16\n            }\n        },\n        //这里可以添加echarts内置的，例如下载图片等\n        toolbox: {\n            feature: {\n                dataView: {\n                    show: false,\n                    readOnly: true\n                },\n                magicType: {\n                    show: false,\n                    type: [\"line\", \"bar\"]\n                },\n                restore: {\n                    show: false\n                },\n                saveAsImage: {\n                    show: true,\n                    name: parentInfo[parentInfo.length - 1].cityName + \"地图\",\n                    pixelRatio: 2\n                }\n            },\n            iconStyle: {\n                normal: {\n                    borderColor: \"#41A7DE\"\n                }\n            },\n            itemSize: 15,\n            top: 20,\n            right: 22\n        },\n        visualMap: {\n            type: 'piecewise',\n            pieces: [{\n                    max: 30,\n                    label: '安全',\n                    color: '#2c9a42'\n                },\n                {\n                    min: 30,\n                    max: 60,\n                    label: '警告',\n                    color: '#d08a00'\n                },\n                {\n                    min: 60,\n                    label: '危险',\n                    color: '#c23c33'\n                },\n            ],\n            color: '#fff',\n            textStyle: {\n                color: '#fff',\n            },\n            visibility: 'off'\n        },\n\n        series: [{\n                name: \"地图\",\n                type: \"map\",\n                map: \"Map\",\n                roam: true, //是否可缩放\n                zoom: 1.1, //缩放比例\n                data: mapData,\n                itemStyle: {\n                    normal: {\n                        show: true,\n                        areaColor: '#2E98CA',\n                        borderColor: 'rgb(185, 220, 227)',\n                        borderWidth: '1',\n                    },\n                },\n                label: {\n\n                    normal: {\n                        show: true, //显示省份标签\n                        textStyle: {\n                            color: \"rgb(249, 249, 249)\", //省份标签字体颜色\n                            fontSize: 12\n                        },\n                        formatter: p => {\n                            let val = p.value;\n                            if (window.isNaN(val)) {\n                                val = 0;\n                            }\n                            //\n                            switch (p.name) {\n                                case '内蒙古自治区':\n                                    p.name = \"内蒙古\"\n                                    break;\n                                case '西藏自治区':\n                                    p.name = \"西藏\"\n                                    break;\n                                case '新疆维吾尔自治区':\n                                    p.name = \"新疆\"\n                                    break;\n                                case '宁夏回族自治区':\n                                    p.name = \"宁夏\"\n                                    break;\n                                case '广西壮族自治区':\n                                    p.name = \"广西\"\n                                    break;\n                                case '香港特别行政区':\n                                    p.name = \"香港\"\n                                    break;\n                                case '澳门特别行政区':\n                                    p.name = \"澳门\"\n                                    break;\n                                default:\n                                    // code\n                            }\n                            if (p.name === \"内蒙古自治区\") {\n                                p.name = \"内蒙古\";\n                            }\n                            let txtCon =\n                                p.name;\n                            return txtCon;\n                        }\n                    },\n                    emphasis: {\n                        //对应的鼠标悬浮效果\n                        show: true,\n                        textStyle: {\n                            color: \"#000\"\n                        }\n                    }\n                }\n            },\n            {\n                name: '散点',\n                type: 'effectScatter',\n                coordinateSystem: 'geo',\n                rippleEffect: {\n                    brushType: 'fill'\n                },\n                itemStyle: {\n                    normal: {\n                        color: '#F4E925',\n                        shadowBlur: 10,\n                        shadowColor: '#333'\n                    }\n                },\n                data: pointData,\n                symbolSize: 8,\n                showEffectOn: 'render', //加载完毕显示特效\n            },\n        ]\n\n    }, true)\n\n    //点击前解绑，防止点击事件触发多次\n    myChart.off('click');\n    myChart.on('click', echartsMapClick);\n}\n\n//echarts点击事件\n\nfunction echartsMapClick(params) {\n    console.log(\"=========params===========\")\n    console.log(params)\n    console.log(\"=========params===========\")\n    //如果当前是最后一级，那就直接return\n    if (parentInfo[parentInfo.length - 1].code == params.data.cityCode) {\n        return\n    }\n    let data = params.data\n    parentInfo.push({\n        cityName: data.name,\n        level: data.level,\n        code: data.cityCode\n    })\n    getGeoJson(data.cityCode)\n\n}","html":"","externalScripts":"https://webapi.amap.com/maps?v=1.3&key=73cddabc2173e0166a622f4483d3592a&plugin=AMap.DistrictSearch,https://webapi.amap.com/maps?v=1.3&key=73cddabc2173e0166a622f4483d3592a,https://webapi.amap.com/ui/1.0/main.js,/dep/echarts/map/js/china.js,/dep/echarts/map/js/world.js,https://cdn.bootcss.com/PapaParse/4.1.2/papaparse.min.js,/dep/echarts/latest/extension/dataTool.min.js","updaterUID":"obd-oMH85wya6PNiunhPKJqmihYoomarO23","theme":"","layout":"","viewCount":43735,"userName":"小***丶","commentCount":26,"starCount":94,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xz3jGj90ns.png?v=1641371251071","isCustomThumbnail":0,"builtinTags":["category-work","series-map","title","toolbox","tooltip","visualMap"],"customTags":[],"updaterUserName":"我***i"}}