{"status":0,"data":{"cid":"xuFzSwEWaQ","authorUid":"bd-1624748243","authorUserName":"l***3","title":"堆叠饼图","description":"右侧lend自定义,嵌套饼图","latestVersion":1,"alwaysLatest":0,"createTime":"2021-12-01T03:51:39.000Z","lastUpdateTime":"2021-12-01T03:51:39.000Z","auth":1,"uid":"bd-1624748243","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"5.2.2","versionCreateTime":"2021-12-01T03:51:39.000Z","code":"// 定义学生行为\r\nvar behaviours = {}, std={};\r\nbehaviours['范围2'] = ['范围2'];\r\nbehaviours['范围1'] = ['固定排放','移动排放', '逸散排放'];\r\nstd['范围2'] =  [12];\r\nstd['范围1'] = [1,1,2];\r\n// 内环数据统计，2种形式的总次数\r\nvar innervalue = [];\r\nfor(let k of Object.keys(behaviours)){\r\n    innervalue.push({\r\n        name: k,\r\n        value: std[k].reduce((acc, cur)=>{ return acc+cur; },0)\r\n    })\r\n}\r\n// 外环数据统计, 各类行为的次数\r\nvar outervalue = [];\r\nvar behaviours_arr = [...behaviours['范围2'], ...behaviours['范围1']];\r\nvar std_arr = [...std['范围2'], ...std['范围1']];\r\nfor(let [k,v] of behaviours_arr.entries()){\r\n    outervalue.push({\r\n        name: v,\r\n        value: std_arr[k]\r\n    })\r\n}\r\n// 定义好坏颜色，注意：echart文字不支持渐变色，所以外环只能单色\r\ngoodCor = ['#67FF8A','#67FF8A'];\r\nbadCor = ['rgba(66,180,255,.6)','rgba(180, 220,252,.6)'];\r\n\r\nlet echartData = {\r\n    inner: innervalue,\r\n    outer: outervalue\r\n};\r\noption = {\r\n    grid: {\r\n        left:  '1%',\r\n        right: '',\r\n        top:  0,\r\n        bottom:  0,\r\n    },\r\n    legend: [\r\n    {\r\n        show: true,\r\n        data: ['范围1'],\r\n        orient: 'vertical',\r\n        right: '10%',\r\n        top: '37%',\r\n        // top: 'center',\r\n        itemWidth: 20,\r\n        itemHeight: 20,\r\n        itemGap: 30,\r\n        formatter: function (params) {\r\n            var datas = std;\r\n            var total = 0\r\n            var total2 = 0\r\n            datas['范围1'].map(item => {\r\n                    total += (item - 0)\r\n                    total2 += (item - 0)\r\n                })\r\n            datas['范围2'].map(item => {\r\n                    total += (item - 0)\r\n                })\r\n                return params +'        '+ total2 +''+ 't CO2 '+'   '+ ((total2 / total).toFixed(2))*100 + '%'\r\n                // let valueIndex = datas.map(item => item.name).indexOf(name);\r\n                // return name + \"  \" + (showValue ? datas[valueIndex].value + (option.legendValueUnit || '') + ' ' : '') + (showPercent ? ((datas[valueIndex].value / total) * 100).toFixed(2) + \"%\" : '');\r\n          debugger   \r\n        },\r\n        textStyle: {\r\n            color: '#fff',\r\n            fontSize: 16,\r\n        },\r\n    },\r\n    {\r\n        show: true,\r\n        data: ['固定排放','移动排放','逸散排放',],\r\n        orient: 'vertical',\r\n        right: '10.5%',\r\n        top: '13%',\r\n        top: 'center',\r\n        itemWidth: 20,\r\n        itemHeight: 20,\r\n        itemGap: 30,\r\n        formatter: function (params) {\r\n            var datas = std;\r\n            var total = 0\r\n            datas['范围1'].map(item => {\r\n                    total += (item - 0)\r\n                })\r\n            datas['范围2'].map(item => {\r\n                    total += (item - 0)\r\n                })\r\n            let nameData = ['固定排放','移动排放','逸散排放',]\r\n            let valueIndex = nameData.filter(item => item).indexOf(params);\r\n            \r\n                return params +'    '+ datas['范围1'][valueIndex] +''+ 't CO2 '+'   '+ ((datas['范围1'][valueIndex] / total).toFixed(2))*100 + '%'\r\n                // let valueIndex = datas.map(item => item.name).indexOf(name);\r\n                // return name + \"  \" + (showValue ? datas[valueIndex].value + (option.legendValueUnit || '') + ' ' : '') + (showPercent ? ((datas[valueIndex].value / total) * 100).toFixed(2) + \"%\" : '');\r\n       \r\n        },\r\n        textStyle: {\r\n            color: '#B6C1C9',\r\n            fontSize: 14,\r\n        },\r\n    },\r\n    {\r\n        show: true,\r\n        data: ['范围2'],\r\n        orient: 'vertical',\r\n        right: '10%',\r\n        top: '59%',\r\n        itemWidth: 20,\r\n        itemHeight: 20,\r\n        itemGap: 30,\r\n        formatter: function (params) {\r\n            var datas = std;\r\n            var total = 0\r\n            var total2 = 0\r\n            datas['范围1'].map(item => {\r\n                    total += (item - 0)\r\n                })\r\n            datas['范围2'].map(item => {\r\n                    total += (item - 0)\r\n                    total2 += (item - 0)\r\n                })\r\n                return params +'       '+ total2 +''+ 't CO2 '+'   '+ ((total2 / total).toFixed(2))*100 + '%'\r\n                // let valueIndex = datas.map(item => item.name).indexOf(name);\r\n                // return name + \"  \" + (showValue ? datas[valueIndex].value + (option.legendValueUnit || '') + ' ' : '') + (showPercent ? ((datas[valueIndex].value / total) * 100).toFixed(2) + \"%\" : '');\r\n        },\r\n        textStyle: {\r\n            color: '#fff',\r\n            fontSize: 16,\r\n        },\r\n    },\r\n    \r\n    ],\r\n};\r\noption.backgroundColor=\"#071B33\"\r\noption.color = [\r\n    {\r\n        x: 0,\r\n        y: 0,\r\n        x2: 0,\r\n        y2: 1,\r\n        colorStops: [{\r\n            offset: 0,\r\n            color: goodCor[0] // 0% 处的颜色\r\n        }, {\r\n            offset: 1,\r\n            color: goodCor[1] // 100% 处的颜色\r\n        }],\r\n    }, {\r\n        x: 0,\r\n        y: 0,\r\n        x2: 0,\r\n        y2: 1,\r\n        colorStops: [{\r\n            offset: 0,\r\n            color: badCor[0] // 0% 处的颜色\r\n        }, {\r\n            offset: 1,\r\n            color: badCor[1] // 100% 处的颜色\r\n        }],\r\n    }\r\n];\r\n// option.color = ['#ff6900'];\r\noption.series = [\r\n    {\r\n        type: 'pie', //内圈圈\r\n        radius: ['34%', '40%'],\r\n        \r\n        hoverAnimation:1,\r\n        hoverOffset:1,\r\n        selectedMode: 'single',\r\n        selectedOffset:3,\r\n        zlevel:3,\r\n        label: {\r\n            show: false,\r\n        },\r\n        itemStyle: {\r\n            normal: {\r\n                borderColor: 'auto',\r\n            }\r\n        },\r\n        data: echartData.inner\r\n    },\r\n    {\r\n        type: 'pie', //外圈圈\r\n        radius: ['34%', '46%'],\r\n        hoverAnimation:1,\r\n        hoverOffset:1,\r\n        selectedMode: 'single',\r\n        selectedOffset:3,\r\n        label: {\r\n            show: false,\r\n        },\r\n        itemStyle:{\r\n            normal:{\r\n                color: params => {\r\n                    if(behaviours['范围1'].includes(params.name)){\r\n                        if(params.name === '固定排放') {\r\n                            return 'rgba(66,180,255,.8)'\r\n                        } else if(params.name === '移动排放') {\r\n                            return 'rgba(121,199,250,.8)'\r\n                        } else if (params.name === '逸散排放') {\r\n                            return 'rgba(170,221,255,.8)'\r\n                        }\r\n                        // return badCor[0]\r\n                    }else{\r\n                        return 'rgba(146,250,150,.2)'\r\n                    }\r\n                },\r\n                borderWidth: 0,\r\n                borderColor: 'rgba(14,36,76,.3)'\r\n            }\r\n        },\r\n        data: echartData.outer\r\n    },\r\n    {\r\n        type: 'pie', //外圈圈 蓝色透明扇形\r\n        radius: ['29%', '40.2%'],\r\n        hoverAnimation:1,\r\n        hoverOffset:1,\r\n        selectedMode: 'single',\r\n        selectedOffset:3,\r\n        zlevel:20,\r\n        label: {\r\n            show: false,\r\n        },\r\n        zlevel: 6,\r\n        itemStyle:{\r\n            normal:{\r\n                color: params => {\r\n                    if(behaviours['范围1'].includes(params.name)){\r\n                        // return option.color[1]\r\n                        // return 'rgba(24,57,110,.7)'\r\n                        return 'rgba(4,155,255,.6)'\r\n                    }else{\r\n                        // return 'rgba(41,77,91,.1)'\r\n                        return 'rgba(137,234,145,.3)'\r\n                    }\r\n                },\r\n                borderWidth: 0,\r\n                borderColor: 'rgba(14,36,76,.1)'\r\n            }\r\n        },\r\n        data: echartData.outer\r\n    }\r\n];\r\n","html":"","externalScripts":"","updaterUID":"bd-1624748243","theme":"","layout":"","viewCount":0,"userName":"l***3","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xuFzSwEWaQ.png?v=1638330699455","isCustomThumbnail":0,"builtinTags":["category-work","legend","series-pie"],"customTags":[],"updaterUserName":"l***3"}}