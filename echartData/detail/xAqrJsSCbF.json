{"status":0,"data":{"cid":"xAqrJsSCbF","authorUid":"bd-3456915023","authorUserName":"咏***恒","title":"疫情发展模拟","description":"交流请教","latestVersion":2,"alwaysLatest":1,"createTime":"2020-07-15T12:13:46.000Z","lastUpdateTime":"2020-07-15T12:13:46.000Z","auth":2,"uid":"bd-3456915023","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-15T12:40:44.000Z","code":"//居民数量\nvar nodesnum = 360\n//病毒传染机会\nvar xiadu = 1\n//病毒的传染性，接触就传染的概率\nvar infectivity = 0.2\n//治疗天数\nvar cureday = 4\n//死亡率\nvar dierate = 0.2\n//社区结构大小\nvar shequsize = 90\n//社区内连接强度\nvar density = 0.35\n\n$(`\n    <div class=\"input-item chuan\" @click=\"chuanbo\">点击进行传播</div>\n    <div class=\"text\">传染性:0.2</div>\n<input class=\"slider\" type=\"range\" min=\"0\" max=\"0.5\" value=\"0.2\" step=\"0.01\" style=\"\">\n<div class=\"textcure\">潜伏期天数:4</div>\n<input class=\"slidercure\" type=\"range\" min=\"2\" max=\"30\" value=\"4\" step=\"1\" style=\"\">\n<div class=\"textdie\">致死率:0.2</div>\n<input class=\"sliderdie\" type=\"range\" min=\"0\" max=\"1\" value=\"0.2\" step=\"0.01\" style=\"\">\n<div class=\"r0\">估计R0:</div>\n`).appendTo(\n    $('#chart-panel')\n);\n\n$('.input-item').css({\n    'position': 'absolute',\n    'top': '180px',\n    left: '10px',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '8rem',\n    height: '2rem',\n})\n\n$('.chuan').css({\n    display: '-webkit-box',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-webkit-box-pack': 'center',\n    '-ms-flex-pack': 'center',\n    'justify-content': 'center',\n    '-webkit-box-align': 'center',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    border: '1px solid #ced4da',\n    'border-radius': '.25rem',\n    'background-color': '#e9ecef',\n    color: '#495057',\n    'text-align': 'center',\n    cursor: 'pointer'\n})\n$('.slider').css({\n    'position': 'absolute',\n    'top': '60px',\n    left: '0.5rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '6rem',\n    height: '2rem',\n})\n$('.text').css({\n    'position': 'absolute',\n    'top': '60px',\n    left: '7rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '6rem',\n    height: '2rem',\n})\n$('.slidercure').css({\n    'position': 'absolute',\n    'top': '100px',\n    left: '0.5rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '6rem',\n    height: '2rem',\n})\n$('.textcure').css({\n    'position': 'absolute',\n    'top': '100px',\n    left: '7rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '10rem',\n    height: '2rem',\n})\n$('.sliderdie').css({\n    'position': 'absolute',\n    'top': '140px',\n    left: '0.5rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '6rem',\n    height: '2rem',\n})\n$('.textdie').css({\n    'position': 'absolute',\n    'top': '140px',\n    left: '7rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '10rem',\n    height: '2rem',\n})\n$('.r0').css({\n    'position': 'absolute',\n    'top': '5px',\n    left: '12rem',\n    display: '-ms-flexbox',\n    display: 'flex',\n    '-ms-flex-wrap': 'wrap',\n    'flex-wrap': 'wrap',\n    '-ms-flex-align': 'center',\n    'align-items': 'center',\n    width: '10rem',\n    height: '2rem',\n})\n\n\nvar nodes = [{\n    name: '0',\n    category: 1\n}]\nvar nodeindexes = []\n//生成节点\nfor (var i = 1; i < nodesnum; i++) {\n    nodes.push({\n        name: i.toString(),\n        category: 1\n    })\n    nodeindexes.push(i)\n\n}\n\n\n\nvar links = []\n//随机生成边\nvar items = []\n\nfunction shequ(links, items, nodes, density) {\n    var shequ1size = nodes.length\n    for (var i = 0; i < shequ1size; i++) {\n        for (var j = i; j < shequ1size; j++) {\n            if (Math.random() < density * density * i / shequ1size * j / shequ1size && i != j) {\n                links.push({\n                    source: nodes[i].name,\n                    target: nodes[j].name\n                })\n                items.push(nodes[i].name)\n                items.push(nodes[j].name)\n            }\n        }\n    }\n    return links, items\n}\n\nfor (var j = 0; j < nodesnum; j += shequsize) {\n    var start = Math.max(j - Math.floor(0.1 * shequsize), 0)\n    var end = Math.min(j + shequsize + Math.floor(0.1 * shequsize), nodesnum)\n    var shequ1node = []\n    for (var i = start; i < end; i++) {\n        shequ1node.push(nodes[i])\n    }\n    links, items = shequ(links, items, shequ1node, density)\n}\n\n//补充边\nfor (var i = 0; i < nodesnum; i++) {\n    if (items.indexOf(i.toString()) == -1) {\n        nodeindexes.pop(i)\n        links.push({\n            source: i,\n            target: nodeindexes[Math.floor(Math.random() * nodeindexes.length)]\n        })\n    }\n}\n\n\n//随机下毒一个人\nnodes[Math.floor(Math.random() * nodesnum)].category = 0\n\n//估计R0\nvar r0 = (2 * cureday * infectivity * links.length / nodes.length).toFixed(2)\n\n$('.r0').text('估计R0:' + r0)\n$('.slider').change(function() {\n    infectivity = this.value\n    $('.text').text('传染性:' + infectivity)\n    var r0 = (2 * cureday * infectivity * links.length / nodes.length).toFixed(2)\n    $('.r0').text('估计R0:' + r0)\n})\n$('.slidercure').change(function() {\n    cureday = this.value\n    $('.textcure').text('潜伏期天数:' + cureday)\n    var r0 = (2 * cureday * infectivity * links.length / nodes.length).toFixed(2)\n    $('.r0').text('估计R0:' + r0)\n})\n$('.sliderdie').change(function() {\n    dierate = this.value\n    $('.textdie').text('致死率:' + dierate)\n    var r0 = (2 * cureday * infectivity * links.length / nodes.length).toFixed(2)\n    $('.r0').text('估计R0:' + r0)\n})\n\n\n//去重函数\nfunction unique(arr) {\n    return Array.from(new Set(arr))\n}\n\n//病毒数\nvar viruscount = 1\nvar viruscounts = [\n    [1, viruscount]\n]\nvar viruscounts_new = [\n    [1, 0]\n]\nvar cures = [\n    [1, 0]\n]\nvar dies = [\n    [1, 0]\n]\n\n//echarts的基础设置\noption = {\n    title: [{\n        text: '患者数：0',\n        subtext: '设置传染病属性' + xiadu + '：'\n    }, {\n        text: '数据虚构，仅供学习交流',\n        textStyle: {\n            fontSize: 12\n        },\n        top: 'bottom',\n        left: 'left'\n\n    }],\n    grid: [{\n        gridindex: 1,\n        left: '35%',\n        right: '3%',\n        top: '5%',\n        bottom: '75%',\n        containLabel: true\n    }],\n    xAxis: [{\n        name: '天',\n        type: 'value',\n        show: true,\n        min: 0,\n        max: 10,\n        gridIndex: 0\n    }],\n    yAxis: [{\n        name: '人数',\n        type: 'value',\n        show: true,\n\n        gridIndex: 0\n    }],\n    tooltip: {},\n    animationDurationUpdate: 1500,\n    animationEasingUpdate: 'quinticInOut',\n    legend: [{\n            data: ['感染者', '未感染', '治愈', '死亡'],\n            orient: 'vertical',\n            x: '0%',\n            y: '220px'\n        },\n        {\n            data: ['总患者数', '新增患者数', '治愈数', '死亡数'],\n\n            x: '70%',\n            y: '0%'\n        }\n    ],\n\n\n    series: [{\n            type: 'graph',\n            name: '宅男',\n            layout: 'force',\n            symbolSize: 12,\n            roam: true,\n            top: '24%',\n            label: {\n                fontSize: 12,\n                show: false\n            },\n            edgeSymbol: ['circle', 'circle'],\n            edgeSymbolSize: [4, 4],\n            edgeLabel: {\n                fontSize: 10\n            },\n            categories: [{\n                name: '感染者'\n            }, {\n                name: '未感染'\n            }, {\n                name: '治愈'\n            }, {\n                name: '死亡'\n            }],\n            data: nodes,\n            // links: [],\n            links: links,\n            lineStyle: {\n                opacity: 0.9,\n                width: 1.5,\n                curveness: 0\n            },\n            draggable: true,\n            force: {\n                repulsion: 20,\n                gravity: 0.12,\n                edgeLength: 1\n            }\n        },\n        {\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            name: '总患者数',\n            type: 'line',\n            showSymbol: false,\n            data: viruscounts,\n            itemStyle: {\n                normal: {\n                    color: '#C23531'\n                }\n            }\n        },\n        {\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            name: '新增患者数',\n            type: 'line',\n            showSymbol: false,\n            data: viruscounts,\n            itemStyle: {\n                normal: {\n                    color: '#2f4554'\n                }\n            }\n        },\n        {\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            name: '治愈数',\n            type: 'line',\n            showSymbol: false,\n            data: viruscounts,\n            itemStyle: {\n                normal: {\n                    color: '#61A0A8'\n                }\n            }\n        },\n        {\n            xAxisIndex: 0,\n            yAxisIndex: 0,\n            name: '死亡数',\n            type: 'line',\n            showSymbol: false,\n            data: viruscounts,\n            itemStyle: {\n                normal: {\n                    color: '#D48265'\n                }\n            }\n        }\n    ]\n};\n\nmyChart.setOption(option);\n\n\n\n\nvar t = 1\nvar score = 0\nvar gameend = 0\n$(\".chuan\").click(function() {\n\n\n    //计算分数\n    score += parseInt(infectivity * 100)\n    //找到红的点\n    var virusitem = []\n    for (eachnodeinfo in nodes) {\n        if (nodes[eachnodeinfo].category == 0) {\n\n            virusitem.push(nodes[eachnodeinfo].name)\n        }\n    }\n    //找到红的点连接的点,新的感染者\n    var virusitem_new = []\n    for (linkinfo in links) {\n        //console.log(links[linkinfo].source.toString())\n        if (virusitem.indexOf(links[linkinfo].source.toString()) != -1) {\n            if (Math.random() < infectivity) {\n                if (nodes[links[linkinfo].target].category == 1) {\n                    virusitem_new.push(links[linkinfo].target)\n                }\n            }\n        }\n        if (virusitem.indexOf(links[linkinfo].target.toString()) != -1) {\n            if (Math.random() < infectivity) {\n                if (nodes[links[linkinfo].source].category == 1) {\n\n                    virusitem_new.push(links[linkinfo].source)\n                }\n            }\n        }\n    }\n    //感染者加入\n    for (virusitem_new_id in virusitem_new) {\n        virusitem_new_id = virusitem_new[virusitem_new_id]\n        virusitem.push(virusitem_new_id.toString())\n    }\n\n    virusitem = unique(virusitem)\n\n    //更新患者信息\n    for (nodes_id in nodes) {\n        if (virusitem.indexOf(nodes[nodes_id].name.toString()) != -1) {\n            nodes[nodes_id].category = 0\n            if (nodes[nodes_id].infecttime) {} else {\n                nodes[nodes_id].infecttime = t\n            }\n        }\n    }\n\n    //判断治愈情况\n    for (nodes_id in nodes) {\n        if (t - nodes[nodes_id].infecttime > cureday & nodes[nodes_id].category == 0) {\n            if (Math.random() < dierate) {\n                nodes[nodes_id].category = 3\n            } else {\n                nodes[nodes_id].category = 2\n            }\n        }\n    }\n\n    //计数\n    cure = 0\n    die = 0\n    for (nodes_id in nodes) {\n        if (nodes[nodes_id].category == 2) {\n            cure += 1\n        }\n        if (nodes[nodes_id].category == 3) {\n            die += 1\n        }\n    }\n    t += 1\n    viruscounts.push([t, virusitem.length])\n    viruscounts_new.push([t, virusitem.length - viruscount])\n    cures.push([t, cure])\n    dies.push([t, die])\n\n    optionchange = {\n        title: [{\n            text: '患者数：' + virusitem.length,\n            subtext: '设置传染病属性' + xiadu + '：'\n        }],\n        xAxis: [{\n            max: 2 + t\n        }],\n        series: [{\n            data: nodes\n        }, {\n            data: viruscounts\n        }, {\n            data: viruscounts_new\n        }, {\n            data: cures\n        }, {\n            data: dies\n        }]\n    }\n    myChart.setOption(optionchange);\n\n    //病毒数\n    //判断游戏结束\n    //计算分数\n\n    if (viruscount == 0 & xiadu == 0 & gameend == 0) {\n        alert('游戏结束，你的得分是：' + ((score * density * 1000 / t) / (cure + die)).toFixed(2) + '分')\n        gameend = 1\n    }\n    viruscount = virusitem.length\n\n})\n\n\n\nmyChart.on('click', function(p) {\n    if (p.dataType == 'node') {\n        if (xiadu > 0) {\n            xiadu -= 1\n\n            //找到红的点\n            var virusitem = []\n            for (eachnodeinfo in nodes) {\n                if (nodes[eachnodeinfo].category == 0) {\n\n                    virusitem.push(nodes[eachnodeinfo].name)\n                }\n            }\n\n\n            //更新点击的点\n            nodes[p.name].category = 0\n\n            //重新计算感染者数量\n            for (eachnodeinfo in nodes) {\n                if (nodes[eachnodeinfo].category == 0) {\n                    virusitem.push(nodes[eachnodeinfo].name)\n                }\n            }\n\n            //去重\n            virusitem = unique(virusitem)\n\n            //更新点\n            for (nodes_id in nodes) {\n                if (virusitem.indexOf(nodes[nodes_id].name.toString()) != -1) {\n                    nodes[nodes_id].category = 0\n                    nodes[nodes_id].infecttime = t\n                }\n            }\n            optionchange = {\n                title: [{\n                    text: '患者数：' + virusitem.length,\n                    subtext: '你还有' + xiadu + '次下毒机会（点击目标下毒）'\n                }],\n                xAxis: [{\n                    max: 2 + t\n                }],\n                series: [{\n                    data: nodes\n\n                }]\n            }\n            myChart.setOption(optionchange);\n\n            //病毒数\n            viruscount = virusitem.length\n        }\n    }\n})","html":"","externalScripts":"","updaterUID":"bd-3456915023","theme":"","layout":"","viewCount":934,"userName":"咏***恒","commentCount":0,"starCount":3,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xAqrJsSCbF.png?v=1594816845096","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","series-graph","series-line","title","tooltip"],"customTags":[],"updaterUserName":"咏***恒"}}