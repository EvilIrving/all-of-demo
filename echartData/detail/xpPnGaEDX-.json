{"status":0,"data":{"cid":"xpPnGaEDX-","authorUid":"bd-4044629902","authorUserName":"z***z","title":"24小时—全国空气质量3D可视化","description":"通过百度云函数CFC调用vercel的python脚本，每小时爬取pm25网站数据。存储于leancould。通过api调取数据","latestVersion":2,"alwaysLatest":1,"createTime":"2021-01-23T16:55:27.000Z","lastUpdateTime":"2021-01-23T16:55:27.000Z","auth":2,"uid":"bd-4044629902","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.8.0","versionCreateTime":"2021-01-23T17:00:40.000Z","code":"timeLineData = []\r\ndatalist = []\r\nfetch('https://24h-aqi-list.vercel.app/api')\r\n    .then(function(response) {\r\n        return response.json()\r\n    })\r\n    .then(function(json) {\r\n        datalist = json\r\n        datalist = datalist.reverse()\r\n        for (item of datalist) {\r\n            let str = item[0][0]\r\n            let itemdata = item[1]\r\n            let itemdatalist = [{\r\n                name: \"基准\",\r\n                value: 0\r\n            }]\r\n            for (let j in allarealist) {\r\n                let newitemdata = {\r\n                    name: allarealist[j],\r\n                    value: 50\r\n                }\r\n                for (i of itemdata) {\r\n                    if (i.area === allarealist[j]) {\r\n                        newitemdata.value = i.aqi\r\n                    } else {\r\n\r\n                    }\r\n                }\r\n                itemdatalist.push(newitemdata)\r\n            }\r\n            let gettime = str.split(' ')[1].split(':')[0]\r\n            timetext = ''\r\n            if (Number(gettime) >= 12) {\r\n                timetext = item[0][0] + '   ' + 'P.M'\r\n            } else if (Number(gettime) <= 11) {\r\n                timetext = item[0][0] + '   ' + 'A.M'\r\n            }\r\n            timeLineData.push(Number(gettime))\r\n            option.baseOption.timeline.data.push(Number(gettime));\r\n            option.options.push({\r\n                title: [{\r\n                    text: timetext,\r\n                    textAlign: 'center',\r\n                    left: '50%',\r\n                    top: '10%',\r\n                    textStyle: {\r\n                        fontSize: 30,\r\n                        color: 'rgba(255, 255, 255, 0.7)'\r\n                    }\r\n                }, {\r\n                    text: '全国主要城市空气质量',\r\n                    subtext: 'data from pm25.com',\r\n                    sublink: 'http://www.pm25.com/',\r\n                    left: 'center',\r\n                    textStyle: {\r\n                        color: '#fff'\r\n                    }\r\n                }],\r\n                series: [{\r\n                    data: convertData(itemdatalist),\r\n                }]\r\n            });\r\n        }\r\n        myChart.setOption(option);\r\n    })\r\n    .catch(function(ex) {\r\n        console.log('parsing failed', ex)\r\n    })\r\n\r\noption = {\r\n    baseOption: {\r\n        backgroundColor: '#08304a',\r\n        timeline: {\r\n            show: true,\r\n            axisType: 'category',\r\n            tooltip: {\r\n                show: true,\r\n                formatter: function(params) {\r\n                    console.log(params);\r\n                    return params.name + '时';\r\n                }\r\n            },\r\n            autoPlay: true,\r\n            currentIndex: 6,\r\n            playInterval: 2000,\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    interval: 'auto',\r\n                    formatter: '{value}时',\r\n                },\r\n            },\r\n            data: [],\r\n        },\r\n        tooltip: {\r\n            show: true,\r\n            formatter: (params) => {\r\n                let data = \"位置:\" + params.name + \"<br/>\" + \"AQI值:\" + params.value[2] + \"<br/>\";\r\n                return data;\r\n            },\r\n        },\r\n        legend: {\r\n            selectedMode: 'single',\r\n            orient: 'vertical',\r\n            y: 'bottom',\r\n            x: 'right',\r\n            data: ['AQI'],\r\n            textStyle: {\r\n                color: '#fff',\r\n            },\r\n        },\r\n        visualMap: {\r\n            textStyle: {\r\n                color: '#fff',\r\n            },\r\n            itemWidth: 30,\r\n            itemHeight: 21,\r\n            pieces: [{\r\n                min: 0,\r\n                max: 50,\r\n                label: '优',\r\n                color: '#6ccc06'\r\n            }, {\r\n                min: 51,\r\n                max: 100,\r\n                label: '良',\r\n                color: '#fbd029'\r\n            }, {\r\n                min: 101,\r\n                max: 150,\r\n                label: '轻度污染',\r\n                color: '#fe8800'\r\n            }, {\r\n                min: 151,\r\n                max: 200,\r\n                label: '中度污染',\r\n                color: '#fe0000'\r\n            }, {\r\n                min: 201,\r\n                max: 300,\r\n                label: '重度污染',\r\n                color: '#970454'\r\n            }, {\r\n                min: 301,\r\n                max: 500,\r\n                label: '严重污染',\r\n                color: '#62001e'\r\n            }, ],\r\n        },\r\n        geo3D: {\r\n            environment: 'black',\r\n            boxHeight: 20,\r\n            map: 'china',\r\n            roam: true,\r\n            realisticMaterial: {\r\n                detailTexture: '#666',\r\n                textureTiling: 1,\r\n                metalness: 0,\r\n                roughness: 0.5,\r\n\r\n            },\r\n            label: {\r\n                show: false,\r\n                textStyle: {\r\n                    color: '#fff', //地图初始化区域字体颜色\r\n                    fontSize: 18,\r\n                    opacity: 1,\r\n                    backgroundColor: 'rgba(0,23,11,0)'\r\n                },\r\n            },\r\n            postEffect: {\r\n                enable: true,\r\n                SSAO: {\r\n                    enable: true,\r\n                    radius: 1,\r\n                    quality: 'high'\r\n                }\r\n            },\r\n            shading: 'lambert',\r\n            lambertMaterial: {\r\n                detailTexture: '',\r\n                textureTiling: 20\r\n            },\r\n            itemStyle: {\r\n                color: 'https://aqi.zfe.space/images/pisa.hdr',\r\n                opacity: 0.007,\r\n                borderWidth: 0,\r\n                borderColor: 'rgba(0,23,11,0)'\r\n            },\r\n            emphasis: { //当鼠标放上去  地区区域是否显示名称\r\n                label: {\r\n                    show: true,\r\n                    textStyle: {\r\n                        color: '#fff',\r\n                        fontSize: 3,\r\n                        backgroundColor: 'rgba(0,23,11,0)'\r\n                    }\r\n                }\r\n            },\r\n            //shading: 'lambert',\r\n            light: {\r\n                main: {\r\n                    intensity: 1,\r\n                    shadow: false,\r\n                    shadowQuality: 'high'\r\n                },\r\n                ambient: {\r\n                    intensity: 1.\r\n                },\r\n                ambientCubemap: {\r\n                    texture: 'https://aqi.zfe.space/images/pisa.hdr',\r\n                    exposure: 3,\r\n                    diffuseIntensity: 0.5,\r\n                    specularIntensity: 2\r\n                }\r\n            }\r\n        },\r\n        series: [{\r\n            name: 'AQI',\r\n            type: \"bar3D\",\r\n            coordinateSystem: 'geo3D',\r\n            barSize: 0.8, //柱子粗细\r\n            shading: 'realistic',\r\n            realisticMaterial: {\r\n                metalness: 1,\r\n                roughness: 0.2,\r\n            },\r\n            minHeight: 0.1,\r\n            instancing: true,\r\n            animation: true,\r\n            animationDurationUpdate: 500,\r\n            opacity: 1,\r\n            bevelSize: 0.3,\r\n            label: {\r\n                show: false,\r\n                formatter: '{b}'\r\n            },\r\n            data: [],\r\n        }]\r\n    },\r\n    options: [],\r\n};\r\nvar convertData = function(arr) {\r\n    var res = [];\r\n    for (var i = 0; i < arr.length; i++) {\r\n        var geoCoord = geoCoordMap[arr[i].name];\r\n        if (geoCoord) {\r\n            res.push({\r\n                name: arr[i].name,\r\n                value: geoCoord.concat(arr[i].value)\r\n            });\r\n        }\r\n    }\r\n    return res;\r\n};\r\n\r\n//进行图标参数设置\r\nfunction sortByKey(array, key) {\r\n    return array.sort(function(a, b) {\r\n        var x = a[key];\r\n        var y = b[key];\r\n        return ((x < y) ? -1 : ((x > y) ? 1 : 0));\r\n    });\r\n}\r\nif (screen.width < 768) {\r\n    option.baseOption.series[0].shading = \"lambert\"\r\n    myChart.setOption(option);\r\n}","html":"","externalScripts":"/dep/echarts/map/js/china.js,http://echarts.baidu.com/resource/echarts-gl-latest/dist/echarts-gl.min.js,https://aqi.zfe.space/js/location.js,/dep/echarts/map/js/world.js,https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js","updaterUID":"bd-4044629902","theme":"","layout":"","viewCount":321,"userName":"z***z","commentCount":0,"starCount":22,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xpPnGaEDX-.png?v=1611420928238","isCustomThumbnail":1,"builtinTags":["category-work","geo3D","legend","series-bar3D","timeline","title","tooltip","visualMap"],"customTags":["leancould","python","vercel","云函数CFC"],"updaterUserName":"z***z"}}