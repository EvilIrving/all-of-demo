{"status":0,"data":{"cid":"xLwIV7njyp","authorUid":"bd-554080228","authorUserName":"t***0","title":"Test Map","description":"","latestVersion":12,"alwaysLatest":1,"createTime":"2020-03-18T11:29:10.000Z","lastUpdateTime":"2020-03-18T11:29:10.000Z","auth":2,"uid":"bd-554080228","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":12,"parentVersion":11,"echartsVersion":"4.4.0","versionCreateTime":"2020-03-18T14:24:39.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1584539897741-awremJ0P_.json\";\n\nmyChart.showLoading();\n\n$.get('/asset/get/s/data-1584530867563-fUXCJiNUK.json', function(mapJson) {\n    echarts.registerMap('SGP', mapJson);\n\n    $.get(uploadedDataURL, function(covidDataJson) {\n        myChart.hideLoading();\n        \n        var covidData = JSON.parse(covidDataJson);\n        \n        var geoCoordMap = {\n            // \"NCID\": [103.847242, 1.322125],\n            // \"SGH\": [103.8298055,1.2857238],\n            // \"NTFGH\": [103.745413,1.333927],\n        };\n\n        var processedData = {};\n        Object.keys(covidData).forEach(function(key) {\n            if (!geoCoordMap[covidData[key]]) {\n                geoCoordMap[covidData[key].Hospital] = [covidData[key].HospitalLongitude, covidData[key].HospitalLatitude];\n            }\n            if (!processedData[covidData[key].Hospital]) {\n                processedData[covidData[key].Hospital] = {\n                    num: 1,\n                    details: {\n                        isRecovered: covidData[key].IsRecovered ? 1 : 0,\n                        isLocal: covidData[key].IsLocal ? 1 : 0\n                    }\n                };\n            } else {\n                processedData[covidData[key].Hospital].num += 1;\n                if (covidData[key].IsRecovered) {\n                    processedData[covidData[key].Hospital].details.isRecovered += 1;\n                }\n                 if (covidData[key].IsLocal) {\n                    processedData[covidData[key].Hospital].details.isLocal += 1;\n                }\n            }\n        });\n\n        var data = [];\n        Object.keys(processedData).forEach(function(key) {\n            data.push({\n                name: key,\n                value: processedData[key].num,\n                details: processedData[key].details\n            });\n        });\n\n        var convertData = function(data) {\n            var res = [];\n            for (var i = 0; i < data.length; i++) {\n                var geoCoord = geoCoordMap[data[i].name];\n                if (geoCoord) {\n                    res.push({\n                        name: data[i].name,\n                        value: geoCoord.concat(data[i].value).concat(data[i].details)\n                    });\n                }\n            }\n            return res;\n        };\n\n        option = {\n            backgroundColor: '#404a59',\n            title: {\n                text: 'Singapore Covid-19',\n                left: 'right'\n            },\n            tooltip: {\n                trigger: 'item'\n            },\n            visualMap: {\n                left: 'right',\n                min: 0,\n                max: 300,\n                inRange: {\n                    color: ['#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']\n                },\n                text: ['High', 'Low'],\n                calculable: true\n            },\n            toolbox: {\n                show: true,\n                //orient: 'vertical',\n                left: 'left',\n                top: 'top',\n                feature: {\n                    dataView: {\n                        readOnly: false\n                    },\n                    restore: {},\n                    saveAsImage: {}\n                }\n            },\n            geo: {\n                map: 'SGP',\n                label: {\n                    emphasis: {\n                        show: false\n                    }\n                },\n                roam: true,\n                itemStyle: {\n                    normal: {\n                        areaColor: '#323c48',\n                        borderColor: '#111'\n                    },\n                    emphasis: {\n                        areaColor: '#2a333d'\n                    }\n                }\n            },\n            series: [{\n                    name: 'Covid-19',\n                    type: 'heatmap',\n                    coordinateSystem: 'geo',\n                    data: convertData(data)\n                },\n                {\n                    name: 'Point',\n                    type: 'scatter',\n                    coordinateSystem: 'geo',\n                    data: convertData(data),\n                    symbolSize: function(val) {\n                        return (5 + Math.log2(val[2]));\n                    },\n                    label: {\n                        normal: {\n                            formatter: '{b}',\n                            position: 'right',\n                            show: false\n                        },\n                        emphasis: {\n                            show: true\n                        }\n                    },\n                    itemStyle: {\n                        normal: {\n                            color: '#ddb926'\n                        }\n                    },\n                    tooltip: {\n                        trigger: 'item',\n                        formatter: function(params) {\n                            var details = params.value[3];\n                            var tipHtml = '';\n                            tipHtml = '<div style=\"width:280px;height:180px;background:rgba(22,80,158,0.8);border:1px solid rgba(7,166,255,0.7)\">'\n                            +'<div style=\"width:100%;height:40px;line-height:40px;border-bottom:2px solid rgba(7,166,255,0.7);padding:0 0\">'\n                            +'<span style=\"margin-left:10px;color:#fff;font-size:16px;\">'+params.name+'</span>'+'</div>'\n                            +'<div style=\"padding:20px\">'\n                            +'<p style=\"color:#fff;font-size:12px;\">'+'<i style=\"display:inline-block;width:10px;height:10px;background:#16d6ff;border-radius:40px;margin:0 8px\">'+'</i>'\n                            +'Num：'+'<span style=\"color:#11ee7d;margin:0 6px;\">'+params.value[2]+'</span></p>'\n                            +'<p style=\"color:#fff;font-size:12px;\">'+'<i style=\"display:inline-block;width:10px;height:10px;background:#16d6ff;border-radius:40px;margin:0 8px\">'+'</i>'\n                            +'IsRecovered：'+'<span style=\"color:#11ee7d;margin:0 6px;\">'+details.isRecovered+'</span></p>'\n                             +'<p style=\"color:#fff;font-size:12px;\">'+'<i style=\"display:inline-block;width:10px;height:10px;background:#16d6ff;border-radius:40px;margin:0 8px\">'+'</i>'\n                            +'IsLocal：'+'<span style=\"color:#11ee7d;margin:0 6px;\">'+details.isLocal+'</span></p>'\n                            +'</div>'+'</div>';\n                            // return params.name + ' : ' + params.value[2];\n                            return tipHtml;\n                        }\n                    },\n                }\n            ]\n        };\n\n        myChart.setOption(option);\n    });\n});","html":"","externalScripts":"","updaterUID":"bd-554080228","theme":"","layout":"","viewCount":379,"userName":"t***0","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xLwIV7njyp.png?v=1584541480039","isCustomThumbnail":0,"builtinTags":["category-work","geo","series-heatmap","series-scatter","title","toolbox","tooltip","visualMap"],"customTags":[],"updaterUserName":"t***0"}}