{"status":0,"data":{"cid":"xlIkKU3gaM","authorUid":"bd-1277561159","authorUserName":"执***开","title":"停机次数","description":"","latestVersion":1,"alwaysLatest":1,"createTime":"2019-05-24T09:01:39.000Z","lastUpdateTime":"2019-05-24T09:01:39.000Z","auth":2,"uid":"bd-1277561159","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"4.2.1","versionCreateTime":"2019-05-24T09:01:39.000Z","code":"let data = [{\r\n    \"haltCountMonthGoal\": 80,\r\n    \"monthHaltCount\": 40,\r\n    \"name\": \"A\",\r\n    \"todayHaltCount\": 5\r\n}, {\r\n    \"haltCountMonthGoal\": 50,\r\n    \"monthHaltCount\": 50,\r\n    \"name\": \"C\",\r\n    \"todayHaltCount\": 10\r\n}, ]\r\ndata = data.reverse()\r\n// a在下，b在上\r\nconst [a, b] = data\r\n// 取最大值，上下两列的最大值都设为这个值\r\nconst max = Math.max(a.haltCountMonthGoal, b.haltCountMonthGoal)\r\n// 箭头标记点坐标，当月累计大于月目标时，去最大值，否则乘以相应的比例\r\nconst markPointData = [{\r\n        name: '日累计',\r\n        value: b.todayHaltCount,\r\n        xAxis: b.monthHaltCount >= b.haltCountMonthGoal ? max : (b.monthHaltCount + b.todayHaltCount) * (max / b.haltCountMonthGoal),\r\n        yAxis: 1\r\n    },\r\n    {\r\n        name: '日累计',\r\n        value: a.todayHaltCount,\r\n        xAxis: a.monthHaltCount >= a.haltCountMonthGoal ? max : (a.monthHaltCount + a.todayHaltCount) * (max / a.haltCountMonthGoal),\r\n        yAxis: 0\r\n    }\r\n]\r\n// 提示框标记坐标\r\nlet markPointRectData = JSON.parse(JSON.stringify(markPointData))\r\n// 提示框左侧和右侧都不能被隐藏\r\nmarkPointRectData.map(v => {\r\n    if ((v.xAxis - v.value) >= max) {\r\n        v.xAxis -= v.value * 2\r\n    }\r\n    let rate = v.xAxis / max\r\n    if (rate < 0.1) {\r\n        v.xAxis += max * 0.08\r\n    } else if (rate > 0.9) {\r\n        v.xAxis -= max * 0.08\r\n    }\r\n})\r\n// 标记线数据，上下两列\r\nlet markLineData = [\r\n    // 下标记线\r\n    [{\r\n            x: '2',\r\n            y: '76.5%',\r\n            lineStyle: {\r\n                width: 40,\r\n                color: '#ff001c'\r\n            }\r\n        },\r\n        {\r\n            x: '80%',\r\n            y: '76.5%'\r\n        }\r\n    ],\r\n    // 上标记线\r\n    [{\r\n            x: '15',\r\n            y: '38.4%',\r\n            lineStyle: {\r\n                width: 40,\r\n                color: '#ff001c'\r\n            }\r\n        },\r\n        {\r\n            x: '525',\r\n            y: '38.4%'\r\n        }\r\n    ]\r\n]\r\n// 标记线数量，长度\r\nlet monthCount = data.map((v, index) => {\r\n    // 长度是否为2，如果长度不为2，那么下标只能取0，而取不到1\r\n    const lengthIs2 = markLineData.length === 2\r\n    if (v.monthHaltCount >= v.haltCountMonthGoal) {\r\n        // 控制红色警告线的长度\r\n        markLineData[lengthIs2 ? index : 0][1].x -= 5.1\r\n        return max - v.todayHaltCount * (max / v.haltCountMonthGoal)\r\n    } else {\r\n        // 未超过，不显示标记线\r\n        markLineData.splice(lengthIs2 ? index : 0, 1)\r\n    }\r\n    return (v.monthHaltCount / v.haltCountMonthGoal) * max\r\n})\r\noption = {\r\n    color: ['#5095f3', '#000f84', '#bbdaf7'],\r\n    title: {\r\n        text: '停机次数',\r\n        textStyle: {\r\n            fontFamily: 'PingFang SC Bold',\r\n            fontSize: 30,\r\n            fontWeight: 'lighter'\r\n        },\r\n        left: 12,\r\n        top: 15\r\n    },\r\n    legend: {\r\n        textStyle: {\r\n            fontFamily: 'PingFang SC Regular',\r\n            fontSize: 100 / 4\r\n        },\r\n        right: 15,\r\n        top: 66 / 4,\r\n        itemHeight: 96 / 4,\r\n        itemWidth: 96 / 4,\r\n        itemGap: 76 / 4,\r\n        data: [{\r\n                name: '日累计',\r\n                icon: 'rect'\r\n            },\r\n            {\r\n                name: '月累计',\r\n                icon: 'rect'\r\n            },\r\n            {\r\n                name: '月目标',\r\n                icon: 'rect'\r\n            }\r\n        ]\r\n    },\r\n    grid: {\r\n        top: 60,\r\n        left: 15,\r\n        right: 15,\r\n        bottom: -10,\r\n        containLabel: true\r\n    },\r\n    xAxis: {\r\n        show: false,\r\n        type: 'value',\r\n        max: max\r\n    },\r\n    yAxis: {\r\n        type: 'category',\r\n        axisLabel: {\r\n            show: false\r\n        },\r\n        data: data.map(v => v.name),\r\n        splitLine: {\r\n            show: false\r\n        },\r\n        axisTick: {\r\n            show: false\r\n        },\r\n        axisLine: {\r\n            show: false\r\n        }\r\n    },\r\n    series: [{\r\n            name: '月累计',\r\n            type: 'bar',\r\n            barWidth: 160 / 4,\r\n            stack: 'count',\r\n            label: {\r\n                show: true,\r\n                position: 'insideLeft',\r\n                fontFamily: 'PingFang SC Regular',\r\n                fontSize: 18,\r\n                offset: [0, -40],\r\n                color: '#333',\r\n                formatter: params => {\r\n                    return '{letter|' + params.name + '}组 月累计停机次数 ' +\r\n                        '{number|' + (params.dataIndex === 0 ? a : b).monthHaltCount + '}次'\r\n                },\r\n                rich: {\r\n                    letter: {\r\n                        fontFamily: 'PingFang SC Regular',\r\n                        color: '#333',\r\n                        fontSize: 30,\r\n                        verticalAlign: 'top'\r\n                    },\r\n                    number: {\r\n                        fontFamily: 'PingFang SC Regular',\r\n                        color: '#333',\r\n                        fontSize: 30,\r\n                        verticalAlign: 'top',\r\n                        lineHeight: 36\r\n                    }\r\n                }\r\n            },\r\n            markLine: {\r\n                symbol: 'none',\r\n                lineStyle: {\r\n                    type: 'solid'\r\n                },\r\n                silent: true,\r\n                label: {\r\n                    position: 'middle',\r\n                    color: '#fff',\r\n                    fontFamily: 'PingFang SC Regular',\r\n                    fontSize: 18,\r\n                    height: 30,\r\n                    lineHeight: 40,\r\n                    verticalAlign: 'middle',\r\n                    formatter: params => {\r\n                        const {\r\n                            haltCountMonthGoal,\r\n                            monthHaltCount\r\n                        } = data[params.dataIndex]\r\n                        const value = monthHaltCount - haltCountMonthGoal\r\n                        if (value === 0) {\r\n                            return '已触及月目标'\r\n                        } else if (value > 0) {\r\n                            return '已超出月目标停机次数{number|' + value + '}次'\r\n                        }\r\n                        return ''\r\n                    },\r\n                    rich: {\r\n                        number: {\r\n                            fontFamily: 'PingFang SC Regular',\r\n                            fontSize: 27,\r\n                            color: '#fff',\r\n                            verticalAlign: 'middle',\r\n                            lineHeight: 27\r\n                        }\r\n                    }\r\n                },\r\n                data: markLineData\r\n            },\r\n            data: monthCount\r\n        },\r\n        {\r\n            name: '日累计',\r\n            type: 'bar',\r\n            barWidth: 160 / 4,\r\n            barGap: '0%',\r\n            stack: 'count',\r\n            label: {\r\n                normal: {\r\n                    show: false,\r\n                    position: 'top',\r\n                    fontFamily: 'PingFang SC Regular',\r\n                    fontSize: 120 / 4,\r\n                    color: '#333'\r\n                }\r\n            },\r\n            data: data.map(v => {\r\n                return v.todayHaltCount * (max / v.haltCountMonthGoal)\r\n            }),\r\n            markPoint: {\r\n                symbol: 'arrow',\r\n                symbolSize: 15,\r\n                symbolOffset: [0, 20],\r\n                data: markPointData,\r\n                label: {\r\n                    show: false\r\n                }\r\n            }\r\n        },\r\n        {\r\n            name: '月目标',\r\n            type: 'bar',\r\n            barWidth: 160 / 4,\r\n            stack: 'count',\r\n            label: {\r\n                show: true,\r\n                position: 'insideRight',\r\n                offset: [0, -40],\r\n                fontFamily: 'PingFang SC Regular',\r\n                fontSize: 18,\r\n                color: '#333',\r\n                formatter: params => {\r\n                    return '月目标停机次数 {number|' + (params.dataIndex === 0 ? a : b).haltCountMonthGoal + '}次'\r\n                },\r\n                rich: {\r\n                    number: {\r\n                        fontFamily: 'PingFang SC Regular',\r\n                        color: '#333',\r\n                        fontSize: 30,\r\n                        verticalAlign: 'top',\r\n                        lineHeight: 36\r\n                    }\r\n                }\r\n            },\r\n            data: data.map(v => {\r\n                if (v.monthHaltCount >= v.haltCountMonthGoal) {\r\n                    return 0\r\n                }\r\n                return max - (v.monthHaltCount / v.haltCountMonthGoal) * max - v.todayHaltCount * (max / v.haltCountMonthGoal)\r\n            }),\r\n            markPoint: {\r\n                symbol: 'rect',\r\n                symbolSize: [100, 30],\r\n                symbolOffset: [0, 45],\r\n                data: markPointRectData,\r\n                itemStyle: {\r\n                    color: '#000f84'\r\n                },\r\n                label: {\r\n                    fontFamily: 'PingFang SC Regular',\r\n                    fontSize: 15,\r\n                    formatter: params => {\r\n                        return '今日已停 ' + (params.dataIndex === 0 ? b : a).todayHaltCount + '次'\r\n                    },\r\n                    offset: [0, 0]\r\n                }\r\n            }\r\n        }\r\n    ]\r\n}","html":"","externalScripts":"","updaterUID":"bd-1277561159","theme":"","layout":"","viewCount":6084,"userName":"执***开","commentCount":0,"starCount":37,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xlIkKU3gaM.png?v=1558688500028","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","markLine","markPoint","series-bar","title"],"customTags":[],"updaterUserName":"执***开"}}