{"status":0,"data":{"cid":"xWg1n7lAUN","authorUid":"bd-696783921","authorUserName":"n***人","title":"经纬度查询","description":"调用高德、腾讯、百度地址解析插件，获取精准经纬度。可点击地图获取实时鼠标漫游经纬度","latestVersion":11,"alwaysLatest":1,"createTime":"2018-11-14T05:47:49.000Z","lastUpdateTime":"2019-08-28T09:49:41.000Z","auth":2,"uid":"bd-696783921","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":11,"parentVersion":10,"echartsVersion":"4.8.0","versionCreateTime":"2021-01-27T03:13:07.000Z","code":"const map = Loca.create(myChart.getDom().id, {\n    pitch: 52\n});\n\nmap.on('mapload', function() {\n    map.getMap().plugin(['AMap.ControlBar'], function() {\n        var controlBar = new AMap.ControlBar({\n            position: {\n                right: '0',\n                bottom: '-173px'\n            }\n        });\n        map.getMap().addControl(controlBar);\n    });\n    map.getMap().plugin(['AMap.MapType'], function() {\n        var mapType = new AMap.MapType({\n            liteStyle: true\n        });\n        map.getMap().addControl(mapType);\n    });\n    map.getMap().plugin(['AMap.Scale'], function() {\n        var scale = new AMap.Scale();\n        map.getMap().addControl(scale);\n    });\n    map.getMap().plugin(['AMap.ToolBar'], function() {\n        var toolBar = new AMap.ToolBar();\n        map.getMap().addControl(toolBar);\n    });\n    map.getMap().on('complete', function() {\n\n        var infoWin = new AMap.InfoWindow({\n            autoMove: true,\n            //closeWhenClickMap: true\n        });\n        this.on('mousemove', function(e) {\n            var $lnglat = $('#lnglat');\n            if (!$lnglat.length) {\n                $lnglat = $('<div></div>');\n                $lnglat.prop('id', 'lnglat');\n                $lnglat.appendTo($('#' + this.J.id));\n                $lnglat.css({\n                    position: 'fixed',\n                    'background-color': 'white',\n                    padding: '.52%',\n                    'box-shadow': '0px 1px 4px #ddd'\n                })\n            }\n            $('#lnglat').show();\n            $lnglat.css({\n                top: e.pixel.y + 21,\n                left: e.pixel.x + 12\n            })\n\n            this.plugin('AMap.Geocoder', function() {\n                new AMap.Geocoder().getAddress([e.lnglat.lng, e.lnglat.lat], function(status, result) {\n                    if (status === 'complete' && result.regeocode) {\n                        var address = result.regeocode.formattedAddress;\n                        $lnglat.html(address + '<br/>' + [e.lnglat.lng, e.lnglat.lat].join(','))\n                    } else {\n                        $('#lnglat').hide();\n                    }\n                });\n            })\n        });\n        this.on('mouseleave', function() {\n            $('#lnglat').hide();\n        })\n\n        function showinfo(address, point) {\n            infoWin.setContent(address + '<br>经度：' + point[0] + '<br>纬度：' + point[1]);\n            infoWin.open(map.getMap(), new AMap.LngLat(point[0], point[1]));\n            map.getMap().setCenter(point);\n            map.getMap().setZoom(15);\n        }\n\n        function getGeoCoord(address, func) {\n            var center;\n            $.ajax({\n                type: \"post\",\n                url: 'http://apis.map.qq.com/ws/geocoder/v1/',\n                dataType: 'jsonp',\n                async: false,\n                data: {\n                    key: '4ERBZ-DVSWW-VHMR6-O26OJ-65VZ6-4HBRD',\n                    output: 'jsonp',\n                    address: address\n                },\n                success: function(result) {\n                    if (result.result && result.result.location) {\n                        center = [result.result.location.lng, result.result.location.lat];\n                        func(address, center);\n                    } else {\n                        function amapsearch(address, func) {\n                            var center;\n                            $.ajax({\n                                type: \"post\",\n                                url: 'http://restapi.amap.com/v3/geocode/geo',\n                                dataType: 'jsonp',\n                                async: false,\n                                data: {\n                                    key: 'cb83484daa1f719b2a64dd48f66f60a3',\n                                    address: address\n                                },\n                                success: function(result) {\n                                    if (result.geocodes && result.geocodes.length) {\n                                        center = result.geocodes[0].location.split(',');\n                                        func(address, center);\n\n                                    } else {\n                                        function bmapsearch(address, func) {\n                                            $.ajax({\n                                                type: \"post\",\n                                                url: 'http://api.map.baidu.com/geocoder/v2/',\n                                                dataType: 'jsonp',\n                                                async: false,\n                                                data: {\n                                                    ak: 'ZUONbpqGBsYGXNIYHicvbAbM',\n                                                    output: 'json',\n                                                    address: address\n                                                },\n                                                success: function(result) {\n                                                    if (result.result && result.result.location) {\n                                                        center = [result.result.location.lng, result.result.location.lat];\n                                                        func(address, center);\n                                                    }\n                                                }\n                                            });\n                                        }\n                                        bmapsearch(address, func);\n                                    }\n                                }\n                            });\n                        }\n                        amapsearch(address, func);\n                    }\n                }\n            });\n        }\n\n        this.plugin([\"AMap.Geolocation\"], function() {\n            new AMap.Geolocation().getCurrentPosition(function(status, r) {\n                if (r.position) {\n                    showinfo(r.formattedAddress, [r.position.lng, r.position.lat]);\n                }\n            });\n        });\n        var $div = $('<div></div>')\n        var $input = $('<input id=\"tipinput\" type=\"text\" placeholder=\"请输入要查询的地址\" />');\n        $div.css({\n            position: 'fixed',\n            'line-height': 2,\n            left: '100px',\n            'text-align': 'center',\n            'box-shadow': '0 1px 4px #ddd',\n            border: 'navajowhite',\n            padding: '1% 4%',\n            'background-color': '#2e465699',\n\n            'max-width': '80%'\n\n        });\n        $input.css({\n            'line-height': 2,\n            'text-align': 'center',\n            'box-shadow': '0 1px 4px #ddd',\n            border: 'navajowhite',\n            padding: '1% 4%'\n\n        })\n        $div.append($input);\n        var $button = $('<button>搜索</button>');\n        $button.css({\n            'line-height': 2,\n            'margin-left': '-8%',\n            color: 'white',\n            'background-color': '#2f2525',\n            'font-weight': 'bold'\n        })\n        // $button.bind('click', function() {\n        //     getGeoCoord($('#tipinput').val(), showinfo)\n        // })\n        $div.append($button);\n        $(this.getContainer()).after($div);\n        this.plugin(['AMap.Autocomplete', 'AMap.PlaceSearch'], function() {\n            var auto = new AMap.Autocomplete({\n                input: \"tipinput\"\n            });\n            var placeSearch = new AMap.PlaceSearch({\n                map: map.getMap()\n            }); //构造地点查询类\n            AMap.event.addListener(auto, \"select\", select); //注册监听，当选中某条记录时会触发\n            function select(e) {\n                placeSearch.setCity(e.poi.adcode);\n                placeSearch.search(e.poi.name);\n                console.log(e.poi)\n                showinfo(e.poi.name, [e.poi.location.lng, e.poi.location.lat]);\n                //getGeoCoord(e.poi.district + e.poi.name, showinfo);\n            }\n        });\n    })\n})","html":"","externalScripts":"//webapi.amap.com/loca?v=1.2.0&key=35a871e5905ecfd749bd998448b9cd03","updaterUID":"bd-696783921","theme":"default","layout":"","viewCount":218006,"userName":"n***人","commentCount":6,"starCount":60,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xWg1n7lAUN.png?v=1566985781334","isCustomThumbnail":1,"builtinTags":["category-work"],"customTags":["amap","bmap","qmap"],"updaterUserName":"n***人"}}