{"status":0,"data":{"cid":"xSyOCuRATb","authorUid":"bd-460850157","authorUserName":"S***七","title":"地图下钻","description":"copy自用","latestVersion":1,"alwaysLatest":1,"createTime":"2017-10-26T03:38:55.000Z","lastUpdateTime":"2017-10-26T03:38:55.000Z","auth":2,"uid":"bd-460850157","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":1,"parentVersion":-1,"echartsVersion":"3.7.2","versionCreateTime":"2017-10-26T03:38:55.000Z","code":"function loadJSON() {\n    var i, o, n, m, l, k, j;\n    a = myChart, a.showLoading(), i = $(\".panel\").find(\"option:selected\").last(), i.attr(\"selected\", !0), \n    o = i.val().split(\"|\"), n = o[0], m = o[1], l = i.text(), k = {\n        subdistrict: 1,\n        extensions: \"all\"\n    }, j = new AMap.DistrictSearch(k), j.setSubdistrict(1), j.setLevel(n), j.search(l, function(A, z) {\n        function y() {\n            this.type = \"FeatureCollection\", this.features = [];\n        }\n        function x() {\n            this.type = \"Feature\", this.id = \"\", this.properties = {\n                name: \"\",\n                cp: [],\n                childNum: 1\n            }, this.geometry = {\n                type: \"Polygon\",\n                coordinates: []\n            };\n        }\n        function w(H, G) {\n            var B, q, p, F = [], E = [], D = [], C = H.boundaries.length;\n            if (1 === C) {\n                for (B = H.boundaries[0], q = 0; q < B.length; q++) {\n                    F[0] = B[q].lng, F[1] = B[q].lat, E.push(F), F = [];\n                }\n                G.push(E);\n            } else {\n                for (p = 0; C > p; p++) {\n                    for (B = H.boundaries[p], q = 0; q < B.length; q++) {\n                        F[0] = B[q].lng, F[1] = B[q].lat, E.push(F), F = [];\n                    }\n                    D.push(E), E = [], G.push(D), D = [];\n                }\n            }\n        }\n        function v(f) {\n            f.UTF8Encoding = !0;\n            var c = f.features;\n            return c ? (c.forEach(function(p) {\n                var g = p.geometry.encodeOffsets = [], q = p.geometry.coordinates;\n                \"Polygon\" === p.geometry.type ? q.forEach(function(b, B) {\n                    q[B] = u(b, g[B] = []);\n                }) : \"MultiPolygon\" === p.geometry.type && q.forEach(function(b, B) {\n                    g[B] = [], b.forEach(function(C, D) {\n                        q[B][D] = u(C, g[B][D] = []);\n                    });\n                });\n            }), f) : void 0;\n        }\n        function u(q, p) {\n            var C, B, F = \"\", E = t(q[0][0]), D = t(q[0][1]);\n            for (p[0] = E, p[1] = D, C = 0; C < q.length; C++) {\n                B = q[C], F += s(B[0], E), F += s(B[1], D), E = t(B[0]), D = t(B[1]);\n            }\n            return F;\n        }\n        function t(b) {\n            return Math.ceil(1024 * b);\n        }\n        function s(f, c) {\n            return f = t(f), f -= c, 8232 == 64 + (f << 1 ^ f >> 15) && f--, f = f << 1 ^ f >> 15, \n            String.fromCharCode(f + 64);\n        }\n        function r(K, J, I) {\n            var B, g, f, H = new y(), G = H.features, F = K[0], E = F.districtList, D = F.citycode, C = 0;\n            if (D.length) {\n                for (B = 0, g = E.length; g > B; B++) {\n                    C++, j.search(E[B].name, function(p, q) {\n                        function c(N, M) {\n                            var T, S, R, Q, P, O;\n                            for (T = new x(), S = [], R = [], Q = 0, P = N.length; P > Q; Q++) {\n                                if (O = N[Q], O.citycode === M) {\n                                    return T.id = O.adcode, T.properties.name = O.name, T.properties.childNum = O.boundaries.length, \n                                    T.properties.childNum > 1 && (T.geometry.type = \"MultiPolygon\"), S[0] = O.center.lng, \n                                    S[1] = O.center.lat, T.properties.cp = S, S = [], w(O, R), T.geometry.coordinates = R, \n                                    R = [], T;\n                                }\n                            }\n                        }\n                        C--;\n                        var b = q.districtList, L = c(b, m);\n                        L && G.push(L), 0 === C && (J && (H = v(H)), I(H), j.setSubdistrict(1));\n                    });\n                }\n            } else {\n                for (B = 0, g = E.length; g > B; B++) {\n                    f = E[B].name, C++, j.search(f, function(q, c) {\n                        function M(O) {\n                            var N, T, S, R, Q, P;\n                            for (N = new x(), T = [], S = [], R = 0, Q = O.length; Q > R; R++) {\n                                return P = O[R], N.id = P.adcode, N.properties.name = P.name, N.properties.childNum = P.boundaries.length, \n                                N.properties.childNum > 1 && (N.geometry.type = \"MultiPolygon\"), T[0] = P.center.lng, \n                                T[1] = P.center.lat, N.properties.cp = T, T = [], w(P, S), N.geometry.coordinates = S, \n                                S = [], N;\n                            }\n                        }\n                        C--;\n                        var L = c.districtList, p = M(L);\n                        G.push(p), 0 === C && (H = v(H), I(H), j.setSubdistrict(1));\n                    });\n                }\n            }\n        }\n        function h(H, G, F) {\n            function E(I, p) {\n                var O, N, M, L, K, J;\n                for (O = new x(), N = [], M = [], L = 0, K = I.length; K > L; L++) {\n                    if (J = I[L], J.citycode == p) {\n                        return O.id = J.adcode, O.properties.name = J.name, O.properties.childNum = J.boundaries.length, \n                        O.properties.childNum > 1 && (O.geometry.type = \"MultiPolygon\"), N[0] = J.center.lng, \n                        N[1] = J.center.lat, O.properties.cp = N, N = [], w(J, M), O.geometry.coordinates = M, \n                        O;\n                    }\n                }\n            }\n            function D(I) {\n                var p = new x(), K = [], J = [];\n                return p.id = I.adcode, p.properties.name = I.name, p.properties.childNum = I.boundaries.length, \n                p.properties.childNum > 1 && (p.geometry.type = \"MultiPolygon\"), K[0] = I.center.lng, \n                K[1] = I.center.lat, p.properties.cp = K, K = [], w(I, J), p.geometry.coordinates = J, \n                p;\n            }\n            var C, B = new y(), q = B.features, g = H[0], f = (g.citycode, g.level);\n            C = \"district\" === f ? E(H, m) : D(g), q.push(C), G && (B = v(B)), F(B), j.setSubdistrict(1);\n        }\n        function e(c) {\n            echarts.registerMap(\"mapArea\", c), $(\"#\" + a.getDom().id).contextmenu(function() {\n                return !1;\n            }), a.clear(), a.setOption({\n                color: [ \"#dd6b66\", \"#759aa0\", \"#e69d87\", \"#8dc1a9\", \"#ea7e53\", \"#eedd78\", \"#73a373\", \"#73b9bc\", \"#7289ab\", \"#91ca8c\", \"#f49f42\" ],\n                backgroundColor: \"#333\",\n                textStyle: {\n                    color: \"#eee\",\n                    fontFamily: \"Microsoft YaHei\",\n                    fontSize: 12,\n                    fontStyle: \"normal\",\n                    fontWeight: \"normal\"\n                },\n                title: {\n                    text: $(\".panel select:eq(-2) option:selected\").text(),\n                    subtext: \"注：点击下钻，右击跳出（目前只支持到县市级）\",\n                    textStyle: {\n                        color: \"#fff\"\n                    }\n                },\n                geo: {\n                    map: \"mapArea\",\n                    roam: !0,\n                    selectedMode: \"single\",\n                    itemStyle: {\n                        normal: {\n                            borderColor: \"rgba(100,149,237,1)\",\n                            borderWidth: 1.5,\n                            areaColor: \"#1b1b1b\"\n                        }\n                    }\n                }\n            }), a.on(\"geoselectchanged\", function(b) {\n                /*$(\".panel select:last-child option\").each(function() {\n                    return $(this).text() == b.batch[0].name ? ($(this).attr(\"selected\", !0), void loadJSON()) : void 0;\n                });*/\n            }), a.getZr().on(\"mousedown\", function(b) {\n                switch (b.event.which) {\n                  case 3:\n                    $(\".panel select\").length > 2 && ($(\".panel select:last-child\").remove(), $(\".panel select:last-child\").remove(), \n                    loadJSON());\n                }\n            }), a.hideLoading();\n        }\n        switch (n) {\n          case \"district\":\n          case \"biz_area\":\n            h(z.districtList, !0, e);\n            break;\n\n          default:\n            r(z.districtList, !0, e);\n            var d = $(\"<select></select>\");\n            switch (d.change(function() {\n                $(this).nextAll().remove(), $(this).val() || $(this).remove(), loadJSON();\n            }), d.appendTo($(\".panel\")), n) {\n              case \"country\":\n                d.append($('<option value=\"\">--  所有省(行政区,直辖市)  --</option>'));\n                break;\n\n              case \"province\":\n                d.append($('<option value=\"\">--  所有城市  --</option>'));\n                break;\n\n              case \"city\":\n                d.append($('<option value=\"\">--  所有区县  --</option>'));\n            }\n            z.districtList[0].districtList.forEach(function(b) {\n                d.append($('<option value=\"' + b.level + (b.citycode ? \"|\" + b.citycode : \"\") + '\">' + b.name + \"</option>\"));\n            });\n        }\n    });\n}\n\n$(\"body\").append($('<div class=\"panel\" style=\"position: absolute;background-color: #fff;border: solid 1px silver;box-shadow: 3px 4px 3px 0px silver;right: 10px;top: 10px;padding: 5px 10px;font-size: 12px;border-radius: 4px\">请选择区域：<select><option selected=\"selected\" value=\"country\">中国</option></select></div>')), \nloadJSON();","html":"","externalScripts":"http://webapi.amap.com/maps?v=1.3&key=9d4f5c2078ba12cb9d9d09c4e81c95d0&plugin=AMap.DistrictSearch","updaterUID":"bd-460850157","theme":"","layout":"","viewCount":416,"userName":"S***七","commentCount":0,"starCount":5,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xSyOCuRATb.png?v=1508989135974","isCustomThumbnail":0,"builtinTags":["category-work"],"customTags":[],"updaterUserName":"S***七"}}