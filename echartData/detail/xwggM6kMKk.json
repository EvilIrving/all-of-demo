{"status":0,"data":{"cid":"xwggM6kMKk","authorUid":"obd-ol2lzLE0qKlGJfGPR1IZeu8AHdcyV0z","authorUserName":"l***e","title":"失能申请","description":"","latestVersion":2,"alwaysLatest":0,"createTime":"2022-01-13T03:46:15.000Z","lastUpdateTime":"2022-01-13T03:48:25.000Z","auth":2,"uid":"obd-ol2lzLE0qKlGJfGPR1IZeu8AHdcyV0z","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"5.2.2","versionCreateTime":"2022-01-13T03:48:25.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1641799723453-_SqgBq685.json\";\r\n// 1. 初始化地图\r\n$.getJSON(uploadedDataURL, function (geoJson) {\r\n    echarts.registerMap(\"tianjin\", geoJson);\r\n    option = {\r\n        legend: {\r\n            orient: \"vertical\",\r\n            top: 20,\r\n            left: 20,\r\n            data: [\r\n                { name: \"失能评估申请\", textStyle: { color: \"#fff\" } },\r\n                { name: \"符合享受待遇\", textStyle: { color: \"#fff\" } },\r\n            ],\r\n            selectedMode: false,\r\n        },\r\n        geo: {\r\n            map: \"tianjin\",\r\n            roam: true,\r\n            zoom: 1.2,\r\n            label: { show: false, color: \"#fff\" },\r\n            itemStyle: { areaColor: \"#033786\", borderWidth: 2, borderColor: \"#48D6FD\", color: \"#eee\" },\r\n            emphasis: {\r\n                label: { color: \"#fff\", show: true },\r\n                itemStyle: {\r\n                    areaColor: \"#FFE700\",\r\n                    borderWidth: 2,\r\n                    borderColor: \"#48D6FD\",\r\n                    color: \"rgba(255,215,0,0.8)\",\r\n                },\r\n            },\r\n            silent: true,\r\n            scaleLimit: { min: 1.2, max: 7 },\r\n            zlevel: 0,\r\n            z: 0,\r\n            show: true,\r\n            left: \"center\",\r\n            top: \"center\",\r\n            aspectScale: null,\r\n            boundingCoords: null,\r\n            center: null,\r\n            select: { label: { show: true, color: \"rgb(100,0,0)\" }, itemStyle: { color: \"rgba(255,215,0,0.8)\" } },\r\n            regions: [\r\n                { name: \"滨海新区\", label: { show: true } },\r\n                { name: \"西青区\", label: { show: true } },\r\n                { name: \"河东区\", label: { show: true } },\r\n                { name: \"津南区\", label: { show: true } },\r\n                { name: \"东丽区\", label: { show: true } },\r\n                { name: \"红桥区\", label: { show: true } },\r\n                { name: \"蓟州区\", label: { show: true } },\r\n                { name: \"静海区\", label: { show: true } },\r\n                { name: \"河北区\", label: { show: false } },\r\n                { name: \"北辰区\", label: { show: true } },\r\n                { name: \"武清区\", label: { show: true } },\r\n                { name: \"宝坻区\", label: { show: true } },\r\n                { name: \"宁河区\", label: { show: true } },\r\n                { name: \"南开区\", label: { show: false } },\r\n                { name: \"河西区\", label: { show: true } },\r\n                { name: \"和平区\", label: { show: false } },\r\n            ],\r\n            selectedMap: {},\r\n        },\r\n        series: [\r\n            {\r\n                name: \"失能评估申请\",\r\n                coordinateSystem: \"geo\",\r\n                type: \"effectScatter\",\r\n                showEffectOn: \"render\",\r\n                rippleEffect: { brushType: \"stroke\" },\r\n                itemStyle: { color: \"#2CD050\", shadowBlur: 10, shadowColor: \"#333\" },\r\n                symbolSize: 10,\r\n                data: [],\r\n            },\r\n            {\r\n                name: \"符合享受待遇\",\r\n                coordinateSystem: \"geo\",\r\n                type: \"effectScatter\",\r\n                showEffectOn: \"render\",\r\n                rippleEffect: { brushType: \"stroke\" },\r\n                itemStyle: { color: \"#F66B72\", shadowBlur: 10, shadowColor: \"#333\" },\r\n                symbolSize: 10,\r\n                data: [],\r\n            },\r\n        ],\r\n    };\r\n    myChart.setOption(option);\r\n});\r\n\r\n// 2. 添加缩放区域展示\r\n// 根据视图缩放判断区域名称是否展示\r\nconst controlLabelShowByZoom = (zoom, data) => {\r\n    data = data || [\r\n        { name: \"滨海新区\" },\r\n        { name: \"西青区\" },\r\n        { name: \"河东区\" },\r\n        { name: \"津南区\" },\r\n        { name: \"东丽区\" },\r\n        { name: \"红桥区\" },\r\n        { name: \"蓟州区\" },\r\n        { name: \"静海区\" },\r\n        { name: \"河北区\" },\r\n        { name: \"北辰区\" },\r\n        { name: \"武清区\" },\r\n        { name: \"宝坻区\" },\r\n        { name: \"宁河区\" },\r\n        { name: \"南开区\" },\r\n        { name: \"河西区\" },\r\n        { name: \"和平区\" },\r\n    ];\r\n    zoom = zoom || 1.2;\r\n    return data.map((v) => {\r\n        if (v.name === \"南开区\") {\r\n            v.label = { ...v.label, show: zoom >= 1.45 };\r\n        } else if ([\"河北区\", \"和平区\"].includes(v.name)) {\r\n            v.label = { ...v.label, show: zoom >= 2.6 };\r\n        } else {\r\n            v.label = { ...v.label, show: true };\r\n        }\r\n        return v;\r\n    });\r\n};\r\n// 缩放事件监听\r\nmyChart.on(\"georoam\", (params) => {\r\n    option.series = myChart.getOption().series;\r\n    option.geo = myChart.getOption().geo[0];\r\n    if (params.dy === undefined && params.dx === undefined) {\r\n        let zoom = myChart.getOption()?.geo[0].zoom;\r\n        option.geo.regions = controlLabelShowByZoom(zoom);\r\n        myChart.clear();\r\n        // true => noMerge:true 不进行选项合并，使用覆盖方式\r\n        myChart.setOption(option || {}, true);\r\n    }\r\n});\r\n\r\n// 3. 随机生成闪烁点\r\n/**\r\n * 生成指定区域内随机点\r\n * @param {*} echartInstance 当前地图组件\r\n * @param {*} areaName 区域名称\r\n * @returns [lon,lat]\r\n */\r\nconst generatePointLAL = (echartInstance, areaName) => {\r\n    let region = echartInstance.getModel().getComponent(\"geo\").coordinateSystem.getRegion(areaName);\r\n    let rect = region.getBoundingRect();\r\n    let coord = [Infinity, Infinity];\r\n    while (!region.contain(coord)) {\r\n        coord[0] = rect.x + Math.random() * rect.width;\r\n        coord[1] = rect.y + Math.random() * rect.height;\r\n    }\r\n    return coord;\r\n};\r\n\r\nconst datas = [\"蓟州区\", \"武清区\", \"和平区\"];\r\nsetInterval(function () {\r\n    let d1 = datas.map((v) => ({ name: v, value: generatePointLAL(myChart, v) }));\r\n    let d2 = datas.map((v) => ({ name: v, value: generatePointLAL(myChart, v) }));\r\n    option.series[0].data = d1;\r\n    option.series[1].data = d2;\r\n    myChart.clear();\r\n    // true => noMerge:true 不进行选项合并，使用覆盖方式\r\n    myChart.setOption(option || {}, true);\r\n}, 1000);\r\n","html":"","externalScripts":"","updaterUID":"obd-ol2lzLE0qKlGJfGPR1IZeu8AHdcyV0z","theme":"dark","layout":"","viewCount":0,"userName":"l***e","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xwggM6kMKk.png?v=1642045705667","isCustomThumbnail":0,"builtinTags":["category-work","geo","legend","series-effectScatter"],"customTags":["地图","天津","缩放","随机点"],"updaterUserName":"l***e"}}