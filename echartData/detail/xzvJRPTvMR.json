{"status":0,"data":{"cid":"xzvJRPTvMR","authorUid":"bd-1493481016","authorUserName":"i***a","title":"最近三个月各产品良率和出货率变化趋势","description":"产品分组折线图，多grid，并且可根据分组个数设置每个grid占用的宽度","latestVersion":10,"alwaysLatest":1,"createTime":"2018-12-24T05:47:35.000Z","lastUpdateTime":"2018-12-24T05:47:35.000Z","auth":2,"uid":"bd-1493481016","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":10,"parentVersion":9,"echartsVersion":"4.2.0","versionCreateTime":"2019-01-03T02:00:59.000Z","code":"\tvar threeMonthRate = [\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]},\r\n\t    {\"ThreeMonthRate\":[{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8},{\"yield\": Math.random()*0.1+0.9 , \"outputrate\": Math.random()*0.2+0.8}]}\r\n\t    ];\r\n\tvar productnames = ['产品1','产品2','产品3','产品4','产品5','产品6','产品7','产品8','产品9','产品10','产品11','产品12'];\r\n\r\n\tvar grids = [];\r\n\tvar xAxes = [];\r\n\tvar yAxes = [];\r\n\tvar series = [];\r\n\tvar titles = [];\r\n\tvar datas =[];\r\n\tvar aGradeRates=[];\r\n\tvar count = 0;\r\n\r\n\tvar zh_month = new Array(3);//最近三个月\r\n\tvar now = new Date(); \r\n\tvar currentMonth = now.getMonth()+1; \r\n\tvar productsnum = productnames.length;\r\n\tvar monthFontSize = 12; //default month lablesize\r\n\tvar monthRorate = 0; //default month lable rorate\r\n\tif(productnames.length< 6) {monthFontSize = 12; monthRorate = 0;}\r\n\telse if(productnames.length> 6) { monthFontSize = 9;monthRorate = -90;}\r\n\t\r\n\tfor(var i=0; i<3; i++){\r\n\t\tvar month = currentMonth-2+i;\r\n\t\tswitch(month)\r\n\t\t{\r\n\t\t\tcase 1: zh_month[i] = '一月';break;\r\n\t\t\tcase 2: zh_month[i] = '二月';break;\r\n\t\t\tcase 3: zh_month[i] = '三月';break;\r\n\t\t\tcase 4: zh_month[i] = '四月';break;\r\n\t\t\tcase 5: zh_month[i] = '五月';break;\r\n\t\t\tcase 6: zh_month[i] = '六月';break;\r\n\t\t\tcase 7: zh_month[i] = '七月';break;\r\n\t\t\tcase 8: zh_month[i] = '八月';break;\r\n\t\t\tcase 9: zh_month[i] = '九月';break;\r\n\t\t\tcase 10: zh_month[i] = '十月';break;\r\n\t\t\tcase -1:  //对于跨年时计算，当前月是1月或2月时需要进行 -1和 0的判断\r\n\t\t\tcase 11: zh_month[i] = '十一月';break;\r\n\t\t\tcase 0:\r\n\t\t\tcase 12: zh_month[i] = '十二月';break;\r\n\t\t\tdefault: break;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfor(var i = 0; i < productsnum; i++) {\r\n\t\tthreeMonthRate[i].ThreeMonthYield\r\n\t\t\r\n\t    var data = new Array(3);\r\n\t    var outputRate = new Array(3);\r\n\t    for(var j=0 ; j < 3; j++){\r\n\t    \tdata[j]=threeMonthRate[i].ThreeMonthRate[j].yield*100;\r\n\t    \toutputRate[j]=threeMonthRate[i].ThreeMonthRate[j].outputrate*100;\r\n\t    }\r\n\t    if(i===0){\r\n\t        grids.push({\r\n\t            left:'4%',\r\n\t            show: true,\r\n\t            borderWidth: 0,\r\n\t            backgroundColor: '#fff',\r\n\t            shadowColor: 'rgba(0, 0, 0, 0.3)',\r\n\t            shadowBlur: 1,\r\n\t            height:'70%',\r\n\t            top:'20%',\t            \r\n\t            width: (1/productsnum*(100-4))+'%',\r\n\t            //右边距right的位置：左边100先减去第一个左移的4%，再减去宽度 (1/productsnum*(100-4))+'%'\r\n\t            right: ((100-4)-(1/productsnum*(100-4)))+'%' \r\n\t        });\r\n\t    }else{\r\n\t        grids.push({\r\n\t            left:((4)+(i)/productsnum*(100-4))+'%',//除去第一个左边距的4%,剩余渐分都以96%进行分割\r\n\t            show: true,\r\n\t            borderWidth: 0,\r\n\t            backgroundColor: '#fff',\r\n\t            shadowColor: 'rgba(0, 0, 0, 0.3)',\r\n\t            shadowBlur: 1,\r\n\t            height:'70%',\r\n\t            top:'20%',\r\n\t            Width: (1/productsnum*(100-4))+'%',\r\n\t        \t//右边距right的位置：左边100%先减去第一个左移的4%，再减去96%为起始的该grid的左边距(i/productsnum*(100-4))，再减去宽度 (1/productsnum*(100-4))+'%'\r\n\t            right:((100-4)-(i/productsnum*(100-4))-(1/productsnum*(100-4)))+'%'\r\n\t        });\r\n\t    }\r\n\t    titles.push({\r\n\t    \ttext:'最近三个月各产品良率和出货率变化趋势'\r\n            ,left:'0%'\r\n            ,top:'6%'\r\n\t    });\r\n\r\n\r\n\t    xAxes.push({\r\n\t        gridIndex:i,\r\n\t            type : 'category',\r\n\t            data : zh_month,\r\n\t            axisTick: {\r\n\t                alignWithLabel: false\r\n\t            },\r\n\t            textStyle: {\r\n\t                fontSize: 20,\r\n\t                color: 'red'\r\n\t            },\r\n\t            axisLabel:{\r\n\t                show:true,\r\n\t                interval:0,\r\n\t                rotate: monthRorate,\r\n\t                margin: 4,\r\n\t                fontSize: monthFontSize\r\n\t            },\r\n\t            position:'bottom'\r\n\t            \r\n\t    });\r\n\t    xAxes.push({ //给每个Grid 底部设置一个产品的名字\r\n\t        gridIndex:i,\r\n\t            type : 'category',\r\n\t            position:'bottom',\r\n\t            name: productnames[i], //设置产品名字\r\n\t            nameLocation: 'center', //产品名字居中对齐\r\n\t            nameTextStyle: {\r\n                   fontWeight: 'bold'  //产品名字粗体\r\n                },\r\n                nameGap: -5,\r\n\t            offset: 40, //坐标轴线偏移量\r\n\t            data: [''], // 设置该坐标轴只有一个刻度\r\n\t            axisTick: {\r\n                   length: 40, //坐标轴刻度线(与坐标轴成垂直)显示的长度\r\n                   inside: true, //坐标轴刻度线向内侧（向上）显示：true\r\n                   show: true //坐标轴刻度线显示与否\r\n                },\r\n                axisLabel: {\r\n                   inside: false,\r\n                   show: true //坐标轴刻度标签显示与否\r\n                },\r\n                axisLine: {\r\n                    show: false, //坐标轴线显示与否\r\n                    onZero: false\r\n                }\r\n\t    });\r\n\r\n\t    if(i==0){\r\n\t        yAxes.push({\r\n\t            gridIndex:i,\r\n\t            type : 'value',\r\n\t            interval:20,\r\n\t            max:100,\r\n\t            min:0,\r\n\t            axisTick:{\r\n\t                inside:false\r\n\t            },\r\n\t            name : '百分比 (%)',\r\n\t \t        axisLabel : {\r\n\t \t                show:true,\r\n\t \t                formatter: '{value} '\r\n\t \t            },\r\n\t \t        position: 'left'\r\n\t \t        \r\n\t        });\r\n\t    }else{\r\n\t        yAxes.push({\r\n\t            gridIndex:i,\r\n\t            type : 'value',\r\n\t            interval:20,\r\n\t            max:100,\r\n\t            min:0,\r\n\t            axisTick:{//坐标轴刻度线\r\n\t                show:false\r\n\t            },\r\n\t            axisLine:{\r\n\t                show:false,\r\n\t                onZero: true\r\n\t            },\r\n\t            axisLabel:{\r\n\t                show:false\r\n\t            }\r\n\t        });\r\n\t    }\r\n\t    series.push({\r\n\t        xAxisIndex: i*2,\r\n\t        yAxisIndex: i,\r\n\t        name:'良率',\r\n\t        type:'line',\r\n\t        //barWidth: '60%',\r\n\t        data:data,\r\n\t        markLine: {\r\n\t            data: [\r\n\t                {type: 'average', name: '良率均值'}\r\n\t            ]\r\n\t        }\r\n//\t        ,itemStyle:itemStyle\r\n\t    });\r\n\t    series.push({\r\n\t        xAxisIndex: i*2,\r\n\t        yAxisIndex: i,\r\n\t        name:'出货率',\r\n\t        type:'line',\r\n\t        //barWidth: '60%',\r\n\t        data:outputRate,\r\n\t        markLine: {\r\n\t            data: [\r\n\t                {type: 'average', name: '出货率均值'}\r\n\t            ]\r\n\t        }\r\n//\t        ,itemStyle:itemStyle\r\n\t    });\r\n\t    \r\n\t}\r\n\t\r\nmyChart.on('legendselectchanged', function(params){\r\n\tvar option1 = myChart.getOption();\r\n\t//重新选择yAxis的最小值，尽量将刻度值精细化\r\n\tvar minall = 100;\r\n\tvar selected = params.selected;  //记录哪些legend对象被选择\r\n\tfor(var b=0 ; b<option1.series.length; b++){\r\n\t\t//遍历series\r\n\t    var minm = 100;\r\n\t\tfor ( var name in selected) {//遍历legend对象\r\n\t\t\tif(selected[name] && option1.series[b].name == name ) {\r\n\t\t\t\tfor(var c=0; c<option1.series[b].data.length;c++) {\r\n\t\t\t\t\tif(option1.series[b].data[c]>0){\r\n\t\t\t\t\t\tif(minm>option1.series[b].data[c])\r\n\t\t\t\t\t\t\tminm=option1.series[b].data[c];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak; //当发现存在之后，可跳出本次拨乱循环\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(minall > minm) minall = minm;\r\n\t}\r\n\tfor(var e=0 ; e<option1.series.length; e++){\r\n\t\toption1.yAxis[option1.series[e].yAxisIndex].min=Math.floor((minall-1)/2)*2>0?Math.floor((minall-1)/2)*2:0;\r\n\t}\r\n\tmyChart.setOption(option1);\r\n});\t\t\r\n\r\noption = {\r\n\t    title:titles,\r\n\t    tooltip : {\r\n\t        trigger: 'axis',\r\n\t        axisPointer : {            // 坐标轴指示器，坐标轴触发有效\r\n\t            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'\r\n\t        }\r\n\t    },\r\n\t    legend: {\r\n\t        data : ['良率','出货率'],\r\n\t        top:'10%'\r\n\t    },\r\n\t    toolbox: {\r\n\t        top: '10%',\r\n\t        show: true,\r\n\t        feature: {\r\n\t            dataView: {readOnly: false},\r\n\t            magicType: {type: ['line','bar']},\r\n\t            restore: {title:'Refresh'},\r\n\t            saveAsImage: {title:'Save'}\r\n\t        }\r\n\t    },\r\n\t    grid : grids,\r\n\t    xAxis : xAxes,\r\n\t    yAxis : yAxes,\r\n\t    series : series\r\n};\r\nvar minall = 100;\r\nfor(var b=0 ; b<option.series.length; b++){\r\n//遍历series\r\n\r\n    var minm = 100;\r\n\tfor(var c=0; c<option.series[b].data.length;c++) {\r\n\t\tif(option.series[b].data[c]>0){\r\n\t\t\tif(minm>option.series[b].data[c])\r\n\t\t\t\tminm=option.series[b].data[c];\r\n\t\t\t}\r\n\t\t}\t\r\n\tif(minall > minm) minall = minm;\r\n}\r\n\t\r\nfor(var b=0 ; b<option.series.length; b++){\r\n\toption.yAxis[option.series[b].yAxisIndex].min=Math.floor((minall-1)/2)*2>0?Math.floor((minall-1)/2)*2:0;\r\n\toption.yAxis[option.series[b].yAxisIndex].interval = (100 -option.yAxis[option.series[b].yAxisIndex].min)/5\r\n}","html":"","externalScripts":"","updaterUID":"bd-1493481016","theme":"","layout":"","viewCount":255,"userName":"i***a","commentCount":0,"starCount":1,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xzvJRPTvMR.png?v=1546480859680","isCustomThumbnail":0,"builtinTags":["category-work","grid","legend","markLine","series-line","title","toolbox","tooltip"],"customTags":[],"updaterUserName":"i***a"}}