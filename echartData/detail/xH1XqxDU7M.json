{"status":0,"data":{"cid":"xH1XqxDU7M","authorUid":"bd-3778831175","authorUserName":"m***i","title":"Taxi routes of Cape Town  ---maptalks","description":"copy from @pissang","latestVersion":7,"alwaysLatest":1,"createTime":"2017-12-31T13:05:15.000Z","lastUpdateTime":"2017-12-31T13:05:15.000Z","auth":2,"uid":"bd-3778831175","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":7,"parentVersion":6,"echartsVersion":"4.1.0","versionCreateTime":"2019-01-09T10:35:20.000Z","code":"var ENCODE_SCALE = 1e6;\n\nfunction decodeLine(line) {\n\n    var result = [];\n    var prevX = line[0];\n    var prevY = line[1];\n\n    for (var i = 0; i < line[2].length; i += 2) {\n        var x = line[2].charCodeAt(i) - 64;\n        var y = line[2].charCodeAt(i + 1) - 64;\n        // ZigZag decoding\n        x = (x >> 1) ^ (-(x & 1));\n        y = (y >> 1) ^ (-(y & 1));\n        // Delta deocding\n        x += prevX;\n        y += prevY;\n\n        prevX = x;\n        prevY = y;\n        // Dequantize\n        result.push([x / ENCODE_SCALE, y / ENCODE_SCALE, 10]);\n    }\n\n    return result;\n}\n\nvar geoJSON = {\n    features: []\n};\nvar regions = [];\nvar readShp = new Promise(function(resolve, reject) {\n    shapefile.open('/asset/get/s/data-1498751177695-rkzAeiGEb.shp', '/asset/get/s/data-1498751184605-rJYAxjMVW.dbf')\n        .then(source => source.read()\n            .then(function append(result) {\n                if (result.done) {\n                    resolve();\n                    return;\n                }\n                var feature = result.value;\n                feature.properties.name = geoJSON.features.length + '';\n                regions.push({\n                    name: geoJSON.features.length + '',\n                    value: 1,\n                    height: feature.properties.SHAPE_leng * 10000\n                })\n                geoJSON.features.push(feature);\n                return source.read().then(append);\n            })\n        );\n});\nmyChart.showLoading();\nPromise.all([$.getJSON('/asset/get/s/data-1498751206824-HkkgZsfEW.json'), readShp])\n    .then(function([data, lastFeature]) {\n        var lines = data.map(function(track) {\n            return {\n                coords: decodeLine(track)\n            };\n        });\n        myChart.hideLoading();\n        echarts.registerMap('buildings', geoJSON);\n        myChart.setOption({\n            maptalks3D: {\n                center: [18.424552361777955, -33.92188144682616],\n                zoom: 15,\n                pitch: 50,\n                bearing: -10,\n                altitudeScale: 2,\n                urlTemplate: 'http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',\n                postEffect: {\n                    enable: true,\n                    screenSpaceAmbientOcclusion: {\n                        enable: true,\n                        intensity: 1.2,\n                        radius: 6,\n                        quality: 'high'\n                    },\n                    screenSpaceReflection: {\n                        enable: true\n                    }\n                },\n                light: {\n                    main: {\n                        intensity: 1,\n                        shadow: true,\n                        shadowQuality: 'high'\n                    },\n                    ambient: {\n                        intensity: 0.\n                    },\n                    ambientCubemap: {\n                        texture: '/asset/get/s/data-1491838644249-ry33I7YTe.hdr',\n                        exposure: 1,\n                        diffuseIntensity: 0.5,\n                        specularIntensity: 2\n                    }\n                }\n            },\n            series: [{\n                type: 'lines3D',\n                coordinateSystem: 'maptalks3D',\n                effect: {\n                    show: true,\n                    constantSpeed: 5,\n                    trailWidth: 2,\n                    trailLength: 0.8,\n                    trailOpacity: 1,\n                    spotIntensity: 10\n                },\n                blendMode: 'lighter',\n                polyline: true,\n                lineStyle: {\n                    width: 0.1,\n                    color: 'rgb(200, 40, 0)',\n                    opacity: 0.\n                },\n                data: lines\n            }, {\n                type: 'map3D',\n                map: 'buildings',\n                coordinateSystem: 'maptalks3D',\n                shading: 'realistic',\n                silent: true,\n                instancing: true,\n                data: regions,\n                realisticMaterial: {\n                    metalness: 1,\n                    roughness: 0.2,\n                }\n            }]\n        });\n    });\n\nwindow.addEventListener('resize', function() {\n    myChart.resize();\n});","html":"","externalScripts":"https://cdn.jsdelivr.net/npm/maptalks@0.39.3/dist/maptalks.min.js,https://cdn.bootcss.com/echarts/4.1.0/echarts.min.js,https://deyihu.github.io/src/lib/echarts-gl.1.1.3.js?tdsourcetag=s_pctim_aiomsg,https://cdn.bootcss.com/jquery/2.0.3/jquery.min.js,https://unpkg.com/shapefile@0.6.6/dist/shapefile.js","updaterUID":"bd-3778831175","theme":"","layout":"","viewCount":1061,"userName":"m***i","commentCount":1,"starCount":6,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xH1XqxDU7M.png?v=1514725516934","isCustomThumbnail":1,"builtinTags":["category-work","maptalks3D","series-lines3D","series-map3D"],"customTags":[],"updaterUserName":"m***i"}}