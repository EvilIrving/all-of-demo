{"status":0,"data":{"cid":"xxQYhjSh81","authorUid":"obd-oFg6PrVkfIgGwHpIf0WU7KQbEZGab5M","authorUserName":"带***飞","title":"map地图+气泡散点图+带排名的柱状图+拼音显示省份名称","description":"怎么用ECharts绘制带排名的柱状图以及在ECharts地图上绘制气泡散点图、带涟漪动画的散点图？","latestVersion":3,"alwaysLatest":1,"createTime":"2020-07-16T03:31:14.000Z","lastUpdateTime":"2020-07-16T03:31:14.000Z","auth":2,"uid":"obd-oFg6PrVkfIgGwHpIf0WU7KQbEZGab5M","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.8.0","versionCreateTime":"2020-07-16T03:38:48.000Z","code":"var name_title = \"Top Province of Total Population in China\";\r\nvar subname = '虚拟数据(随便写的)'\r\nvar nameColor = '#4444FF';\r\nvar name_fontFamily = '等线';\r\nvar name_fontSize = 25;\r\nvar subname_fontSize = 15;\r\nvar mapName = 'china';\r\n// 随便编的数据\r\nvar data = [{\r\n        'name': '北京',\r\n        'value': 1314\r\n    },\r\n    {\r\n        'name': '天津',\r\n        'value': 314\r\n    },\r\n    {\r\n        'name': '河北',\r\n        'value': 1628\r\n    },\r\n    {\r\n        'name': '山西',\r\n        'value': 314\r\n    },\r\n    {\r\n        'name': '内蒙古',\r\n        'value': 156\r\n    },\r\n    {\r\n        'name': '辽宁',\r\n        'value': 687\r\n    },\r\n    {\r\n        'name': '吉林',\r\n        'value': 520\r\n    },\r\n    {\r\n        'name': '黑龙江',\r\n        'value': 441\r\n    },\r\n    {\r\n        'name': '上海',\r\n        'value': 1212\r\n    },\r\n    {\r\n        'name': '江苏',\r\n        'value': 2999\r\n    },\r\n    {\r\n        'name': '浙江',\r\n        'value': 2102\r\n    },\r\n    {\r\n        'name': '安徽',\r\n        'value': 717\r\n    },\r\n    {\r\n        'name': '福建',\r\n        'value': 689\r\n    },\r\n    {\r\n        'name': '江西',\r\n        'value': 654\r\n    },\r\n    {\r\n        'name': '山东',\r\n        'value': 2431\r\n    },\r\n    {\r\n        'name': '河南',\r\n        'value': 1014\r\n    },\r\n    {\r\n        'name': '湖北',\r\n        'value': 715\r\n    },\r\n    {\r\n        'name': '湖南',\r\n        'value': 515\r\n    },\r\n    {\r\n        'name': '广东',\r\n        'value': 3841\r\n    },\r\n    {\r\n        'name': '广西',\r\n        'value': 355\r\n    },\r\n    {\r\n        'name': '海南',\r\n        'value': 874\r\n    },\r\n    {\r\n        'name': '重庆',\r\n        'value': 697\r\n    },\r\n    {\r\n        'name': '四川',\r\n        'value': 610\r\n    },\r\n    {\r\n        'name': '贵州',\r\n        'value': 254\r\n    },\r\n    {\r\n        'name': '云南',\r\n        'value': 647\r\n    },\r\n    {\r\n        'name': '西藏',\r\n        'value': 56\r\n    },\r\n    {\r\n        'name': '陕西',\r\n        'value': 650\r\n    },\r\n    {\r\n        'name': '甘肃',\r\n        'value': 164\r\n    },\r\n    {\r\n        'name': '青海',\r\n        'value': 221\r\n    },\r\n    {\r\n        'name': '宁夏',\r\n        'value': 124\r\n    },\r\n    {\r\n        'name': '新疆',\r\n        'value': 78\r\n    },\r\n    {\r\n        'name': '香港',\r\n        'value': 0\r\n    },\r\n    {\r\n        'name': '澳门',\r\n        'value': 0\r\n    },\r\n    {\r\n        'name': '台湾',\r\n        'value': 0\r\n    }\r\n];\r\n// var dom1 = document.getElementById(\"myChart\");\r\n// var myChart = echarts.init(dom1);\r\n/*获取地图数据*/\r\nmyChart.showLoading();\r\nvar mapFeatures = echarts.getMap(mapName).geoJson.features;\r\nmyChart.hideLoading();\r\nvar geoCoordMap = {};\r\nmapFeatures.forEach(function(v) {\r\n    // 地区名称\r\n    var name = v.properties.name;\r\n    // 地区经纬度\r\n    geoCoordMap[name] = v.properties.cp;\r\n\r\n});\r\n// 用于处理effectScatter气泡散点图，气泡的大小\r\nvar max = 4000,\r\n    min = 10;\r\nvar maxSize4Pin = 100,\r\n    minSize4Pin = 20;\r\n// 柱状图数据处理\r\nvar yData = [];\r\nvar barData = data.filter(function(item) {\r\n    return item.value > 0;\r\n});\r\nbarData = barData.sort(function(a, b) {\r\n    return b.value - a.value;\r\n});\r\nfor (var j = 0; j < barData.length; j++) {\r\n    if (j < 10) {\r\n        yData.push('0' + j + barData[j].name);\r\n    } else {\r\n        yData.push(j + barData[j].name);\r\n    }\r\n}\r\n// ECharts配置\r\nvar option = {\r\n    // 标题\r\n    title: {\r\n        text: name_title,\r\n        subtext: subname,\r\n        left: '300',\r\n        top: 30,\r\n        textStyle: {\r\n            color: nameColor,\r\n            fontFamily: name_fontFamily,\r\n            fontSize: name_fontSize\r\n        },\r\n        subtextStyle: {\r\n            fontSize: subname_fontSize,\r\n            fontFamily: name_fontFamily\r\n        }\r\n    },\r\n    // 提示框信息\r\n    tooltip: {\r\n        trigger: 'item',\r\n        formatter: function(params) {\r\n            var toolTiphtml = '';\r\n            if (params.name === '南海诸岛') {\r\n                toolTiphtml = '';\r\n            } else if (typeof(params.value)[2] === \"undefined\") {\r\n                toolTiphtml = params.value === 0 ? '' : (transferProvinceName(params.name) + ': ' + params.value);\r\n            } else {\r\n                toolTiphtml = transferProvinceName(params.name) + ': ' + params.value[2];\r\n            }\r\n            return toolTiphtml;\r\n        }\r\n    },\r\n    // 视觉映射，数据范围Low--High\r\n    visualMap: {\r\n        show: true,\r\n        min: 0,\r\n        max: 4500,\r\n        left: 'left',\r\n        top: 'bottom',\r\n        text: ['High', 'Low'], // 文本，默认为数值文本\r\n        calculable: true,\r\n        seriesIndex: [1],\r\n        // 数据颜色范围，值越大颜色越深\r\n        inRange: {\r\n            color: ['#EFEFFF', '#4444FF']\r\n        }\r\n    },\r\n    grid: {\r\n        right: 25,\r\n        top: 80,\r\n        bottom: 20,\r\n        width: '200'\r\n    },\r\n    xAxis: {\r\n        show: false\r\n    },\r\n    yAxis: {\r\n        type: 'category',\r\n        inverse: true,\r\n        nameGap: 16,\r\n        axisLine: {\r\n            show: false,\r\n            lineStyle: {\r\n                color: '#ddd'\r\n            }\r\n        },\r\n        axisTick: {\r\n            show: false,\r\n            lineStyle: {\r\n                color: '#ddd'\r\n            }\r\n        },\r\n        // Y轴刻度标签，富文本展示\r\n        axisLabel: {\r\n            interval: 0,\r\n            margin: 105,\r\n            textStyle: {\r\n                align: 'left',\r\n                fontSize: 14\r\n            },\r\n            rich: {\r\n                // 前三名, 序号颜色\r\n                a: {\r\n                    color: '#fff',\r\n                    backgroundColor: '#f0515e',\r\n                    width: 20,\r\n                    height: 20,\r\n                    align: 'center',\r\n                    borderRadius: 2\r\n                },\r\n                // 第四名之后, 序号颜色\r\n                b: {\r\n                    color: '#fff',\r\n                    backgroundColor: '#24a5cd',\r\n                    width: 20,\r\n                    height: 20,\r\n                    align: 'center',\r\n                    borderRadius: 2\r\n                },\r\n                // 前三名, 文字颜色\r\n                x: {\r\n                    color: '#f0515e'\r\n                },\r\n                // 第四名之后, 文字颜色\r\n                y: {\r\n                    color: '#24a5cd'\r\n                }\r\n            },\r\n            // 处理前三名, 及其他的标签\r\n            formatter: function(params) {\r\n                if (parseInt(params.slice(0, 2)) < 3) {\r\n                    return [\r\n                        '{a|' + (parseInt(params.slice(0, 2)) + 1) + '}' + '  ' + '{x|' + transferProvinceName(params.slice(2)) + '}'\r\n                    ].join('\\n')\r\n                } else {\r\n                    return [\r\n                        '{b|' + (parseInt(params.slice(0, 2)) + 1) + '}' + '  ' + '{y|' + transferProvinceName(params.slice(2)) + '}'\r\n                    ].join('\\n')\r\n                }\r\n            }\r\n        },\r\n        data: yData\r\n    },\r\n    // 地理坐标系组件,绘制地图,散点图等\r\n    geo: {\r\n        show: true,\r\n        map: mapName,\r\n        top: 100,\r\n        left: 'left',\r\n        right: '350',\r\n        label: {\r\n            normal: {\r\n                show: false\r\n            },\r\n            emphasis: {\r\n                show: false,\r\n            }\r\n        },\r\n        roam: true,\r\n        itemStyle: {\r\n            // 地图hover颜色\r\n            // emphasis: {\r\n            //   areaColor: '#4444FF',\r\n            // }\r\n        },\r\n        //是否显示南海诸岛\r\n        regions: [{\r\n            name: \"南海诸岛\",\r\n            value: 0,\r\n            itemStyle: {\r\n                normal: {\r\n                    areaColor: '#EFEFFF',\r\n                    // opacity为0不绘制该图形\r\n                    opacity: 1,\r\n                    label: {\r\n                        show: false\r\n                    },\r\n                }\r\n            }\r\n        }],\r\n    },\r\n    series: [\r\n        // 散点图, 蓝色的点\r\n        {\r\n            name: '散点图',\r\n            type: 'scatter',\r\n            coordinateSystem: 'geo',\r\n            data: convertData(data),\r\n            symbolSize: function(val) {\r\n                return val[2] / 100;\r\n            },\r\n            label: {\r\n                normal: {\r\n                    formatter: function(obj) {\r\n                        let name = transferProvinceName(obj.name);\r\n                        return name || '';\r\n                    },\r\n                    position: 'right',\r\n                    show: true\r\n                },\r\n                emphasis: {\r\n                    show: true\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    color: '#4444FF'\r\n                }\r\n            }\r\n        },\r\n        // 地图\r\n        {\r\n            type: 'map',\r\n            map: mapName,\r\n            geoIndex: 0,\r\n            aspectScale: 0.75, // 地图长宽比\r\n            showLegendSymbol: false,\r\n            label: {\r\n                normal: {\r\n                    show: true\r\n                },\r\n                emphasis: {\r\n                    show: false,\r\n                    textStyle: {\r\n                        color: '#fff'\r\n                    }\r\n                }\r\n            },\r\n            roam: true,\r\n            // itemStyle: {\r\n            //   normal: {\r\n            //     areaColor: '#031525',\r\n            //     borderColor: '#3B5077',\r\n            //   },\r\n            //   emphasis: {\r\n            //     areaColor: '#2B91B7'\r\n            //   }\r\n            // },\r\n            animation: false,\r\n            data: data\r\n        },\r\n        // 气泡散点图，红色气泡\r\n        {\r\n            name: '气泡散点图',\r\n            type: 'scatter',\r\n            coordinateSystem: 'geo',\r\n            // 'circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'\r\n            symbol: 'pin', //气泡\r\n            symbolSize: function(val) {\r\n                // 根据value值，设置symbol大小，根据实际情况自己调整\r\n                if (val[2] === 0) {\r\n                    return 0;\r\n                }\r\n                var a = (maxSize4Pin - minSize4Pin) / (max - min);\r\n                var b = maxSize4Pin - a * max;\r\n                return a * val[2] + b * 1.2;\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    formatter: function(obj) {\r\n                        return obj.data.value[2];\r\n                    },\r\n                    textStyle: {\r\n                        color: '#fff',\r\n                        fontSize: 9,\r\n                    }\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    // 气泡颜色\r\n                    color: '#F62157',\r\n                }\r\n            },\r\n            zlevel: 6,\r\n            data: convertData(data),\r\n        },\r\n        // 前五名，带有涟漪特效动画的散点（气泡）图，黄色\r\n        {\r\n            name: 'Top 5',\r\n            type: 'effectScatter',\r\n            coordinateSystem: 'geo',\r\n            data: convertData(data.sort(function(a, b) {\r\n                return b.value - a.value;\r\n            }).slice(0, 5)),\r\n            symbolSize: function(val) {\r\n                return val[2] / 120;\r\n            },\r\n            showEffectOn: 'render',\r\n            rippleEffect: {\r\n                brushType: 'stroke'\r\n            },\r\n            hoverAnimation: true,\r\n            label: {\r\n                normal: {\r\n                    formatter: function(obj) {\r\n                        let name = transferProvinceName(obj.name);\r\n                        return name || '';\r\n                    },\r\n                    position: 'right',\r\n                    show: false\r\n                }\r\n            },\r\n            itemStyle: {\r\n                normal: {\r\n                    color: 'yellow',\r\n                    shadowBlur: 10,\r\n                    shadowColor: 'yellow'\r\n                }\r\n            },\r\n            zlevel: 1\r\n        },\r\n        // 柱状图\r\n        {\r\n            name: '柱状图',\r\n            type: 'bar',\r\n            roam: false,\r\n            visualMap: false,\r\n            barMaxWidth: 20,\r\n            zlevel: 2,\r\n            barGap: 0,\r\n            itemStyle: {\r\n                normal: {\r\n                    // 柱状图，渐变色\r\n                    color: function(params) {\r\n                        var colorList = [{\r\n                                colorStops: [{\r\n                                    offset: 0,\r\n                                    color: '#f0515e'\r\n                                }, {\r\n                                    offset: 1,\r\n                                    color: '#ef8554'\r\n                                }]\r\n                            },\r\n                            {\r\n                                colorStops: [{\r\n                                    offset: 0,\r\n                                    color: '#3c38e4'\r\n                                }, {\r\n                                    offset: 1,\r\n                                    color: '#24a5cd'\r\n                                }]\r\n                            }\r\n                        ];\r\n                        if (params.dataIndex < 3) {\r\n                            return colorList[0]\r\n                        } else {\r\n                            return colorList[1]\r\n                        }\r\n                    },\r\n                },\r\n                // 柱状图hover颜色\r\n                emphasis: {\r\n                    color: \"#f0515e\"\r\n                },\r\n            },\r\n            label: {\r\n                normal: {\r\n                    show: true,\r\n                    position: 'right',\r\n                    textBorderWidth: 0\r\n                }\r\n            },\r\n            data: barData\r\n        }\r\n    ]\r\n};\r\nmyChart.setOption(option);\r\n\r\n// 将中文省份名称转换为拼音名称\r\nfunction transferProvinceName(name) {\r\n    var provincesPinyin = ['Shanghai', 'Hebei', 'Shanxi', 'Neimenggu', 'Liaoning', 'Jilin', 'Heilongjiang', 'Jiangsu', 'Zhejiang', 'Anhui', 'Fujian', 'Jiangxi', 'Shandong', 'Henan', 'Hubei', 'Hunan', 'Guangdong', 'Guangxi', 'Hainan', 'Sichuan', 'Guizhou', 'Yunnan', 'Xizang', 'Shanxi1', 'Gansu', 'Qinghai', 'Ningxia', 'Xinjiang', 'Beijing', 'Tianjin', 'Chongqing', 'Xianggang', 'Aomen', 'Taiwan'];\r\n    var provincesChinese = ['上海', '河北', '山西', '内蒙古', '辽宁', '吉林', '黑龙江', '江苏', '浙江', '安徽', '福建', '江西', '山东', '河南', '湖北', '湖南', '广东', '广西', '海南', '四川', '贵州', '云南', '西藏', '陕西', '甘肃', '青海', '宁夏', '新疆', '北京', '天津', '重庆', '香港', '澳门', '台湾'];\r\n    var pinyinName = provincesPinyin[provincesChinese.indexOf(name)];\r\n    return pinyinName || '';\r\n}\r\n\r\n// 用于处理散点图数据\r\nfunction convertData(data) {\r\n    var res = [];\r\n    for (var i = 0; i < data.length; i++) {\r\n        var geoCoord = geoCoordMap[data[i].name];\r\n        if (geoCoord) {\r\n            res.push({\r\n                name: data[i].name,\r\n                value: geoCoord.concat(data[i].value),\r\n            });\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * 更多示例及完整代码示例下载：GitHub: https://github.com/Jackyyans/code123\r\n * \r\n */\r\n\r\n/**\r\n * 参考：\r\n * https://gallery.echartsjs.com/editor.html?c=xBJDR584vG\r\n * https://gallery.echartsjs.com/editor.html?c=xdExzKlpOh\r\n * \r\n */","html":"","externalScripts":"/dep/echarts/map/js/china.js","updaterUID":"obd-oFg6PrVkfIgGwHpIf0WU7KQbEZGab5M","theme":"","layout":"","viewCount":2447,"userName":"带***飞","commentCount":1,"starCount":8,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xxQYhjSh81.png?v=1594870728613","isCustomThumbnail":0,"builtinTags":["category-work","geo","grid","series-bar","series-effectScatter","series-map","series-scatter","title","tooltip","visualMap"],"customTags":[],"updaterUserName":"带***飞"}}