{"status":0,"data":{"cid":"xoFPcD1cHr","authorUid":"obd-oEy_EUNgOZEBor92UXh4rt8Z_hzq84N","authorUserName":"阳***2","title":"券别库存统计","description":"单位：万元","latestVersion":2,"alwaysLatest":1,"createTime":"2020-05-20T01:26:45.000Z","lastUpdateTime":"2020-05-20T01:26:45.000Z","auth":2,"uid":"obd-oEy_EUNgOZEBor92UXh4rt8Z_hzq84N","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":2,"parentVersion":1,"echartsVersion":"4.7.0","versionCreateTime":"2020-05-20T01:37:59.000Z","code":"var oldData = [{\n        \"COFFERS_NAME\": \"第一金库\",\n        \"DENOMINATION\": \"专用钞\",\n        \"CURRENCY_TYPE\": \"完整券\",\n        \"AMOUNT\": 412.35\n    },{\n        \"COFFERS_NAME\": \"第一金库\",\n        \"DENOMINATION\": \"专用钞\",\n        \"CURRENCY_TYPE\": \"残损券\",\n        \"AMOUNT\": 452.35\n    },{\n        \"COFFERS_NAME\": \"第一金库\",\n        \"DENOMINATION\": \"流通钞\",\n        \"CURRENCY_TYPE\": \"完整券\",\n        \"AMOUNT\": 122.35\n    },{\n        \"COFFERS_NAME\": \"第一金库\",\n        \"DENOMINATION\": \"流通钞\",\n        \"CURRENCY_TYPE\": \"残损券\",\n        \"AMOUNT\": 90.35\n    },{\n        \"COFFERS_NAME\": \"第二金库\",\n        \"DENOMINATION\": \"专用钞\",\n        \"CURRENCY_TYPE\": \"完整券\",\n        \"AMOUNT\": 212.35\n    },{\n        \"COFFERS_NAME\": \"第二金库\",\n        \"DENOMINATION\": \"专用钞\",\n        \"CURRENCY_TYPE\": \"残损券\",\n        \"AMOUNT\": 452.35\n    },{\n        \"COFFERS_NAME\": \"第二金库\",\n        \"DENOMINATION\": \"流通钞\",\n        \"CURRENCY_TYPE\": \"完整券\",\n        \"AMOUNT\": 122.35\n    },{\n        \"COFFERS_NAME\": \"第二金库\",\n        \"DENOMINATION\": \"流通钞\",\n        \"CURRENCY_TYPE\": \"残损券\",\n        \"AMOUNT\": 567.35\n    },{\n        \"COFFERS_NAME\": \"第三金库\",\n        \"DENOMINATION\": \"专用钞\",\n        \"CURRENCY_TYPE\": \"完整券\",\n        \"AMOUNT\": 225.35\n    },{\n        \"COFFERS_NAME\": \"第三金库\",\n        \"DENOMINATION\": \"专用钞\",\n        \"CURRENCY_TYPE\": \"残损券\",\n        \"AMOUNT\": 34.35\n    },{\n        \"COFFERS_NAME\": \"第三金库\",\n        \"DENOMINATION\": \"流通钞\",\n        \"CURRENCY_TYPE\": \"完整券\",\n        \"AMOUNT\": 422.35\n    },{\n        \"COFFERS_NAME\": \"第三金库\",\n        \"DENOMINATION\": \"流通钞\",\n        \"CURRENCY_TYPE\": \"残损券\",\n        \"AMOUNT\": 910.35\n    } \n];\n\nvar datavalue = {\n    source: [\n        ['product'],\n        ['专用钞(完整券)'],\n        ['流通钞(完整券)'],\n        ['流通钞(残损券)'],\n        ['专用钞(残损券)']\n    ]\n};\n\nvar interDate = [\n        ['product'],\n        ['完整券'],\n        ['残损券']\n    ];\n\nvar coffersArr = [];\n\noldData.forEach((item) => {\n    if (coffersArr.indexOf(item.COFFERS_NAME) < 0) {\n        coffersArr.push(item.COFFERS_NAME);\n    }\n});\n/*\nvar datavalue ={\n    source: \n    [\n      [\"product\", \"第一金库\", \"第二金库\", \"第三金库\"], \n      [\"专用钞(完整券)\", 212.35, 212.35, 225.35], \n      [\"流通钞(完整券)\", 122.35, 122.35, 422.35], \n      [\"流通钞(残损券)\", 90.35, 567.35, 910.35], \n      [\"专用钞(残损券)\", 452.35, 452.35, 34.35]\n     ]\n}\nvar interDate = [\n        [\"product\", \"第一金库\", \"第二金库\", \"第三金库\"],\n        [\"完整券\", 334.7, 334.7, 647.7], \n      [\"残损券\", 542.7, 1019.7, 944.7], \n];\n*/\n\n\nfor (let i = 0; i < coffersArr.length; i++) {\n  datavalue.source[0][i + 1] = coffersArr[i];\n  interDate[0][i + 1] = coffersArr[i];\n}\n\nfor (let k = 0; k < oldData.length; k++) {\n    for (let i = 1; i < datavalue.source[0].length; i++) {\n        for (let j = 1; j < datavalue.source.length; j++) {\n            if (datavalue.source[0][i] == oldData[k].COFFERS_NAME &&\n                (datavalue.source[j][0].indexOf(oldData[k].DENOMINATION) != -1) &&\n                (datavalue.source[j][0].indexOf(oldData[k].CURRENCY_TYPE) != -1) ) {\n                datavalue.source[j][i] = oldData[k].AMOUNT;\n            }\n        }\n    }\n    for (var m = 1; m < interDate[0].length; m++) {\n        for (var n = 1; n < interDate.length; n++) {\n            if (interDate[0][m] == oldData[k].COFFERS_NAME &&\n                interDate[n][0] == oldData[k].CURRENCY_TYPE ) {\n                if(interDate[n][m] == \"undefined\" || isNaN(interDate[n][m]) ){\n                    interDate[n][m] = 0;\n                }\n                interDate[n][m] +=  parseFloat(oldData[k].AMOUNT);\n            }\n        }\n    }\n    \n}\n\nsetTimeout(function() {\n    option = {\n        title: {\n            text: '券别库存统计',\n            subtext: '单位：万元',\n            left: '0'\n        },\n        legend: {\n          right: '0',\n          orient: 'vertical',\n        },\n        tooltip: {\n            trigger: 'axis',\n            showContent: true,\n            position: 'outside'\n        },\n        dataset: datavalue,\n        xAxis: {\n            type: 'category'\n        },\n        yAxis: {\n            gridIndex: 0\n        },\n        grid: {\n            top: '55%'\n        },\n        series: [{\n                type: 'line',\n                smooth: true,\n                seriesLayoutBy: 'row'\n            },\n            {\n                type: 'line',\n                smooth: true,\n                seriesLayoutBy: 'row'\n            },\n            {\n                type: 'line',\n                smooth: true,\n                seriesLayoutBy: 'row'\n            },\n            {\n                type: 'line',\n                smooth: true,\n                seriesLayoutBy: 'row'\n            },\n            {\n                name: 'outer',\n                type: 'pie',\n                id: 'outer',\n                radius: ['30%', '20%'],\n                center: ['50%', '30%'],\n                label: {\n                    position: 'outside',\n                    formatter: function(data){\n                        return data.data[1]+'万元';\n                    },\n                },\n                labelLine:{\n                    show: true,\n                    length: 50,\n                },\n                encode: {\n                    itemName: 'product',\n                    value: 1,\n                    tooltip: 1,\n                }\n            },\n            {\n                name: 'inner',\n                type: 'pie',\n                id: 'inner',\n                radius: [0, '15%'],\n                center: ['50%', '30%'],\n                label: {\n                    position: 'inner',\n                    formatter: function(data){\n                        return data.data[0];\n                    }\n                },\n                data: interDate,\n                encode: {\n                    itemName: 'product',\n                    value: 1,\n                    tooltip: 1,\n                }\n            }\n        ]\n    };\n\n    myChart.on('updateAxisPointer', function(event) {\n        var xAxisInfo = event.axesInfo[0];\n        if (xAxisInfo) {\n            var dimension = xAxisInfo.value + 1;\n            myChart.setOption({\n                series: [{\n                    id: 'outer',\n                    label: {\n                        // formatter: '{b}: {@[' + dimension + ']} ({d}%)'\n                        formatter: function(data){\n                            return data.data[dimension]+'万元';\n                        }\n                    },\n                    encode: {\n                        value: dimension,\n                        tooltip: dimension\n                    }\n                },{\n                    id: 'inner',\n                    label: {\n                        // formatter: '{b}: {@[' + dimension + ']} ({d}%)'\n                        formatter: function(data){\n                            return data.data[0];\n                        }\n                    },\n                    encode: {\n                        value: dimension,\n                        tooltip: dimension\n                    }\n                }]\n            });\n        }\n    });\n\n    myChart.setOption(option);\n\n});","html":"","externalScripts":"","updaterUID":"obd-oEy_EUNgOZEBor92UXh4rt8Z_hzq84N","theme":"","layout":"","viewCount":88,"userName":"阳***2","commentCount":0,"starCount":0,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xoFPcD1cHr.png?v=1589938679202","isCustomThumbnail":0,"builtinTags":["category-work","dataset","grid","legend","series-line","series-pie","title","tooltip"],"customTags":[],"updaterUserName":"阳***2"}}