{"status":0,"data":{"cid":"xM-mqAfHSM","authorUid":"bd-154239406","authorUserName":"青春如此的扯1","title":"使用echart绘制北京市朝阳区内部区域细分并自动高亮切换","description":"","latestVersion":3,"alwaysLatest":1,"createTime":"2019-04-15T08:10:56.000Z","lastUpdateTime":"2019-04-15T08:10:56.000Z","auth":2,"uid":"bd-154239406","publishedVersion":0,"forkFrom":"-","isSpam":0,"version":3,"parentVersion":2,"echartsVersion":"4.2.1","versionCreateTime":"2019-04-15T08:18:40.000Z","code":"var uploadedDataURL = \"/asset/get/s/data-1555315257733-csgpAyN4z.json\";\nvar coords = {\n    \"北片\": [\n        [116.3864, 40.0018],\n        [116.4407, 40.0171]\n    ],\n    \"中北片\": [\n        [116.5169, 39.9819],\n        [116.5821, 39.9750]\n    ],\n    \"中南片\": [\n        [116.5100, 39.9250],\n        [116.5855, 39.9060]\n    ],\n    \"南片\": [\n        [116.5011, 39.8333],\n        [116.5402, 39.8660]\n    ],\n    \"外区\": [\n        [116.5965, 40.0565],\n        [116.5903, 40.0807]\n    ],\n\n};\nvar ponitSymbolColors = ['red', 'yellow']; //地图上标记点标记图形的颜色数组\n\n//本地模拟数据\nvar data = [{\n    \"name\": \"北片\",\n    \"info\": [{\n        \"name\": \"其他类\",\n        \"value\": \"407\"\n    }, {\n        \"name\": \"交通事故\",\n        \"value\": \"169\"\n    }]\n}, {\n    \"name\": \"南片\",\n    \"info\": [{\n        \"name\": \"交通事故\",\n        \"value\": \"230\"\n    }, {\n        \"name\": \"其他类\",\n        \"value\": \"608\"\n    }]\n}, {\n    \"name\": \"中北片\",\n    \"info\": [{\n        \"name\": \"其他类\",\n        \"value\": \"674\"\n    }, {\n        \"name\": \"交通事故\",\n        \"value\": \"223\"\n    }]\n}, {\n    \"name\": \"中南片\",\n    \"info\": [{\n        \"name\": \"交通事故\",\n        \"value\": \"141\"\n    }, {\n        \"name\": \"其他类\",\n        \"value\": \"604\"\n    }]\n}]\n\n$.get(uploadedDataURL, function(geoJson) {\n    echarts.registerMap('chaoyang', geoJson, {});\n    var option = {\n        tooltip: {\n            trigger: 'item',\n            formatter: '{b}<br/>'\n        },\n        series: [{\n            name: '朝阳120各分区突发事件统计',\n            type: 'map',\n            // top:100,\n            map: 'chaoyang',\n            aspectScale: 1, //地图长度比,默认0.75\n            label: { //图形上的文本标签---对应json数据上的多边形分区name值\n                normal: { //正常时的样式\n                    show: false,\n                    textStyle: {\n                        // color: '#ef5400',\n                        color: '#333',\n                        fontSize: 18,\n                    }\n                },\n                emphasis: { //高亮时的样式设置\n                    show: true,\n                    textStyle: {\n                        color: 'red',\n                        fontSize: 20,\n                    }\n                }\n            },\n            emphasis: { //高亮状态下的样式---2019-03-22 plq 循环高亮效果添加\n                itemStyle: { //多边形样式\n                    areaColor: \"#36c5d8\",\n                }\n            },\n            data: [{\n                    name: '北部', //只有与json数据上的多边形分区name值对应才可以显示颜色\n                    value: 50, //value值对应颜色映射的取值\n                    itemStyle: {\n                        areaColor: '#0c254d' //区域颜色\n                    }\n                },\n                {\n                    name: '中北',\n                    value: 100,\n                    itemStyle: {\n                        areaColor: '#0c254d '\n                    }\n                },\n                {\n                    name: '中南',\n                    value: 180,\n                    itemStyle: {\n                        areaColor: '#0c254d'\n                    }\n                },\n                {\n                    name: '南部',\n                    value: 220,\n                    itemStyle: {\n                        areaColor: '#0c254d'\n                    }\n                },\n            ],\n            itemStyle: { //地图区域的多边形 图形样式。\n                borderColor: '#fff', //图形的描边颜色\n                borderWidth: 1,\n                borderType: 'dashed',\n            },\n            markPoint: { //默认情况下，标记会居中置放在数据对应的位置，\n                symbol: 'path://m 0,0 h 48 v 20 h -30 l -6,10 l -6,-10 h -6 z',\n                symbolSize: 20,\n                // symbolSize:(rawValue, params) => {   //回调函数实现每个数据图形大小不一样\n                //     params.symbolSize = rawValue*5;\n                //     return params.symbolSize\n                // },\n                itemStyle: { //全局标注样式\n                    // normal: {\n                    //     // color:'#70b218' //貌似标记的颜色只能统一设置一个。。。回调无效？？\n                    // },\n                    emphasis: {\n                        color: '#f16d02',\n                        borderColor: '#fff',\n                        borderWidth: 1\n                    }\n                },\n                label: { //标注的文本。\n                    normal: {\n                        show: true,\n                        position: 'top',\n                        distance: 0,\n                        offset: [0, 2],\n                        // formatter: function (d) { //文本 回调函数格式：(params: Object|Array) => string\n                        //     return d.name + \"\\n\" + d.value + \"起\"\n                        // },\n                        formatter: '{styleA|{b}\\t}{styleB|{c}}',\n                        textStyle: {\n                            fontFamily: '微软雅黑',\n                            align: 'center',\n                            color: '#fff',\n                            // backgroundColor:\"31b573\",\n                            padding: 4,\n                        },\n                        rich: {\n                            styleA: {\n                                fontSize: 18,\n                                // color: \"#4b96ff\",\n                                color: '#fff'\n                            },\n                            styleB: {\n                                fontSize: 20,\n                                color: \"#fff\",\n                                lineHeight: 30,\n                            },\n                        }\n                    }\n                },\n                animation: true, //开启动画\n                data: getMarkPointData(data),\n            },\n        }]\n    };\n    myChart.setOption(option);\n\n    //2019-03-22 plq 区域循环高亮\n    autoDispatchMapAction(myChart, option);\n\n});\n\n//function:解析后台传递的数据，结合经纬度坐标数据及标记图形颜色数组解析成echarts可用数据\nfunction getMarkPointData(data) {\n    var arr = [];\n    for (var i = 0; i < data.length; i++) {\n        for (var j = 0; j < data[i][\"info\"].length; j++) {\n            var obj = {};\n            obj.name = data[i][\"info\"][j][\"name\"];\n            obj.value = data[i][\"info\"][j][\"value\"];\n            obj.coord = coords[data[i][\"name\"]][j];\n            obj.itemStyle = {};\n            obj.itemStyle.color = ponitSymbolColors[j];\n            arr.push(obj);\n        }\n    }\n    console.log(arr);\n    return arr;\n}\n\n//function: 主动触发echarts实例高亮行为，实现高亮自动切换。参数1：echarts实例；参数2：option配置对象\nfunction autoDispatchMapAction(myChart, option) {\n    var app = {\n        currentIndex: -1 //初始数据索引值---通过其指定高亮的某个数据\n    };\n\n    timeId = setInterval(function() {\n        var dataLen = option.series[0].data.length;\n        // 取消之前高亮的图形\n        myChart.dispatchAction({\n            type: 'mapUnSelect', //取消高亮指定的数据图形。\n            seriesIndex: 0, // 可选，系列 index，在 tooltip 的 trigger 为 axis 的时候可选。\n            dataIndex: app.currentIndex // 可选，数据的 index\n        });\n        app.currentIndex = (app.currentIndex + 1) % dataLen;\n        // 高亮当前图形---通过seriesName或者seriesIndex指定系列。通过指定dataIndex或者name再指定某个数据。\n        myChart.dispatchAction({\n            type: 'mapSelect',\n            seriesIndex: 0,\n            dataIndex: app.currentIndex\n        });\n        // 显示 tooltip\n        myChart.dispatchAction({\n            type: 'showTip',\n            seriesIndex: 0, //这行不能省\n            dataIndex: app.currentIndex\n            // name:\"北部\"\n        });\n\n    }, 5000);\n}","html":"","externalScripts":"","updaterUID":"bd-154239406","theme":"","layout":"","viewCount":1161,"userName":"青春如此的扯1","commentCount":0,"starCount":4,"isStared":0,"thumbnailURL":"https://www.makeapie.com/ecg-storage/ec_gallery_thumbnail/xM-mqAfHSM.png?v=1555316320946","isCustomThumbnail":0,"builtinTags":["category-work","markPoint","series-map","tooltip"],"customTags":[],"updaterUserName":"青春如此的扯1"}}