<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ygkj.water.project.mapper.GiveAnAlarmMapper">

    <select id="getTideLevels" resultType="java.util.Map">
        select t.MGSTCD stcd, t.TDZ tdz,TM tm from
        (select MGSTCD, TDZ, TM from ${tableName} where TM &gt;= date_sub(now(), interval 1 day)
        AND MGSTCD IN
        <foreach collection="set" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
         having 1 order by TM desc) t
        group by t.MGSTCD

    </select>

    <select id="getYbTideLevels" resultType="java.util.Map">
        select t.MGSTCD stcd, t.TDZ tdz, YMDH tm from
        (select MGSTCD, TDZ,YMDH  from st_astrotd_r where YMDH &gt;=  DATE_FORMAT(DATE_ADD(NOW(),INTERVAL 1 DAY),'%Y-%m-%d 00:00:00')
        AND MGSTCD IN
        <foreach collection="set" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
        ORDER BY YMDH DESC) t
        group by t.MGSTCD
    </select>

    <select id="getDdStation" resultType="com.alibaba.fastjson.JSONObject">
        SELECT a.waga_code,a.waga_name name,b.stcd FROM att_waga_base a LEFT JOIN sl_proj_st_r b ON a.waga_code = b.project_code AND b.is_main = 1
        WHERE a.del_flag = 0 AND a.waga_code IN
        <foreach collection="prcd" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="getDdStationReal" resultType="com.alibaba.fastjson.JSONObject">
        SELECT a.* FROM (SELECT * FROM ${tableName}
        WHERE TM >= DATE_ADD(NOW(),INTERVAL -2 HOUR)
        AND MGSTCD IN
        <foreach collection="stcd" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
        HAVING 1 ORDER BY TM DESC) a GROUP BY a.MGSTCD
    </select>

    <select id="getPtStation" resultType="com.alibaba.fastjson.JSONObject">
        SELECT a.pust_code,a.pust_name name,b.stcd FROM att_pust_base a LEFT JOIN sl_proj_st_r b ON a.pust_code = b.project_code AND b.is_main = 1
        WHERE a.del_flag = 0  AND a.pust_code IN
        <foreach collection="prcd" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="getPust" resultType="com.alibaba.fastjson.JSONObject">
        SELECT pust_code,pust_name name,pust_type,ins_flow,ins_pow,pump_num,des_head,eng_task,eng_grad,eng_scal FROM att_pust_base
        WHERE del_flag = 0  AND pust_code IN
        <foreach collection="prcd" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="getHistoryMax" resultType="com.alibaba.fastjson.JSONObject">
        select a.* from (
        <foreach collection="tables" item="item" separator="UNION ALL">
            (SELECT mgstcd,stcd, tm, tdz FROM ${item}
            WHERE mgstcd = #{stCode} ORDER BY TDZ DESC,TM ASC LIMIT 1)
        </foreach>
        ) a ORDER BY a.TDZ DESC,a.TM ASC LIMIT 1
    </select>

    <select id="getHistoryMin" resultType="com.alibaba.fastjson.JSONObject">
        select a.* from (
        <foreach collection="tables" item="item" separator="UNION ALL">
            (SELECT mgstcd,stcd, tm, tdz FROM ${item}
            WHERE mgstcd = #{stCode} ORDER BY TDZ,TM ASC LIMIT 1)
        </foreach>
        ) a ORDER BY a.TDZ,a.TM ASC LIMIT 1
    </select>
</mapper>

